{"version":3,"file":"hebe.esm.js","sources":["../src/core/context.js","../src/core/utils.js","../src/ui/CursorController.js","../src/animations/presets.js","../src/animations/lines.js","../src/animations/navigation.js","../src/ui/Badge.js","../src/init/barba.js","../src/features/register.js","../src/features/topic.js","../src/ui/MapController.js","../src/ui/Presence.js","../src/ui/MenuController.js","../src/features/faq.js","../src/features/layout.js","../src/ui/Enochian.js","../src/features/calendar.js","../src/ui/Glossary.js","../src/ui/Notepad.js","../src/init/app.js","../src/main.js"],"sourcesContent":["// modules/context.js\r\n// Refactor du bloc Context de ton menu.js\r\n\r\nconst Context = (function () {\r\n    let hooks = [];\r\n    let currentIndex = 0;\r\n    let container = null;\r\n\r\n    const update = () => {\r\n        console.log(\"Context updated!\");\r\n    };\r\n\r\n    return {\r\n        get container() {\r\n            return container;\r\n        },\r\n        set container(value) {\r\n            container = value;\r\n            currentIndex = 0; // reset index à chaque nouveau container\r\n        },\r\n\r\n        useState(initialValue) {\r\n            const idx = currentIndex++;\r\n            hooks[idx] = hooks[idx] ?? initialValue;\r\n\r\n            const setState = (newValue) => {\r\n                hooks[idx] =\r\n                    typeof newValue === \"function\"\r\n                        ? newValue(hooks[idx])\r\n                        : newValue;\r\n                update();\r\n            };\r\n\r\n            return [hooks[idx], setState];\r\n        },\r\n\r\n        useReducer(reducer, initialState) {\r\n            const idx = currentIndex++;\r\n            hooks[idx] = hooks[idx] ?? initialState;\r\n\r\n            const dispatch = (action) => {\r\n                hooks[idx] = reducer(hooks[idx], action);\r\n                update();\r\n            };\r\n\r\n            return [hooks[idx], dispatch];\r\n        },\r\n\r\n        useEffect(callback, deps) {\r\n            const idx = currentIndex++;\r\n            const prevDeps = hooks[idx];\r\n            const hasNoDeps = !deps;\r\n            const hasChanged = prevDeps\r\n                ? !deps.every((el, i) => el === prevDeps[i])\r\n                : true;\r\n\r\n            if (hasNoDeps || hasChanged) {\r\n                hooks[idx] = deps;\r\n                callback();\r\n            }\r\n        },\r\n    };\r\n})();\r\n\r\nexport default Context;\r\n","export const isElement = (node) =>\r\n    node instanceof Element || node instanceof HTMLDocument;\r\n\r\nexport const qsa = (root, sel) => root.querySelectorAll(sel);\r\nexport const qs = (root, sel) => root.querySelector(sel);\r\n\r\nexport const closest = (el, sel) =>\r\n    el && el.nodeType === 1 ? el.closest(sel) : null;\r\n","import { isElement, closest } from \"../core/utils.js\";\r\n\r\nconst CONFIG = {\r\n    FOLLOW_SIZE: 40,\r\n    EASE: \"power4\",\r\n    DUR: {\r\n        focus: 0.5, // zoom sur l'élément\r\n        shrink: 0.2, // retour à la taille 40\r\n        follow: 0.6, // inertie de suivi\r\n        fade: 300, // show/hide via Element.animate\r\n    },\r\n    SELECTORS: {\r\n        text: \".txt, .txt *:not(dfn, a), .ce-block__content, .ce-block__content *, textarea, input\",\r\n        forum: \".forum, .forum *, .spy, .spy *, dfn\",\r\n        btn: \".btn, .btn *\",\r\n        profileSymbol: \".subject__profileSymbol\",\r\n        barbaContainer: 'section[data-barba=\"container\"]',\r\n        progressPath: \".progress-wrap path\",\r\n        cursor: \"#cursor\",\r\n        cursorFollow: \"#cursorFollow\",\r\n        postbody: \".postbody\",\r\n        forumEl: \".forum\",\r\n        link: \".switcheroo__squircle--button, .switcheroo__squircle--button *, .switcheroo__delete, a[href]:not(.no-cursor):not(:where(.btn *, .spy *)):not(.btn, .spy), a[href]:not(.no-cursor):not(:where(.btn *, .spy *)) *, .marker:not(.temp), .marker:not(.temp) *, .link, .link *\",\r\n        map: \"#map canvas\",\r\n    },\r\n};\r\n\r\nfunction getRectData(el) {\r\n    const rect = el.getBoundingClientRect();\r\n    return { x: rect.left, y: rect.top, w: rect.width, h: rect.height };\r\n}\r\n\r\nfunction setOpacity(el, value) {\r\n    el.animate(\r\n        { opacity: value },\r\n        { duration: CONFIG.DUR.fade, fill: \"forwards\" }\r\n    );\r\n}\r\n\r\nconst CursorController = {\r\n    // ------- refs & state -------\r\n    cursor: document.querySelector(CONFIG.SELECTORS.cursor),\r\n    cursorFollow: document.querySelector(CONFIG.SELECTORS.cursorFollow),\r\n    postbody: document.querySelectorAll(CONFIG.SELECTORS.postbody),\r\n    progressPath: document.querySelector(CONFIG.SELECTORS.progressPath),\r\n    forums: document.querySelectorAll(CONFIG.SELECTORS.forumEl),\r\n\r\n    stopFollow: false,\r\n\r\n    // ------- API -------\r\n    init() {\r\n        this.bindEvents();\r\n        this.bindScroll();\r\n    },\r\n\r\n    // ------- events -------\r\n    bindEvents() {\r\n        document.addEventListener(\"mouseenter\", () => {\r\n            setOpacity(this.cursor, 1);\r\n            setOpacity(this.cursorFollow, 1);\r\n        });\r\n\r\n        document.addEventListener(\"mouseleave\", () => {\r\n            setOpacity(this.cursor, 0);\r\n            setOpacity(this.cursorFollow, 0);\r\n        });\r\n\r\n        document.addEventListener(\"mousemove\", (e) => {\r\n            const { pageX: leftPosition, pageY: topPosition, target } = e;\r\n\r\n            if (!(target instanceof Element)) return;\r\n\r\n            // position du pointeur \"avant-plan\"\r\n            this.cursor.style.left = leftPosition + \"px\";\r\n            this.cursor.style.top = topPosition + \"px\";\r\n\r\n            // badges visuels (texte / oeil)\r\n            this.updateCursorBadges(target);\r\n\r\n            // branchements exacts de l'original\r\n            if (target.matches(CONFIG.SELECTORS.btn)) {\r\n                this.handleBtnFocus(target);\r\n            } else if (target.matches(CONFIG.SELECTORS.profileSymbol)) {\r\n                this.handleProfileSymbolFocus(target);\r\n            } else {\r\n                this.resetFollowSize();\r\n            }\r\n\r\n            // suivre la souris si non figé\r\n            if (!this.stopFollow) {\r\n                this.cursorFollow.classList.remove(\"static\");\r\n                this.cursor.classList.remove(\"hide\");\r\n                gsap.to(this.cursorFollow, {\r\n                    top: topPosition,\r\n                    left: leftPosition,\r\n                    duration: CONFIG.DUR.follow,\r\n                    ease: CONFIG.EASE,\r\n                });\r\n            }\r\n        });\r\n\r\n        // progress sur scroll (container Barba)\r\n        document.addEventListener(\r\n            \"scroll\",\r\n            (e) => {\r\n                if (e.target.dataset.barba === \"container\") {\r\n                    this.updateProgress();\r\n                }\r\n            },\r\n            true\r\n        );\r\n\r\n        document.addEventListener(\r\n            \"pointerleave\",\r\n            (e) => {\r\n                if (!(e.target instanceof Element)) return;\r\n\r\n                const host = e.target.closest(\".btn, .subject__profileSymbol\");\r\n                if (!host) return;\r\n                // si on quitte l'élément mais qu'on reste dans un de ses enfants => on ne fait rien\r\n                if (host.contains(e.relatedTarget)) return;\r\n\r\n                // on force le retour à l'état \"follow\" même si la souris ne bouge plus\r\n                this.stopFollow = false;\r\n\r\n                // retirer tout de suite les classes qui modifient le border-radius\r\n                this.cursorFollow.classList.remove(\"static\", \"large\");\r\n                this.cursor.classList.remove(\"hide\", \"grow\");\r\n\r\n                // arrêter l'animation en cours pour éviter les états mixtes\r\n                gsap.killTweensOf(this.cursorFollow);\r\n                gsap.killTweensOf(this.cursor);\r\n\r\n                // revenir à la taille d'origine ; la position sera gérée par le prochain mousemove\r\n                gsap.to(this.cursorFollow, {\r\n                    width: 40,\r\n                    height: 40,\r\n                    duration: 0.5,\r\n                    ease: \"circ.out\",\r\n                });\r\n            },\r\n\r\n            true\r\n        );\r\n    },\r\n\r\n    // ------- helpers souris -------\r\n    updateCursorBadges(target) {\r\n        // .text\r\n        if (target.matches(CONFIG.SELECTORS.text)) {\r\n            this.cursor.classList.add(\"text\");\r\n        } else {\r\n            this.cursor.classList.remove(\"text\");\r\n        }\r\n\r\n        // .eye\r\n        if (target.matches(CONFIG.SELECTORS.forum)) {\r\n            this.cursor.classList.add(\"eye\");\r\n        } else {\r\n            this.cursor.classList.remove(\"eye\");\r\n        }\r\n\r\n        if (target.matches(CONFIG.SELECTORS.link)) {\r\n            this.cursor.classList.add(\"grow\");\r\n            this.cursorFollow.classList.add(\"large\");\r\n        } else {\r\n            this.cursor.classList.remove(\"grow\");\r\n            this.cursorFollow.classList.remove(\"large\");\r\n        }\r\n\r\n        if (target.matches(CONFIG.SELECTORS.map)) {\r\n            this.cursor.classList.add(\"crosshair\");\r\n            this.cursorFollow.classList.add(\"shrink\");\r\n        } else {\r\n            this.cursor.classList.remove(\"crosshair\");\r\n            this.cursorFollow.classList.remove(\"shrink\");\r\n        }\r\n    },\r\n\r\n    handleBtnFocus(target) {\r\n        this.stopFollow = true;\r\n        const element = target.closest(\".btn\");\r\n        const { x, y, w, h } = getRectData(element);\r\n\r\n        this.cursorFollow.classList.add(\"static\");\r\n\r\n        gsap.to(this.cursorFollow, {\r\n            top: y + h / 2,\r\n            left: x + w / 2,\r\n            width: w,\r\n            height: h,\r\n            duration: CONFIG.DUR.focus,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    handleProfileSymbolFocus(target) {\r\n        this.stopFollow = true;\r\n        const element = target.closest(\".subject__profileSymbol\");\r\n        const { x, y, w, h } = getRectData(element);\r\n\r\n        // NB: fidèle à l’original — pas d'ajout de .static / .hide ici\r\n        gsap.to(this.cursorFollow, {\r\n            top: y + h / 2,\r\n            left: x + w / 2,\r\n            width: w,\r\n            height: h,\r\n            duration: CONFIG.DUR.focus,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    resetFollowSize() {\r\n        this.stopFollow = false;\r\n        gsap.to(this.cursorFollow, {\r\n            width: CONFIG.FOLLOW_SIZE,\r\n            height: CONFIG.FOLLOW_SIZE,\r\n            duration: CONFIG.DUR.shrink,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    // ------- scroll progress -------\r\n    bindScroll() {\r\n        if (!this.progressPath) return; // garde-fou\r\n        const len = this.pathLength();\r\n        this.progressPath.style.strokeDasharray = `${len} ${len}`;\r\n        this.updateProgress();\r\n    },\r\n\r\n    currentContainer() {\r\n        return document.querySelector(CONFIG.SELECTORS.barbaContainer);\r\n    },\r\n\r\n    updateProgress() {\r\n        if (!this.progressPath) return;\r\n        const container = this.currentContainer();\r\n        if (!container) return;\r\n\r\n        const scroll = container.scrollTop;\r\n        const height = container.scrollHeight - window.innerHeight;\r\n        const progress =\r\n            this.pathLength() - (scroll * this.pathLength()) / height;\r\n        this.progressPath.style.strokeDashoffset = progress;\r\n    },\r\n\r\n    // ------- computed -------\r\n    pathLength() {\r\n        return this.progressPath.getTotalLength();\r\n    },\r\n};\r\nexport default CursorController;\r\n","// animations/presets.js\r\nexport const easeCurve = \"M0,0,C0.625,0,0,1,1,1\";\r\n\r\nlet _ease = null;\r\nexport function ensureEase() {\r\n    if (!window.gsap) return null;\r\n    if (_ease) return _ease;\r\n    try {\r\n        if (window.CustomEase) {\r\n            gsap.registerPlugin(CustomEase);\r\n            _ease =\r\n                gsap.parseEase?.(\"custom\") ||\r\n                CustomEase.create(\"custom\", easeCurve);\r\n        }\r\n    } catch {}\r\n    if (!_ease) _ease = \"power4.out\"; // fallback discret\r\n    return _ease;\r\n}\r\n\r\nexport const he = {\r\n    coverFrom: { transform: \"scaleX(0)\" },\r\n    coverTo: { transform: \"scaleX(1)\" },\r\n    coverExitFrom: { left: 0, width: \"100%\" },\r\n    coverExitTo: { left: \"100%\", width: \"0%\" },\r\n    fadeFrom: { autoAlpha: 0 },\r\n    fadeTo: { autoAlpha: 1 },\r\n    fadeUpFrom: { autoAlpha: 0, transform: \"translateY(20px)\" },\r\n    fadeUpTo: { autoAlpha: 1, transform: \"translateY(0)\" },\r\n    growHeightFrom: { height: \"0%\" },\r\n    growHeightTo: { height: \"100%\" },\r\n    growWidthFrom: { width: \"0%\" },\r\n    growWidthTo: { width: \"100%\" },\r\n    fadeFromLeft50From: { autoAlpha: 0, transform: \"translateX(-50%)\" },\r\n    fadeFromLeft50To: { autoAlpha: 1, transform: \"translateX(0)\" },\r\n};\r\n","// animations/lines.js\r\nimport { ensureEase } from \"./presets.js\";\r\n\r\nconst qsa = (root, sel) => root.querySelectorAll(sel);\r\n\r\nexport function animateLinesIn(root = document, onDone) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) {\r\n        onDone?.();\r\n        return;\r\n    }\r\n    const tl = gsap.timeline({ ease, onComplete: onDone });\r\n    qsa(root, \".bb\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.2, delay: i * 0.03 }, \"h\")\r\n    );\r\n    qsa(root, \".br\").forEach((el, i) =>\r\n        tl.to(el, { height: \"100%\", duration: 0.2, delay: i * 0.03 }, \"v\")\r\n    );\r\n    qsa(root, \".bl\").forEach((el, i) =>\r\n        tl.to(el, { height: \"100%\", duration: 0.2, delay: i * 0.03 }, \"v\")\r\n    );\r\n    qsa(root, \".bt\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.2, delay: i * 0.03 }, \"h\")\r\n    );\r\n    qsa(root, \".bg-hash-v\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.4 }, \"h\")\r\n    );\r\n    return tl;\r\n}\r\n\r\nexport function animateLinesOut(root = document, onDone) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) {\r\n        onDone?.();\r\n        return;\r\n    }\r\n    const tl = gsap.timeline({ ease, onComplete: onDone });\r\n    qsa(root, \".br\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                top: i % 2 ? 0 : \"+=100%\",\r\n                height: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"v\"\r\n        )\r\n    );\r\n    qsa(root, \".bl\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                top: i % 2 ? 0 : \"+=100%\",\r\n                height: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"v\"\r\n        )\r\n    );\r\n    qsa(root, \".bb\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                left: i % 2 ? 0 : \"+=100%\",\r\n                width: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"h\"\r\n        )\r\n    );\r\n    qsa(root, \".bg-hash-v\").forEach((el, i) =>\r\n        tl.to(el, { width: \"0%\", duration: 0.4 }, \"h\")\r\n    );\r\n    return tl;\r\n}\r\n","// animations/navigation.js\r\nimport { he, ensureEase } from \"./presets.js\";\r\nimport { qsa, qs } from \"../core/utils.js\";\r\n\r\n// ✅ timeline globale déclarée\r\nlet globalTimeline = null;\r\n\r\nexport const getGlobalTimeline = () => globalTimeline;\r\nexport const setGlobalTimeline = (tl) => (globalTimeline = tl);\r\nexport const clearGlobal = () => {\r\n    globalTimeline = null;\r\n};\r\n\r\nconst has = (list) => list && list.length > 0;\r\n\r\nexport function mapAnimation({ container }) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) return null;\r\n\r\n    const root = qs(document, \"#map\");\r\n    try {\r\n        globalTimeline?.kill();\r\n    } catch {}\r\n\r\n    const tl = gsap.timeline({\r\n        defaults: { duration: 1, ease },\r\n        onReverseComplete: () => {\r\n            clearGlobal();\r\n            container.classList.add(\"onLoad\");\r\n        },\r\n    });\r\n\r\n    const i = qsa(root, \".anim-bg-cover\");\r\n    const r = qsa(root, \".anim-bg\");\r\n    const o = qsa(root, \".anim-fade\");\r\n    const p = qsa(root, \".anim-fadeFromLeft-50\");\r\n    const l = qsa(root, \".anim-fadeUp\");\r\n    const width = qsa(root, \".anim-bb, .anim-bt\");\r\n    const height = qsa(root, \".anim-br, .anim-bl\");\r\n\r\n    const ft = (targets, fromVars, toVars, pos) => {\r\n        if (!has(targets)) return tl;\r\n        return pos !== undefined\r\n            ? tl.fromTo(targets, fromVars, toVars, pos)\r\n            : tl.fromTo(targets, fromVars, toVars);\r\n    };\r\n\r\n    ft(i, he.coverFrom, he.coverTo);\r\n    ft(i, he.coverExitFrom, he.coverExitTo, 0.3);\r\n    ft(r, he.coverFrom, he.coverTo, 0.3);\r\n    ft(o, he.fadeFrom, { ...he.fadeTo, stagger: 0.033 }, 0.4);\r\n    ft(width, he.growWidthFrom, { ...he.growWidthTo, stagger: 0.033 }, 0.4);\r\n    ft(height, he.growHeightFrom, { ...he.growHeightTo, stagger: 0.033 }, 0.4);\r\n\r\n    setGlobalTimeline(tl);\r\n    return tl;\r\n}\r\n\r\nexport function navigationAnimation() {}\r\n\r\nexport function contentsIn(root = document, opts = {}) {\r\n    const items = root.querySelectorAll(\".content, .contents\");\r\n    if (!items || items.length === 0) return null; // évite le warning GSAP si vide\r\n    return gsap.to(items, {\r\n        alpha: 1,\r\n        stagger: 0.03,\r\n        ...opts,\r\n    });\r\n}\r\n\r\nexport function contentsOut(root = document, opts = {}) {\r\n    const items = root.querySelectorAll(\".content, .contents\");\r\n    if (!items || items.length === 0) return null;\r\n    return gsap.to(items, {\r\n        alpha: 0,\r\n        stagger: 0.03,\r\n        ...opts,\r\n    });\r\n}\r\n","// ui/Badge.js\r\n// Badge compteur, fidèle à ton comportement, mais plus robuste à l'init.\r\n\r\nexport default class Badge {\r\n    /**\r\n     * @param {HTMLElement} element  hôte du badge (ex: #menu .notification)\r\n     * @param {Object} options\r\n     */\r\n    constructor(element, options = {}) {\r\n        this.options = {\r\n            badgeClass: \"notification-badge\",\r\n            badgeCounterClass: \"notification-counter\",\r\n            animationSpeed: 150,\r\n            countLimit: 99,\r\n            activeClass: \"notification-badge--active\",\r\n            limitClass: \"notification-badge--limit\",\r\n            ...options,\r\n        };\r\n\r\n        if (!element) {\r\n            console.error(\"[Badge] host element is null/undefined.\");\r\n            return; // no-op, évite les erreurs.\r\n        }\r\n\r\n        this.element = element;\r\n        this.badgeElement = null;\r\n        this.badgeCounterElement = null;\r\n\r\n        // ✅ injecte/recâble systématiquement le markup\r\n        this.renderIfNeeded();\r\n    }\r\n\r\n    /** Injecte le markup si absent et met à jour les refs */\r\n    renderIfNeeded() {\r\n        // cherche un wrapper existant\r\n        let wrapper = this.element.querySelector(\".\" + this.options.badgeClass);\r\n        if (!wrapper) {\r\n            wrapper = document.createElement(\"span\");\r\n            wrapper.className = this.options.badgeClass;\r\n            wrapper.innerHTML = `<span class=\"${this.options.badgeCounterClass}\">0</span>`;\r\n            this.element.appendChild(wrapper);\r\n        }\r\n        this.badgeElement = wrapper;\r\n        this.badgeCounterElement = wrapper.querySelector(\r\n            \".\" + this.options.badgeCounterClass\r\n        );\r\n    }\r\n\r\n    /** Active/désactive et swap la valeur avec petite anim */\r\n    set(n = 0) {\r\n        if (!this.element) return false;\r\n\r\n        // ✅ s’assure que le DOM du badge est présent (au cas où Barba a réhydraté)\r\n        this.renderIfNeeded();\r\n\r\n        if (typeof n !== \"number\" || Number.isNaN(n) || n < 0) {\r\n            console.error(`[Badge] invalid value: ${n}`);\r\n            this.badgeElement?.classList.remove(this.options.activeClass);\r\n            if (this.badgeCounterElement)\r\n                this.badgeCounterElement.textContent = \"\";\r\n            return false;\r\n        }\r\n\r\n        // n == 0 : on “éteint” visuellement\r\n        if (n === 0) {\r\n            this.badgeElement?.classList.remove(this.options.activeClass);\r\n            if (this.badgeCounterElement)\r\n                this.badgeCounterElement.textContent = \"\";\r\n            return false;\r\n        }\r\n\r\n        // état \"limit\"\r\n        if (n > this.options.countLimit) {\r\n            this.badgeElement?.classList.add(this.options.limitClass);\r\n        } else {\r\n            this.badgeElement?.classList.remove(this.options.limitClass);\r\n        }\r\n\r\n        // activer si pas déjà\r\n        if (\r\n            this.badgeElement &&\r\n            !this.badgeElement.classList.contains(this.options.activeClass)\r\n        ) {\r\n            this.badgeElement.classList.add(this.options.activeClass);\r\n        }\r\n\r\n        const oldEl = this.badgeCounterElement;\r\n        if (!oldEl) return false;\r\n\r\n        // si même valeur, assure juste l’état actif et sors\r\n        if (String(oldEl.textContent).trim() === String(n)) {\r\n            return true;\r\n        }\r\n\r\n        const newEl = oldEl.cloneNode(false);\r\n        newEl.textContent = n;\r\n\r\n        // petites classes d’anim (compatibles avec ton CSS)\r\n        newEl.classList.add(this.options.badgeCounterClass + \"--new\");\r\n        oldEl.classList.add(this.options.badgeCounterClass + \"--old\");\r\n\r\n        oldEl.after(newEl);\r\n\r\n        // déclenche l’anim au frame suivant puis nettoie\r\n        requestAnimationFrame(() => {\r\n            newEl.classList.remove(this.options.badgeCounterClass + \"--new\");\r\n            setTimeout(() => {\r\n                try {\r\n                    oldEl.remove();\r\n                } catch {}\r\n                this.badgeCounterElement = newEl;\r\n            }, this.options.animationSpeed);\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    get() {\r\n        const n = parseInt(this.badgeCounterElement?.textContent || \"0\", 10);\r\n        return Number.isNaN(n) ? 0 : n;\r\n    }\r\n\r\n    increase(n = 1) {\r\n        return this.set(this.get() + n);\r\n    }\r\n    decrease(n = 1) {\r\n        return this.set(Math.max(0, this.get() - n));\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.element) return;\r\n        const wrap = this.element.querySelector(\".\" + this.options.badgeClass);\r\n        if (wrap) wrap.remove();\r\n        this.badgeElement = null;\r\n        this.badgeCounterElement = null;\r\n        this.element = null;\r\n    }\r\n}\r\n","// init/barba.js\r\nimport Context from \"../core/context.js\";\r\nimport { animateLinesIn, animateLinesOut } from \"../animations/lines.js\";\r\nimport {\r\n    navigationAnimation,\r\n    contentsIn,\r\n    contentsOut,\r\n} from \"../animations/navigation.js\";\r\n\r\nimport Badge from \"../ui/Badge.js\";\r\n\r\nconst CFG = {\r\n    CONTAINER_SEL: 'section[data-barba=\"container\"]',\r\n    PROGRESS_PATH_SEL: \".progress-wrap path\",\r\n};\r\n\r\nlet _initialized = false;\r\nconst _nsHooks = new Map();\r\n\r\nfunction rebindProgressPath(nextContainer, cursor) {\r\n    if (!cursor || !cursor.progressPath) return;\r\n    const nextPath = nextContainer?.querySelector?.(CFG.PROGRESS_PATH_SEL);\r\n    if (nextPath) cursor.progressPath = nextPath;\r\n    try {\r\n        const len = cursor.pathLength();\r\n        cursor.progressPath.style.strokeDasharray = `${len} ${len}`;\r\n        cursor.updateProgress();\r\n    } catch {}\r\n}\r\n\r\nexport function onNamespace(ns, handlers) {\r\n    _nsHooks.set(ns, { ...(handlers || {}) });\r\n}\r\n\r\nexport function initBarba({ cursor } = {}) {\r\n    if (_initialized) return { destroy };\r\n    _initialized = true;\r\n\r\n    if (!window.barba?.init) {\r\n        console.warn(\r\n            \"[barba] introuvable. Charge @barba/core avant initBarba().\"\r\n        );\r\n        const root = document.querySelector(CFG.CONTAINER_SEL) || document;\r\n        Context.container = root;\r\n        animateLinesIn(root, () => navigationAnimation(root));\r\n        return { destroy };\r\n    }\r\n\r\n    Context.container = document.querySelector(CFG.CONTAINER_SEL) || document;\r\n\r\n    const menu = document.getElementById(\"menu\");\r\n    const host = menu?.querySelector(\".notification\");\r\n    const notificationBadge = new Badge(host);\r\n\r\n    barba.init({\r\n        prevent: ({ el }) => el?.hasAttribute?.(\"data-barba-prevent\"),\r\n        transitions: [\r\n            {\r\n                name: \"lines-and-reveal\",\r\n\r\n                beforeOnce(data) {\r\n                    const done = this.async();\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.beforeOnce?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:beforeOnce ns]\", e);\r\n                    }\r\n                    animateLinesIn(data.next.container, done);\r\n                    notificationBadge.set(5);\r\n                },\r\n\r\n                once(data) {\r\n                    console.debug(\"[barba] once ns=\", data?.next?.namespace);\r\n\r\n                    // 🔗 appeler les hooks namespace au premier load\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.once?.(data); // si tu en as un\r\n                        h?.afterEnter?.(data); // mime afterEnter au 1er load\r\n                    } catch (e) {\r\n                        console.error(\"[barba:once ns hook]\", e);\r\n                    }\r\n\r\n                    // fade-in de tes .content/.contents (inchangé)\r\n                    const done = this.async();\r\n                    const contents = data.next.container.querySelectorAll(\r\n                        \".content, .contents\"\r\n                    );\r\n                    if (contents.length) {\r\n                        gsap.to(contents, {\r\n                            alpha: 1,\r\n                            stagger: 0.03,\r\n                            onComplete: done,\r\n                        });\r\n                    } else {\r\n                        done();\r\n                    }\r\n                },\r\n\r\n                before(data) {\r\n                    const ns = data?.current?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.before?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:before ns]\", e);\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    const tl = contentsOut(data.current.container, {\r\n                        onComplete: done,\r\n                    });\r\n                    if (!tl) done();\r\n                },\r\n\r\n                async leave(data) {\r\n                    const ns = data?.current?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    if (h?.leave) {\r\n                        try {\r\n                            await h.leave(data);\r\n                        } catch (e) {\r\n                            console.error(\"[barba:leave]\", e);\r\n                        }\r\n                    }\r\n                    const done = this.async();\r\n                    animateLinesOut(data.current.container, done);\r\n                },\r\n\r\n                async enter(data) {\r\n                    console.debug(\"[barba] enter ns=\", data?.next?.namespace);\r\n                    Context.container = data.next.container;\r\n                    rebindProgressPath(data.next.container, cursor);\r\n\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    if (h?.enter) {\r\n                        try {\r\n                            await h.enter(data);\r\n                        } catch (e) {\r\n                            console.error(\"[barba:enter]\", e);\r\n                        }\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    animateLinesIn(data.next.container, () => {\r\n                        navigationAnimation(data.next.container);\r\n                        done();\r\n                    });\r\n                },\r\n\r\n                afterEnter(data) {\r\n                    console.debug(\r\n                        \"[barba] afterEnter ns=\",\r\n                        data?.next?.namespace\r\n                    );\r\n\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.afterEnter?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:afterEnter]\", e);\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    const tl = contentsIn(data.next.container, {\r\n                        onComplete: done,\r\n                    });\r\n                    if (!tl) done();\r\n                },\r\n            },\r\n        ],\r\n    });\r\n\r\n    return { destroy };\r\n}\r\n\r\nexport function getRegisteredNamespaces() {\r\n    return Array.from(_nsHooks.keys());\r\n}\r\n\r\nfunction destroy() {\r\n    try {\r\n        if (barba && barba.destroy) barba.destroy();\r\n    } catch {}\r\n    _nsHooks.clear();\r\n    _initialized = false;\r\n}\r\n","// features/register/register.js\r\n// Refactor minimal du \"register script\" (iframe) depuis ton code existant.\r\n// Aucune logique ajoutée : juste structuré, sécurisé, et sans utiliser `this` implicite.\r\n\r\nimport localforage from \"https://cdn.jsdelivr.net/npm/localforage@1.10.0/+esm\";\r\n\r\n// Helpers locaux (copie fidèle de tes utilitaires)\r\nconst slugify = (text) =>\r\n    text\r\n        .toString()\r\n        .toLowerCase()\r\n        .normalize(\"NFD\")\r\n        .trim()\r\n        .replace(/\\s+/g, \"-\")\r\n        .replace(/[^\\w\\-]+/g, \"\")\r\n        .replace(/\\-\\-+/g, \"-\");\r\n\r\nconst getSiblings = (el) => {\r\n    const siblings = [];\r\n    if (!el?.parentNode) return siblings;\r\n    let n = el.parentNode.firstChild;\r\n    while (n) {\r\n        if (n.nodeType === 1 && n !== el) siblings.push(n);\r\n        n = n.nextSibling;\r\n    }\r\n    return siblings;\r\n};\r\n\r\n// --- parsing / étapes -------------------------------------------------------\r\n\r\nfunction computeRegisterStep(url = \"\", htmlDoc = document) {\r\n    // Fidèle à ta logique, avec garde-fous\r\n    let step = 1;\r\n    if (url.includes(\"step=2\")) step = 2;\r\n    if (htmlDoc.querySelector(\"form#form_confirm\")) step = 6;\r\n    if (htmlDoc.querySelector(\".randommessageclass\")) step = 7; // message de succès\r\n    return step;\r\n}\r\n\r\nfunction parseFieldset(fieldset) {\r\n    const dls = fieldset?.querySelectorAll?.(\"dl\") || [];\r\n    const data = {};\r\n    dls.forEach((dl) => {\r\n        const dt = dl.querySelector(\"dt\");\r\n        const title = (dt?.textContent || \"\").replace(/[*:]/g, \"\");\r\n        const slug = slugify(title);\r\n        const input = dl.querySelector(\"dd input, dd textarea, dd select\");\r\n        if (input) {\r\n            const type = input.tagName.toLowerCase();\r\n            const value =\r\n                type === \"select\" ? input.value : (input.value || \"\").trim();\r\n            data[slug] = {\r\n                title,\r\n                type,\r\n                value,\r\n                validate: () => true,\r\n                inputHTML: input,\r\n                originalHTML: dl,\r\n            };\r\n        }\r\n    });\r\n    return data;\r\n}\r\n\r\nfunction getAllFields(accountFieldset, profileFieldset) {\r\n    return [parseFieldset(accountFieldset), parseFieldset(profileFieldset)];\r\n}\r\n\r\n// Placeholders pour garder le même flux sans casser\r\nfunction formatFields(/* account, profile */) {\r\n    return null;\r\n}\r\nfunction changeFormAction() {\r\n    /* no-op fidèle au code actuel */\r\n}\r\n\r\n// --- DOM actions ------------------------------------------------------------\r\n\r\nfunction goToStep(container, idx) {\r\n    const panel = container.querySelector(`.register__panel:nth-child(${idx})`);\r\n    if (!panel) return;\r\n    getSiblings(panel).forEach((s) => s.classList.remove(\"isOpen\"));\r\n    panel.classList.add(\"isOpen\");\r\n}\r\n\r\nfunction deletePanelContent(container, idx) {\r\n    const target = container.querySelector(\r\n        `.register__panel:nth-child(${idx}) .register__panelContentWrapper`\r\n    );\r\n    target?.remove();\r\n}\r\n\r\n// --- handler principal (évènement load de l’iframe) ------------------------\r\n\r\nexport async function updateIframeRegister(event) {\r\n    const iframe = event?.currentTarget;\r\n    if (!iframe) return;\r\n\r\n    const doc = iframe.contentDocument || iframe.contentWindow?.document;\r\n    const url = iframe.contentWindow?.location?.href || \"\";\r\n    if (!doc) return;\r\n\r\n    const cpMain = doc.querySelector(\"#cp-main\");\r\n    if (!cpMain) return;\r\n\r\n    const html = cpMain.cloneNode(true);\r\n    const fieldsets = html.querySelectorAll(\"fieldset\");\r\n\r\n    // état local minimum (comme ton code)\r\n    /* const foragedForm = await localforage.getItem(\"registration_form\");\r\n    const formData = {}; */\r\n\r\n    // container barba courant (ou document à défaut)\r\n    const container =\r\n        iframe.closest('section[data-barba=\"container\"]') || document;\r\n\r\n    const step = computeRegisterStep(url, html);\r\n\r\n    const steps = {\r\n        1: () => {},\r\n        2: async () => {\r\n            if (fieldsets.length >= 2) {\r\n                const [account, profile] = getAllFields(\r\n                    fieldsets[0],\r\n                    fieldsets[1]\r\n                );\r\n                // garde le hook existant :\r\n                const formatted = formatFields(account, profile);\r\n                void formatted;\r\n            }\r\n            goToStep(container, 2);\r\n            await new Promise((r) => setTimeout(r, 400));\r\n            deletePanelContent(container, 1);\r\n            changeFormAction();\r\n        },\r\n        3: () => {},\r\n        6: () => {}, // confirm\r\n        7: () => {}, // success\r\n    };\r\n\r\n    if (steps[step]) {\r\n        await steps[step]();\r\n    }\r\n}\r\n\r\n// --- init public ------------------------------------------------------------\r\n\r\nexport function initRegisterScripts(container = document) {\r\n    try {\r\n        const iFrame = container.querySelector(\"#registerIframe\");\r\n        if (!iFrame) return;\r\n        // sécurise : évite les doublons si Barba réentre\r\n        iFrame.removeEventListener(\"load\", updateIframeRegister);\r\n        iFrame.addEventListener(\"load\", updateIframeRegister);\r\n    } catch (e) {\r\n        console.log(\"RegisterScripts:\", e);\r\n    }\r\n}\r\n","// features/subject/SubjectScripts.js\r\n// Refactor minimal du bloc \"SubjectScripts\" depuis menu.js (comportement identique)\r\nimport Context from \"../core/context.js\";\r\nimport { qsa, qs } from \"../core/utils.js\";\r\n\r\nexport function initTopicScripts(root = Context.container) {\r\n    const container = root || document;\r\n\r\n    /* Date with Tyme.js */\r\n    qsa(container, \".postbody__date-time\").forEach((el) => {\r\n        el.innerHTML = new Tyme(el).fromNow();\r\n    });\r\n\r\n    /* ----------------------------\r\n     * EditorJS: normaliser les paragraphes\r\n     * ---------------------------- */\r\n    const messages = container.querySelectorAll(\".postbody\");\r\n    messages.forEach((message) => {\r\n        const content = message.querySelector(\".grid-content\");\r\n        if (!content) return;\r\n\r\n        const trim = (str) => str.replace(/^\\s+|\\s+$/g, \"\");\r\n        const arr = [];\r\n\r\n        for (let i = 0; i < content.childNodes.length; i++) {\r\n            const elem = content.childNodes[i];\r\n            if (elem.nodeType === 3) {\r\n                const newElem = document.createElement(\"p\");\r\n                newElem.innerHTML = trim(elem.nodeValue);\r\n                elem.parentNode.insertBefore(newElem, elem.nextSibling);\r\n                content.removeChild(elem);\r\n                arr.push(newElem);\r\n            } else {\r\n                arr.push(elem);\r\n            }\r\n        }\r\n\r\n        const paragraphs = arr\r\n            .filter((k) => k.nodeName !== \"BR\")\r\n            .filter((k) => k.nodeName === \"P\" && k.childNodes.length === 0);\r\n\r\n        const frag = document.createDocumentFragment();\r\n        for (let i = 0; i < paragraphs.length; ++i)\r\n            frag.appendChild(paragraphs[i]);\r\n        content.appendChild(frag);\r\n    });\r\n\r\n    /* ----------------------------\r\n     * Masquer des profils (œil) + localStorage\r\n     * ---------------------------- */\r\n    const appendToStorage = (name, data) => {\r\n        let list = JSON.parse(localStorage.getItem(name));\r\n        if (list == null) list = [];\r\n        const idx = list.indexOf(data);\r\n        if (idx === -1) list.push(data);\r\n        else list.splice(idx, 1);\r\n        localStorage.setItem(name, JSON.stringify(list));\r\n    };\r\n\r\n    const hideProfiles = () => {\r\n        const items = JSON.parse(localStorage.getItem(\"hiddenProfiles\"));\r\n        if (items === null) return;\r\n\r\n        if (items.length === 0) {\r\n            container\r\n                .querySelectorAll(\".subject__profileAvatar\")\r\n                .forEach((a) => {\r\n                    a.classList.remove(\"blurred\");\r\n                });\r\n        }\r\n\r\n        items.forEach((u) => {\r\n            const avatars = container.querySelectorAll(\r\n                `.subject__profileAvatar > a[href ^= \"/${u}\"]`\r\n            );\r\n            const removeOthers = container.querySelectorAll(\r\n                `.subject__profileAvatar > a:not([href ^= \"/${u}\"])`\r\n            );\r\n            avatars.forEach((a) =>\r\n                a.closest(\".subject__profileAvatar\").classList.add(\"blurred\")\r\n            );\r\n            removeOthers.forEach((a) =>\r\n                a.closest(\".subject__profileAvatar\").classList.remove(\"blurred\")\r\n            );\r\n        });\r\n    };\r\n\r\n    container.querySelectorAll(\".subject__profileEye\").forEach((eye) => {\r\n        eye.addEventListener(\"click\", () => {\r\n            const u = eye\r\n                .closest(\".subject__profileAvatar\")\r\n                .querySelector('a[href^=\"/u\"]')\r\n                .pathname.replace(/^./, \"\");\r\n            appendToStorage(\"hiddenProfiles\", u);\r\n            hideProfiles();\r\n        });\r\n    });\r\n    hideProfiles();\r\n\r\n    /* ----------------------------\r\n     * Triggers <tw> → #triggers\r\n     * ---------------------------- */\r\n    const nextBR = (elem) => {\r\n        do {\r\n            elem = elem.nextSibling;\r\n        } while (elem && elem.nodeType !== 1);\r\n        if (elem && elem.tagName === \"BR\") return elem;\r\n    };\r\n    /* const allTriggers = [];\r\n        const appendTriggers = () => {\r\n            const triggersContainer = container.querySelector(\"#triggers\");\r\n            const triggersEls = container.querySelectorAll(\"tw\");\r\n            if (!triggersContainer || !triggersEls.length) return;\r\n            triggersEls.forEach((el) => {\r\n                const triggersArr = el.textContent\r\n                    .split(\",\")\r\n                    .map((v) => v.trim());\r\n                triggersArr.forEach((t) => allTriggers.push(t));\r\n                nextBR(el)?.remove();\r\n                el.remove();\r\n            });\r\n            allTriggers.forEach((trigger, idx, array) => {\r\n                const text =\r\n                    idx === array.length - 1 ? trigger : trigger + \", \";\r\n                triggersContainer.innerHTML += text;\r\n            });\r\n        };\r\n        appendTriggers(); */\r\n\r\n    /* ----------------------------\r\n     * Helpers profil (nom/couleur/groupe)\r\n     * ---------------------------- */\r\n    const splitNames = (p) => {\r\n        const name = p.querySelector(\".username strong\");\r\n        if (!name) return null;\r\n        name.innerHTML = name.innerText\r\n            .split(\"\")\r\n            .map((e) =>\r\n                !e.trim() ? \"<div>&nbsp</div>\" : \"<div>\" + e + \"</div>\"\r\n            )\r\n            .join(\"\");\r\n        return name;\r\n    };\r\n\r\n    const applyColorFromName = (name) => {\r\n        if (!name) return null;\r\n        const color = name.parentElement.style.color;\r\n        name.closest(\".subject__post\").style = \"--accentColor:\" + color;\r\n        return color;\r\n    };\r\n\r\n    const getGroup = (color) => {\r\n        const groups = {\r\n            djinn: \"rgb(255, 107, 139)\",\r\n            human: \"rgb(115, 169, 255)\",\r\n        };\r\n        return Object.keys(groups).find((key) => groups[key] === color);\r\n    };\r\n\r\n    /* ----------------------------\r\n     * Déplacement champs profil + Chart OCEAN\r\n     * ---------------------------- */\r\n    const pfields = container.querySelectorAll(\".pfield\");\r\n    pfields.forEach(function (field) {\r\n        var name = field.textContent\r\n            .split(\" \")[0]\r\n            .toLowerCase()\r\n            .replace(/'/g, \"\")\r\n            .replace(/\\(|\\)/g, \"\");\r\n        field.closest(\".pfield\").classList.add(name);\r\n    });\r\n    const moveField = (p, item, to) => {\r\n        const el = p.querySelectorAll(`.pfield.${item} `);\r\n        let value = \"\";\r\n        el.forEach((e) => {\r\n            value = e.querySelector(\".pcontent\")?.textContent || \"\";\r\n            e.closest(\".subject__profileWrapper\")\r\n                .querySelector(to)\r\n                ?.appendChild(e);\r\n        });\r\n        return value;\r\n    };\r\n\r\n    const createChart = (p, color, values) => {\r\n        const ctx = p.querySelector(\".subject__profileChart canvas\");\r\n        if (!ctx || !window.Chart) return null;\r\n        return new Chart(ctx, {\r\n            type: \"line\",\r\n            data: {\r\n                labels: [\"O\", \"C\", \"E\", \"A\", \"N\"],\r\n                datasets: [\r\n                    {\r\n                        data: values,\r\n                        borderWidth: 2,\r\n                        borderColor: color,\r\n                        fill: true,\r\n                        backgroundColor: color,\r\n                    },\r\n                ],\r\n            },\r\n            options: {\r\n                aspectRatio: 8,\r\n                maintainAspectRatio: false,\r\n                animations: {\r\n                    tension: {\r\n                        duration: 1000,\r\n                        easing: \"easeInQuad\",\r\n                        from: 0,\r\n                        to: 0.4,\r\n                        loop: true,\r\n                    },\r\n                },\r\n                scales: {\r\n                    y: { display: false, min: -10, max: 10 },\r\n                    x: { display: false },\r\n                },\r\n                layout: { padding: 0 },\r\n                elements: { point: { pointRadius: 0 } },\r\n                plugins: {\r\n                    tooltip: { enabled: false },\r\n                    title: { display: false },\r\n                    subtitle: { display: false },\r\n                    legend: { display: false },\r\n                },\r\n            },\r\n        });\r\n    };\r\n\r\n    /* ----------------------------\r\n     * Symboles (hover / mapping)\r\n     * ---------------------------- */\r\n    const createSymbols = (p, group) => {\r\n        const symbolElements = p.querySelectorAll(\".subject__profileSymbol\");\r\n        symbolElements.forEach((el) => {\r\n            const symbol = el.dataset.symbol;\r\n            el.addEventListener(\"mouseenter\", (e) => {\r\n                const target = e.target\r\n                    .closest(\".subject__profileBlock\")\r\n                    .querySelector(\".subject__profileAvatar\");\r\n                if (target) target.dataset.symbol = symbol;\r\n            });\r\n        });\r\n\r\n        const symbolList = p.querySelectorAll(\".subject__profileMeta\");\r\n        symbolList.forEach((el) => {\r\n            el.addEventListener(\"mouseenter\", (e) => {\r\n                const target = e.target\r\n                    .closest(\".subject__profileBlock\")\r\n                    .querySelector(\".subject__profileAvatar\");\r\n                target?.classList.add(\"symbol\");\r\n            });\r\n            el.addEventListener(\"mouseleave\", (e) => {\r\n                const target = e.target\r\n                    .closest(\".subject__profileBlock\")\r\n                    .querySelector(\".subject__profileAvatar\");\r\n                target?.classList.remove(\"symbol\");\r\n            });\r\n        });\r\n    };\r\n\r\n    const moveSymbol = (p, item, to, group) => {\r\n        const f = p.querySelectorAll(`.pfield.${item} `);\r\n        if (!f || !f.length) return;\r\n        const [name, desc] = f;\r\n\r\n        const labelName =\r\n            group == \"djinn\"\r\n                ? (name\r\n                      .querySelector(\".plabel span[style]\")\r\n                      .textContent.split(\")\")[0] += \")\")\r\n                : \"Vœu\";\r\n        const labelContent = name.querySelector(\".pcontent\")?.textContent || \"\";\r\n        const description = desc.querySelector(\".pcontent\")?.textContent || \"\";\r\n\r\n        console.log(labelName, labelContent, description);\r\n\r\n        const label = p.querySelector(`.subject__symbolsTrack .${to} .label`);\r\n        console.log(label);\r\n        if (label) label.innerText = labelName;\r\n        const content = p.querySelector(\r\n            `.subject__symbolsTrack .${to} .content`\r\n        );\r\n        if (content) content.innerText = labelContent;\r\n        const descr = p.querySelector(`.subject__symbolsTrack .${to} .desc`);\r\n        if (descr) descr.innerText = description;\r\n    };\r\n\r\n    /* ----------------------------\r\n     * Application sur chaque bloc profil\r\n     * ---------------------------- */\r\n    const allProfiles = container.querySelectorAll(\".subject__profileBlock\");\r\n    allProfiles.forEach((profile) => {\r\n        const name = splitNames(profile);\r\n        const color = applyColorFromName(name);\r\n        const group = getGroup(color);\r\n        const chartValues = [];\r\n\r\n        const ocean = [\r\n            \"ouverture\",\r\n            \"conscienciosité\",\r\n            \"extraversion\",\r\n            \"agréabilité\",\r\n            \"neuroticisme\",\r\n        ];\r\n        const fields = {\r\n            messages: \".subject__profileNumbers\",\r\n            points: \".subject__profileNumbers\",\r\n\r\n            ouverture: \".subject__profileChart div\",\r\n            conscienciosité: \".subject__profileChart div\",\r\n            extraversion: \".subject__profileChart div\",\r\n            agréabilité: \".subject__profileChart div\",\r\n            neuroticisme: \".subject__profileChart div\",\r\n\r\n            âge: \".subject__profileFacts\",\r\n            pronoms: \".subject__profileFacts\",\r\n            faceclaim: \".subject__profileFacts\",\r\n\r\n            citation: \".subject__profileQuote\",\r\n        };\r\n\r\n        for (const [key, to] of Object.entries(fields)) {\r\n            const content = moveField(profile, key, to);\r\n            if (ocean.indexOf(key) > -1) chartValues.push(Number(content) || 0);\r\n        }\r\n\r\n        function createEnmity(p) {\r\n            const enmity = p.querySelector(\".pfield.niveau\");\r\n            const el = p.querySelector(\".subject__profileEnmity\");\r\n\r\n            if (!enmity) return;\r\n\r\n            const content =\r\n                enmity.querySelector(\".pcontent\")?.textContent || \"\";\r\n            switch (content.toLowerCase()) {\r\n                case \"normal\":\r\n                    el.querySelector(\".level-1\").classList.add(\"show\");\r\n                    break;\r\n                case \"surveillé\":\r\n                    el.querySelector(\".level-2\").classList.add(\"show\");\r\n                    break;\r\n                case \"recherché\":\r\n                    el.querySelector(\".level-3\").classList.add(\"show\");\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        createEnmity(profile);\r\n        createChart(profile, color, chartValues);\r\n        createSymbols(profile, group);\r\n        moveSymbol(profile, \"salt\", \"body\", group);\r\n        moveSymbol(profile, \"mercury\", \"mind\", group);\r\n        moveSymbol(profile, \"sulfur\", \"soul\", group);\r\n    });\r\n}\r\n","import { qs } from \"../core/utils.js\";\r\nimport { getGlobalTimeline } from \"../animations/navigation.js\";\r\n\r\n// Map + Topic Controllers — refactor v2\r\n// -------------------------------------\r\n// Goals\r\n// - Stronger separation of concerns (map vs. topic creation UI)\r\n// - Safer DOM access & defensive guards to avoid null errors\r\n// - Resize-aware map (ResizeObserver), with camera/offset updates when side asides open/close\r\n// - Clean event lifecycle (add/remove) and small utilities (throttle, DMS helpers)\r\n// - Robust topic parsing from forum list + safe marker rendering\r\n// - Smooth “click to drop temp marker → open creation aside → prefill coords” flow\r\n\r\n// External expectations\r\n// - global `maplibregl`\r\n// - optional `getGlobalTimeline()` from animations/navigation.js\r\n// - DOM structure:\r\n//   - map container: #map and #map-content (canvas host)\r\n//   - list aside: .map__asideContainer.topicList\r\n//   - new-topic aside: .map__asideContainer.newTopic\r\n//   - toggle board button: #board\r\n//   - creation close button (optional): .newTopic__closeButton\r\n//   - creation form fields (optional):\r\n//       [name=\"subject\"], [name=\"message\"], [name=\"district\"], [name=\"coords\"],\r\n//       [data-coords-decimal], [data-coords-dms]\r\n\r\n// -------------------------------------\r\n// utils\r\nexport function rafThrottle(fn) {\r\n    let ticking = false;\r\n    return function throttled(...args) {\r\n        if (ticking) return;\r\n        ticking = true;\r\n        requestAnimationFrame(() => {\r\n            try {\r\n                fn.apply(this, args);\r\n            } finally {\r\n                ticking = false;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\nfunction clamp(n, min, max) {\r\n    return Math.max(min, Math.min(max, n));\r\n}\r\n\r\nfunction pxOffsetToLngLatFraction(container, pxX = 0, pxY = 0) {\r\n    // Convert a pixel offset into a crude lng/lat fraction of current bounds width/height.\r\n    // Used only to nudge maxBounds slightly when the layout changes.\r\n    // Guards: if container missing, return 0,0 fractions.\r\n    const w = container?.clientWidth || 0;\r\n    const h = container?.clientHeight || 0;\r\n    if (!w || !h) return { fx: 0, fy: 0 };\r\n    return { fx: pxX / w, fy: pxY / h };\r\n}\r\n\r\nfunction offsetBoundsByFraction(bounds, fx = 0, fy = 0) {\r\n    const sw = bounds.getSouthWest();\r\n    const ne = bounds.getNorthEast();\r\n    const dLng = (ne.lng - sw.lng) * fx;\r\n    const dLat = (ne.lat - sw.lat) * fy;\r\n    return new maplibregl.LngLatBounds(\r\n        [sw.lng + dLng, sw.lat + dLat],\r\n        [ne.lng + dLng, ne.lat + dLat]\r\n    );\r\n}\r\n\r\n// -------------------------------------\r\n// DMS helpers\r\nexport function toDMS(value, type = \"lat\", precision = 4) {\r\n    const hemi =\r\n        type === \"lat\" ? (value >= 0 ? \"N\" : \"S\") : value >= 0 ? \"E\" : \"W\";\r\n    let v = Math.abs(Number(value));\r\n    let d = Math.floor(v);\r\n    let mFloat = (v - d) * 60;\r\n    let m = Math.floor(mFloat);\r\n    let s = (mFloat - m) * 60;\r\n    const p = Math.max(0, precision | 0);\r\n    s = Number(s.toFixed(p));\r\n    if (s >= 60) {\r\n        s -= 60;\r\n        m += 1;\r\n    }\r\n    if (m >= 60) {\r\n        m -= 60;\r\n        d += 1;\r\n    }\r\n    return { d, m, s, hemi, type };\r\n}\r\n\r\nexport function formatDMS(\r\n    { d, m, s, hemi, type },\r\n    { precision = 4, pad = true } = {}\r\n) {\r\n    const dd = String(d).padStart(type === \"lon\" ? 3 : 2, \"0\");\r\n    const mm = pad ? String(m).padStart(2, \"0\") : String(m);\r\n    const ss = pad\r\n        ? Number(s)\r\n              .toFixed(precision)\r\n              .padStart(precision ? 3 + 1 + precision : 2, \"0\")\r\n        : Number(s).toFixed(precision);\r\n    return `${dd}° ${mm}' ${ss}\" ${hemi}`;\r\n}\r\n\r\nexport function decimalToDMSString(\r\n    value,\r\n    type = \"lat\",\r\n    precision = 4,\r\n    pad = true\r\n) {\r\n    return formatDMS(toDMS(value, type, precision), { precision, pad });\r\n}\r\n\r\nfunction readInlineColor(el) {\r\n    if (!el) return \"\";\r\n    const target = el.querySelector?.('.color-groups[style*=\"color\"]') || el;\r\n    const style = target?.style.color || target?.getAttribute(\"style\") || \"\";\r\n    if (!style) return \"\";\r\n    // parse color: #rrggbb or rgb(...) or named color from style attribute\r\n    return style;\r\n}\r\n\r\n// -------------------------------------\r\n// Forum topics scraping (robust)\r\nasync function fetchForumTopics({ forumId = 1, limit = 12, signal } = {}) {\r\n    try {\r\n        const res = await fetch(`/f${forumId}-`, {\r\n            credentials: \"same-origin\",\r\n            signal,\r\n        });\r\n        const html = await res.text();\r\n        const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n        const anchors = Array.from(doc.querySelectorAll(\"a.topictitle\"));\r\n        const list = anchors\r\n            .slice(0, limit)\r\n            .map((a) => {\r\n                try {\r\n                    const href = a.getAttribute(\"href\");\r\n                    const url = new URL(href, location.origin).href;\r\n                    const row = a.closest(\".row, .topic-row, tr\");\r\n                    const title = (a.textContent || \"Untitled\").trim();\r\n\r\n                    const authorA = qs(\r\n                        row,\r\n                        \".topic-author a, .username a, .topic-author > a\"\r\n                    );\r\n                    const authorUrl = authorA\r\n                        ? new URL(authorA.getAttribute(\"href\"), location.origin)\r\n                              .href\r\n                        : \"\";\r\n                    const authorName =\r\n                        authorA?.textContent?.trim() ||\r\n                        row\r\n                            ?.querySelector(\".topic-author\")\r\n                            ?.textContent?.replace(/\\s*par\\s*/i, \"\")\r\n                            .trim() ||\r\n                        \"\";\r\n                    const authorColor = readInlineColor(authorA);\r\n\r\n                    const replies =\r\n                        qs(\r\n                            row,\r\n                            \".posts, .topic-replies\"\r\n                        )?.textContent?.trim() || \"\";\r\n\r\n                    const desc =\r\n                        qs(\r\n                            row,\r\n                            \".topic-description, .topic-desc\"\r\n                        )?.textContent?.trim() || \"\";\r\n                    const mId = url.match(/t(\\d+)-/);\r\n                    const id = mId ? mId[1] : \"\";\r\n                    // parse [lon, lat] in title or description\r\n                    const where = title + \"\\n\" + desc;\r\n                    const coords = where.match(/\\[(.+?),\\s*(.+?)\\]/);\r\n                    if (!coords) return null;\r\n                    const lon = parseFloat(coords[1]);\r\n                    const lat = parseFloat(coords[2]);\r\n                    if (!Number.isFinite(lon) || !Number.isFinite(lat))\r\n                        return null;\r\n\r\n                    // lastpost\r\n                    const lastpost = qs(row, \".lastpost\");\r\n                    const lastpost_avatar = qs(lastpost, \"img\");\r\n                    const lastpost_user = qs(lastpost, 'a[href^=\"/u\"]');\r\n                    const lastpost_color = readInlineColor(lastpost_user);\r\n                    const lastpost_link = qs(lastpost, 'a[href^=\"/t\"]');\r\n                    const lastpost_infos = qs(lastpost, \".lastpost-infos\");\r\n                    const lastpost_date =\r\n                        new Tyme(\r\n                            lastpost_infos?.lastChild.textContent.trim()\r\n                        ) || \"\";\r\n                    console.log({\r\n                        lastpost_avatar,\r\n                        lastpost_user,\r\n                        lastpost_color,\r\n                        lastpost_link,\r\n                        lastpost_date,\r\n                    });\r\n\r\n                    return {\r\n                        id,\r\n                        title,\r\n                        desc,\r\n                        url,\r\n                        author: {\r\n                            name: authorName,\r\n                            url: authorUrl,\r\n                            color: authorColor,\r\n                        },\r\n                        replies,\r\n                        coords: [lon, lat],\r\n                        lastpost: {\r\n                            avatar: lastpost_avatar\r\n                                ? new URL(lastpost_avatar.src)\r\n                                : null,\r\n                            user: lastpost_user\r\n                                ? {\r\n                                      name: lastpost_user.textContent.trim(),\r\n                                      url: new URL(lastpost_user.href),\r\n                                      color: lastpost_color,\r\n                                  }\r\n                                : null,\r\n                            link: lastpost_link\r\n                                ? new URL(lastpost_link.href)\r\n                                : null,\r\n                            date: {\r\n                                day: lastpost_date.parseToFormat(\"DD\") || \"\",\r\n                                month: lastpost_date.parseToFormat(\"MM\") || \"\",\r\n                                year: lastpost_date.parseToFormat(\"YYYY\") || \"\",\r\n                                time:\r\n                                    lastpost_date.parseToFormat(\"HH:mm\") || \"\",\r\n                                full: lastpost_date.toString() || \"\",\r\n                            },\r\n                        },\r\n                    };\r\n                } catch (e) {\r\n                    console.error(\"[Map] fetchForumTopics error:\", e);\r\n                    return null;\r\n                }\r\n            })\r\n            .filter(Boolean);\r\n        return list;\r\n    } catch (e) {\r\n        console.warn(\"[Map] fetchForumTopics error:\", e);\r\n        return [];\r\n    }\r\n}\r\n\r\n// -------------------------------------\r\n// TopicController (refactor)\r\nexport class TopicController {\r\n    constructor({\r\n        map,\r\n        topicsContainerSelector = \".map__asideContainer.topicList\",\r\n        newTopicAsideSelector = \".map__asideContainer.newTopic\",\r\n    } = {}) {\r\n        this.map = map;\r\n        this.topicsContainer = qs(document, topicsContainerSelector) || null;\r\n        this.asideContainer = qs(document, newTopicAsideSelector) || null;\r\n        this.toggleButton =\r\n            qs(this.asideContainer, \".newTopic__closeButton\") || null;\r\n        this.isCreating = false;\r\n        this.isAsideOpened = false;\r\n\r\n        // optional fields inside aside\r\n        this.subjectInput =\r\n            qs(this.asideContainer, '[name=\"subject\"], #newTopicSubject') ||\r\n            null;\r\n        this.messageInput =\r\n            qs(this.asideContainer, '[name=\"message\"], #newTopicMessage') ||\r\n            null;\r\n        this.coordsInput =\r\n            qs(this.asideContainer, '[name=\"coords\"], #newTopicCoords') || null;\r\n        this.districtInput =\r\n            qs(this.asideContainer, '[name=\"district\"], #newTopicDistrict') ||\r\n            null;\r\n        this.coordsDecimalEl =\r\n            qs(this.asideContainer, \"[data-coords-decimal]\") || null;\r\n        this.coordsDMSEl = qs(this.asideContainer, \"[data-coords-dms]\") || null;\r\n\r\n        this._bindAsideEvents();\r\n        this._loadState();\r\n    }\r\n\r\n    _bindAsideEvents() {\r\n        if (this.toggleButton) {\r\n            this.toggleButton.addEventListener(\"click\", () =>\r\n                this.toggleAside()\r\n            );\r\n        }\r\n        // ESC to close\r\n        document.addEventListener(\"keydown\", (e) => {\r\n            if (e.key === \"Escape\" && this.isAsideOpened) this.closeAside();\r\n        });\r\n\r\n        // Mirror text inputs back into state\r\n        const sync = () => this._saveState();\r\n        this.subjectInput?.addEventListener(\"input\", sync);\r\n        this.messageInput?.addEventListener(\"input\", sync);\r\n    }\r\n\r\n    _loadState() {\r\n        try {\r\n            const saved = localStorage.getItem(\"newTopic\");\r\n            if (!saved) return;\r\n            const { coords, district, subject, message } = JSON.parse(saved);\r\n            if (coords)\r\n                this.isCreating = { coords, district, subject, message };\r\n            if (this.subjectInput) this.subjectInput.value = subject || \"\";\r\n            if (this.messageInput) this.messageInput.value = message || \"\";\r\n            if (this.districtInput) this.districtInput.value = district || \"\";\r\n            if (coords) this._updateCoordDisplays(coords);\r\n            // expose close button if we have a draft\r\n            this.toggleButton?.classList.add(\"show\");\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    _saveState() {\r\n        if (!this.isCreating) return;\r\n        try {\r\n            const payload = {\r\n                coords: this.isCreating.coords || null,\r\n                district:\r\n                    this.isCreating.district || this.districtInput?.value || \"\",\r\n                subject: this.subjectInput?.value || \"\",\r\n                message: this.messageInput?.value || \"\",\r\n            };\r\n            localStorage.setItem(\"newTopic\", JSON.stringify(payload));\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    _readDraft() {\r\n        const raw = localStorage.getItem(\"newTopic\");\r\n        if (!raw) return null;\r\n        return JSON.parse(raw);\r\n    }\r\n\r\n    _writeDraft(payload) {\r\n        try {\r\n            localStorage.setItem(\"newTopic\", JSON.stringify(payload));\r\n        } catch {}\r\n    }\r\n\r\n    getDraft() {\r\n        return this._readDraft();\r\n    }\r\n\r\n    _updateCoordDisplays(lngLat) {\r\n        const { lng, lat } = Array.isArray(lngLat)\r\n            ? { lng: lngLat[0], lat: lngLat[1] }\r\n            : lngLat;\r\n        if (this.coordsInput) this.coordsInput.value = `${lng},${lat}`;\r\n        if (this.coordsDecimalEl)\r\n            this.coordsDecimalEl.textContent = `${lng.toFixed(\r\n                6\r\n            )}, ${lat.toFixed(6)}`;\r\n        if (this.coordsDMSEl)\r\n            this.coordsDMSEl.textContent = `${decimalToDMSString(\r\n                lng,\r\n                \"lon\",\r\n                4\r\n            )}, ${decimalToDMSString(lat, \"lat\", 4)}`;\r\n    }\r\n\r\n    initNewTopic(coords, district) {\r\n        this.isCreating = { coords, district };\r\n        this._saveState();\r\n        this.openAside();\r\n        this.moveNewTopic(coords, district);\r\n    }\r\n\r\n    moveNewTopic(coords, district) {\r\n        if (!coords) return;\r\n        this.isCreating = {\r\n            ...this.isCreating,\r\n            coords,\r\n            district: district ?? this.isCreating?.district,\r\n        };\r\n        this._updateCoordDisplays(coords);\r\n        this._saveState();\r\n        this.openAside();\r\n    }\r\n\r\n    setDistrict(district) {\r\n        this.isCreating = { ...this.isCreating, district };\r\n        if (this.districtInput) this.districtInput.value = district || \"\";\r\n        this._saveState();\r\n    }\r\n\r\n    toggleAside() {\r\n        this.isAsideOpened ? this.closeAside() : this.openAside();\r\n    }\r\n\r\n    openAside() {\r\n        if (!this.asideContainer) return;\r\n        this.asideContainer.classList.add(\"active\");\r\n        this.topicsContainer?.classList.remove(\"active\");\r\n        this.isAsideOpened = true;\r\n    }\r\n\r\n    closeAside() {\r\n        if (!this.asideContainer) return;\r\n        this.asideContainer.classList.remove(\"active\");\r\n        this.isAsideOpened = false;\r\n        // keep draft in localStorage; do not wipe here\r\n    }\r\n}\r\n\r\n// -------------------------------------\r\n// MapController (refactor)\r\nexport async function createMapController({\r\n    styleUrl = \"http://127.0.0.1:8080/dark_matter.json\",\r\n    selectors = {\r\n        trigger: \"#navigate\",\r\n        container: \"#map\",\r\n        mapContainer: \"#map-content\",\r\n        board: \"#board\",\r\n        cursor: \"#cursor\",\r\n        topics: \"#map-topics\",\r\n        layoutBoard: \".map__asideContainer.topicList\",\r\n        newTopic: \".map__asideContainer.newTopic\",\r\n    },\r\n    animations = {},\r\n    forumId = 1,\r\n    topicsLimit = 12,\r\n} = {}) {\r\n    const { mapAnimation } = animations || {};\r\n\r\n    const trigger = document.querySelector(selectors.trigger);\r\n    const container = document.querySelector(selectors.container);\r\n    const mapHost = document.querySelector(selectors.mapContainer);\r\n    const cursor = document.querySelector(selectors.cursor);\r\n    const boardTrigger = document.querySelector(selectors.board);\r\n    const topicsContainer = document.querySelector(selectors.topics);\r\n    const layoutBoard = document.querySelector(selectors.layoutBoard);\r\n    const newTopicAside = document.querySelector(selectors.newTopic);\r\n\r\n    if (!container || !mapHost) {\r\n        console.warn(\"[Map] container/mapHost missing:\", selectors);\r\n    }\r\n\r\n    const aborter = new AbortController();\r\n    const topics =\r\n        (await fetchForumTopics({\r\n            forumId,\r\n            limit: topicsLimit,\r\n            signal: aborter.signal,\r\n        })) || [];\r\n\r\n    let map = null;\r\n    const topicMarkers = new Map();\r\n    let cam = null;\r\n    let tempMarker = null;\r\n    let onMove = null;\r\n    let resizeObs = null;\r\n    let topicController = null;\r\n\r\n    // district layer name you use to restrict clicks\r\n    const DISTRICT_LAYER = \"districts-fill\";\r\n\r\n    // initial logical bounds (Amsterdam demo)\r\n    const INITIAL_BOUNDS = new maplibregl.LngLatBounds(\r\n        [4.825, 52.33],\r\n        [5.015, 52.397]\r\n    );\r\n    const INITIAL_CENTER = [4.89361, 52.37278];\r\n\r\n    function safeGetTl() {\r\n        try {\r\n            return (\r\n                (typeof getGlobalTimeline === \"function\" &&\r\n                    getGlobalTimeline()) ||\r\n                null\r\n            );\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function isMarkerElement(el) {\r\n        return !!el?.closest?.(\".marker, .maplibregl-marker, .mapboxgl-marker\");\r\n    }\r\n\r\n    function isDistrictLayerPresent() {\r\n        return Boolean(\r\n            map?.getStyle()?.layers?.some((l) => l.id === DISTRICT_LAYER)\r\n        );\r\n    }\r\n\r\n    function pointIsInDistrict(point) {\r\n        if (!map) return false;\r\n        if (!isDistrictLayerPresent()) return true; // fallback: allow clicks anywhere if layer missing\r\n        const features = map.queryRenderedFeatures(point, {\r\n            layers: [DISTRICT_LAYER],\r\n        });\r\n        return features && features.length > 0;\r\n    }\r\n\r\n    function districtAtLngLat(lngLat) {\r\n        if (!map || !isDistrictLayerPresent()) return null;\r\n        const features = map.queryRenderedFeatures(map.project(lngLat), {\r\n            layers: [DISTRICT_LAYER],\r\n        });\r\n        return features && features.length > 0\r\n            ? features[0].properties?.Stadsdeel || features[0].id || null\r\n            : null;\r\n    }\r\n\r\n    function renderTopicMarkers() {\r\n        if (!map || !Array.isArray(topics) || !topics.length) return [];\r\n        const made = [];\r\n\r\n        topics.forEach((t) => {\r\n            try {\r\n                if (!t || !Array.isArray(t.coords) || t.coords.length !== 2)\r\n                    return;\r\n                const pos = Array.isArray(t.coords)\r\n                    ? { lng: t.coords[0], lat: t.coords[1] }\r\n                    : t.coords;\r\n                if (!Number.isFinite(pos.lng) || !Number.isFinite(pos.lat))\r\n                    return;\r\n                const title = t.title || \"Untitled\";\r\n                const el = document.createElement(\"div\");\r\n                el.className = \"marker\";\r\n                el.innerHTML = `<div class=\"marker-label\">${title}</div><div class='marker-pulse'></div>`;\r\n                const m = new maplibregl.Marker({ element: el })\r\n                    .setLngLat([pos.lng, pos.lat])\r\n                    .addTo(map);\r\n                made.push(m);\r\n                if (t.id) topicMarkers.set(String(t.id), m);\r\n            } catch (error) {\r\n                console.error(\"[Map] renderTopicMarkers error:\", error);\r\n            }\r\n        });\r\n\r\n        // optional: attach to topicsContainer\r\n        try {\r\n            if (topicsContainer) topicsContainer.appendChild(frag);\r\n        } catch {}\r\n\r\n        return made;\r\n    }\r\n\r\n    function focusTopicById(id) {\r\n        const m = topicMarkers.get(String(id));\r\n        if (!m || !map) return;\r\n\r\n        const ll = m.getLngLat();\r\n\r\n        // décale légèrement pour compenser l’aside (gauche/droite)\r\n        const leftAsideW = layoutBoard?.classList.contains(\"active\")\r\n            ? layoutBoard.offsetWidth || 0\r\n            : 0;\r\n        const rightAsideW = newTopicAside?.classList.contains(\"active\")\r\n            ? newTopicAside.offsetWidth || 0\r\n            : 0;\r\n        const offsetX = (leftAsideW - rightAsideW) / 2; // px vers la droite si aside gauche ouverte\r\n\r\n        centerOn(ll);\r\n\r\n        // petit highlight visuel du marker\r\n        try {\r\n            const el = m.getElement();\r\n            el.classList.add(\"is-hovered\");\r\n            setTimeout(() => el.classList.remove(\"is-hovered\"), 700);\r\n        } catch {}\r\n    }\r\n\r\n    let lastFocusLL = null; // mémorise le dernier point centré\r\n\r\n    function centerOn(\r\n        lngLat,\r\n        { zoom = 16, padX = 0, padY = 0, duration = 450 } = {}\r\n    ) {\r\n        if (!map) return;\r\n        lastFocusLL = lngLat; // garde la trace pour re-centre après resize\r\n        map.easeTo({\r\n            center: lngLat,\r\n            zoom: Math.max(map.getZoom(), zoom),\r\n            offset: [padX, padY], // en push-layout, laisse à 0,0 (sauf micro-ajustement d’ancre)\r\n            duration,\r\n        });\r\n    }\r\n\r\n    function installTopicHover() {\r\n        if (!topicsContainer) return;\r\n\r\n        // garde la référence du label actuellement surligné\r\n        let activeLabelEl = null;\r\n\r\n        function activateLabelForMarker(m) {\r\n            try {\r\n                const el = m?.getElement?.();\r\n                const label = el?.querySelector?.(\".marker-label\") || null;\r\n                if (activeLabelEl && activeLabelEl !== label) {\r\n                    activeLabelEl.classList.remove(\"marker-label--hover\");\r\n                }\r\n                if (label) {\r\n                    label.classList.add(\"marker-label--hover\");\r\n                }\r\n                activeLabelEl = label || null;\r\n            } catch {\r\n                // en cas d'erreur, on nettoie\r\n                if (activeLabelEl) {\r\n                    activeLabelEl.classList.remove(\"marker-label--hover\");\r\n                    activeLabelEl = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        function clearActiveLabel() {\r\n            if (activeLabelEl) {\r\n                activeLabelEl.classList.remove(\"marker-label--hover\");\r\n                activeLabelEl = null;\r\n            }\r\n        }\r\n\r\n        // Survol d'un item → focus + highlight du label\r\n        topicsContainer.addEventListener(\"mouseover\", (e) => {\r\n            const item = e.target.closest(\".map__topicsList-item\");\r\n            if (!item || !topicsContainer.contains(item)) return;\r\n\r\n            const id = item.dataset.topicId;\r\n\r\n            if (id && topicMarkers?.has(id)) {\r\n                // centrer/zoomer via l’ID → marker connu\r\n                focusTopicById(id);\r\n                const m = topicMarkers.get(id);\r\n                activateLabelForMarker(m);\r\n            } else if (item.dataset.lng && item.dataset.lat) {\r\n                // fallback coordonnées (pas d’ID mappé) → centre sans highlight\r\n                const ll = [\r\n                    parseFloat(item.dataset.lng),\r\n                    parseFloat(item.dataset.lat),\r\n                ];\r\n                if (Number.isFinite(ll[0]) && Number.isFinite(ll[1])) {\r\n                    centerOn(ll, { zoom: 16.4, duration: 600 });\r\n                }\r\n                clearActiveLabel();\r\n            }\r\n        });\r\n\r\n        // Quand on QUITTE l’item, retirer la classe du label\r\n        topicsContainer.addEventListener(\"mouseout\", (e) => {\r\n            const item = e.target.closest(\".map__topicsList-item\");\r\n            if (!item) return;\r\n\r\n            // si on reste à l’intérieur du même item, ne rien faire\r\n            if (e.relatedTarget && item.contains(e.relatedTarget)) return;\r\n\r\n            clearActiveLabel();\r\n        });\r\n\r\n        // (optionnel) si tu veux aussi nettoyer quand on quitte toute la liste :\r\n        topicsContainer.addEventListener(\"mouseleave\", clearActiveLabel);\r\n    }\r\n\r\n    function renderTopicAside() {\r\n        if (!Array.isArray(topics) || !topics.length || !topicsContainer)\r\n            return;\r\n\r\n        const div = document.createElement(\"div\");\r\n        div.className = \"map__topicsList\";\r\n\r\n        topics.forEach((topic) => {\r\n            const item = document.createElement(\"div\");\r\n            item.className = \"map__topicsList-item\";\r\n            item.dataset.topicId = String(topic.id || \"\");\r\n            item.dataset.lng = String(topic.coords?.[0] ?? \"\");\r\n            item.dataset.lat = String(topic.coords?.[1] ?? \"\");\r\n            const safeTitle = topic.title || \"Aucun titre à signaler\";\r\n            item.innerHTML = `\r\n            <div>\r\n                ${\r\n                    topic.lastpost?.avatar\r\n                        ? `<img src=\"${topic.lastpost.avatar}\" alt=\"Avatar\" class=\"map__topicsList-item-avatar\" />`\r\n                        : \"\"\r\n                }\r\n                <div class=\"map__topicsList-item-date\">\r\n                    <span>${topic.lastpost?.date.day || \"\"}</span>\r\n                    <span>${topic.lastpost?.date.month || \"\"}</span>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <h4 class=\"map__topicsList-item-title\"><a class=\"linkStriked\" href=\"${\r\n                    topic.url\r\n                }\">${safeTitle}</a></h4>\r\n                <p class=\"map__topicsList-item-meta\">\r\n                 <span class=\"map__topicsList-item-district\">${\r\n                     districtAtLngLat({\r\n                         lng: topic.coords[0],\r\n                         lat: topic.coords[1],\r\n                     }) || \"Unknown District\"\r\n                 }</span>\r\n                    <a href=\"${\r\n                        topic.lastpost?.user?.profileUrl || \"#\"\r\n                    }\" class=\"map__topicsList-item-author \">\r\n                        <span style=\"background-color:${\r\n                            topic.lastpost?.user?.color || \"inherit\"\r\n                        }\"></span>${\r\n                topic.lastpost?.user?.name.split(\" \")[0][0]\r\n            }. ${topic.lastpost?.user?.name.split(\" \")[1] || \"\"}\r\n                    </a>\r\n                </p>\r\n            </div>\r\n\r\n            `;\r\n            div.appendChild(item);\r\n        });\r\n\r\n        topicsContainer.innerHTML = \"\";\r\n        topicsContainer.appendChild(div);\r\n    }\r\n\r\n    function installUIBindings() {\r\n        // toggle between topic list and new-topic asides via the board button\r\n        boardTrigger?.addEventListener(\"click\", (e) => {\r\n            e?.preventDefault?.();\r\n            layoutBoard?.classList.toggle(\"active\");\r\n            newTopicAside?.classList.remove(\"active\");\r\n        });\r\n    }\r\n\r\n    function onMouseMove(e) {\r\n        if (!cursor) return;\r\n        const outside = !pointIsInDistrict(e.point);\r\n        cursor.classList.toggle(\"out\", outside);\r\n        const { lng, lat } = e.lngLat;\r\n        cursor.dataset.coords = `${decimalToDMSString(\r\n            lng,\r\n            \"lon\",\r\n            4\r\n        )}, ${decimalToDMSString(lat, \"lat\", 4)}`;\r\n    }\r\n\r\n    function onMapClick(e) {\r\n        if (!map) return;\r\n\r\n        // ignore clicks on markers/popups\r\n        if (isMarkerElement(e.originalEvent?.target)) return;\r\n\r\n        // optionally constrain to district layer\r\n        if (!pointIsInDistrict(e.point)) return;\r\n\r\n        // drop/replace a temp marker\r\n        ensureTempMarkerAt(e.lngLat);\r\n\r\n        // zoom in a bit & center on click\r\n        centerOn(e.lngLat, { zoom: 16.4, duration: 600 });\r\n\r\n        // update aside via TopicController\r\n        const dist = districtAtLngLat(e.lngLat);\r\n        topicController?.moveNewTopic(e.lngLat, dist);\r\n        topicController?.openAside();\r\n\r\n        // if we have a subject, show it on the temp marker label\r\n        const currentSubject = topicController?.subjectInput?.value?.trim();\r\n        if (currentSubject) updateTempMarkerLabel(currentSubject);\r\n    }\r\n\r\n    function updateViewportConstraints() {\r\n        if (!map) return;\r\n        map.resize(); // le centre visible = centre du container (pas besoin d'offset)\r\n\r\n        try {\r\n            map.setMaxBounds(INITIAL_BOUNDS); // pas de décalage\r\n            cam = map.cameraForBounds(INITIAL_BOUNDS, {\r\n                padding: { top: 32, right: 32, bottom: 32, left: 32 },\r\n                bearing: map.getBearing(),\r\n                pitch: map.getPitch(),\r\n                maxZoom: clamp(map.getZoom(), 6, 19),\r\n            });\r\n        } catch {}\r\n    }\r\n\r\n    function ensureTempMarkerAt(lngLat) {\r\n        if (!map) return null;\r\n        const pos = Array.isArray(lngLat)\r\n            ? { lng: lngLat[0], lat: lngLat[1] }\r\n            : lngLat;\r\n        if (!tempMarker) {\r\n            const el = document.createElement(\"div\");\r\n            el.className = \"marker temp\";\r\n            el.innerHTML = `<div class=\"marker-label marker-label--temp\" hidden></div><div class='marker-pulse'></div>`;\r\n            tempMarker = new maplibregl.Marker({ element: el }).setLngLat(pos);\r\n            tempMarker.addTo(map);\r\n        } else {\r\n            tempMarker.setLngLat(pos);\r\n        }\r\n        const popupText = `Lng: ${Number(pos.lng).toFixed(6)}\\nLat: ${Number(\r\n            pos.lat\r\n        ).toFixed(6)}`;\r\n        tempMarker.getPopup()?.setText(popupText);\r\n        return tempMarker;\r\n    }\r\n\r\n    function updateTempMarkerLabel(text) {\r\n        if (!tempMarker) return;\r\n        const el = tempMarker.getElement?.() || tempMarker._element || null;\r\n        if (!el) return;\r\n\r\n        let label = el.querySelector(\".marker-label\");\r\n        if (!label) {\r\n            label = document.createElement(\"div\");\r\n            label.className = \"marker-label marker-label--temp\";\r\n            el.prepend(label);\r\n        }\r\n        const t = (text || \"\").trim();\r\n        label.textContent = t;\r\n        label.hidden = !t.length; // affiche si non-vide\r\n    }\r\n\r\n    function open() {\r\n        try {\r\n            if (typeof mapAnimation === \"function\" && trigger && container) {\r\n                trigger.classList.add(\"active\");\r\n                container.classList.remove(\"onLoad\");\r\n                mapAnimation({ container });\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[Map] mapAnimation error:\", err);\r\n        }\r\n    }\r\n\r\n    function close() {\r\n        const tl = safeGetTl();\r\n        if (tl) tl.timeScale(2).reverse();\r\n        trigger?.classList.remove(\"active\");\r\n        layoutBoard?.classList.remove(\"active\");\r\n        newTopicAside?.classList.remove(\"active\");\r\n    }\r\n\r\n    function onTriggerClick(e) {\r\n        e?.preventDefault?.();\r\n        const tl = safeGetTl();\r\n        if (tl && tl.progress() > 0 && !tl.reversed()) {\r\n            close();\r\n            return;\r\n        }\r\n        open();\r\n    }\r\n\r\n    function destroy() {\r\n        aborter.abort();\r\n        trigger?.removeEventListener(\"click\", onTriggerClick);\r\n        boardTrigger?.replaceWith(boardTrigger.cloneNode(true)); // drop listeners\r\n        if (map) {\r\n            try {\r\n                map.off(\"mousemove\", onMove);\r\n                map.off(\"click\", onMapClick);\r\n            } catch {}\r\n            try {\r\n                tempMarker?.remove();\r\n            } catch {}\r\n            try {\r\n                map.remove();\r\n            } catch {}\r\n            map = null;\r\n        }\r\n        try {\r\n            resizeObs?.disconnect();\r\n        } catch {}\r\n    }\r\n\r\n    // ---- init map\r\n    if (!maplibregl) {\r\n        console.error(\r\n            \"[Map] maplibregl missing. Inject the script before init.\"\r\n        );\r\n        return { open, close, destroy };\r\n    }\r\n\r\n    installUIBindings();\r\n\r\n    try {\r\n        map = new maplibregl.Map({\r\n            style: styleUrl,\r\n            center: INITIAL_CENTER,\r\n            pitch: 45,\r\n            bearing: -17.6,\r\n            container: mapHost || selectors.mapContainer,\r\n            canvasContextAttributes: { antialias: true },\r\n            attributionControl: false,\r\n            maxBounds: offsetBoundsByFraction(INITIAL_BOUNDS, -0.18, 0),\r\n            dragRotate: false,\r\n        });\r\n        window.map = map; // debug\r\n\r\n        // topic UI\r\n        topicController = new TopicController({ map });\r\n        topicController?.subjectInput?.addEventListener(\"input\", (e) => {\r\n            updateTempMarkerLabel(e.currentTarget.value);\r\n        });\r\n\r\n        onMove = rafThrottle(onMouseMove);\r\n        map.on(\"mousemove\", onMove);\r\n        map.on(\"click\", onMapClick);\r\n\r\n        map.on(\"load\", () => {\r\n            try {\r\n                cam = map.cameraForBounds(\r\n                    offsetBoundsByFraction(INITIAL_BOUNDS, -0.18, 0),\r\n                    {\r\n                        bearing: -17.6,\r\n                        pitch: 45,\r\n                        maxZoom: 12.62,\r\n                        offset: [-600, 0],\r\n                    }\r\n                );\r\n                if (cam) map.jumpTo(cam);\r\n                map.easeTo({ ...cam, offset: [-600, 0], duration: 600 });\r\n            } catch {}\r\n\r\n            renderTopicMarkers();\r\n            renderTopicAside();\r\n            installTopicHover();\r\n\r\n            try {\r\n                const draft = topicController?.getDraft?.();\r\n                if (draft?.coords) {\r\n                    const coords = Array.isArray(draft.coords)\r\n                        ? { lng: draft.coords[0], lat: draft.coords[1] }\r\n                        : draft.coords;\r\n\r\n                    ensureTempMarkerAt(coords);\r\n                    topicController?.moveNewTopic(\r\n                        [coords.lng, coords.lat],\r\n                        draft.district || null\r\n                    );\r\n                    topicController?.openAside();\r\n                    map.easeTo({\r\n                        ...cam,\r\n                        center: [coords.lng, coords.lat],\r\n                        zoom: Math.max(map.getZoom(), 16.4),\r\n                    });\r\n                    if (draft.subject) updateTempMarkerLabel(draft.subject);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"[Map] init error:\", err);\r\n            }\r\n            updateViewportConstraints();\r\n        });\r\n    } catch (err) {\r\n        console.error(\"[Map] init error:\", err);\r\n    }\r\n\r\n    trigger?.addEventListener(\"click\", onTriggerClick);\r\n\r\n    return { open, close, destroy };\r\n}\r\n","/* présence rp */\r\nconst PRESENCE_FIELD_ID = \"field_id16\";\r\n\r\nconst memoizedStatus = () => {\r\n    let cache = {};\r\n    return (n) => {\r\n        if (n in cache) {\r\n            return cache[n];\r\n        } else {\r\n            var result = \"\";\r\n            switch (n) {\r\n                case \"Présent(e)\":\r\n                    result = \"present\";\r\n                    break;\r\n                case \"Réduite\":\r\n                    result = \"slowed\";\r\n                    break;\r\n                case \"Absent(e)\":\r\n                    result = \"away\";\r\n                    break;\r\n            }\r\n            cache[n] = result;\r\n            return result;\r\n        }\r\n    };\r\n};\r\nconst getStatus = memoizedStatus();\r\n\r\nconst user_anchors = document.querySelectorAll('a[href^=\"/u\"]');\r\n\r\nconst getUsersPresence = () => {\r\n    const user_list = {};\r\n    user_anchors.forEach((el) => {\r\n        const user_url = el.pathname;\r\n        const user_id = el.pathname.slice(2);\r\n        user_list[user_id] = user_url;\r\n    });\r\n    return user_list;\r\n};\r\n\r\nconst parseUsersPresence = async (id, url) => {\r\n    const user_list = [];\r\n    await fetch(url)\r\n        .then((res) => res.text())\r\n        .then((html) => {\r\n            var parser = new DOMParser();\r\n            var doc = parser.parseFromString(html, \"text/html\");\r\n            user_list.push({\r\n                id,\r\n                status: doc.querySelector(\r\n                    `#${PRESENCE_FIELD_ID} div.field_uneditable`\r\n                ).innerText,\r\n            });\r\n        });\r\n    user_list.forEach((obj) => {\r\n        document\r\n            .querySelectorAll(`a[href=\"/u${obj.id}\"] strong`)\r\n            .forEach((el) => {\r\n                const statusElement = document.createElement(\"span\");\r\n                statusElement.classList.add(\"status\", getStatus(obj.status));\r\n\r\n                el.appendChild(statusElement);\r\n            });\r\n    });\r\n};\r\n\r\nexport class Presence {\r\n    constructor() {\r\n        for (const [id, url] of Object.entries(getUsersPresence())) {\r\n            parseUsersPresence(id, url);\r\n        }\r\n    }\r\n}\r\n\r\n/* présence rp */\r\n","import { Presence } from \"./Presence.js\";\r\n\r\nlet teardown = null;\r\n\r\nexport function initMenu() {\r\n  if (teardown) teardown();\r\n\r\n  const btn = document.getElementById(\"menu\");\r\n  const sidebar = document.getElementById(\"sidebar\");\r\n\r\n  if (!btn || !sidebar) {\r\n    teardown = null;\r\n    return () => {};\r\n  }\r\n\r\n  const isOpen = () => sidebar.classList.contains(\"open\");\r\n  const setOpen = (open) => {\r\n    sidebar.classList.toggle(\"open\", open);\r\n    btn.classList.toggle(\"active\", open);\r\n    btn.setAttribute(\"aria-expanded\", open ? \"true\" : \"false\");\r\n  };\r\n  const toggle = () => setOpen(!isOpen());\r\n\r\n  const onBtnClick = (e) => {\r\n    e.stopPropagation();\r\n    toggle();\r\n  };\r\n\r\n  const onDocClick = (e) => {\r\n    if (!e.target.closest(\".layout__menu\") && isOpen()) setOpen(false);\r\n  };\r\n\r\n  const onKeyDown = (e) => {\r\n    if (e.key === \"Escape\" && isOpen()) setOpen(false);\r\n  };\r\n\r\n  btn.addEventListener(\"click\", onBtnClick);\r\n  document.documentElement.addEventListener(\"click\", onDocClick);\r\n  document.addEventListener(\"keydown\", onKeyDown);\r\n\r\n  setOpen(isOpen());\r\n\r\n  teardown = () => {\r\n    btn.removeEventListener(\"click\", onBtnClick);\r\n    document.documentElement.removeEventListener(\"click\", onDocClick);\r\n    document.removeEventListener(\"keydown\", onKeyDown);\r\n  };\r\n\r\n  /* init presence */\r\n  new Presence();\r\n\r\n  return teardown;\r\n}\r\n","// faq.js — refactor, accessible & resilient\r\n// --------------------------------------\r\n// - Works standalone or with Context.container (keeps your pattern)\r\n// - Robust DOM guards; no hard crashes if a piece is missing\r\n// - Keyboard navigation (←/→, Home/End) with proper ARIA roles\r\n// - Hash deep-link (#<data-id>) support without scroll jump\r\n// - Resize-aware: slider repositions and container height adapts to dynamic content\r\n// - Public API: goTo(id|index), next(), prev(), destroy()\r\n\r\nimport Context from \"../core/context.js\";\r\nimport { getGlobalTimeline } from \"../animations/navigation.js\";\r\n\r\n/**\r\n * @typedef {Object} FAQOptions\r\n * @property {HTMLElement} [container] - root container (defaults to Context.container)\r\n * @property {boolean} [updateHash] - update URL hash when switching tabs\r\n * @property {number} [duration] - animation duration in ms\r\n */\r\n\r\nexport function initFAQScripts(/** @type {FAQOptions} */ opts = {}) {\r\n    const updateHash = opts.updateHash ?? true;\r\n    const DURATION = opts.duration ?? 500;\r\n\r\n    // --- DOM nodes\r\n    const root = opts.container || Context.container || document;\r\n    const faq = root?.querySelector?.(\".faq\");\r\n    if (!faq) {\r\n        console.warn(\"[FAQ] .faq root not found\");\r\n        return blankAPI();\r\n    }\r\n\r\n    const slider = faq.querySelector(\".faq__tab-slider\") || createSlider(faq);\r\n    const scroller = faq.querySelector(\".faq__scroll\");\r\n    const panels = Array.from(faq.querySelectorAll(\".faq__content\"));\r\n    const tabs = Array.from(faq.querySelectorAll(\".faq__tab\"));\r\n    const container = faq.querySelector(\".faq__container\") || faq;\r\n    const tablist = slider?.parentElement || tabs[0]?.parentElement || faq;\r\n\r\n    if (!scroller || !tabs.length || !panels.length) {\r\n        console.warn(\"[FAQ] Missing pieces: \", {\r\n            scroller: !!scroller,\r\n            tabs: tabs.length,\r\n            panels: panels.length,\r\n        });\r\n        return blankAPI();\r\n    }\r\n\r\n    // Normalize indexes & ids\r\n    tabs.forEach((t, i) => {\r\n        if (!t.dataset.idx) t.dataset.idx = String(i);\r\n        if (!t.id) t.id = `faq-tab-${i}`;\r\n        t.setAttribute(\"role\", \"tab\");\r\n        t.setAttribute(\"tabindex\", \"-1\");\r\n        t.setAttribute(\"aria-selected\", \"false\");\r\n    });\r\n    panels.forEach((p, i) => {\r\n        p.setAttribute(\"role\", \"tabpanel\");\r\n        p.setAttribute(\"aria-labelledby\", tabs[i]?.id || `faq-tab-${i}`);\r\n    });\r\n    tablist?.setAttribute?.(\"role\", \"tablist\");\r\n\r\n    // State\r\n    let activeIndex = 0;\r\n    let ro = null; // ResizeObserver on current panel\r\n    let destroyed = false;\r\n\r\n    // --- helpers\r\n    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));\r\n    const difference = (a, b) => Math.abs(a - b);\r\n\r\n    function createSlider(faq) {\r\n        const s = document.createElement(\"div\");\r\n        s.className = \"faq__tab-slider\";\r\n        faq.querySelector(\".faq__tabs\")?.appendChild(s) || faq.appendChild(s);\r\n        return s;\r\n    }\r\n\r\n    function getTabBox(el) {\r\n        const target = el.parentElement || el; // supports <li><button.faq__tab></button></li>\r\n        return { left: target.offsetLeft, width: target.offsetWidth };\r\n    }\r\n\r\n    function moveSliderTo(el, wideJump = false) {\r\n        if (!slider || !el) return;\r\n\r\n        const { left: toLeft, width: toWidth } = getTabBox(el);\r\n\r\n        // mesures “from”\r\n        const fromLeft = Number.parseFloat(slider.style.left || 0) || 0;\r\n        const fromWidth =\r\n            Number.parseFloat(slider.style.width || 0) ||\r\n            getTabBox(tabs[activeIndex])?.width ||\r\n            toWidth;\r\n\r\n        // 1) timeline injectée > 2) timeline globale > 3) gsap global > 4) WAAPI > 5) styles\r\n        let tl = null;\r\n        try {\r\n            tl =\r\n                injectedTimeline && typeof injectedTimeline.to === \"function\"\r\n                    ? injectedTimeline\r\n                    : typeof getGlobalTimeline === \"function\"\r\n                    ? getGlobalTimeline()\r\n                    : null;\r\n        } catch {\r\n            tl = null;\r\n        }\r\n\r\n        const gs =\r\n            window.gsap && typeof window.gsap.to === \"function\"\r\n                ? window.gsap\r\n                : null;\r\n        const durationSec = DURATION / 1000;\r\n\r\n        if (tl && typeof tl.to === \"function\") {\r\n            // On évite la troisième arg “0” qui force l’insertion au début du TL.\r\n            tl.to(slider, {\r\n                left: `${toLeft}px`,\r\n                width: `${toWidth}px`,\r\n                ease: \"power2.inOut\",\r\n                duration: durationSec,\r\n                overwrite: \"auto\",\r\n            });\r\n        } else if (gs) {\r\n            gs.to(slider, {\r\n                left: `${toLeft}px`,\r\n                width: `${toWidth}px`,\r\n                ease: \"power2.inOut\",\r\n                duration: durationSec,\r\n                overwrite: \"auto\",\r\n            });\r\n        } else if (slider.animate) {\r\n            // Fallback WAAPI\r\n            const widths = wideJump\r\n                ? [\r\n                      `${fromWidth}px`,\r\n                      `${Math.max(200, (fromWidth + toWidth) / 2)}px`,\r\n                      `${toWidth}px`,\r\n                  ]\r\n                : [`${fromWidth}px`, `${toWidth}px`];\r\n            const lefts = wideJump\r\n                ? [`${fromLeft}px`, `${toLeft}px`, `${toLeft}px`]\r\n                : [`${fromLeft}px`, `${toLeft}px`];\r\n\r\n            slider.animate(\r\n                { left: lefts, width: widths },\r\n                {\r\n                    duration: DURATION,\r\n                    fill: \"forwards\",\r\n                    easing: \"cubic-bezier(0.4,0,0.2,1)\",\r\n                }\r\n            );\r\n            // pour les navigateurs sans WAAPI persistante\r\n            slider.style.left = `${toLeft}px`;\r\n            slider.style.width = `${toWidth}px`;\r\n        } else {\r\n            // Fallback styles direct\r\n            slider.style.left = `${toLeft}px`;\r\n            slider.style.width = `${toWidth}px`;\r\n        }\r\n    }\r\n\r\n    function translateTo(idx) {\r\n        scroller.style.transform = `translateX(${idx * -100}%)`;\r\n    }\r\n\r\n    function ensureHeight(idx) {\r\n        const content = panels[idx]?.querySelector?.(\".content\") || panels[idx];\r\n        if (!content) return;\r\n        const h = Math.max(\r\n            content.scrollHeight,\r\n            content.getBoundingClientRect().height\r\n        );\r\n        container.style.height = `${h}px`;\r\n\r\n        // Observe size changes of current panel\r\n        if (ro) {\r\n            try {\r\n                ro.disconnect();\r\n            } catch {}\r\n        }\r\n        if (window.ResizeObserver) {\r\n            ro = new ResizeObserver(() => {\r\n                const hh = Math.max(\r\n                    content.scrollHeight,\r\n                    content.getBoundingClientRect().height\r\n                );\r\n                container.style.height = `${hh}px`;\r\n            });\r\n            ro.observe(content);\r\n        }\r\n    }\r\n\r\n    function setActive(index, sourceEl) {\r\n        index = clamp(index, 0, tabs.length - 1);\r\n        const prev = activeIndex;\r\n        activeIndex = index;\r\n\r\n        tabs.forEach((t, i) => {\r\n            const isActive = i === index;\r\n            t.classList.toggle(\"active\", isActive);\r\n            t.setAttribute(\"aria-selected\", isActive ? \"true\" : \"false\");\r\n            t.setAttribute(\"tabindex\", isActive ? \"0\" : \"-1\");\r\n        });\r\n\r\n        translateTo(index);\r\n        ensureHeight(index);\r\n        moveSliderTo(tabs[index], difference(prev, index) > 1);\r\n\r\n        if (updateHash) {\r\n            const id = tabs[index].dataset.id || `${index}`;\r\n            const url = new URL(location.href);\r\n            url.hash = id;\r\n            history.replaceState(null, \"\", url); // no scroll jump\r\n        }\r\n\r\n        // keep focus on clicked tab for a11y\r\n        if (sourceEl === true) tabs[index].focus();\r\n    }\r\n\r\n    // --- events\r\n    function onTabClick(e) {\r\n        const el = e.currentTarget;\r\n        const idx = Number(el.dataset.idx || 0);\r\n        setActive(idx, true);\r\n    }\r\n\r\n    function onKeydown(e) {\r\n        const { key } = e;\r\n        // Only handle keys if focus is within the tablist\r\n        if (!tablist.contains(document.activeElement)) return;\r\n        let idx = activeIndex;\r\n        if (key === \"ArrowRight\") {\r\n            idx = clamp(activeIndex + 1, 0, tabs.length - 1);\r\n        } else if (key === \"ArrowLeft\") {\r\n            idx = clamp(activeIndex - 1, 0, tabs.length - 1);\r\n        } else if (key === \"Home\") {\r\n            idx = 0;\r\n        } else if (key === \"End\") {\r\n            idx = tabs.length - 1;\r\n        } else return;\r\n        e.preventDefault();\r\n        setActive(idx, true);\r\n    }\r\n\r\n    function onResize() {\r\n        // Recompute slider position and container height for the active tab\r\n        moveSliderTo(tabs[activeIndex], false);\r\n        ensureHeight(activeIndex);\r\n    }\r\n\r\n    // Attach listeners\r\n    tabs.forEach((t) => t.addEventListener(\"click\", onTabClick));\r\n    window.addEventListener(\"keydown\", onKeydown, true);\r\n    window.addEventListener(\"resize\", onResize);\r\n\r\n    // --- init view\r\n    try {\r\n        // initial from hash\r\n        let startIndex = 0;\r\n        if (window.location.hash) {\r\n            const id = decodeURIComponent(window.location.hash.substring(1));\r\n            const found = tabs.findIndex((el) => (el.dataset.id || \"\") == id);\r\n            if (found >= 0) startIndex = found;\r\n        }\r\n        setActive(startIndex, false);\r\n        slider?.classList.add(\"visible\");\r\n    } catch (e) {\r\n        console.log(\"FAQ init error:\", e);\r\n    }\r\n\r\n    // --- public API\r\n    function goTo(target) {\r\n        if (destroyed) return;\r\n        if (typeof target === \"number\") setActive(target, true);\r\n        else if (typeof target === \"string\") {\r\n            const found = tabs.findIndex(\r\n                (el) => (el.dataset.id || \"\") === target\r\n            );\r\n            if (found >= 0) setActive(found, true);\r\n        }\r\n    }\r\n    function next() {\r\n        goTo(activeIndex + 1);\r\n    }\r\n    function prev() {\r\n        goTo(activeIndex - 1);\r\n    }\r\n    function destroy() {\r\n        destroyed = true;\r\n        tabs.forEach((t) => t.removeEventListener(\"click\", onTabClick));\r\n        window.removeEventListener(\"keydown\", onKeydown, true);\r\n        window.removeEventListener(\"resize\", onResize);\r\n        try {\r\n            ro?.disconnect();\r\n        } catch {}\r\n    }\r\n\r\n    return { goTo, next, prev, destroy };\r\n}\r\n\r\nfunction blankAPI() {\r\n    return {\r\n        goTo: () => {},\r\n        next: () => {},\r\n        prev: () => {},\r\n        destroy: () => {},\r\n    };\r\n}\r\n","import { qs } from \"../core/utils.js\";\r\nimport { getGlobalTimeline, mapAnimation } from \"../animations/navigation.js\";\r\n\r\nimport { createMapController } from \"../ui/MapController.js\";\r\nimport { initMenu } from \"../ui/MenuController.js\";\r\n\r\nconst els = {\r\n    menuButton: qs(document, \"#menu\"),\r\n    panel: qs(document, \"#board\"),\r\n    cursor: qs(document, \"#cursor\"),\r\n    cursorFollow: qs(document, \"#cursorFollow\"),\r\n    mapPanel: qs(document, \"#mapPanel\"),\r\n};\r\n\r\nexport function initLayoutScripts(opts = {}) {\r\n    // MAP\r\n    const mapCtrl = createMapController({\r\n        animations: { mapAnimation, getGlobalTimeline },\r\n    });\r\n    // Hooks Barba (optionnels si tu utilises Barba)\r\n    if (window.barba?.hooks) {\r\n        barba.hooks.beforeLeave(() => {\r\n            try {\r\n                mapCtrl.close();\r\n            } catch {}\r\n        });\r\n    }\r\n\r\n    initMenu();\r\n\r\n    return {\r\n        destroy() {\r\n            mapCtrl.destroy();\r\n        },\r\n        closeAll() {\r\n            mapCtrl.close();\r\n        },\r\n    };\r\n}\r\n\r\nfunction page_type() {\r\n    const p = location.pathname;\r\n    if (/^\\/t[1-9][0-9]*(p[1-9][0-9]*)?-/.test(p)) return \"topic\";\r\n    if (/^\\/f[1-9][0-9]*(p[1-9][0-9]*)?-/.test(p)) return \"forum\";\r\n    if (\r\n        document\r\n            .querySelector(\"#i_icon_mini_index\")\r\n            ?.parentElement?.getAttribute(\"href\") === p ||\r\n        p === \"/\"\r\n    )\r\n        return \"index\";\r\n    if (/^\\/post/.test(p)) return \"editor\";\r\n    if (/^\\/c[1-9][0-9]*-/.test(p)) return \"category\";\r\n    const qs = p + location.search;\r\n    const m = qs.match(/\\/modcp\\?mode=([^&]+)/);\r\n    return m ? m[1] : \"\";\r\n}\r\n\r\nasync function defaultFetchForums() {\r\n    if (page_type() === \"index\") {\r\n        const el = document.querySelector(\"#js-board\");\r\n        if (el) el.innerHTML = \"\";\r\n    }\r\n    const res = await fetch(\"/\");\r\n    const html = await res.text();\r\n    const parser = new DOMParser();\r\n    return parser.parseFromString(html, \"text/html\");\r\n}\r\n\r\nfunction initMap() {\r\n    const trigger = qs(document, \"#navigate\");\r\n    const panel = qs(document, \"#map\");\r\n\r\n    async function onClick(e) {\r\n        e.preventDefault();\r\n\r\n        // Si une timeline est active, on ferme (reverse) comme dans menu.js\r\n        const tl =\r\n            (typeof getGlobalTimeline === \"function\" && getGlobalTimeline()) ||\r\n            null;\r\n        if (tl) {\r\n            trigger.classList.remove(\"active\");\r\n            tl.timeScale(2).reverse(); // fermeture accélérée\r\n            return;\r\n        }\r\n\r\n        // Ouverture\r\n        try {\r\n            trigger.classList.add(\"active\");\r\n\r\n            // Lance tes anims d'ouverture (doit définir window.globalTimeline en interne)\r\n            mapAnimation();\r\n        } catch (err) {\r\n            console.error(\"[HomeMenu] fetch/open error:\", err);\r\n        }\r\n    }\r\n\r\n    trigger.addEventListener(\"click\", onClick);\r\n\r\n    const map = new maplibregl.Map({\r\n        style: `http://127.0.0.1:8080/dark_matter.json`,\r\n        center: [4.905115848796186, 52.36171966529636], // Amsterdam\r\n        zoom: 12.64072662255258,\r\n        pitch: 45,\r\n        bearing: -17.6,\r\n        container: document.querySelector(\"#map-content\"),\r\n        canvasContextAttributes: { antialias: true },\r\n        attributionControl: false,\r\n        maxBounds: [\r\n            [4.737470306116194, 52.31534775089125],\r\n            [5.00319881008906, 52.4543176657192],\r\n        ],\r\n    });\r\n\r\n    map.on(\"load\", () => panel.classList.remove(\"onLoad\"));\r\n\r\n    if (!map) return;\r\n\r\n    map.on(\"mousemove\", (e) => {\r\n        // j'ai besoin d'avoir les coordonnées latitutde/longitude du point sous le curseur\r\n        const coords = e.lngLat;\r\n        console.log(`Longitude: ${coords.lng}, Latitude: ${coords.lat}`);\r\n        els.cursor.dataset.coords = `${coords.lng.toFixed(\r\n            5\r\n        )}, ${coords.lat.toFixed(5)}`;\r\n    });\r\n\r\n    map.on(\"click\", (e) => {\r\n        const t = e.originalEvent?.target;\r\n        if (t && t.closest(\".marker, .maplibregl-marker, .mapboxgl-marker\"))\r\n            return;\r\n        const popup = new maplibregl.Popup({ offset: 25 }).setText(\r\n            \"Construction on the Washington Monument began in 1848.\"\r\n        );\r\n\r\n        /* else, open side panel */\r\n        console.log(\"click map\", e.lngLat);\r\n        els.mapPanel.classList.add(\"active\");\r\n\r\n        // create DOM element for the marker\r\n        const el = document.createElement(\"div\");\r\n        el.className = \"marker\";\r\n        el.innerHTML = `<div class=\"marker-label\">Frankfurt</div><div class='marker-pulse'></div>`;\r\n\r\n        /* [\"click\", \"pointerdown\", \"pointerup\", \"mousedown\", \"mouseup\"].forEach(\r\n            (evt) => el.addEventListener(evt, (ev) => ev.stopPropagation())\r\n        ); */\r\n\r\n        // create the marker\r\n        new maplibregl.Marker({ element: el })\r\n            .setLngLat(e.lngLat)\r\n            .setPopup(popup) // sets a popup on this marker\r\n            .addTo(map);\r\n    });\r\n}\r\n","import Context from \"../core/context.js\";\r\nimport { qsa } from \"../core/utils.js\";\r\n\r\nconst DIRECTIONS = [\"top\", \"right\", \"bottom\", \"left\"];\r\nconst SYMBOLS = [\r\n    \"🜁\",\r\n    \"🜃\",\r\n    \"🜂\",\r\n    \"🜄\",\r\n    \"🜍\",\r\n    \"☿\",\r\n    \"🜔\",\r\n    \"☉\",\r\n    \"☿\",\r\n    \"♃\",\r\n    \"♁\",\r\n    \"♆\",\r\n    \"🜊\",\r\n    \"🜅\",\r\n    \"🜖\",\r\n    \"🜋\",\r\n    \"🜏\",\r\n    \"♈︎\",\r\n    \"♉︎\",\r\n    \"♊︎\",\r\n    \"♋︎\",\r\n    \"♌︎\",\r\n    \"♍︎\",\r\n    \"♎︎\",\r\n    \"♏︎\",\r\n    \"♐︎\",\r\n    \"♑︎\",\r\n    \"♒︎\",\r\n    \"♓︎\",\r\n];\r\n\r\nfunction randomlyAddedSymbols() {\r\n    const howMany = Math.floor(Math.random() * 4) + 1; // 1..4\r\n    const dirs = [...DIRECTIONS].sort(() => Math.random() - 0.5);\r\n    const out = [];\r\n    for (let i = 0; i < howMany; i++) {\r\n        out.push({\r\n            direction: dirs[i],\r\n            symbol: SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\r\n        });\r\n    }\r\n    return out;\r\n}\r\n\r\nfunction escapeHTML(s) {\r\n    return s.replace(\r\n        /[&<>\"']/g,\r\n        (m) =>\r\n            ({\r\n                \"&\": \"&amp;\",\r\n                \"<\": \"&lt;\",\r\n                \">\": \"&gt;\",\r\n                '\"': \"&quot;\",\r\n                \"'\": \"&#39;\",\r\n            }[m])\r\n    );\r\n}\r\n\r\nfunction renderLetter(char) {\r\n    // Cas espace : pas de symboles, et la classe est .space\r\n    if (char === \" \") {\r\n        return `<span class=\"space\"><span>&nbsp;</span></span>`;\r\n    }\r\n\r\n    const extras = randomlyAddedSymbols();\r\n    const charHTML = escapeHTML(char);\r\n    const extraHTML = extras\r\n        .map(\r\n            ({ symbol, direction }) =>\r\n                `<i class=\"symbol ${direction}\" data-dir=\"${direction}\">${symbol}</i>`\r\n        )\r\n        .join(\"\");\r\n\r\n    return `<span class=\"letter\"><span class=\"e-letter\">${charHTML}</span><span class=\"t-letter\">${charHTML}</span><b></b>${extraHTML}</span>`;\r\n}\r\n\r\nexport function initEnochian(container = Context.container) {\r\n    // Initialize Enochian UI components here\r\n    qsa(container, \"enoch\").forEach((el) => {\r\n        // split each letter into a span\r\n        const text = el.textContent;\r\n        el.innerHTML = text\r\n            .toLowerCase()\r\n            /* replace tout ce qui n'est pas une lettre de a à z ou un espace */\r\n            .toString()\r\n            .normalize(\"NFD\")\r\n            .trim()\r\n            .replace(/[^a-z ]/g, \"\")\r\n            .split(\"\")\r\n            .map(renderLetter)\r\n            .join(\"\");\r\n    });\r\n}\r\n","const CFG = {\r\n    baseUrl: \"/calendar\",\r\n    param: \"start\", // /calendar?start=YYYYMMDD\r\n    containerSel: \".calendar__container\",\r\n    yearBlockSel: \".calendar__year\",\r\n    yearTitleSel: \"h2\",\r\n    yearDlSel: \"article > dl\",\r\n    eventSel: \".calendar__event\",\r\n    maxInitialPreviousYears: 5, // préchargement initial max\r\n    maxTotalYears: 20, // plafond global (sécurité)\r\n    rootMarginIO: \"800px 0px\", // déclenchement anticipé\r\n};\r\n\r\n/* ========= CACHE ========= */\r\nconst YEAR_CACHE = {\r\n    key: (y) => `calendar.timeline.year.${y}`,\r\n    ttlMs: 3 * 60 * 60 * 1000, // 3h\r\n\r\n    read(y) {\r\n        try {\r\n            return JSON.parse(localStorage.getItem(this.key(y)));\r\n        } catch {\r\n            return null;\r\n        }\r\n    },\r\n    write(y, events) {\r\n        const payload = {\r\n            version: 1,\r\n            updatedAt: Date.now(),\r\n            checkedAt: Date.now(),\r\n            events,\r\n        };\r\n        localStorage.setItem(this.key(y), JSON.stringify(payload));\r\n        return payload;\r\n    },\r\n    isStale(y) {\r\n        const c = this.read(y);\r\n        if (!c) return true;\r\n        return Date.now() - (c.checkedAt || 0) > this.ttlMs;\r\n    },\r\n    touch(y) {\r\n        const c = this.read(y) || {};\r\n        c.checkedAt = Date.now();\r\n        localStorage.setItem(this.key(y), JSON.stringify(c));\r\n    },\r\n};\r\n\r\nconst YEAR_REFRESH = new Map(); // y -> timeoutId\r\n\r\n// --- Kill switch Barba (minimale) ---\r\nexport const CalendarKill = {\r\n    active: false,\r\n    container: null,\r\n    io: null,\r\n    sentinel: null,\r\n\r\n    activate(container) {\r\n        this.active = true;\r\n        this.container = container || document;\r\n    },\r\n    kill() {\r\n        this.active = false;\r\n\r\n        // 1) couper l'observer d'infinite scroll\r\n        if (this.io) {\r\n            try {\r\n                this.io.disconnect();\r\n            } catch {}\r\n            this.io = null;\r\n        }\r\n\r\n        // 2) retirer le sentinel (évite de relancer l’IO via layout)\r\n        if (this.sentinel?.parentNode) {\r\n            this.sentinel.remove();\r\n        }\r\n        this.sentinel = null;\r\n\r\n        // 3) stopper tous les refresh timers (Map existante)\r\n        for (const [, id] of YEAR_REFRESH) clearTimeout(id);\r\n        YEAR_REFRESH.clear();\r\n\r\n        // (optionnel) oublier le container\r\n        this.container = null;\r\n    },\r\n};\r\n\r\n// normalisation des events stockés (léger, trié)\r\nconst normalizeEvents = (events) =>\r\n    events\r\n        .map(({ ts, label, title, href, meta }) => ({\r\n            ts,\r\n            label,\r\n            title,\r\n            href,\r\n            meta,\r\n        }))\r\n        .sort((a, b) => a.ts - b.ts);\r\n\r\n// comparaison rapide cache vs frais (clé = année+label+href)\r\nconst _evKey = (y, e) => `${y}::${e.label}::${e.href || \"\"}`;\r\nconst sameEventSet = (y, a = [], b = []) => {\r\n    if (a.length !== b.length) return false;\r\n    const A = new Set(a.map((e) => _evKey(y, e)));\r\n    for (const e of b) if (!A.has(_evKey(y, e))) return false;\r\n    return true;\r\n};\r\n/* ======== /CACHE ======== */\r\n\r\nconst pad2 = (n) => String(n).padStart(2, \"0\");\r\nconst toStart = (y, m) => `${y}${pad2(m)}01`;\r\n\r\nconst $ = (root, sel) => root.querySelector(sel);\r\nconst $$ = (root, sel) => Array.from(root.querySelectorAll(sel));\r\nconst htmlToDoc = (html) => new DOMParser().parseFromString(html, \"text/html\");\r\n\r\nconst getContainer = () => $(document, CFG.containerSel) || document.body;\r\n\r\nfunction extractOverviewHtmlFromAttr(attr) {\r\n    if (!attr) return null;\r\n    // essaie d'abord la version '...' puis \"...\"\r\n    let m = attr.match(/createTitle\\(\\s*this\\s*,\\s*'([\\s\\S]*?)'\\s*,/);\r\n    if (!m) m = attr.match(/createTitle\\(\\s*this\\s*,\\s*\"([\\s\\S]*?)\"\\s*,/);\r\n    if (!m) return null;\r\n\r\n    // dé-échappe les quotes JS \\', \\\"\r\n    let s = m[1].replace(/\\\\'/g, \"'\").replace(/\\\\\"/g, '\"');\r\n    return s;\r\n}\r\nfunction parseOverviewMeta(html) {\r\n    const wrap = document.createElement(\"div\");\r\n    wrap.innerHTML = html;\r\n\r\n    const titleName =\r\n        wrap.querySelector(\".title-overview\")?.textContent?.trim() || \"\";\r\n\r\n    const author = (() => {\r\n        const p = Array.from(wrap.querySelectorAll(\"p\")).find((el) =>\r\n            /Auteur\\s*:/.test(el.textContent)\r\n        );\r\n        if (!p) return \"\";\r\n        const txt = p.textContent.replace(/\\s+/g, \" \").trim();\r\n        const m = txt.match(/Auteur\\s*:\\s*([^|<\\n\\r]+)/i);\r\n        return m ? m[1].trim() : \"\";\r\n    })();\r\n\r\n    const linkedDateText = (() => {\r\n        const p = Array.from(wrap.querySelectorAll(\"p\")).find((el) =>\r\n            /Sujets\\s+liés\\s*:/.test(el.textContent)\r\n        );\r\n        if (!p) return \"\";\r\n        const txt = p.textContent.replace(/\\s+/g, \" \").trim();\r\n        const m = txt.match(/Sujets\\s+liés\\s*:\\s*(.+)$/i);\r\n        return m ? m[1].trim() : \"\";\r\n    })();\r\n\r\n    const excerpt = wrap.querySelector(\"#msg_ov\")?.textContent?.trim() || \"\";\r\n\r\n    return { titleName, author, linkedDateText, excerpt };\r\n}\r\nfunction escapeHtml(s) {\r\n    const span = document.createElement(\"span\");\r\n    span.textContent = s ?? \"\";\r\n    return span.innerHTML;\r\n}\r\n\r\nconst yearNow = () => new Date().getFullYear();\r\n\r\nconst getLoadedYears = () =>\r\n    $$(getContainer(), `${CFG.yearBlockSel} ${CFG.yearTitleSel}`)\r\n        .map((h2) => Number(h2.textContent.trim()))\r\n        .filter((y) => !Number.isNaN(y))\r\n        .sort((a, b) => a - b);\r\n\r\nconst getYearBlock = (y) =>\r\n    $$(getContainer(), CFG.yearBlockSel).find(\r\n        (b) => $(b, CFG.yearTitleSel)?.textContent.trim() === String(y)\r\n    ) || null;\r\n\r\nfunction ensureYearBlock(y) {\r\n    let block = getYearBlock(y);\r\n    if (block) return block;\r\n\r\n    block = document.createElement(\"div\");\r\n    block.className = \"calendar__year grid grid--ratioReversed hasLines\";\r\n    block.innerHTML = `\r\n    <hr class=\"br\" style=\"height: 100%;\">\r\n    <h2>${y}</h2>\r\n    <article><dl></dl></article>\r\n  `;\r\n\r\n    const container = getContainer();\r\n    const sentinel = container.querySelector(\r\n        '[data-cal-sentinel-bottom=\"true\"]'\r\n    );\r\n\r\n    // ✅ garde le sentinel tout en bas : on insère l'année juste avant lui\r\n    if (sentinel) {\r\n        container.insertBefore(block, sentinel);\r\n    } else {\r\n        container.appendChild(block);\r\n    }\r\n    return block;\r\n}\r\n\r\nconst getYearDl = (y) => $(ensureYearBlock(y), CFG.yearDlSel);\r\n\r\n// clé anti-doublon : année + jour/mois + href sujet\r\nconst eventKey = (y, label, href) => `${y}::${label}::${href || \"\"}`;\r\n\r\n// --- parsing d’un .calendar__event ---\r\nfunction parseEventNode(evNode) {\r\n    // 1) ancre \"scheduler\" pour la date (timestamp ?d=...)\r\n    const dateA = evNode.querySelector(\".calendar-day-date\");\r\n\r\n    // 2) **seulement** le lien de sujet /t[ID]-slug\r\n    const topicA = Array.from(evNode.querySelectorAll(\"a\")).find((a) =>\r\n        /^\\/t\\d+-/i.test(a.getAttribute(\"href\") || \"\")\r\n    );\r\n\r\n    if (!topicA) return null; // ignore \"—\" ou autres liens non /t…\r\n\r\n    // --- timestamp ---\r\n    let ts = null;\r\n    if (dateA) {\r\n        try {\r\n            const u = new URL(dateA.getAttribute(\"href\"), location.origin);\r\n            const d = u.searchParams.get(\"d\");\r\n            if (d) ts = Number(d) * 1000;\r\n        } catch {}\r\n    }\r\n    if (!ts && dateA) {\r\n        const txt = dateA.textContent.trim(); // ex \"Sam 13 Sep 2025\"\r\n        const guessed = Date.parse(txt.replace(/^[A-Za-zéûç]+\\s+/i, \"\")); // retire \"Sam \"\r\n        if (!Number.isNaN(guessed)) ts = guessed;\r\n    }\r\n    if (!ts) return null;\r\n\r\n    const d = new Date(ts);\r\n    const year = d.getFullYear();\r\n    const label = `${String(d.getDate()).padStart(2, \"0\")}.${String(\r\n        d.getMonth() + 1\r\n    ).padStart(2, \"0\")}`;\r\n\r\n    const href = topicA.getAttribute(\"href\") || \"\";\r\n    const title = (topicA.textContent || \"\").trim();\r\n\r\n    // --- meta depuis onmouseover / onmousemove ---\r\n    const mouseAttr =\r\n        topicA.getAttribute(\"onmouseover\") ||\r\n        topicA.getAttribute(\"onmousemove\") ||\r\n        \"\";\r\n    let meta = null;\r\n    const overviewHtml = extractOverviewHtmlFromAttr(mouseAttr);\r\n    if (overviewHtml) {\r\n        meta = parseOverviewMeta(overviewHtml); // { titleName, author, linkedDateText, excerpt }\r\n    }\r\n\r\n    return { ts, year, label, title, href, meta };\r\n}\r\n\r\n// --- collecte des événements d’un document (page en cours ou fetch mensuel) ---\r\nfunction collectEventsFromDoc(doc) {\r\n    return $$(doc, CFG.eventSel)\r\n        .map(parseEventNode)\r\n        .filter(Boolean)\r\n        .sort((a, b) => a.ts - b.ts);\r\n}\r\n\r\n// --- injection dans <dl> d’une année ---\r\nfunction appendEventsToYear(y, events, seenSet) {\r\n    if (!events.length) return;\r\n    const article = $(ensureYearBlock(y), \"article\");\r\n    const dl = document.createElement(\"dl\");\r\n\r\n    for (const e of events) {\r\n        const key = eventKey(y, e.label, e.href);\r\n        console.log(e);\r\n        if (seenSet.has(key)) continue;\r\n        seenSet.add(key);\r\n\r\n        const dt = document.createElement(\"dt\");\r\n        dt.textContent = e.label;\r\n\r\n        const dd = document.createElement(\"dd\");\r\n        if (e.href) {\r\n            const a = document.createElement(\"a\");\r\n            a.href = e.href;\r\n            a.textContent = e.title || e.href;\r\n            dd.appendChild(a);\r\n        } else {\r\n            dd.textContent = e.title || \"—\";\r\n        }\r\n\r\n        dl.append(dt, dd);\r\n    }\r\n\r\n    if (dl.childNodes.length) article.appendChild(dl);\r\n}\r\n\r\nfunction replaceYearEvents(y, events) {\r\n    const block = ensureYearBlock(y);\r\n    let article = block.querySelector(\"article\");\r\n    if (!article) {\r\n        article = document.createElement(\"article\");\r\n        block.appendChild(article);\r\n    }\r\n    // on repart propre : 1 seul <dl>\r\n    article.innerHTML = \"\";\r\n    const dl = document.createElement(\"dl\");\r\n\r\n    for (const e of events) {\r\n        const dt = document.createElement(\"dt\");\r\n        dt.textContent = e.label;\r\n\r\n        const dd = document.createElement(\"dd\");\r\n        if (e.href) {\r\n            const a = document.createElement(\"a\");\r\n            a.href = e.href;\r\n            a.textContent = e.title || e.href;\r\n            dd.appendChild(a);\r\n        } else {\r\n            dd.textContent = e.title || \"—\";\r\n        }\r\n        dl.append(dt, dd);\r\n    }\r\n\r\n    article.appendChild(dl);\r\n}\r\n\r\nfunction indexSeenForYear(y) {\r\n    const seen = new Set();\r\n    const block = getYearBlock(y);\r\n    if (!block) return seen;\r\n    const dl = $(block, CFG.yearDlSel);\r\n    if (!dl) return seen;\r\n\r\n    // reconstitue les clés existantes\r\n    let curDt = null;\r\n    for (const node of Array.from(dl.children)) {\r\n        if (node.tagName === \"DT\") {\r\n            curDt = node.textContent.trim();\r\n        } else if (node.tagName === \"DD\" && curDt) {\r\n            const href = node.querySelector(\"a\")?.getAttribute(\"href\") || \"\";\r\n            seen.add(eventKey(y, curDt, href));\r\n        }\r\n    }\r\n    return seen;\r\n}\r\n\r\n// --- fetch d’un mois (YYYY, MM) et renvoi des events (filtrés par année) ---\r\nasync function fetchMonthEvents(y, m) {\r\n    const url = `${CFG.baseUrl}?${CFG.param}=${toStart(y, m)}`;\r\n    const res = await fetch(url, { credentials: \"same-origin\" });\r\n    if (!res.ok) return [];\r\n    const doc = htmlToDoc(await res.text());\r\n    return collectEventsFromDoc(doc).filter((e) => e.year === y);\r\n}\r\n\r\nasync function fetchYearEvents(y) {\r\n    const collected = [];\r\n    const seen = new Set();\r\n    for (let m = 1; m <= 12; m++) {\r\n        const evs = await fetchMonthEvents(y, m);\r\n        for (const e of evs) {\r\n            const k = `${y}::${e.label}::${e.href || \"\"}`;\r\n            if (seen.has(k)) continue;\r\n            seen.add(k);\r\n            collected.push(e);\r\n        }\r\n    }\r\n    collected.sort((a, b) => a.ts - b.ts);\r\n    return collected;\r\n}\r\n\r\nasync function loadYearUsingCacheFirst(y) {\r\n    ensureYearBlock(y);\r\n\r\n    // 1) affichage immédiat depuis cache si dispo\r\n    const cached = YEAR_CACHE.read(y);\r\n    if (cached?.events?.length) {\r\n        replaceYearEvents(y, cached.events);\r\n    }\r\n\r\n    // 2) réseau → diff → mise à jour DOM + cache si changement\r\n    const fresh = await fetchYearEvents(y);\r\n    const needUpdate = !cached || !sameEventSet(y, cached.events, fresh);\r\n\r\n    if (needUpdate) {\r\n        replaceYearEvents(y, fresh);\r\n        YEAR_CACHE.write(y, normalizeEvents(fresh));\r\n    } else {\r\n        YEAR_CACHE.touch(y);\r\n    }\r\n\r\n    // 3) planifie le rafraîchissement 3h\r\n    scheduleYearRefresh(y);\r\n\r\n    return getYearBlock(y);\r\n}\r\n\r\nasync function refreshYear(y) {\r\n    // si l'année n'est pas dans le DOM, on zappe\r\n    if (!getYearBlock(y)) return;\r\n\r\n    if (!YEAR_CACHE.isStale(y)) return;\r\n\r\n    const cached = YEAR_CACHE.read(y);\r\n    const fresh = await fetchYearEvents(y);\r\n    const needUpdate = !cached || !sameEventSet(y, cached.events, fresh);\r\n\r\n    if (needUpdate) {\r\n        replaceYearEvents(y, fresh);\r\n        YEAR_CACHE.write(y, normalizeEvents(fresh));\r\n    } else {\r\n        YEAR_CACHE.touch(y);\r\n    }\r\n}\r\n\r\nfunction scheduleYearRefresh(y) {\r\n    const prev = YEAR_REFRESH.get(y);\r\n    if (prev) clearTimeout(prev);\r\n    const id = setTimeout(async () => {\r\n        try {\r\n            if (!CalendarKill.active) return;\r\n            await refreshYear(y);\r\n        } finally {\r\n            if (CalendarKill.active) scheduleYearRefresh(y);\r\n        }\r\n    }, YEAR_CACHE.ttlMs);\r\n    YEAR_REFRESH.set(y, id);\r\n}\r\n\r\n// --- initialisation : range les events de la page en cours dans l’année actuelle ---\r\nfunction seedFromCurrentPage() {\r\n    const curY = yearNow();\r\n    ensureYearBlock(curY);\r\n\r\n    const pageEvents = collectEventsFromDoc(document).filter(\r\n        (e) => e.year === curY\r\n    );\r\n    const seen = indexSeenForYear(curY);\r\n    appendEventsToYear(curY, pageEvents, seen);\r\n\r\n    // ✅ cache + refresh pour l’année courante\r\n    YEAR_CACHE.write(curY, normalizeEvents(pageEvents));\r\n    scheduleYearRefresh(curY);\r\n}\r\n\r\n// --- précharge jusqu’à 5 années précédentes, ou stop si la dernière dépasse le viewport ---\r\nasync function preloadPreviousYearsUntilFilled() {\r\n    const curY = yearNow();\r\n    let added = 0;\r\n    let y = curY - 1;\r\n\r\n    while (added < CFG.maxInitialPreviousYears) {\r\n        const block = await loadYearUsingCacheFirst(y); // <-- ici\r\n        added++;\r\n\r\n        if (block) {\r\n            const rect = block.getBoundingClientRect();\r\n            const overflows = rect.bottom > window.innerHeight - 20;\r\n            if (overflows) break;\r\n        }\r\n        y--;\r\n    }\r\n}\r\n\r\nfunction isSentinelVisible(sentinel) {\r\n    const r = sentinel.getBoundingClientRect();\r\n    return r.top < window.innerHeight && r.bottom > 0;\r\n}\r\n\r\nfunction getOldestLoadedYear() {\r\n    const years = getLoadedYears(); // triés croissant\r\n    return years.length ? years[0] : yearNow();\r\n}\r\n\r\nasync function raf() {\r\n    return new Promise((res) => requestAnimationFrame(res));\r\n}\r\n\r\n// Charge une année la plus ancienne manquante (oldest - 1)\r\nasync function loadNextOldestYear() {\r\n    const oldest = getOldestLoadedYear();\r\n    const target = oldest - 1;\r\n    if (getLoadedYears().length >= CFG.maxTotalYears) return false;\r\n    await loadYearUsingCacheFirst(target); // <-- ici\r\n    return true;\r\n}\r\n\r\nfunction setupBottomInfiniteAutoFill() {\r\n    if (!CalendarKill.active) return;\r\n    const container = getContainer();\r\n\r\n    let sentinel = container.querySelector('[data-cal-sentinel-bottom=\"true\"]');\r\n    if (!sentinel) {\r\n        sentinel = document.createElement(\"div\");\r\n        sentinel.setAttribute(\"data-cal-sentinel-bottom\", \"true\");\r\n        sentinel.style.cssText = \"height:1px;\";\r\n        container.appendChild(sentinel);\r\n    }\r\n\r\n    let busy = false;\r\n\r\n    const io = new IntersectionObserver(\r\n        async (entries) => {\r\n            if (!CalendarKill.active) return;\r\n            const entry = entries[0];\r\n            if (!entry || !entry.isIntersecting || busy) return;\r\n\r\n            busy = true;\r\n            try {\r\n                // 🔁 tant que visible → on charge l’année suivante (plus ancienne)\r\n                // + on yield pour laisser le layout se recalculer\r\n                while (\r\n                    isSentinelVisible(sentinel) &&\r\n                    getLoadedYears().length < CFG.maxTotalYears\r\n                ) {\r\n                    const ok = await loadNextOldestYear();\r\n                    // s’il n’y a plus rien à charger, on sort\r\n                    if (!ok) break;\r\n\r\n                    // le sentinel doit rester en dernier\r\n                    if (\r\n                        sentinel.parentNode !== container ||\r\n                        container.lastElementChild !== sentinel\r\n                    ) {\r\n                        container.appendChild(sentinel);\r\n                    }\r\n                    await raf(); // laisse le DOM se re-peindre avant de re-tester la visibilité\r\n                }\r\n            } finally {\r\n                busy = false;\r\n            }\r\n        },\r\n        { root: null, rootMargin: \"800px 0px\", threshold: 0 }\r\n    );\r\n\r\n    io.observe(sentinel);\r\n    // ➜ enregistrer dans la kill switch\r\n    CalendarKill.io = io;\r\n    CalendarKill.sentinel = sentinel;\r\n}\r\n\r\n// --- boot ---\r\nexport async function initTimelineCalendar() {\r\n    seedFromCurrentPage(); // 1) range les events courants dans l’année en cours\r\n    await preloadPreviousYearsUntilFilled(); // 2) charge jusqu’à 5 années précédentes ou jusqu’à remplir\r\n    setupBottomInfiniteAutoFill(); // 3) infinite scroll pour la suite des années\r\n}\r\n","// Glossary.js — aside de définitions pour <abbr>\r\n// Export par défaut façon \"controller\": Glossary.init(...)\r\n\r\nconst defaults = {\r\n    url: null, // URL du JSON (prioritaire si fourni)\r\n    data: null, // Objet JSON inline (fallback si pas d’URL)\r\n    selector: \"dfn[data-def],dfn[title]\", // sur quels éléments brancher\r\n    container: \"#faq-dfn\",\r\n    position: \"anchor\", // 'dock' | 'anchor'\r\n    anchorPlacement: \"top\", // 'auto' | 'right' | 'left' | 'bottom' | 'top'\r\n    anchorOffset: 0,\r\n    hashParam: null, // ex. 'def' => #def=TERM ouvre directement\r\n    observeBarba: true, // rescanner après transitions Barba\r\n    prefetchOnHover: true,\r\n    hoverDelay: 80,\r\n};\r\n\r\nconst state = {\r\n    opts: { ...defaults },\r\n    dict: null, // Map normalisée: key → entry\r\n    aside: null,\r\n    backdrop: null,\r\n    content: null,\r\n    isOpen: false,\r\n    lastTrigger: null,\r\n    focusBeforeOpen: null,\r\n    hoverTimer: null,\r\n};\r\n\r\n// $ / $$ tolérants: $(sel) ou $(root, sel)\r\nconst $ = (...args) =>\r\n    args.length === 1\r\n        ? document.querySelector(args[0])\r\n        : args[0]?.querySelector?.(args[1]);\r\nconst $$ = (...args) =>\r\n    args.length === 1\r\n        ? Array.from(document.querySelectorAll(args[0]))\r\n        : Array.from(args[0]?.querySelectorAll?.(args[1]) || []);\r\n\r\nconst normalize = (raw) => {\r\n    if (!raw) return {};\r\n    if (Array.isArray(raw)) {\r\n        const out = {};\r\n        raw.forEach((x) => {\r\n            if (x && x.key) out[String(x.key)] = x;\r\n        });\r\n        return out;\r\n    }\r\n    return raw; // déjà map clé → entrée\r\n};\r\n\r\nconst getRootEl = () => {\r\n    const c = state.opts.container;\r\n    return c && c.nodeType ? c : typeof c === \"string\" ? $(c) : document.body;\r\n};\r\n\r\nconst positionAside = (trigger) => {\r\n    if (!state.aside || !trigger || state.opts.position !== \"anchor\") return;\r\n\r\n    state.aside.classList.add(\"anchored\"); // active le mode ancré\r\n    const root = getRootEl();\r\n    const rootRect = root.getBoundingClientRect();\r\n    const tr = trigger.getBoundingClientRect();\r\n    const trContainer = trigger.parentElement;\r\n    const cr = trContainer.getBoundingClientRect();\r\n\r\n    const asideRect = state.aside.getBoundingClientRect();\r\n    const asideContainer = state.aside.offsetParent;\r\n    const ar = asideContainer.getBoundingClientRect();\r\n\r\n    // première mesure\r\n\r\n    // pour la position anchored, il faudrait calculer la hauteur depuis le document, puis la hauteur relative à son container à la fois du trigger et de l'aside\r\n    const space = {\r\n        top: tr.top - ar.top - cr.height,\r\n        right: tr.right - ar.left + state.opts.anchorOffset,\r\n        bottom: tr.bottom - ar.top - (tr.height + asideRect.height) / 2,\r\n        left: tr.left - ar.left - (asideRect.width + state.opts.anchorOffset),\r\n    };\r\n\r\n    state.aside.style.top = `${space.top}px`;\r\n};\r\n\r\nconst fetchDict = async () => {\r\n    if (state.dict) return state.dict;\r\n    const { url, data } = state.opts;\r\n    if (url) {\r\n        const res = await fetch(url, {\r\n            cache: \"no-store\",\r\n            credentials: \"same-origin\",\r\n        });\r\n        if (!res.ok) throw new Error(\"Glossary JSON HTTP \" + res.status);\r\n        state.dict = normalize(await res.json());\r\n    } else if (data) {\r\n        state.dict = normalize(data);\r\n    } else {\r\n        state.dict = {};\r\n    }\r\n    console.log(state);\r\n    return state.dict;\r\n};\r\n\r\nconst escapeHTML = (s = \"\") =>\r\n    s.replace(\r\n        /[&<>\"']/g,\r\n        (m) =>\r\n            ({\r\n                \"&\": \"&amp;\",\r\n                \"<\": \"&lt;\",\r\n                \">\": \"&gt;\",\r\n                '\"': \"&quot;\",\r\n                \"'\": \"&#39;\",\r\n            }[m])\r\n    );\r\n\r\nconst toFocusable = () =>\r\n    $$(\r\n        state.aside,\r\n        'button,[href],input,select,textarea,[tabindex]:not([tabindex=\"-1\"])'\r\n    ).filter((el) => !el.hasAttribute(\"disabled\"));\r\n\r\nconst trapFocus = (e) => {\r\n    if (!state.isOpen) return;\r\n    const nodes = toFocusable();\r\n    if (!nodes.length) return;\r\n    const first = nodes[0];\r\n    const last = nodes[nodes.length - 1];\r\n    if (e.key === \"Tab\") {\r\n        if (e.shiftKey && document.activeElement === first) {\r\n            e.preventDefault();\r\n            last.focus();\r\n        } else if (!e.shiftKey && document.activeElement === last) {\r\n            e.preventDefault();\r\n            first.focus();\r\n        }\r\n    } else if (e.key === \"Escape\") {\r\n        close();\r\n    }\r\n};\r\n\r\nconst createUI = () => {\r\n    if (state.aside) return;\r\n    const aside = document.createElement(\"aside\");\r\n    aside.className = \"glossary-aside\";\r\n    aside.setAttribute(\"role\", \"dialog\");\r\n    aside.setAttribute(\"aria-modal\", \"true\");\r\n    aside.setAttribute(\"aria-labelledby\", \"glossary-title\");\r\n\r\n    const backdrop = document.createElement(\"div\");\r\n    backdrop.className = \"glossary-backdrop\";\r\n\r\n    aside.innerHTML = `\r\n    <header class=\"glossary-header\">\r\n        <h3 id=\"glossary-title\"></h3>\r\n        <button class=\"glossary-close btn\" aria-label=\"Fermer\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-x-icon lucide-x\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg></button>\r\n    </header>\r\n    <div class=\"glossary-body\" id=\"glossary-body\" tabindex=\"-1\"></div>\r\n    <footer class=\"glossary-footer\" hidden></footer>\r\n  `;\r\n\r\n    $(state.opts.container).appendChild(backdrop);\r\n    $(state.opts.container).appendChild(aside);\r\n\r\n    state.aside = aside;\r\n    state.backdrop = backdrop;\r\n    state.content = $(state.aside, \"#glossary-body\");\r\n\r\n    backdrop.addEventListener(\"click\", close);\r\n    $(state.aside, \".glossary-close\").addEventListener(\"click\", close);\r\n    document.addEventListener(\"keydown\", trapFocus, true);\r\n};\r\n\r\nconst renderEntry = (key, entry) => {\r\n    const title = entry.title || key;\r\n    const short = entry.short\r\n        ? `<p class=\"glossary-short\">${entry.short}</p>`\r\n        : \"\";\r\n    const long = entry.long\r\n        ? `<div class=\"glossary-long\">${entry.long}</div>`\r\n        : \"\";\r\n    const tags =\r\n        Array.isArray(entry.tags) && entry.tags.length\r\n            ? `<ul class=\"glossary-tags\">${entry.tags\r\n                  .map((t) => `<li>#${escapeHTML(String(t))}</li>`)\r\n                  .join(\"\")}</ul>`\r\n            : \"\";\r\n    const links =\r\n        Array.isArray(entry.links) && entry.links.length\r\n            ? `<ul class=\"glossary-links\">${entry.links\r\n                  .map(\r\n                      (l) =>\r\n                          `<li><a target=\"_blank\" rel=\"noopener\" href=\"${escapeHTML(\r\n                              l.href\r\n                          )}\">${escapeHTML(l.label || l.href)}</a></li>`\r\n                  )\r\n                  .join(\"\")}</ul>`\r\n            : \"\";\r\n\r\n    $(state.aside, \"#glossary-title\").textContent = title;\r\n    /* $(state.aside, \".glossary-sub\").textContent =\r\n        (entry.abbr && entry.abbr.join(\", \")) || \"\"; */\r\n    state.content.innerHTML = `${short}${long}${tags}${links}`;\r\n\r\n    state.aside.dispatchEvent(\r\n        new CustomEvent(\"glossary:render\", { detail: { key, entry } })\r\n    );\r\n};\r\n\r\nconst open = async (key, trigger) => {\r\n    state.focusBeforeOpen = document.activeElement;\r\n    state.lastTrigger = trigger || null;\r\n    createUI();\r\n\r\n    const dict = await fetchDict().catch((err) => {\r\n        console.error(\"[Glossary] JSON error\", err);\r\n        return {};\r\n    });\r\n    const entry = dict[key] || null;\r\n\r\n    if (!entry) {\r\n        renderEntry(key, {\r\n            title: key,\r\n        });\r\n    } else {\r\n        renderEntry(key, entry);\r\n    }\r\n\r\n    requestAnimationFrame(() => positionAside(trigger));\r\n\r\n    state.aside.classList.add(\"open\");\r\n    state.backdrop.classList.add(\"open\");\r\n    state.isOpen = true;\r\n\r\n    const focusTarget =\r\n        $(state.aside, \"#glossary-body\") || $(state.aside, \".glossary-close\");\r\n    requestAnimationFrame(() => focusTarget && focusTarget.focus());\r\n\r\n    if (state.opts.hashParam) {\r\n        const url = new URL(location.href);\r\n        url.hash = `${state.opts.hashParam}=${encodeURIComponent(key)}`;\r\n        history.replaceState(null, \"\", url.toString());\r\n    }\r\n\r\n    state._reflow = () => positionAside(state.lastTrigger);\r\n    window.addEventListener(\"resize\", state._reflow);\r\n    window.addEventListener(\"scroll\", state._reflow, true);\r\n    state.aside.dispatchEvent(\r\n        new CustomEvent(\"glossary:open\", { detail: { key, entry } })\r\n    );\r\n};\r\n\r\nconst close = () => {\r\n    if (!state.isOpen) return;\r\n    state.aside.classList.remove(\"open\");\r\n    state.backdrop.classList.remove(\"open\");\r\n    state.isOpen = false;\r\n\r\n    if (\r\n        state.opts.hashParam &&\r\n        location.hash.includes(state.opts.hashParam + \"=\")\r\n    ) {\r\n        const url = new URL(location.href);\r\n        url.hash = \"\";\r\n        history.replaceState(null, \"\", url.toString());\r\n    }\r\n\r\n    const toFocus = state.lastTrigger || state.focusBeforeOpen;\r\n    if (toFocus && typeof toFocus.focus === \"function\") toFocus.focus();\r\n\r\n    state.aside.dispatchEvent(new CustomEvent(\"glossary:close\"));\r\n};\r\n\r\nconst onAbbrClick = (e) => {\r\n    e.preventDefault();\r\n    const el = e.currentTarget;\r\n    const key = el.getAttribute(\"data-def\") || el.getAttribute(\"title\");\r\n    if (el.getAttribute(\"title\")) {\r\n        el.removeAttribute(\"title\");\r\n        el.setAttribute(\"data-def\", key);\r\n    }\r\n    if (!key) return;\r\n    open(key, el);\r\n};\r\n\r\nconst onAbbrKey = (e) => {\r\n    if (e.key === \"Enter\" || e.key === \" \") {\r\n        e.preventDefault();\r\n        e.currentTarget.click();\r\n    }\r\n};\r\n\r\nconst bindOne = (el) => {\r\n    if (el.__glBound) return;\r\n    console.log(el);\r\n    el.__glBound = true;\r\n    el.setAttribute(\"role\", \"button\");\r\n    el.setAttribute(\"tabindex\", \"0\");\r\n    el.addEventListener(\"click\", onAbbrClick);\r\n    el.addEventListener(\"keydown\", onAbbrKey);\r\n\r\n    const key = el.getAttribute(\"data-def\") || el.getAttribute(\"title\");\r\n    if (el.getAttribute(\"title\")) {\r\n        el.removeAttribute(\"title\");\r\n        el.setAttribute(\"data-def\", key);\r\n    }\r\n\r\n    if (state.opts.prefetchOnHover && state.opts.url) {\r\n        el.addEventListener(\"mouseenter\", () => {\r\n            clearTimeout(state.hoverTimer);\r\n            state.hoverTimer = setTimeout(() => {\r\n                fetchDict().catch((e) => {\r\n                    console.warn(e);\r\n                });\r\n            }, state.opts.hoverDelay);\r\n        });\r\n        el.addEventListener(\"mouseleave\", () => clearTimeout(state.hoverTimer));\r\n    }\r\n};\r\n\r\nconst scan = (root = document) => {\r\n    console.log($$(root, state.opts.selector));\r\n    $$(root, state.opts.selector).forEach(bindOne);\r\n};\r\n\r\nconst fromHash = () => {\r\n    if (!state.opts.hashParam) return;\r\n    const h = (location.hash || \"\").slice(1);\r\n    const [k, v] = h.split(\"=\");\r\n    if (k === state.opts.hashParam && v) open(decodeURIComponent(v));\r\n};\r\n\r\nconst Glossary = {\r\n    init(options = {}) {\r\n        state.opts = { ...defaults, ...options };\r\n        createUI();\r\n        scan(document);\r\n        fromHash();\r\n        console.log(\"[Glossary] initialized\", state);\r\n        if (state.opts.observeBarba && \"addEventListener\" in document) {\r\n            document.addEventListener(\"barba:after\", () => scan(document));\r\n        }\r\n        return { open, close, scan };\r\n    },\r\n    open,\r\n    close,\r\n    scan,\r\n};\r\n\r\nexport default Glossary;\r\n","const NOTEPAD_STORE_KEY = \"notepad\";\r\nconst notepad_element = document.getElementById(\"js-notepad\");\r\nconst notepad_text = localStorage.getItem(NOTEPAD_STORE_KEY) || \"\";\r\n\r\nexport class Notepad {\r\n    constructor() {\r\n        if (notepad_element) {\r\n            notepad_element.value = notepad_text;\r\n        }\r\n        notepad_element.addEventListener(\"input\", function () {\r\n            localStorage.setItem(NOTEPAD_STORE_KEY, this.value);\r\n        });\r\n    }\r\n}\r\n","import Context from \"../core/context.js\";\r\nimport CursorController from \"../ui/CursorController.js\";\r\nimport { initBarba, onNamespace, getRegisteredNamespaces } from \"./barba.js\";\r\n\r\nimport { initRegisterScripts } from \"../features/register.js\";\r\nimport { initTopicScripts } from \"../features/topic.js\";\r\nimport { initLayoutScripts } from \"../features/layout.js\";\r\nimport { initFAQScripts } from \"../features/faq.js\";\r\nimport { initEnochian } from \"../ui/Enochian.js\";\r\nimport { initTimelineCalendar, CalendarKill } from \"../features/calendar.js\";\r\n\r\nimport Glossary from \"../ui/Glossary.js\";\r\nimport { Notepad } from \"../ui/Notepad.js\";\r\n\r\n// ex:\r\n\r\nexport function initUI() {\r\n  document\r\n    .querySelectorAll('div[style^=\"height:\"')\r\n    .forEach((el) => el.remove());\r\n\r\n  Context.container =\r\n    document.querySelector('section[data-barba=\"container\"]') || document;\r\n\r\n  const cursor = CursorController.init();\r\n\r\n  new Notepad();\r\n\r\n  initLayoutScripts();\r\n  // REGISTER\r\n  onNamespace(\"register\", { afterEnter: async () => initRegisterScripts() });\r\n  // TOPIC\r\n  onNamespace(\"topic\", {\r\n    afterEnter: async ({ next }) => {\r\n      initTopicScripts(next.container);\r\n      initEnochian(next.container);\r\n    },\r\n  });\r\n  // FAQ\r\n  onNamespace(\"faq\", {\r\n    afterEnter: async ({ next }) => {\r\n      initFAQScripts(next.container);\r\n      initEnochian(next.container);\r\n      Glossary.init({\r\n        url: \"http://127.0.0.1:8080/faq.json\",\r\n      });\r\n    },\r\n  });\r\n\r\n  onNamespace(\"calendar\", {\r\n    afterEnter: async ({ next }) => {\r\n      await initTimelineCalendar(next.container);\r\n    },\r\n  });\r\n\r\n  console.debug(\"[barba] registered ns hooks:\", getRegisteredNamespaces());\r\n\r\n  initBarba({ cursor });\r\n\r\n  return { Context, cursor };\r\n}\r\n","import { initUI } from \"./init/app.js\";\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    initUI();\r\n});\r\n"],"names":["Context","hooks","currentIndex","container","update","console","log","value","useState","initialValue","idx","newValue","useReducer","reducer","initialState","action","useEffect","callback","deps","prevDeps","hasNoDeps","hasChanged","every","el","i","qsa","root","sel","querySelectorAll","qs","querySelector","CONFIG","focus","shrink","follow","fade","text","forum","btn","profileSymbol","barbaContainer","progressPath","cursor","cursorFollow","postbody","forumEl","link","map","getRectData","rect","getBoundingClientRect","x","left","y","top","w","width","h","height","setOpacity","animate","opacity","duration","fill","CursorController","document","forums","stopFollow","init","this","bindEvents","bindScroll","addEventListener","e","pageX","leftPosition","pageY","topPosition","target","Element","style","updateCursorBadges","matches","handleBtnFocus","handleProfileSymbolFocus","resetFollowSize","classList","remove","gsap","to","ease","dataset","barba","updateProgress","host","closest","contains","relatedTarget","killTweensOf","add","element","len","pathLength","strokeDasharray","currentContainer","scroll","scrollTop","scrollHeight","window","innerHeight","progress","strokeDashoffset","getTotalLength","_ease","ensureEase","CustomEase","registerPlugin","parseEase","create","he","transform","autoAlpha","animateLinesIn","onDone","tl","timeline","onComplete","forEach","delay","globalTimeline","getGlobalTimeline","mapAnimation","kill","defaults","onReverseComplete","r","o","ft","targets","fromVars","toVars","pos","list","length","undefined","fromTo","stagger","setGlobalTimeline","Badge","constructor","options","badgeClass","badgeCounterClass","animationSpeed","countLimit","activeClass","limitClass","badgeElement","badgeCounterElement","renderIfNeeded","error","wrapper","createElement","className","innerHTML","appendChild","set","n","Number","isNaN","textContent","oldEl","String","trim","newEl","cloneNode","after","requestAnimationFrame","setTimeout","get","parseInt","increase","decrease","Math","max","destroy","wrap","CFG","_initialized","_nsHooks","Map","onNamespace","ns","handlers","initBarba","warn","menu","getElementById","notificationBadge","prevent","hasAttribute","transitions","name","beforeOnce","data","done","async","next","namespace","once","debug","afterEnter","contents","alpha","before","current","opts","items","contentsOut","leave","animateLinesOut","enter","nextContainer","nextPath","rebindProgressPath","contentsIn","clear","parseFieldset","fieldset","dls","dl","dt","title","replace","slug","toString","toLowerCase","normalize","input","type","tagName","validate","inputHTML","originalHTML","updateIframeRegister","event","iframe","currentTarget","doc","contentDocument","contentWindow","url","location","href","cpMain","html","fieldsets","step","htmlDoc","includes","computeRegisterStep","steps","accountFieldset","profileFieldset","panel","siblings","parentNode","firstChild","nodeType","push","nextSibling","getSiblings","s","goToStep","Promise","deletePanelContent","initTopicScripts","Tyme","fromNow","message","content","str","arr","childNodes","elem","newElem","nodeValue","insertBefore","removeChild","paragraphs","filter","k","nodeName","frag","createDocumentFragment","hideProfiles","JSON","parse","localStorage","getItem","a","u","avatars","removeOthers","eye","indexOf","splice","setItem","stringify","appendToStorage","pathname","field","split","moveField","p","item","moveSymbol","group","f","desc","labelName","labelContent","description","label","innerText","descr","profile","join","splitNames","color","parentElement","applyColorFromName","groups","djinn","human","Object","keys","find","key","getGroup","chartValues","ocean","fields","messages","points","ouverture","extraversion","neuroticisme","pronoms","faceclaim","citation","entries","enmity","createEnmity","values","ctx","Chart","labels","datasets","borderWidth","borderColor","backgroundColor","aspectRatio","maintainAspectRatio","animations","tension","easing","from","loop","scales","display","min","layout","padding","elements","point","pointRadius","plugins","tooltip","enabled","subtitle","legend","createChart","symbol","offsetBoundsByFraction","bounds","fx","fy","sw","getSouthWest","ne","getNorthEast","dLng","lng","dLat","lat","maplibregl","LngLatBounds","decimalToDMSString","precision","pad","d","m","hemi","padStart","toFixed","formatDMS","v","abs","floor","mFloat","toDMS","readInlineColor","getAttribute","TopicController","topicsContainerSelector","newTopicAsideSelector","topicsContainer","asideContainer","toggleButton","isCreating","isAsideOpened","subjectInput","messageInput","coordsInput","districtInput","coordsDecimalEl","coordsDMSEl","_bindAsideEvents","_loadState","toggleAside","closeAside","sync","_saveState","saved","coords","district","subject","_updateCoordDisplays","payload","_readDraft","raw","_writeDraft","getDraft","lngLat","Array","isArray","initNewTopic","openAside","moveNewTopic","setDistrict","createMapController","styleUrl","selectors","trigger","mapContainer","board","topics","layoutBoard","newTopic","forumId","topicsLimit","mapHost","boardTrigger","newTopicAside","aborter","AbortController","limit","signal","res","fetch","credentials","DOMParser","parseFromString","slice","URL","origin","row","authorA","authorUrl","authorName","authorColor","replies","mId","match","id","lon","parseFloat","isFinite","lastpost","lastpost_avatar","lastpost_user","lastpost_color","lastpost_link","lastpost_infos","lastpost_date","lastChild","author","avatar","src","user","date","day","parseToFormat","month","year","time","full","Boolean","fetchForumTopics","topicMarkers","cam","tempMarker","onMove","topicController","DISTRICT_LAYER","INITIAL_BOUNDS","INITIAL_CENTER","safeGetTl","isDistrictLayerPresent","getStyle","layers","some","l","pointIsInDistrict","features","queryRenderedFeatures","districtAtLngLat","project","properties","Stadsdeel","centerOn","zoom","padX","padY","easeTo","center","getZoom","offset","installTopicHover","activeLabelEl","clearActiveLabel","topicId","has","ll","getLngLat","offsetWidth","getElement","focusTopicById","activateLabelForMarker","onMapClick","originalEvent","ensureTempMarkerAt","dist","currentSubject","updateTempMarkerLabel","setLngLat","Marker","addTo","popupText","getPopup","setText","_element","prepend","t","hidden","open","err","close","timeScale","reverse","onTriggerClick","preventDefault","reversed","abort","removeEventListener","replaceWith","off","toggle","pitch","bearing","canvasContextAttributes","antialias","attributionControl","maxBounds","dragRotate","fn","ticking","args","apply","rafThrottle","outside","on","cameraForBounds","maxZoom","jumpTo","made","renderTopicMarkers","div","topic","safeTitle","profileUrl","renderTopicAside","draft","resize","setMaxBounds","right","bottom","getBearing","getPitch","updateViewportConstraints","getStatus","cache","result","memoizedStatus","user_anchors","parseUsersPresence","user_list","then","status","obj","statusElement","Presence","user_url","user_id","getUsersPresence","teardown","initMenu","sidebar","isOpen","setOpen","setAttribute","onBtnClick","stopPropagation","onDocClick","onKeyDown","documentElement","initFAQScripts","updateHash","DURATION","faq","goTo","prev","slider","createSlider","scroller","panels","tabs","tablist","activeIndex","ro","destroyed","clamp","getTabBox","offsetLeft","moveSliderTo","wideJump","toLeft","toWidth","fromLeft","fromWidth","injectedTimeline","gs","durationSec","overwrite","widths","lefts","ensureHeight","disconnect","ResizeObserver","hh","observe","setActive","index","sourceEl","b","isActive","hash","history","replaceState","onTabClick","onKeydown","activeElement","onResize","startIndex","decodeURIComponent","substring","found","findIndex","DIRECTIONS","SYMBOLS","renderLetter","char","extras","howMany","random","dirs","sort","out","direction","randomlyAddedSymbols","charHTML","initEnochian","YEAR_CACHE","ttlMs","read","write","events","version","updatedAt","Date","now","checkedAt","isStale","c","touch","YEAR_REFRESH","CalendarKill","active","io","sentinel","activate","clearTimeout","normalizeEvents","ts","meta","_evKey","sameEventSet","A","Set","toStart","$","$$","getContainer","body","yearNow","getFullYear","getYearBlock","ensureYearBlock","block","eventKey","parseEventNode","evNode","dateA","topicA","test","searchParams","txt","guessed","getDate","getMonth","overviewHtml","attr","extractOverviewHtmlFromAttr","titleName","linkedDateText","excerpt","parseOverviewMeta","collectEventsFromDoc","replaceYearEvents","article","dd","append","fetchMonthEvents","ok","fetchYearEvents","collected","seen","evs","loadYearUsingCacheFirst","cached","fresh","scheduleYearRefresh","refreshYear","seedFromCurrentPage","curY","pageEvents","curDt","node","children","indexSeenForYear","seenSet","appendEventsToYear","initTimelineCalendar","added","preloadPreviousYearsUntilFilled","selector","position","anchorPlacement","anchorOffset","hashParam","observeBarba","prefetchOnHover","hoverDelay","state","dict","aside","backdrop","lastTrigger","focusBeforeOpen","hoverTimer","positionAside","getRootEl","tr","cr","asideRect","ar","offsetParent","space","fetchDict","Error","json","escapeHTML","trapFocus","nodes","first","last","shiftKey","createUI","renderEntry","entry","short","long","tags","links","dispatchEvent","CustomEvent","detail","catch","focusTarget","encodeURIComponent","_reflow","toFocus","onAbbrClick","removeAttribute","onAbbrKey","click","bindOne","__glBound","scan","Glossary","fromHash","NOTEPAD_STORE_KEY","notepad_element","notepad_text","Notepad","initUI","mapCtrl","beforeLeave","initLayoutScripts","iFrame","initRegisterScripts"],"mappings":"6DAGA,MAAMA,EAAU,WACZ,IAAIC,EAAQ,GACRC,EAAe,EACfC,EAAY,KAEhB,MAAMC,EAAS,KACXC,QAAQC,IAAI,qBAGhB,MAAO,CACH,aAAIH,GACA,OAAOA,CACX,EACA,aAAIA,CAAUI,GACVJ,EAAYI,EACZL,EAAe,CACnB,EAEA,QAAAM,CAASC,GACL,MAAMC,EAAMR,IACZD,EAAMS,GAAOT,EAAMS,IAAQD,EAU3B,MAAO,CAACR,EAAMS,GARIC,IACdV,EAAMS,GACkB,mBAAbC,EACDA,EAASV,EAAMS,IACfC,EACVP,KAIR,EAEA,UAAAQ,CAAWC,EAASC,GAChB,MAAMJ,EAAMR,IACZD,EAAMS,GAAOT,EAAMS,IAAQI,EAO3B,MAAO,CAACb,EAAMS,GALIK,IACdd,EAAMS,GAAOG,EAAQZ,EAAMS,GAAMK,GACjCX,KAIR,EAEA,SAAAY,CAAUC,EAAUC,GAChB,MAAMR,EAAMR,IACNiB,EAAWlB,EAAMS,GACjBU,GAAaF,EACbG,GAAaF,IACZD,EAAKI,MAAM,CAACC,EAAIC,IAAMD,IAAOJ,EAASK,KAGzCJ,GAAaC,KACbpB,EAAMS,GAAOQ,EACbD,IAER,EAEP,CA3De,GCAHQ,EAAM,CAACC,EAAMC,IAAQD,EAAKE,iBAAiBD,GAC3CE,EAAK,CAACH,EAAMC,IAAQD,EAAKI,cAAcH,GCF9CI,EACW,GADXA,EAEI,SAFJA,EAGG,CACDC,MAAO,GACPC,OAAQ,GACRC,OAAQ,GACRC,KAAM,KAPRJ,EASS,CACPK,KAAM,sFACNC,MAAO,sCACPC,IAAK,eACLC,cAAe,0BACfC,eAAgB,kCAChBC,aAAc,sBACdC,OAAQ,UACRC,aAAc,gBACdC,SAAU,YACVC,QAAS,SACTC,KAAM,4QACNC,IAAK,eAIb,SAASC,EAAYzB,GACjB,MAAM0B,EAAO1B,EAAG2B,wBAChB,MAAO,CAAEC,EAAGF,EAAKG,KAAMC,EAAGJ,EAAKK,IAAKC,EAAGN,EAAKO,MAAOC,EAAGR,EAAKS,OAC/D,CAEA,SAASC,EAAWpC,EAAIhB,GACpBgB,EAAGqC,QACC,CAAEC,QAAStD,GACX,CAAEuD,SAAU/B,EAAWI,KAAM4B,KAAM,YAE3C,CAEA,MAAMC,EAAmB,CAErBtB,OAAQuB,SAASnC,cAAcC,EAAiBW,QAChDC,aAAcsB,SAASnC,cAAcC,EAAiBY,cACtDC,SAAUqB,SAASrC,iBAAiBG,EAAiBa,UACrDH,aAAcwB,SAASnC,cAAcC,EAAiBU,cACtDyB,OAAQD,SAASrC,iBAAiBG,EAAiBc,SAEnDsB,YAAY,EAGZ,IAAAC,GACIC,KAAKC,aACLD,KAAKE,YACT,EAGA,UAAAD,GACIL,SAASO,iBAAiB,aAAc,KACpCb,EAAWU,KAAK3B,OAAQ,GACxBiB,EAAWU,KAAK1B,aAAc,KAGlCsB,SAASO,iBAAiB,aAAc,KACpCb,EAAWU,KAAK3B,OAAQ,GACxBiB,EAAWU,KAAK1B,aAAc,KAGlCsB,SAASO,iBAAiB,YAAcC,IACpC,MAAQC,MAAOC,EAAcC,MAAOC,EAAWC,OAAEA,GAAWL,EAEtDK,aAAkBC,UAGxBV,KAAK3B,OAAOsC,MAAM5B,KAAOuB,EAAe,KACxCN,KAAK3B,OAAOsC,MAAM1B,IAAMuB,EAAc,KAGtCR,KAAKY,mBAAmBH,GAGpBA,EAAOI,QAAQnD,EAAiBO,KAChC+B,KAAKc,eAAeL,GACbA,EAAOI,QAAQnD,EAAiBQ,eACvC8B,KAAKe,yBAAyBN,GAE9BT,KAAKgB,kBAIJhB,KAAKF,aACNE,KAAK1B,aAAa2C,UAAUC,OAAO,UACnClB,KAAK3B,OAAO4C,UAAUC,OAAO,QAC7BC,KAAKC,GAAGpB,KAAK1B,aAAc,CACvBW,IAAKuB,EACLzB,KAAMuB,EACNb,SAAU/B,EAAWG,OACrBwD,KAAM3D,QAMlBkC,SAASO,iBACL,SACCC,IACkC,cAA3BA,EAAEK,OAAOa,QAAQC,OACjBvB,KAAKwB,mBAGb,GAGJ5B,SAASO,iBACL,eACCC,IACG,KAAMA,EAAEK,kBAAkBC,SAAU,OAEpC,MAAMe,EAAOrB,EAAEK,OAAOiB,QAAQ,iCACzBD,IAEDA,EAAKE,SAASvB,EAAEwB,iBAGpB5B,KAAKF,YAAa,EAGlBE,KAAK1B,aAAa2C,UAAUC,OAAO,SAAU,SAC7ClB,KAAK3B,OAAO4C,UAAUC,OAAO,OAAQ,QAGrCC,KAAKU,aAAa7B,KAAK1B,cACvB6C,KAAKU,aAAa7B,KAAK3B,QAGvB8C,KAAKC,GAAGpB,KAAK1B,aAAc,CACvBa,MAAO,GACPE,OAAQ,GACRI,SAAU,GACV4B,KAAM,iBAId,EAER,EAGA,kBAAAT,CAAmBH,GAEXA,EAAOI,QAAQnD,EAAiBK,MAChCiC,KAAK3B,OAAO4C,UAAUa,IAAI,QAE1B9B,KAAK3B,OAAO4C,UAAUC,OAAO,QAI7BT,EAAOI,QAAQnD,EAAiBM,OAChCgC,KAAK3B,OAAO4C,UAAUa,IAAI,OAE1B9B,KAAK3B,OAAO4C,UAAUC,OAAO,OAG7BT,EAAOI,QAAQnD,EAAiBe,OAChCuB,KAAK3B,OAAO4C,UAAUa,IAAI,QAC1B9B,KAAK1B,aAAa2C,UAAUa,IAAI,WAEhC9B,KAAK3B,OAAO4C,UAAUC,OAAO,QAC7BlB,KAAK1B,aAAa2C,UAAUC,OAAO,UAGnCT,EAAOI,QAAQnD,EAAiBgB,MAChCsB,KAAK3B,OAAO4C,UAAUa,IAAI,aAC1B9B,KAAK1B,aAAa2C,UAAUa,IAAI,YAEhC9B,KAAK3B,OAAO4C,UAAUC,OAAO,aAC7BlB,KAAK1B,aAAa2C,UAAUC,OAAO,UAE3C,EAEA,cAAAJ,CAAeL,GACXT,KAAKF,YAAa,EAClB,MAAMiC,EAAUtB,EAAOiB,QAAQ,SACzB5C,EAAEA,EAACE,EAAEA,EAACE,EAAEA,EAACE,EAAEA,GAAMT,EAAYoD,GAEnC/B,KAAK1B,aAAa2C,UAAUa,IAAI,UAEhCX,KAAKC,GAAGpB,KAAK1B,aAAc,CACvBW,IAAKD,EAAII,EAAI,EACbL,KAAMD,EAAII,EAAI,EACdC,MAAOD,EACPG,OAAQD,EACRK,SAAU/B,EAAWC,MACrB0D,KAAM3D,GAEd,EAEA,wBAAAqD,CAAyBN,GACrBT,KAAKF,YAAa,EAClB,MAAMiC,EAAUtB,EAAOiB,QAAQ,4BACzB5C,EAAEA,EAACE,EAAEA,EAACE,EAAEA,EAACE,EAAEA,GAAMT,EAAYoD,GAGnCZ,KAAKC,GAAGpB,KAAK1B,aAAc,CACvBW,IAAKD,EAAII,EAAI,EACbL,KAAMD,EAAII,EAAI,EACdC,MAAOD,EACPG,OAAQD,EACRK,SAAU/B,EAAWC,MACrB0D,KAAM3D,GAEd,EAEA,eAAAsD,GACIhB,KAAKF,YAAa,EAClBqB,KAAKC,GAAGpB,KAAK1B,aAAc,CACvBa,MAAOzB,EACP2B,OAAQ3B,EACR+B,SAAU/B,EAAWE,OACrByD,KAAM3D,GAEd,EAGA,UAAAwC,GACI,IAAKF,KAAK5B,aAAc,OACxB,MAAM4D,EAAMhC,KAAKiC,aACjBjC,KAAK5B,aAAauC,MAAMuB,gBAAkB,GAAGF,KAAOA,IACpDhC,KAAKwB,gBACT,EAEAW,iBAAgB,IACLvC,SAASnC,cAAcC,EAAiBS,gBAGnD,cAAAqD,GACI,IAAKxB,KAAK5B,aAAc,OACxB,MAAMtC,EAAYkE,KAAKmC,mBACvB,IAAKrG,EAAW,OAEhB,MAAMsG,EAAStG,EAAUuG,UACnBhD,EAASvD,EAAUwG,aAAeC,OAAOC,YACzCC,EACFzC,KAAKiC,aAAgBG,EAASpC,KAAKiC,aAAgB5C,EACvDW,KAAK5B,aAAauC,MAAM+B,iBAAmBD,CAC/C,EAGA,UAAAR,GACI,OAAOjC,KAAK5B,aAAauE,gBAC7B,GCtPJ,IAAIC,EAAQ,KACL,SAASC,IACZ,IAAKN,OAAOpB,KAAM,OAAO,KACzB,GAAIyB,EAAO,OAAOA,EAClB,IACQL,OAAOO,aACP3B,KAAK4B,eAAeD,YACpBF,EACIzB,KAAK6B,YAAY,WACjBF,WAAWG,OAAO,SAXT,yBAarB,CAAE,MAAO,CAET,OADKL,IAAOA,EAAQ,cACbA,CACX,CAEO,MAAMM,EACE,CAAEC,UAAW,aADfD,EAEA,CAAEC,UAAW,aAFbD,EAGM,CAAEnE,KAAM,EAAGI,MAAO,QAHxB+D,EAII,CAAEnE,KAAM,OAAQI,MAAO,MAJ3B+D,EAKC,CAAEE,UAAW,GALdF,EAMD,CAAEE,UAAW,GANZF,EASO,CAAE7D,OAAQ,MATjB6D,EAUK,CAAE7D,OAAQ,QAVf6D,EAWM,CAAE/D,MAAO,MAXf+D,EAYI,CAAE/D,MAAO,QC5BpB/B,EAAM,CAACC,EAAMC,IAAQD,EAAKE,iBAAiBD,GAE1C,SAAS+F,EAAehG,EAAOuC,SAAU0D,GAC5C,MAAMjC,EAAOwB,IACb,IAAKN,OAAOpB,OAASE,EAEjB,YADAiC,MAGJ,MAAMC,EAAKpC,KAAKqC,SAAS,CAAEnC,OAAMoC,WAAYH,IAgB7C,OAfAlG,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GAAGlE,EAAI,CAAEiC,MAAO,OAAQM,SAAU,GAAKkE,MAAW,IAAJxG,GAAY,MAEjEC,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GAAGlE,EAAI,CAAEmC,OAAQ,OAAQI,SAAU,GAAKkE,MAAW,IAAJxG,GAAY,MAElEC,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GAAGlE,EAAI,CAAEmC,OAAQ,OAAQI,SAAU,GAAKkE,MAAW,IAAJxG,GAAY,MAElEC,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GAAGlE,EAAI,CAAEiC,MAAO,OAAQM,SAAU,GAAKkE,MAAW,IAAJxG,GAAY,MAEjEC,EAAIC,EAAM,cAAcqG,QAAQ,CAACxG,EAAIC,IACjCoG,EAAGnC,GAAGlE,EAAI,CAAEiC,MAAO,OAAQM,SAAU,IAAO,MAEzC8D,CACX,CCvBA,IAAIK,EAAiB,KAEd,MAAMC,EAAoB,IAAMD,EAQhC,SAASE,GAAahI,UAAEA,IAC3B,MAAMuF,EAAOwB,IACb,IAAKN,OAAOpB,OAASE,EAAM,OAAO,KAElC,MAAMhE,EAAOG,EAAGoC,SAAU,QAC1B,IACIgE,GAAgBG,MACpB,CAAE,MAAO,CAET,MAAMR,EAAKpC,KAAKqC,SAAS,CACrBQ,SAAU,CAAEvE,SAAU,EAAG4B,QACzB4C,kBAAmB,KAhBvBL,EAAiB,KAkBT9H,EAAUmF,UAAUa,IAAI,aAI1B3E,EAAIC,EAAIC,EAAM,kBACd6G,EAAI9G,EAAIC,EAAM,YACd8G,EAAI/G,EAAIC,EAAM,cACVD,EAAIC,EAAM,yBACVD,EAAIC,EAAM,gBACpB,MAAM8B,EAAQ/B,EAAIC,EAAM,sBAClBgC,EAASjC,EAAIC,EAAM,sBAEnB+G,EAAK,CAACC,EAASC,EAAUC,EAAQC,KACnC,OA5BKC,EA4BIJ,IA5BaI,EAAKC,OAAS,OA6BrBC,IAARH,EACDjB,EAAGqB,OAAOP,EAASC,EAAUC,EAAQC,GACrCjB,EAAGqB,OAAOP,EAASC,EAAUC,GAHThB,EA5BtB,IAACkB,GA0CT,OARAL,EAAGjH,EAAG+F,EAAcA,GACpBkB,EAAGjH,EAAG+F,EAAkBA,EAAgB,IACxCkB,EAAGF,EAAGhB,EAAcA,EAAY,IAChCkB,EAAGD,EAAGjB,EAAa,IAAKA,EAAW2B,QAAS,MAAS,IACrDT,EAAGjF,EAAO+D,EAAkB,IAAKA,EAAgB2B,QAAS,MAAS,IACnET,EAAG/E,EAAQ6D,EAAmB,IAAKA,EAAiB2B,QAAS,MAAS,IA5CzC,CAACtB,IAAQK,EAAiBL,GA8CvDuB,CAAkBvB,GACXA,CACX,CCrDe,MAAMwB,EAKjB,WAAAC,CAAYjD,EAASkD,EAAU,IAC3BjF,KAAKiF,QAAU,CACXC,WAAY,qBACZC,kBAAmB,uBACnBC,eAAgB,IAChBC,WAAY,GACZC,YAAa,6BACbC,WAAY,+BACTN,GAGFlD,GAKL/B,KAAK+B,QAAUA,EACf/B,KAAKwF,aAAe,KACpBxF,KAAKyF,oBAAsB,KAG3BzF,KAAK0F,kBATD1J,QAAQ2J,MAAM,0CAUtB,CAGA,cAAAD,GAEI,IAAIE,EAAU5F,KAAK+B,QAAQtE,cAAc,IAAMuC,KAAKiF,QAAQC,YACvDU,IACDA,EAAUhG,SAASiG,cAAc,QACjCD,EAAQE,UAAY9F,KAAKiF,QAAQC,WACjCU,EAAQG,UAAY,gBAAgB/F,KAAKiF,QAAQE,8BACjDnF,KAAK+B,QAAQiE,YAAYJ,IAE7B5F,KAAKwF,aAAeI,EACpB5F,KAAKyF,oBAAsBG,EAAQnI,cAC/B,IAAMuC,KAAKiF,QAAQE,kBAE3B,CAGA,GAAAc,CAAIC,EAAI,GACJ,IAAKlG,KAAK+B,QAAS,OAAO,EAK1B,GAFA/B,KAAK0F,iBAEY,iBAANQ,GAAkBC,OAAOC,MAAMF,IAAMA,EAAI,EAKhD,OAJAlK,QAAQ2J,MAAM,0BAA0BO,KACxClG,KAAKwF,cAAcvE,UAAUC,OAAOlB,KAAKiF,QAAQK,aAC7CtF,KAAKyF,sBACLzF,KAAKyF,oBAAoBY,YAAc,KACpC,EAIX,GAAU,IAANH,EAIA,OAHAlG,KAAKwF,cAAcvE,UAAUC,OAAOlB,KAAKiF,QAAQK,aAC7CtF,KAAKyF,sBACLzF,KAAKyF,oBAAoBY,YAAc,KACpC,EAIPH,EAAIlG,KAAKiF,QAAQI,WACjBrF,KAAKwF,cAAcvE,UAAUa,IAAI9B,KAAKiF,QAAQM,YAE9CvF,KAAKwF,cAAcvE,UAAUC,OAAOlB,KAAKiF,QAAQM,YAKjDvF,KAAKwF,eACJxF,KAAKwF,aAAavE,UAAUU,SAAS3B,KAAKiF,QAAQK,cAEnDtF,KAAKwF,aAAavE,UAAUa,IAAI9B,KAAKiF,QAAQK,aAGjD,MAAMgB,EAAQtG,KAAKyF,oBACnB,IAAKa,EAAO,OAAO,EAGnB,GAAIC,OAAOD,EAAMD,aAAaG,SAAWD,OAAOL,GAC5C,OAAO,EAGX,MAAMO,EAAQH,EAAMI,WAAU,GAoB9B,OAnBAD,EAAMJ,YAAcH,EAGpBO,EAAMxF,UAAUa,IAAI9B,KAAKiF,QAAQE,kBAAoB,SACrDmB,EAAMrF,UAAUa,IAAI9B,KAAKiF,QAAQE,kBAAoB,SAErDmB,EAAMK,MAAMF,GAGZG,sBAAsB,KAClBH,EAAMxF,UAAUC,OAAOlB,KAAKiF,QAAQE,kBAAoB,SACxD0B,WAAW,KACP,IACIP,EAAMpF,QACV,CAAE,MAAO,CACTlB,KAAKyF,oBAAsBgB,GAC5BzG,KAAKiF,QAAQG,mBAGb,CACX,CAEA,GAAA0B,GACI,MAAMZ,EAAIa,SAAS/G,KAAKyF,qBAAqBY,aAAe,IAAK,IACjE,OAAOF,OAAOC,MAAMF,GAAK,EAAIA,CACjC,CAEA,QAAAc,CAASd,EAAI,GACT,OAAOlG,KAAKiG,IAAIjG,KAAK8G,MAAQZ,EACjC,CACA,QAAAe,CAASf,EAAI,GACT,OAAOlG,KAAKiG,IAAIiB,KAAKC,IAAI,EAAGnH,KAAK8G,MAAQZ,GAC7C,CAEA,OAAAkB,GACI,IAAKpH,KAAK+B,QAAS,OACnB,MAAMsF,EAAOrH,KAAK+B,QAAQtE,cAAc,IAAMuC,KAAKiF,QAAQC,YACvDmC,GAAMA,EAAKnG,SACflB,KAAKwF,aAAe,KACpBxF,KAAKyF,oBAAsB,KAC3BzF,KAAK+B,QAAU,IACnB,EC7HJ,MAAMuF,EACa,kCADbA,EAEiB,sBAGvB,IAAIC,GAAe,EACnB,MAAMC,EAAW,IAAIC,IAad,SAASC,EAAYC,EAAIC,GAC5BJ,EAASvB,IAAI0B,EAAI,IAAMC,GAAY,CAAA,GACvC,CAEO,SAASC,GAAUxJ,OAAEA,GAAW,IACnC,GAAIkJ,EAAc,MAAO,CAAEH,WAG3B,GAFAG,GAAe,GAEVhF,OAAOhB,OAAOxB,KAAM,CACrB/D,QAAQ8L,KACJ,8DAEJ,MAAMzK,EAAOuC,SAASnC,cAAc6J,IAAsB1H,SAG1D,OAFAjE,EAAQG,UAAYuB,EACpBgG,EAAehG,EAAM,QACd,CAAE+J,UACb,CAEAzL,EAAQG,UAAY8D,SAASnC,cAAc6J,IAAsB1H,SAEjE,MAAMmI,EAAOnI,SAASoI,eAAe,QAC/BvG,EAAOsG,GAAMtK,cAAc,iBAC3BwK,EAAoB,IAAIlD,EAAMtD,GA8HpC,OA5HAF,MAAMxB,KAAK,CACPmI,QAAS,EAAGhL,QAASA,GAAIiL,eAAe,sBACxCC,YAAa,CACT,CACIC,KAAM,mBAEN,UAAAC,CAAWC,GACP,MAAMC,EAAOxI,KAAKyI,QACZd,EAAKY,GAAMG,MAAMC,UACjBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,IACIvI,GAAGkJ,aAAaC,EACpB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,wBAAyBvF,EAC3C,CACAiD,EAAekF,EAAKG,KAAK5M,UAAW0M,GACpCP,EAAkBhC,IAAI,EAC1B,EAEA,IAAA2C,CAAKL,GACDvM,QAAQ6M,MAAM,mBAAoBN,GAAMG,MAAMC,WAG9C,MAAMhB,EAAKY,GAAMG,MAAMC,UACjBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,IACIvI,GAAGwJ,OAAOL,GACVnJ,GAAG0J,aAAaP,EACpB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,uBAAwBvF,EAC1C,CAGA,MAAMoI,EAAOxI,KAAKyI,QACZM,EAAWR,EAAKG,KAAK5M,UAAUyB,iBACjC,uBAEAwL,EAASrE,OACTvD,KAAKC,GAAG2H,EAAU,CACdC,MAAO,EACPnE,QAAS,IACTpB,WAAY+E,IAGhBA,GAER,EAEA,MAAAS,CAAOV,GACH,MAAMZ,EAAKY,GAAMW,SAASP,UACpBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,IACIvI,GAAG6J,SAASV,EAChB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,oBAAqBvF,EACvC,CAEA,MAAMoI,EAAOxI,KAAKyI,SFzC/B,SAAqBpL,EAAOuC,SAAUuJ,EAAO,CAAA,GAChD,MAAMC,EAAQ/L,EAAKE,iBAAiB,uBACpC,OAAK6L,GAA0B,IAAjBA,EAAM1E,OACbvD,KAAKC,GAAGgI,EAAO,CAClBJ,MAAO,EACPnE,QAAS,OACNsE,IAJkC,IAM7C,EEkC+BE,CAAYd,EAAKW,QAAQpN,UAAW,CAC3C2H,WAAY+E,KAEPA,GACb,EAEA,WAAMc,CAAMf,GACR,MAAMZ,EAAKY,GAAMW,SAASP,UACpBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,GAAIvI,GAAGkK,MACH,UACUlK,EAAEkK,MAAMf,EAClB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,gBAAiBvF,EACnC,CAEJ,MAAMoI,EAAOxI,KAAKyI,SHlG/B,SAAyBpL,EAAOuC,SAAU0D,GAC7C,MAAMjC,EAAOwB,IACb,IAAKN,OAAOpB,OAASE,EAEjB,YADAiC,MAGJ,MAAMC,EAAKpC,KAAKqC,SAAS,CAAEnC,OAAMoC,WAAYH,IAC7ClG,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GACClE,EACA,CACI+B,IAAK9B,EAAI,EAAI,EAAI,SACjBkC,OAAQ,EACRI,SAAU,GACVkE,MAAW,IAAJxG,GAEX,MAGRC,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GACClE,EACA,CACI+B,IAAK9B,EAAI,EAAI,EAAI,SACjBkC,OAAQ,EACRI,SAAU,GACVkE,MAAW,IAAJxG,GAEX,MAGRC,EAAIC,EAAM,OAAOqG,QAAQ,CAACxG,EAAIC,IAC1BoG,EAAGnC,GACClE,EACA,CACI6B,KAAM5B,EAAI,EAAI,EAAI,SAClBgC,MAAO,EACPM,SAAU,GACVkE,MAAW,IAAJxG,GAEX,MAGRC,EAAIC,EAAM,cAAcqG,QAAQ,CAACxG,EAAIC,IACjCoG,EAAGnC,GAAGlE,EAAI,CAAEiC,MAAO,KAAMM,SAAU,IAAO,KAGlD,CGoDoB8J,CAAgBhB,EAAKW,QAAQpN,UAAW0M,EAC5C,EAEA,WAAMgB,CAAMjB,GACRvM,QAAQ6M,MAAM,oBAAqBN,GAAMG,MAAMC,WAC/ChN,EAAQG,UAAYyM,EAAKG,KAAK5M,UAnHlD,SAA4B2N,EAAepL,GACvC,IAAKA,IAAWA,EAAOD,aAAc,OACrC,MAAMsL,EAAWD,GAAehM,gBAAgB6J,GAC5CoC,IAAUrL,EAAOD,aAAesL,GACpC,IACI,MAAM1H,EAAM3D,EAAO4D,aACnB5D,EAAOD,aAAauC,MAAMuB,gBAAkB,GAAGF,KAAOA,IACtD3D,EAAOmD,gBACX,CAAE,MAAO,CACb,CA2GoBmI,CAAmBpB,EAAKG,KAAK5M,UAAWuC,GAExC,MAAMsJ,EAAKY,GAAMG,MAAMC,UACjBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,GAAIvI,GAAGoK,MACH,UACUpK,EAAEoK,MAAMjB,EAClB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,gBAAiBvF,EACnC,CAGJ,MAAMoI,EAAOxI,KAAKyI,QAClBpF,EAAekF,EAAKG,KAAK5M,UAAW,KACZyM,EAAKG,KAAK5M,UAC9B0M,KAER,EAEA,UAAAM,CAAWP,GACPvM,QAAQ6M,MACJ,yBACAN,GAAMG,MAAMC,WAGhB,MAAMhB,EAAKY,GAAMG,MAAMC,UACjBvJ,EAAIuI,EAAKH,EAASV,IAAIa,GAAM,KAClC,IACIvI,GAAG0J,aAAaP,EACpB,CAAE,MAAOnI,GACLpE,QAAQ2J,MAAM,qBAAsBvF,EACxC,CAEA,MAAMoI,EAAOxI,KAAKyI,SF5G/B,SAAoBpL,EAAOuC,SAAUuJ,EAAO,CAAA,GAC/C,MAAMC,EAAQ/L,EAAKE,iBAAiB,uBACpC,OAAK6L,GAA0B,IAAjBA,EAAM1E,OACbvD,KAAKC,GAAGgI,EAAO,CAClBJ,MAAO,EACPnE,QAAS,OACNsE,IAJkC,IAM7C,EEqG+BS,CAAWrB,EAAKG,KAAK5M,UAAW,CACvC2H,WAAY+E,KAEPA,GACb,MAKL,CAAEpB,UACb,CAMA,SAASA,IACL,IACQ7F,OAASA,MAAM6F,SAAS7F,MAAM6F,SACtC,CAAE,MAAO,CACTI,EAASqC,QACTtC,GAAe,CACnB,CCxJA,SAASuC,EAAcC,GACnB,MAAMC,EAAMD,GAAUxM,mBAAmB,OAAS,GAC5CgL,EAAO,CAAA,EAoBb,OAnBAyB,EAAItG,QAASuG,IACT,MAAMC,EAAKD,EAAGxM,cAAc,MACtB0M,GAASD,GAAI7D,aAAe,IAAI+D,QAAQ,QAAS,IACjDC,EAAeF,EApCpBG,WACAC,cACAC,UAAU,OACVhE,OACA4D,QAAQ,OAAQ,KAChBA,QAAQ,YAAa,IACrBA,QAAQ,SAAU,KA+BnB,MAAMK,EAAQR,EAAGxM,cAAc,oCAC/B,GAAIgN,EAAO,CACP,MAAMC,EAAOD,EAAME,QAAQJ,cACrBrO,EACO,WAATwO,EAAoBD,EAAMvO,OAASuO,EAAMvO,OAAS,IAAIsK,OAC1D+B,EAAK8B,GAAQ,CACTF,QACAO,OACAxO,QACA0O,SAAU,KAAM,EAChBC,UAAWJ,EACXK,aAAcb,EAEtB,IAEG1B,CACX,CAgCOE,eAAesC,EAAqBC,GACvC,MAAMC,EAASD,GAAOE,cACtB,IAAKD,EAAQ,OAEb,MAAME,EAAMF,EAAOG,iBAAmBH,EAAOI,eAAezL,SACtD0L,EAAML,EAAOI,eAAeE,UAAUC,MAAQ,GACpD,IAAKL,EAAK,OAEV,MAAMM,EAASN,EAAI1N,cAAc,YACjC,IAAKgO,EAAQ,OAEb,MAAMC,EAAOD,EAAO/E,WAAU,GACxBiF,EAAYD,EAAKnO,iBAAiB,YAOlCzB,EACFmP,EAAOvJ,QAAQ,oCAAsC9B,SAEnDgM,EAtFV,SAA6BN,EAAM,GAAIO,EAAUjM,UAE7C,IAAIgM,EAAO,EAIX,OAHIN,EAAIQ,SAAS,YAAWF,EAAO,GAC/BC,EAAQpO,cAAc,uBAAsBmO,EAAO,GACnDC,EAAQpO,cAAc,yBAAwBmO,EAAO,GAClDA,CACX,CA+EiBG,CAAoBT,EAAKI,GAEhCM,EAAQ,CACV,EAAG,OACH,EAAGvD,UAxDX,IAAsBwD,EAAiBC,EAyDvBP,EAAUjH,QAAU,IAzDduH,EA2DFN,EAAU,GA3DSO,EA4DnBP,EAAU,GA3DlB7B,EAAcmC,GAAkBnC,EAAcoC,IAa1D,SAAkBpQ,EAAWO,GACzB,MAAM8P,EAAQrQ,EAAU2B,cAAc,8BAA8BpB,MAC/D8P,IA/DW,CAACjP,IACjB,MAAMkP,EAAW,GACjB,IAAKlP,GAAImP,WAAY,OAAOD,EAC5B,IAAIlG,EAAIhJ,EAAGmP,WAAWC,WACtB,KAAOpG,GACgB,IAAfA,EAAEqG,UAAkBrG,IAAMhJ,GAAIkP,EAASI,KAAKtG,GAChDA,EAAIA,EAAEuG,YAEV,OAAOL,GAwDPM,CAAYP,GAAOzI,QAASiJ,GAAMA,EAAE1L,UAAUC,OAAO,WACrDiL,EAAMlL,UAAUa,IAAI,UACxB,CA+CY8K,CAAS9Q,EAAW,SACd,IAAI+Q,QAAS3I,GAAM2C,WAAW3C,EAAG,MA9CnD,SAA4BpI,EAAWO,GACnC,MAAMoE,EAAS3E,EAAU2B,cACrB,8BAA8BpB,qCAElCoE,GAAQS,QACZ,CA0CY4L,CAAmBhR,EAAW,IAGlC,EAAG,OACH,EAAG,OACH,EAAG,QAGHkQ,EAAMJ,UACAI,EAAMJ,IAEpB,CC1IO,SAASmB,EAAiB1P,EAAO1B,EAAQG,WAC5C,MAAMA,EAAYuB,GAAQuC,SAG1BxC,EAAItB,EAAW,wBAAwB4H,QAASxG,IAC5CA,EAAG6I,UAAY,IAAIiH,KAAK9P,GAAI+P,YAMfnR,EAAUyB,iBAAiB,aACnCmG,QAASwJ,IACd,MAAMC,EAAUD,EAAQzP,cAAc,iBACtC,IAAK0P,EAAS,OAEd,MAAM3G,EAAQ4G,GAAQA,EAAIhD,QAAQ,aAAc,IAC1CiD,EAAM,GAEZ,IAAK,IAAIlQ,EAAI,EAAGA,EAAIgQ,EAAQG,WAAW5I,OAAQvH,IAAK,CAChD,MAAMoQ,EAAOJ,EAAQG,WAAWnQ,GAChC,GAAsB,IAAlBoQ,EAAKhB,SAAgB,CACrB,MAAMiB,EAAU5N,SAASiG,cAAc,KACvC2H,EAAQzH,UAAYS,EAAK+G,EAAKE,WAC9BF,EAAKlB,WAAWqB,aAAaF,EAASD,EAAKd,aAC3CU,EAAQQ,YAAYJ,GACpBF,EAAIb,KAAKgB,EACb,MACIH,EAAIb,KAAKe,EAEjB,CAEA,MAAMK,EAAaP,EACdQ,OAAQC,GAAqB,OAAfA,EAAEC,UAChBF,OAAQC,GAAqB,MAAfA,EAAEC,UAA4C,IAAxBD,EAAER,WAAW5I,QAEhDsJ,EAAOpO,SAASqO,yBACtB,IAAK,IAAI9Q,EAAI,EAAGA,EAAIyQ,EAAWlJ,SAAUvH,EACrC6Q,EAAKhI,YAAY4H,EAAWzQ,IAChCgQ,EAAQnH,YAAYgI,KAMxB,MASME,EAAe,KACjB,MAAM9E,EAAQ+E,KAAKC,MAAMC,aAAaC,QAAQ,mBAChC,OAAVlF,IAEiB,IAAjBA,EAAM1E,QACN5I,EACKyB,iBAAiB,2BACjBmG,QAAS6K,IACNA,EAAEtN,UAAUC,OAAO,aAI/BkI,EAAM1F,QAAS8K,IACX,MAAMC,EAAU3S,EAAUyB,iBACtB,yCAAyCiR,OAEvCE,EAAe5S,EAAUyB,iBAC3B,8CAA8CiR,QAElDC,EAAQ/K,QAAS6K,GACbA,EAAE7M,QAAQ,2BAA2BT,UAAUa,IAAI,YAEvD4M,EAAahL,QAAS6K,GAClBA,EAAE7M,QAAQ,2BAA2BT,UAAUC,OAAO,gBAKlEpF,EAAUyB,iBAAiB,wBAAwBmG,QAASiL,IACxDA,EAAIxO,iBAAiB,QAAS,KAtCV,EAACkI,EAAME,KAC3B,IAAI9D,EAAO0J,KAAKC,MAAMC,aAAaC,QAAQjG,IAC/B,MAAR5D,IAAcA,EAAO,IACzB,MAAMpI,EAAMoI,EAAKmK,QAAQrG,IACb,IAARlM,EAAYoI,EAAK+H,KAAKjE,GACrB9D,EAAKoK,OAAOxS,EAAK,GACtBgS,aAAaS,QAAQzG,EAAM8F,KAAKY,UAAUtK,KAqCtCuK,CAAgB,iBAJNL,EACLjN,QAAQ,2BACRjE,cAAc,iBACdwR,SAAS7E,QAAQ,KAAM,KAE5B8D,QAGRA,IAiEgBpS,EAAUyB,iBAAiB,WACnCmG,QAAQ,SAAUwL,GACtB,IAAI7G,EAAO6G,EAAM7I,YACZ8I,MAAM,KAAK,GACX5E,cACAH,QAAQ,KAAM,IACdA,QAAQ,SAAU,IACvB8E,EAAMxN,QAAQ,WAAWT,UAAUa,IAAIuG,EAC3C,GACA,MAAM+G,EAAY,CAACC,EAAGC,EAAMlO,KACxB,MAAMlE,EAAKmS,EAAE9R,iBAAiB,WAAW+R,MACzC,IAAIpT,EAAQ,GAOZ,OANAgB,EAAGwG,QAAStD,IACRlE,EAAQkE,EAAE3C,cAAc,cAAc4I,aAAe,GACrDjG,EAAEsB,QAAQ,4BACLjE,cAAc2D,IACb4E,YAAY5F,KAEflE,GAgFLqT,EAAa,CAACF,EAAGC,EAAMlO,EAAIoO,KAC7B,MAAMC,EAAIJ,EAAE9R,iBAAiB,WAAW+R,MACxC,IAAKG,IAAMA,EAAE/K,OAAQ,OACrB,MAAO2D,EAAMqH,GAAQD,EAEfE,EACO,SAATH,EACOnH,EACI5K,cAAc,uBACd4I,YAAY8I,MAAM,KAAK,IAAM,IAClC,MACJS,EAAevH,EAAK5K,cAAc,cAAc4I,aAAe,GAC/DwJ,EAAcH,EAAKjS,cAAc,cAAc4I,aAAe,GAEpErK,QAAQC,IAAI0T,EAAWC,EAAcC,GAErC,MAAMC,EAAQT,EAAE5R,cAAc,2BAA2B2D,YACzDpF,QAAQC,IAAI6T,GACRA,IAAOA,EAAMC,UAAYJ,GAC7B,MAAMxC,EAAUkC,EAAE5R,cACd,2BAA2B2D,cAE3B+L,IAASA,EAAQ4C,UAAYH,GACjC,MAAMI,EAAQX,EAAE5R,cAAc,2BAA2B2D,WACrD4O,IAAOA,EAAMD,UAAYF,IAMb/T,EAAUyB,iBAAiB,0BACnCmG,QAASuM,IACjB,MAAM5H,EAhKS,CAACgH,IAChB,MAAMhH,EAAOgH,EAAE5R,cAAc,oBAC7B,OAAK4K,GACLA,EAAKtC,UAAYsC,EAAK0H,UACjBZ,MAAM,IACNzQ,IAAK0B,GACDA,EAAEoG,OAA8B,QAAUpG,EAAI,SAAnC,oBAEf8P,KAAK,IACH7H,GAPW,MA8JL8H,CAAWF,GAClBG,EArJiB,CAAC/H,IACxB,IAAKA,EAAM,OAAO,KAClB,MAAM+H,EAAQ/H,EAAKgI,cAAc1P,MAAMyP,MAEvC,OADA/H,EAAK3G,QAAQ,kBAAkBf,MAAQ,iBAAmByP,EACnDA,GAiJOE,CAAmBjI,GAC3BmH,EA/IO,CAACY,IACd,MAAMG,EAAS,CACXC,MAAO,qBACPC,MAAO,sBAEX,OAAOC,OAAOC,KAAKJ,GAAQK,KAAMC,GAAQN,EAAOM,KAAST,IA0I3CU,CAASV,GACjBW,EAAc,GAEdC,EAAQ,CACV,YACA,kBACA,eACA,cACA,gBAEEC,EAAS,CACXC,SAAU,2BACVC,OAAQ,2BAERC,UAAW,6BACX,kBAAiB,6BACjBC,aAAc,6BACd,cAAa,6BACbC,aAAc,6BAEd,MAAK,yBACLC,QAAS,yBACTC,UAAW,yBAEXC,SAAU,0BAGd,IAAK,MAAOZ,EAAKzP,KAAOsP,OAAOgB,QAAQT,GAAS,CAC5C,MAAM9D,EAAUiC,EAAUa,EAASY,EAAKzP,GACpC4P,EAAMpC,QAAQiC,IAAO,GAAIE,EAAYvE,KAAKrG,OAAOgH,IAAY,EACrE,CA7FkB,IAACkC,GA+FnB,SAAsBA,GAClB,MAAMsC,EAAStC,EAAE5R,cAAc,kBACzBP,EAAKmS,EAAE5R,cAAc,2BAE3B,IAAKkU,EAAQ,OAIb,QADIA,EAAOlU,cAAc,cAAc4I,aAAe,IACtCkE,eACZ,IAAK,SACDrN,EAAGO,cAAc,YAAYwD,UAAUa,IAAI,QAC3C,MACJ,IAAK,YACD5E,EAAGO,cAAc,YAAYwD,UAAUa,IAAI,QAC3C,MACJ,IAAK,YACD5E,EAAGO,cAAc,YAAYwD,UAAUa,IAAI,QAKvD,CAEA8P,CAAa3B,GAtKG,EAACZ,EAAGe,EAAOyB,KAC3B,MAAMC,EAAMzC,EAAE5R,cAAc,iCACvBqU,GAAQvP,OAAOwP,OACb,IAAIA,MAAMD,EAAK,CAClBpH,KAAM,OACNnC,KAAM,CACFyJ,OAAQ,CAAC,IAAK,IAAK,IAAK,IAAK,KAC7BC,SAAU,CACN,CACI1J,KAAMsJ,EACNK,YAAa,EACbC,YAAa/B,EACb1Q,MAAM,EACN0S,gBAAiBhC,KAI7BnL,QAAS,CACLoN,YAAa,EACbC,qBAAqB,EACrBC,WAAY,CACRC,QAAS,CACL/S,SAAU,IACVgT,OAAQ,aACRC,KAAM,EACNtR,GAAI,GACJuR,MAAM,IAGdC,OAAQ,CACJ5T,EAAG,CAAE6T,SAAS,EAAOC,KAAK,GAAK3L,IAAK,IACpCrI,EAAG,CAAE+T,SAAS,IAElBE,OAAQ,CAAEC,QAAS,GACnBC,SAAU,CAAEC,MAAO,CAAEC,YAAa,IAClCC,QAAS,CACLC,QAAS,CAAEC,SAAS,GACpBnJ,MAAO,CAAE0I,SAAS,GAClBU,SAAU,CAAEV,SAAS,GACrBW,OAAQ,CAAEX,SAAS,QAgI/BY,CAAYxD,EAASG,EAAOW,IAvHT1B,EAwHLY,GAvHW1S,iBAAiB,2BAC3BmG,QAASxG,IACpB,MAAMwW,EAASxW,EAAGoE,QAAQoS,OAC1BxW,EAAGiD,iBAAiB,aAAeC,IAC/B,MAAMK,EAASL,EAAEK,OACZiB,QAAQ,0BACRjE,cAAc,2BACfgD,IAAQA,EAAOa,QAAQoS,OAASA,OAIzBrE,EAAE9R,iBAAiB,yBAC3BmG,QAASxG,IAChBA,EAAGiD,iBAAiB,aAAeC,IAC/B,MAAMK,EAASL,EAAEK,OACZiB,QAAQ,0BACRjE,cAAc,2BACnBgD,GAAQQ,UAAUa,IAAI,YAE1B5E,EAAGiD,iBAAiB,aAAeC,IAC/B,MAAMK,EAASL,EAAEK,OACZiB,QAAQ,0BACRjE,cAAc,2BACnBgD,GAAQQ,UAAUC,OAAO,cAiGjCqO,EAAWU,EAAS,OAAQ,OAAQT,GACpCD,EAAWU,EAAS,UAAW,OAAQT,GACvCD,EAAWU,EAAS,SAAU,OAAQT,IAE9C,CC3SA,SAASmE,EAAuBC,EAAQC,EAAK,EAAGC,EAAK,GACjD,MAAMC,EAAKH,EAAOI,eACZC,EAAKL,EAAOM,eACZC,GAAQF,EAAGG,IAAML,EAAGK,KAAOP,EAC3BQ,GAAQJ,EAAGK,IAAMP,EAAGO,KAAOR,EACjC,OAAO,IAAIS,WAAWC,aAClB,CAACT,EAAGK,IAAMD,EAAMJ,EAAGO,IAAMD,GACzB,CAACJ,EAAGG,IAAMD,EAAMF,EAAGK,IAAMD,GAEjC,CAuCO,SAASI,EACZvY,EACAwO,EAAO,MACPgK,EAAY,EACZC,GAAM,GAEN,OApBG,UACHC,EAAEA,EAACC,EAAEA,EAAClI,EAAEA,EAACmI,KAAEA,EAAIpK,KAAEA,IACjBgK,UAAEA,EAAY,EAACC,IAAEA,GAAM,GAAS,CAAA,GAShC,MAAO,GAPIpO,OAAOqO,GAAGG,SAAkB,QAATrK,EAAiB,EAAI,EAAG,SAC3CiK,EAAMpO,OAAOsO,GAAGE,SAAS,EAAG,KAAOxO,OAAOsO,OAC1CF,EACLxO,OAAOwG,GACFqI,QAAQN,GACRK,SAASL,EAAY,EAAQA,EAAY,EAAG,KACjDvO,OAAOwG,GAAGqI,QAAQN,OACOI,GACnC,CAQWG,CAzCJ,SAAe/Y,EAAOwO,EAAO,MAAOgK,EAAY,GACnD,MAAMI,EACO,QAATpK,EAAkBxO,GAAS,EAAI,IAAM,IAAOA,GAAS,EAAI,IAAM,IACnE,IAAIgZ,EAAIhO,KAAKiO,IAAIhP,OAAOjK,IACpB0Y,EAAI1N,KAAKkO,MAAMF,GACfG,EAAmB,IAATH,EAAIN,GACdC,EAAI3N,KAAKkO,MAAMC,GACf1I,EAAmB,IAAd0I,EAASR,GAClB,MAAMxF,EAAInI,KAAKC,IAAI,EAAe,EAAZuN,GAUtB,OATA/H,EAAIxG,OAAOwG,EAAEqI,QAAQ3F,IACjB1C,GAAK,KACLA,GAAK,GACLkI,GAAK,GAELA,GAAK,KACLA,GAAK,GACLD,GAAK,GAEF,CAAEA,IAAGC,IAAGlI,IAAGmI,OAAMpK,OAC5B,CAsBqB4K,CAAMpZ,EAAOwO,EAAMgK,GAAY,CAAEA,YAAWC,OACjE,CAEA,SAASY,EAAgBrY,GACrB,IAAKA,EAAI,MAAO,GAChB,MAAMuD,EAASvD,EAAGO,gBAAgB,kCAAoCP,EAChEyD,EAAQF,GAAQE,MAAMyP,OAAS3P,GAAQ+U,aAAa,UAAY,GACtE,OAAK7U,GAAc,EAGvB,CAmIO,MAAM8U,EACT,WAAAzQ,EAAYtG,IACRA,EAAGgX,wBACHA,EAA0B,iCAAgCC,sBAC1DA,EAAwB,iCACxB,IACA3V,KAAKtB,IAAMA,EACXsB,KAAK4V,gBAAkBpY,EAAGoC,SAAU8V,IAA4B,KAChE1V,KAAK6V,eAAiBrY,EAAGoC,SAAU+V,IAA0B,KAC7D3V,KAAK8V,aACDtY,EAAGwC,KAAK6V,eAAgB,2BAA6B,KACzD7V,KAAK+V,YAAa,EAClB/V,KAAKgW,eAAgB,EAGrBhW,KAAKiW,aACDzY,EAAGwC,KAAK6V,eAAgB,uCACxB,KACJ7V,KAAKkW,aACD1Y,EAAGwC,KAAK6V,eAAgB,uCACxB,KACJ7V,KAAKmW,YACD3Y,EAAGwC,KAAK6V,eAAgB,qCAAuC,KACnE7V,KAAKoW,cACD5Y,EAAGwC,KAAK6V,eAAgB,yCACxB,KACJ7V,KAAKqW,gBACD7Y,EAAGwC,KAAK6V,eAAgB,0BAA4B,KACxD7V,KAAKsW,YAAc9Y,EAAGwC,KAAK6V,eAAgB,sBAAwB,KAEnE7V,KAAKuW,mBACLvW,KAAKwW,YACT,CAEA,gBAAAD,GACQvW,KAAK8V,cACL9V,KAAK8V,aAAa3V,iBAAiB,QAAS,IACxCH,KAAKyW,eAIb7W,SAASO,iBAAiB,UAAYC,IACpB,WAAVA,EAAEyQ,KAAoB7Q,KAAKgW,eAAehW,KAAK0W,eAIvD,MAAMC,EAAO,IAAM3W,KAAK4W,aACxB5W,KAAKiW,cAAc9V,iBAAiB,QAASwW,GAC7C3W,KAAKkW,cAAc/V,iBAAiB,QAASwW,EACjD,CAEA,UAAAH,GACI,IACI,MAAMK,EAAQxI,aAAaC,QAAQ,YACnC,IAAKuI,EAAO,OACZ,MAAMC,OAAEA,EAAMC,SAAEA,EAAQC,QAAEA,EAAO9J,QAAEA,GAAYiB,KAAKC,MAAMyI,GACtDC,IACA9W,KAAK+V,WAAa,CAAEe,SAAQC,WAAUC,UAAS9J,YAC/ClN,KAAKiW,eAAcjW,KAAKiW,aAAa/Z,MAAQ8a,GAAW,IACxDhX,KAAKkW,eAAclW,KAAKkW,aAAaha,MAAQgR,GAAW,IACxDlN,KAAKoW,gBAAepW,KAAKoW,cAAcla,MAAQ6a,GAAY,IAC3DD,GAAQ9W,KAAKiX,qBAAqBH,GAEtC9W,KAAK8V,cAAc7U,UAAUa,IAAI,OACrC,CAAE,MAEF,CACJ,CAEA,UAAA8U,GACI,GAAK5W,KAAK+V,WACV,IACI,MAAMmB,EAAU,CACZJ,OAAQ9W,KAAK+V,WAAWe,QAAU,KAClCC,SACI/W,KAAK+V,WAAWgB,UAAY/W,KAAKoW,eAAela,OAAS,GAC7D8a,QAAShX,KAAKiW,cAAc/Z,OAAS,GACrCgR,QAASlN,KAAKkW,cAAcha,OAAS,IAEzCmS,aAAaS,QAAQ,WAAYX,KAAKY,UAAUmI,GACpD,CAAE,MAEF,CACJ,CAEA,UAAAC,GACI,MAAMC,EAAM/I,aAAaC,QAAQ,YACjC,OAAK8I,EACEjJ,KAAKC,MAAMgJ,GADD,IAErB,CAEA,WAAAC,CAAYH,GACR,IACI7I,aAAaS,QAAQ,WAAYX,KAAKY,UAAUmI,GACpD,CAAE,MAAO,CACb,CAEA,QAAAI,GACI,OAAOtX,KAAKmX,YAChB,CAEA,oBAAAF,CAAqBM,GACjB,MAAMnD,IAAEA,EAAGE,IAAEA,GAAQkD,MAAMC,QAAQF,GAC7B,CAAEnD,IAAKmD,EAAO,GAAIjD,IAAKiD,EAAO,IAC9BA,EACFvX,KAAKmW,cAAanW,KAAKmW,YAAYja,MAAQ,GAAGkY,KAAOE,KACrDtU,KAAKqW,kBACLrW,KAAKqW,gBAAgBhQ,YAAc,GAAG+N,EAAIY,QACtC,OACEV,EAAIU,QAAQ,MAClBhV,KAAKsW,cACLtW,KAAKsW,YAAYjQ,YAAc,GAAGoO,EAC9BL,EACA,MACA,OACEK,EAAmBH,EAAK,MAAO,KAC7C,CAEA,YAAAoD,CAAaZ,EAAQC,GACjB/W,KAAK+V,WAAa,CAAEe,SAAQC,YAC5B/W,KAAK4W,aACL5W,KAAK2X,YACL3X,KAAK4X,aAAad,EAAQC,EAC9B,CAEA,YAAAa,CAAad,EAAQC,GACZD,IACL9W,KAAK+V,WAAa,IACX/V,KAAK+V,WACRe,SACAC,SAAUA,GAAY/W,KAAK+V,YAAYgB,UAE3C/W,KAAKiX,qBAAqBH,GAC1B9W,KAAK4W,aACL5W,KAAK2X,YACT,CAEA,WAAAE,CAAYd,GACR/W,KAAK+V,WAAa,IAAK/V,KAAK+V,WAAYgB,YACpC/W,KAAKoW,gBAAepW,KAAKoW,cAAcla,MAAQ6a,GAAY,IAC/D/W,KAAK4W,YACT,CAEA,WAAAH,GACIzW,KAAKgW,cAAgBhW,KAAK0W,aAAe1W,KAAK2X,WAClD,CAEA,SAAAA,GACS3X,KAAK6V,iBACV7V,KAAK6V,eAAe5U,UAAUa,IAAI,UAClC9B,KAAK4V,iBAAiB3U,UAAUC,OAAO,UACvClB,KAAKgW,eAAgB,EACzB,CAEA,UAAAU,GACS1W,KAAK6V,iBACV7V,KAAK6V,eAAe5U,UAAUC,OAAO,UACrClB,KAAKgW,eAAgB,EAEzB,EAKGvN,eAAeqP,GAAoBC,SACtCA,EAAW,yCAAwCC,UACnDA,EAAY,CACRC,QAAS,YACTnc,UAAW,OACXoc,aAAc,eACdC,MAAO,SACP9Z,OAAQ,UACR+Z,OAAQ,cACRC,YAAa,iCACbC,SAAU,iCACb/F,WACDA,EAAa,CAAA,EAAEgG,QACfA,EAAU,EAACC,YACXA,EAAc,IACd,IACA,MAAM1U,aAAEA,GAAiByO,GAAc,GAEjC0F,EAAUrY,SAASnC,cAAcua,EAAUC,SAC3Cnc,EAAY8D,SAASnC,cAAcua,EAAUlc,WAC7C2c,EAAU7Y,SAASnC,cAAcua,EAAUE,cAC3C7Z,EAASuB,SAASnC,cAAcua,EAAU3Z,QAC1Cqa,EAAe9Y,SAASnC,cAAcua,EAAUG,OAChDvC,EAAkBhW,SAASnC,cAAcua,EAAUI,QACnDC,EAAczY,SAASnC,cAAcua,EAAUK,aAC/CM,EAAgB/Y,SAASnC,cAAcua,EAAUM,UAElDxc,GAAc2c,GACfzc,QAAQ8L,KAAK,mCAAoCkQ,GAGrD,MAAMY,EAAU,IAAIC,gBACdT,QAnUV3P,gBAAgC8P,QAAEA,EAAU,EAACO,MAAEA,EAAQ,GAAEC,OAAEA,GAAW,IAClE,IACI,MAAMC,QAAYC,MAAM,KAAKV,KAAY,CACrCW,YAAa,cACbH,WAEErN,QAAasN,EAAIjb,OACjBoN,GAAM,IAAIgO,WAAYC,gBAAgB1N,EAAM,aA+GlD,OA9GgB8L,MAAM9E,KAAKvH,EAAI5N,iBAAiB,iBAE3C8b,MAAM,EAAGP,GACTpa,IAAK6P,IACF,IACI,MAAM/C,EAAO+C,EAAEiH,aAAa,QACtBlK,EAAM,IAAIgO,IAAI9N,EAAMD,SAASgO,QAAQ/N,KACrCgO,EAAMjL,EAAE7M,QAAQ,wBAChByI,GAASoE,EAAElI,aAAe,YAAYG,OAEtCiT,EAAUjc,EACZgc,EACA,mDAEEE,EAAYD,EACZ,IAAIH,IAAIG,EAAQjE,aAAa,QAASjK,SAASgO,QAC1C/N,KACL,GACAmO,EACFF,GAASpT,aAAaG,QACtBgT,GACM/b,cAAc,kBACd4I,aAAa+D,QAAQ,aAAc,IACpC5D,QACL,GACEoT,EAAcrE,EAAgBkE,GAE9BI,EACFrc,EACIgc,EACA,2BACDnT,aAAaG,QAAU,GAExBkJ,EACFlS,EACIgc,EACA,oCACDnT,aAAaG,QAAU,GACxBsT,EAAMxO,EAAIyO,MAAM,WAChBC,EAAKF,EAAMA,EAAI,GAAK,GAGpBhD,GADQ3M,EAAQ,KAAOuF,GACRqK,MAAM,sBAC3B,IAAKjD,EAAQ,OAAO,KACpB,MAAMmD,EAAMC,WAAWpD,EAAO,IACxBxC,EAAM4F,WAAWpD,EAAO,IAC9B,IAAK3Q,OAAOgU,SAASF,KAAS9T,OAAOgU,SAAS7F,GAC1C,OAAO,KAGX,MAAM8F,EAAW5c,EAAGgc,EAAK,aACnBa,EAAkB7c,EAAG4c,EAAU,OAC/BE,EAAgB9c,EAAG4c,EAAU,iBAC7BG,EAAiBhF,EAAgB+E,GACjCE,EAAgBhd,EAAG4c,EAAU,iBAC7BK,EAAiBjd,EAAG4c,EAAU,mBAC9BM,EACF,IAAI1N,KACAyN,GAAgBE,UAAUtU,YAAYG,SACrC,GAST,OARAxK,QAAQC,IAAI,CACRoe,kBACAC,gBACAC,iBACAC,gBACAE,kBAGG,CACHV,KACA7P,QACAuF,OACApE,MACAsP,OAAQ,CACJvS,KAAMsR,EACNrO,IAAKoO,EACLtJ,MAAOwJ,GAEXC,UACA/C,OAAQ,CAACmD,EAAK3F,GACd8F,SAAU,CACNS,OAAQR,EACF,IAAIf,IAAIe,EAAgBS,KACxB,KACNC,KAAMT,EACA,CACIjS,KAAMiS,EAAcjU,YAAYG,OAChC8E,IAAK,IAAIgO,IAAIgB,EAAc9O,MAC3B4E,MAAOmK,GAEX,KACN9b,KAAM+b,EACA,IAAIlB,IAAIkB,EAAchP,MACtB,KACNwP,KAAM,CACFC,IAAKP,EAAcQ,cAAc,OAAS,GAC1CC,MAAOT,EAAcQ,cAAc,OAAS,GAC5CE,KAAMV,EAAcQ,cAAc,SAAW,GAC7CG,KACIX,EAAcQ,cAAc,UAAY,GAC5CI,KAAMZ,EAAcpQ,YAAc,KAIlD,CAAE,MAAOlK,GAEL,OADApE,QAAQ2J,MAAM,gCAAiCvF,GACxC,IACX,IAEHyN,OAAO0N,QAEhB,CAAE,MAAOnb,GAEL,OADApE,QAAQ8L,KAAK,gCAAiC1H,GACvC,EACX,CACJ,CAyMeob,CAAiB,CACpBjD,UACAO,MAAON,EACPO,OAAQH,EAAQG,UACb,GAEX,IAAIra,EAAM,KACV,MAAM+c,EAAe,IAAIhU,IACzB,IAAIiU,EAAM,KACNC,EAAa,KACbC,EAAS,KAETC,EAAkB,KAGtB,MAAMC,EAAiB,iBAGjBC,EAAiB,IAAIxH,WAAWC,aAClC,CAAC,MAAO,OACR,CAAC,MAAO,SAENwH,EAAiB,CAAC,QAAS,UAEjC,SAASC,IACL,IACI,OAEQpY,KACJ,IAER,CAAE,MACE,OAAO,IACX,CACJ,CAMA,SAASqY,IACL,OAAOX,QACH7c,GAAKyd,YAAYC,QAAQC,KAAMC,GAAMA,EAAEtC,KAAO8B,GAEtD,CAEA,SAASS,EAAkBrJ,GACvB,IAAKxU,EAAK,OAAO,EACjB,IAAKwd,IAA0B,OAAO,EACtC,MAAMM,EAAW9d,EAAI+d,sBAAsBvJ,EAAO,CAC9CkJ,OAAQ,CAACN,KAEb,OAAOU,GAAYA,EAAS9X,OAAS,CACzC,CAEA,SAASgY,EAAiBnF,GACtB,IAAK7Y,IAAQwd,IAA0B,OAAO,KAC9C,MAAMM,EAAW9d,EAAI+d,sBAAsB/d,EAAIie,QAAQpF,GAAS,CAC5D6E,OAAQ,CAACN,KAEb,OAAOU,GAAYA,EAAS9X,OAAS,IAC/B8X,EAAS,GAAGI,YAAYC,WAAaL,EAAS,GAAGxC,KACjD,IACV,CAgEA,SAAS8C,EACLvF,GACAwF,KAAEA,EAAO,GAAEC,KAAEA,EAAO,EAACC,KAAEA,EAAO,EAACxd,SAAEA,EAAW,KAAQ,CAAA,GAE/Cf,GAELA,EAAIwe,OAAO,CACPC,OAAQ5F,EACRwF,KAAM7V,KAAKC,IAAIzI,EAAI0e,UAAWL,GAC9BM,OAAQ,CAACL,EAAMC,GACfxd,YAER,CAEA,SAAS6d,IACL,IAAK1H,EAAiB,OAGtB,IAAI2H,EAAgB,KAsBpB,SAASC,IACDD,IACAA,EAActc,UAAUC,OAAO,uBAC/Bqc,EAAgB,KAExB,CAGA3H,EAAgBzV,iBAAiB,YAAcC,IAC3C,MAAMkP,EAAOlP,EAAEK,OAAOiB,QAAQ,yBAC9B,IAAK4N,IAASsG,EAAgBjU,SAAS2N,GAAO,OAE9C,MAAM0K,EAAK1K,EAAKhO,QAAQmc,QAExB,GAAIzD,GAAMyB,GAAciC,IAAI1D,GAAK,EAjFzC,SAAwBA,GACpB,MAAMnF,EAAI4G,EAAa3U,IAAIP,OAAOyT,IAClC,IAAKnF,IAAMnW,EAAK,OAEhB,MAAMif,EAAK9I,EAAE+I,YAGMvF,GAAapX,UAAUU,SAAS,WAC7C0W,EAAYwF,YAEElF,GAAe1X,UAAUU,SAAS,WAChDgX,EAAckF,YAIpBf,EAASa,GAGT,IACI,MAAMzgB,EAAK2X,EAAEiJ,aACb5gB,EAAG+D,UAAUa,IAAI,cACjB+E,WAAW,IAAM3J,EAAG+D,UAAUC,OAAO,cAAe,IACxD,CAAE,MAAO,CACb,CA4DY6c,CAAe/D,IApCvB,SAAgCnF,GAC5B,IACI,MAAM3X,EAAK2X,GAAGiJ,eACRhO,EAAQ5S,GAAIO,gBAAgB,kBAAoB,KAClD8f,GAAiBA,IAAkBzN,GACnCyN,EAActc,UAAUC,OAAO,uBAE/B4O,GACAA,EAAM7O,UAAUa,IAAI,uBAExByb,EAAgBzN,GAAS,IAC7B,CAAE,MAEMyN,IACAA,EAActc,UAAUC,OAAO,uBAC/Bqc,EAAgB,KAExB,CACJ,CAoBQS,CADUvC,EAAa3U,IAAIkT,GAE/B,MAAO,GAAI1K,EAAKhO,QAAQ8S,KAAO9E,EAAKhO,QAAQgT,IAAK,CAE7C,MAAMqJ,EAAK,CACPzD,WAAW5K,EAAKhO,QAAQ8S,KACxB8F,WAAW5K,EAAKhO,QAAQgT,MAExBnO,OAAOgU,SAASwD,EAAG,KAAOxX,OAAOgU,SAASwD,EAAG,KAC7Cb,EAASa,EAAI,CAAEZ,KAAM,KAAMtd,SAAU,MAEzC+d,GACJ,IAIJ5H,EAAgBzV,iBAAiB,WAAaC,IAC1C,MAAMkP,EAAOlP,EAAEK,OAAOiB,QAAQ,yBACzB4N,IAGDlP,EAAEwB,eAAiB0N,EAAK3N,SAASvB,EAAEwB,gBAEvC4b,OAIJ5H,EAAgBzV,iBAAiB,aAAcqd,EACnD,CAgFA,SAASS,EAAW7d,GAChB,IAAK1B,EAAK,OAGV,GApQqBxB,EAoQDkD,EAAE8d,eAAezd,OAnQ5BvD,GAAIwE,UAAU,iDAmQuB,OApQlD,IAAyBxE,EAuQrB,IAAKqf,EAAkBnc,EAAE8S,OAAQ,OAGjCiL,EAAmB/d,EAAEmX,QAGrBuF,EAAS1c,EAAEmX,OAAQ,CAAEwF,KAAM,KAAMtd,SAAU,MAG3C,MAAM2e,EAAO1B,EAAiBtc,EAAEmX,QAChCsE,GAAiBjE,aAAaxX,EAAEmX,OAAQ6G,GACxCvC,GAAiBlE,YAGjB,MAAM0G,EAAiBxC,GAAiB5F,cAAc/Z,OAAOsK,OACzD6X,GAAgBC,EAAsBD,EAC9C,CAiBA,SAASF,EAAmB5G,GACxB,IAAK7Y,EAAK,OAAO,KACjB,MAAM8F,EAAMgT,MAAMC,QAAQF,GACpB,CAAEnD,IAAKmD,EAAO,GAAIjD,IAAKiD,EAAO,IAC9BA,EACN,GAAKoE,EAODA,EAAW4C,UAAU/Z,OAPR,CACb,MAAMtH,EAAK0C,SAASiG,cAAc,OAClC3I,EAAG4I,UAAY,cACf5I,EAAG6I,UAAY,+FACf4V,EAAa,IAAIpH,WAAWiK,OAAO,CAAEzc,QAAS7E,IAAMqhB,UAAU/Z,GAC9DmX,EAAW8C,MAAM/f,EACrB,CAGA,MAAMggB,EAAY,QAAQvY,OAAO3B,EAAI4P,KAAKY,QAAQ,YAAY7O,OAC1D3B,EAAI8P,KACNU,QAAQ,KAEV,OADA2G,EAAWgD,YAAYC,QAAQF,GACxB/C,CACX,CAEA,SAAS2C,EAAsBvgB,GAC3B,IAAK4d,EAAY,OACjB,MAAMze,EAAKye,EAAWmC,gBAAkBnC,EAAWkD,UAAY,KAC/D,IAAK3hB,EAAI,OAET,IAAI4S,EAAQ5S,EAAGO,cAAc,iBACxBqS,IACDA,EAAQlQ,SAASiG,cAAc,OAC/BiK,EAAMhK,UAAY,kCAClB5I,EAAG4hB,QAAQhP,IAEf,MAAMiP,GAAKhhB,GAAQ,IAAIyI,OACvBsJ,EAAMzJ,YAAc0Y,EACpBjP,EAAMkP,QAAUD,EAAEra,MACtB,CAEA,SAASua,IACL,IACgC,mBAAjBnb,GAA+BmU,GAAWnc,IACjDmc,EAAQhX,UAAUa,IAAI,UACtBhG,EAAUmF,UAAUC,OAAO,UAC3B4C,EAAa,CAAEhI,cAEvB,CAAE,MAAOojB,GACLljB,QAAQ2J,MAAM,4BAA6BuZ,EAC/C,CACJ,CAEA,SAASC,IACL,MAAM5b,EAAK0Y,IACP1Y,GAAIA,EAAG6b,UAAU,GAAGC,UACxBpH,GAAShX,UAAUC,OAAO,UAC1BmX,GAAapX,UAAUC,OAAO,UAC9ByX,GAAe1X,UAAUC,OAAO,SACpC,CAEA,SAASoe,EAAelf,GACpBA,GAAGmf,mBACH,MAAMhc,EAAK0Y,IACP1Y,GAAMA,EAAGd,WAAa,IAAMc,EAAGic,WAC/BL,IAGJF,GACJ,CAEA,SAAS7X,IAIL,GAHAwR,EAAQ6G,QACRxH,GAASyH,oBAAoB,QAASJ,GACtC5G,GAAciH,YAAYjH,EAAahS,WAAU,IAC7ChI,EAAK,CACL,IACIA,EAAIkhB,IAAI,YAAahE,GACrBld,EAAIkhB,IAAI,QAAS3B,EACrB,CAAE,MAAO,CACT,IACItC,GAAYza,QAChB,CAAE,MAAO,CACT,IACIxC,EAAIwC,QACR,CAAE,MAAO,CACTxC,EAAM,IACV,CAIJ,CAGA,IAAK6V,WAID,OAHAvY,QAAQ2J,MACJ,4DAEG,CAAEsZ,OAAME,QAAO/X,WAzJtBsR,GAAcvY,iBAAiB,QAAUC,IACrCA,GAAGmf,mBACHlH,GAAapX,UAAU4e,OAAO,UAC9BlH,GAAe1X,UAAUC,OAAO,YA2JxC,IACIxC,EAAM,IAAI6V,WAAW9M,IAAI,CACrB9G,MAAOoX,EACPoF,OAAQnB,EACR8D,MAAO,GACPC,SAAU,KACVjkB,UAAW2c,GAAWT,EAAUE,aAChC8H,wBAAyB,CAAEC,WAAW,GACtCC,oBAAoB,EACpBC,UAAWxM,EAAuBoI,GAAiB,IAAM,GACzDqE,YAAY,IAEhB7d,OAAO7D,IAAMA,EAGbmd,EAAkB,IAAIpG,EAAgB,CAAE/W,QACxCmd,GAAiB5F,cAAc9V,iBAAiB,QAAUC,IACtDke,EAAsBle,EAAE8K,cAAchP,SAG1C0f,EAx2BD,SAAqByE,GACxB,IAAIC,GAAU,EACd,OAAO,YAAsBC,GACrBD,IACJA,GAAU,EACV1Z,sBAAsB,KAClB,IACIyZ,EAAGG,MAAMxgB,KAAMugB,EACnB,CAAC,QACGD,GAAU,CACd,IAER,CACJ,CA21BiBG,CA3Kb,SAAqBrgB,GACjB,IAAK/B,EAAQ,OACb,MAAMqiB,GAAWnE,EAAkBnc,EAAE8S,OACrC7U,EAAO4C,UAAU4e,OAAO,MAAOa,GAC/B,MAAMtM,IAAEA,EAAGE,IAAEA,GAAQlU,EAAEmX,OACvBlZ,EAAOiD,QAAQwV,OAAS,GAAGrC,EACvBL,EACA,MACA,OACEK,EAAmBH,EAAK,MAAO,IACzC,GAkKI5V,EAAIiiB,GAAG,YAAa/E,GACpBld,EAAIiiB,GAAG,QAAS1C,GAEhBvf,EAAIiiB,GAAG,OAAQ,KACX,IACIjF,EAAMhd,EAAIkiB,gBACNjN,EAAuBoI,GAAiB,IAAM,GAC9C,CACIgE,SAAU,KACVD,MAAO,GACPe,QAAS,MACTxD,OAAQ,EAAE,IAAK,KAGnB3B,GAAKhd,EAAIoiB,OAAOpF,GACpBhd,EAAIwe,OAAO,IAAKxB,EAAK2B,OAAQ,EAAE,IAAK,GAAI5d,SAAU,KACtD,CAAE,MAAO,EAnZjB,WACI,IAAKf,IAAQ8Y,MAAMC,QAAQW,KAAYA,EAAO1T,OAAQ,MAAO,GAC7D,MAAMqc,EAAO,GAEb3I,EAAO1U,QAASqb,IACZ,IACI,IAAKA,IAAMvH,MAAMC,QAAQsH,EAAEjI,SAA+B,IAApBiI,EAAEjI,OAAOpS,OAC3C,OACJ,MAAMF,EAAMgT,MAAMC,QAAQsH,EAAEjI,QACtB,CAAE1C,IAAK2K,EAAEjI,OAAO,GAAIxC,IAAKyK,EAAEjI,OAAO,IAClCiI,EAAEjI,OACR,IAAK3Q,OAAOgU,SAAS3V,EAAI4P,OAASjO,OAAOgU,SAAS3V,EAAI8P,KAClD,OACJ,MAAMnK,EAAQ4U,EAAE5U,OAAS,WACnBjN,EAAK0C,SAASiG,cAAc,OAClC3I,EAAG4I,UAAY,SACf5I,EAAG6I,UAAY,6BAA6BoE,0CAC5C,MAAM0K,EAAI,IAAIN,WAAWiK,OAAO,CAAEzc,QAAS7E,IACtCqhB,UAAU,CAAC/Z,EAAI4P,IAAK5P,EAAI8P,MACxBmK,MAAM/f,GACXqiB,EAAKvU,KAAKqI,GACNkK,EAAE/E,IAAIyB,EAAaxV,IAAIM,OAAOwY,EAAE/E,IAAKnF,EAC7C,CAAE,MAAOlP,GACL3J,QAAQ2J,MAAM,kCAAmCA,EACrD,IAIJ,IACQiQ,GAAiBA,EAAgB5P,YAAYgI,KACrD,CAAE,MAAO,CAGb,CAoXQgT,GAhQR,WACI,IAAKxJ,MAAMC,QAAQW,KAAYA,EAAO1T,SAAWkR,EAC7C,OAEJ,MAAMqL,EAAMrhB,SAASiG,cAAc,OACnCob,EAAInb,UAAY,kBAEhBsS,EAAO1U,QAASwd,IACZ,MAAM5R,EAAO1P,SAASiG,cAAc,OACpCyJ,EAAKxJ,UAAY,uBACjBwJ,EAAKhO,QAAQmc,QAAUlX,OAAO2a,EAAMlH,IAAM,IAC1C1K,EAAKhO,QAAQ8S,IAAM7N,OAAO2a,EAAMpK,SAAS,IAAM,IAC/CxH,EAAKhO,QAAQgT,IAAM/N,OAAO2a,EAAMpK,SAAS,IAAM,IAC/C,MAAMqK,EAAYD,EAAM/W,OAAS,yBACjCmF,EAAKvJ,UAAY,wCAGTmb,EAAM9G,UAAUS,OACV,aAAaqG,EAAM9G,SAASS,8DAC5B,0FAGEqG,EAAM9G,UAAUY,KAAKC,KAAO,wCAC5BiG,EAAM9G,UAAUY,KAAKG,OAAS,iKAKtC+F,EAAM5V,QACL6V,mIAGAzE,EAAiB,CACbtI,IAAK8M,EAAMpK,OAAO,GAClBxC,IAAK4M,EAAMpK,OAAO,MAChB,2DAGHoK,EAAM9G,UAAUW,MAAMqG,YAAc,qGAGhCF,EAAM9G,UAAUW,MAAM3K,OAAS,qBAE3C8Q,EAAM9G,UAAUW,MAAM1S,KAAK8G,MAAM,KAAK,GAAG,OACxC+R,EAAM9G,UAAUW,MAAM1S,KAAK8G,MAAM,KAAK,IAAM,yFAMjD8R,EAAIjb,YAAYsJ,KAGpBsG,EAAgB7P,UAAY,GAC5B6P,EAAgB5P,YAAYib,EAChC,CA0MQI,GACA/D,IAEA,IACI,MAAMgE,EAAQzF,GAAiBvE,aAC/B,GAAIgK,GAAOxK,OAAQ,CACf,MAAMA,EAASU,MAAMC,QAAQ6J,EAAMxK,QAC7B,CAAE1C,IAAKkN,EAAMxK,OAAO,GAAIxC,IAAKgN,EAAMxK,OAAO,IAC1CwK,EAAMxK,OAEZqH,EAAmBrH,GACnB+E,GAAiBjE,aACb,CAACd,EAAO1C,IAAK0C,EAAOxC,KACpBgN,EAAMvK,UAAY,MAEtB8E,GAAiBlE,YACjBjZ,EAAIwe,OAAO,IACJxB,EACHyB,OAAQ,CAACrG,EAAO1C,IAAK0C,EAAOxC,KAC5ByI,KAAM7V,KAAKC,IAAIzI,EAAI0e,UAAW,QAE9BkE,EAAMtK,SAASsH,EAAsBgD,EAAMtK,QACnD,CACJ,CAAE,MAAOkI,GACLljB,QAAQ2J,MAAM,oBAAqBuZ,EACvC,EAnLR,WACI,GAAKxgB,EAAL,CACAA,EAAI6iB,SAEJ,IACI7iB,EAAI8iB,aAAazF,GACjBL,EAAMhd,EAAIkiB,gBAAgB7E,EAAgB,CACtC/I,QAAS,CAAE/T,IAAK,GAAIwiB,MAAO,GAAIC,OAAQ,GAAI3iB,KAAM,IACjDghB,QAASrhB,EAAIijB,aACb7B,MAAOphB,EAAIkjB,WACXf,SA7tBD3a,EA6tBgBxH,EAAI0e,UA7tBjBtK,EA6tB4B,EA7tBvB3L,EA6tB0B,GA5tBtCD,KAAKC,IAAI2L,EAAK5L,KAAK4L,IAAI3L,EAAKjB,MA8tB/B,CAAE,MAAO,CA/tBjB,IAAeA,EAAG4M,EAAK3L,CAotBL,CAYd,CAuKQ0a,IAER,CAAE,MAAO3C,GACLljB,QAAQ2J,MAAM,oBAAqBuZ,EACvC,CAIA,OAFAjH,GAAS9X,iBAAiB,QAASmf,GAE5B,CAAEL,OAAME,QAAO/X,UAC1B,CC17BA,MAyBM0a,EAvBiB,MACnB,IAAIC,EAAQ,CAAA,EACZ,OAAQ7b,IACJ,GAAIA,KAAK6b,EACL,OAAOA,EAAM7b,GAEb,IAAI8b,EAAS,GACb,OAAQ9b,GACJ,IAAK,aACD8b,EAAS,UACT,MACJ,IAAK,UACDA,EAAS,SACT,MACJ,IAAK,YACDA,EAAS,OAIjB,OADAD,EAAM7b,GAAK8b,EACJA,IAIDC,GAEZC,EAAetiB,SAASrC,iBAAiB,iBAYzC4kB,EAAqB1Z,MAAOuR,EAAI1O,KAClC,MAAM8W,EAAY,SACZnJ,MAAM3N,GACP+W,KAAMrJ,GAAQA,EAAIjb,QAClBskB,KAAM3W,IACH,IACIP,GADS,IAAIgO,WACAC,gBAAgB1N,EAAM,aACvC0W,EAAU5V,KAAK,CACXwN,KACAsI,OAAQnX,EAAI1N,cACR,oCACFsS,cAGdqS,EAAU1e,QAAS6e,IACf3iB,SACKrC,iBAAiB,aAAaglB,EAAIvI,eAClCtW,QAASxG,IACN,MAAMslB,EAAgB5iB,SAASiG,cAAc,QAC7C2c,EAAcvhB,UAAUa,IAAI,SAAUggB,EAAUS,EAAID,SAEpDplB,EAAG8I,YAAYwc,QAKxB,MAAMC,EACT,WAAAzd,GACI,IAAK,MAAOgV,EAAI1O,KAAQoF,OAAOgB,QAtCd,MACrB,MAAM0Q,EAAY,CAAA,EAMlB,OALAF,EAAaxe,QAASxG,IAClB,MAAMwlB,EAAWxlB,EAAG+R,SACd0T,EAAUzlB,EAAG+R,SAASoK,MAAM,GAClC+I,EAAUO,GAAWD,IAElBN,GA+BoCQ,IACnCT,EAAmBnI,EAAI1O,EAE/B,ECrEJ,IAAIuX,EAAW,KAER,SAASC,IACVD,GAAUA,IAEd,MAAM5kB,EAAM2B,SAASoI,eAAe,QAC9B+a,EAAUnjB,SAASoI,eAAe,WAExC,IAAK/J,IAAQ8kB,EAEX,OADAF,EAAW,KACJ,OAGT,MAAMG,EAAS,IAAMD,EAAQ9hB,UAAUU,SAAS,QAC1CshB,EAAWhE,IACf8D,EAAQ9hB,UAAU4e,OAAO,OAAQZ,GACjChhB,EAAIgD,UAAU4e,OAAO,SAAUZ,GAC/BhhB,EAAIilB,aAAa,gBAAiBjE,EAAO,OAAS,UAI9CkE,EAAc/iB,IAClBA,EAAEgjB,kBAHiBH,GAASD,MAOxBK,EAAcjjB,KACbA,EAAEK,OAAOiB,QAAQ,kBAAoBshB,KAAUC,GAAQ,IAGxDK,EAAaljB,IACH,WAAVA,EAAEyQ,KAAoBmS,KAAUC,GAAQ,IAkB9C,OAfAhlB,EAAIkC,iBAAiB,QAASgjB,GAC9BvjB,SAAS2jB,gBAAgBpjB,iBAAiB,QAASkjB,GACnDzjB,SAASO,iBAAiB,UAAWmjB,GAErCL,EAAQD,KAERH,EAAW,KACT5kB,EAAIyhB,oBAAoB,QAASyD,GACjCvjB,SAAS2jB,gBAAgB7D,oBAAoB,QAAS2D,GACtDzjB,SAAS8f,oBAAoB,UAAW4D,IAI1C,IAAIb,EAEGI,CACT,CCjCO,SAASW,EAAyCra,EAAO,IAC5D,MAAMsa,EAAata,EAAKsa,aAAc,EAChCC,EAAWva,EAAK1J,UAAY,IAG5BpC,EAAO8L,EAAKrN,WAAaH,EAAQG,WAAa8D,SAC9C+jB,EAAMtmB,GAAMI,gBAAgB,QAClC,IAAKkmB,EAED,OADA3nB,QAAQ8L,KAAK,6BAkRV,CACH8b,KAAM,OACNlb,KAAM,OACNmb,KAAM,OACNzc,QAAS,QAlRb,MAAM0c,EAASH,EAAIlmB,cAAc,qBAuCjC,SAAsBkmB,GAClB,MAAMhX,EAAI/M,SAASiG,cAAc,OAGjC,OAFA8G,EAAE7G,UAAY,kBACd6d,EAAIlmB,cAAc,eAAeuI,YAAY2G,IAAMgX,EAAI3d,YAAY2G,GAC5DA,CACX,CA5CwDoX,CAAaJ,GAC/DK,EAAWL,EAAIlmB,cAAc,gBAC7BwmB,EAASzM,MAAM9E,KAAKiR,EAAIpmB,iBAAiB,kBACzC2mB,EAAO1M,MAAM9E,KAAKiR,EAAIpmB,iBAAiB,cACvCzB,EAAY6nB,EAAIlmB,cAAc,oBAAsBkmB,EACpDQ,EAAUL,GAAQzT,eAAiB6T,EAAK,IAAI7T,eAAiBsT,EAEnE,IAAKK,IAAaE,EAAKxf,SAAWuf,EAAOvf,OAMrC,OALA1I,QAAQ8L,KAAK,yBAA0B,CACnCkc,WAAYA,EACZE,KAAMA,EAAKxf,OACXuf,OAAQA,EAAOvf,SAmQhB,CACHkf,KAAM,OACNlb,KAAM,OACNmb,KAAM,OACNzc,QAAS,QAjQb8c,EAAKxgB,QAAQ,CAACqb,EAAG5hB,KACR4hB,EAAEzd,QAAQjF,MAAK0iB,EAAEzd,QAAQjF,IAAMkK,OAAOpJ,IACtC4hB,EAAE/E,KAAI+E,EAAE/E,GAAK,WAAW7c,KAC7B4hB,EAAEmE,aAAa,OAAQ,OACvBnE,EAAEmE,aAAa,WAAY,MAC3BnE,EAAEmE,aAAa,gBAAiB,WAEpCe,EAAOvgB,QAAQ,CAAC2L,EAAGlS,KACfkS,EAAE6T,aAAa,OAAQ,YACvB7T,EAAE6T,aAAa,kBAAmBgB,EAAK/mB,IAAI6c,IAAM,WAAW7c,OAEhEgnB,GAASjB,eAAe,OAAQ,WAGhC,IAAIkB,EAAc,EACdC,EAAK,KACLC,GAAY,EAGhB,MAAMC,EAAQ,CAACre,EAAG4M,EAAK3L,IAAQD,KAAKC,IAAI2L,EAAK5L,KAAK4L,IAAI3L,EAAKjB,IAU3D,SAASse,EAAUtnB,GACf,MAAMuD,EAASvD,EAAGmT,eAAiBnT,EACnC,MAAO,CAAE6B,KAAM0B,EAAOgkB,WAAYtlB,MAAOsB,EAAOod,YACpD,CAEA,SAAS6G,EAAaxnB,EAAIynB,GAAW,GACjC,IAAKb,IAAW5mB,EAAI,OAEpB,MAAQ6B,KAAM6lB,EAAQzlB,MAAO0lB,GAAYL,EAAUtnB,GAG7C4nB,EAAW3e,OAAO+T,WAAW4J,EAAOnjB,MAAM5B,MAAQ,IAAM,EACxDgmB,EACF5e,OAAO+T,WAAW4J,EAAOnjB,MAAMxB,OAAS,IACxCqlB,EAAUN,EAAKE,KAAejlB,OAC9B0lB,EAGJ,IAAIthB,EAAK,KACT,IACIA,EACIyhB,kBAAmD,mBAAxBA,iBAAiB5jB,GACtC4jB,iBAEAnhB,GAEd,CAAE,MACEN,EAAK,IACT,CAEA,MAAM0hB,EACF1iB,OAAOpB,MAAkC,mBAAnBoB,OAAOpB,KAAKC,GAC5BmB,OAAOpB,KACP,KACJ+jB,EAAcxB,EAAW,IAE/B,GAAIngB,GAAuB,mBAAVA,EAAGnC,GAEhBmC,EAAGnC,GAAG0iB,EAAQ,CACV/kB,KAAM,GAAG6lB,MACTzlB,MAAO,GAAG0lB,MACVxjB,KAAM,eACN5B,SAAUylB,EACVC,UAAW,cAEZ,GAAIF,EACPA,EAAG7jB,GAAG0iB,EAAQ,CACV/kB,KAAM,GAAG6lB,MACTzlB,MAAO,GAAG0lB,MACVxjB,KAAM,eACN5B,SAAUylB,EACVC,UAAW,cAEZ,GAAIrB,EAAOvkB,QAAS,CAEvB,MAAM6lB,EAAST,EACT,CACI,GAAGI,MACH,GAAG7d,KAAKC,IAAI,KAAM4d,EAAYF,GAAW,OACzC,GAAGA,OAEP,CAAC,GAAGE,MAAe,GAAGF,OACtBQ,EAAQV,EACR,CAAC,GAAGG,MAAc,GAAGF,MAAY,GAAGA,OACpC,CAAC,GAAGE,MAAc,GAAGF,OAE3Bd,EAAOvkB,QACH,CAAER,KAAMsmB,EAAOlmB,MAAOimB,GACtB,CACI3lB,SAAUikB,EACVhkB,KAAM,WACN+S,OAAQ,8BAIhBqR,EAAOnjB,MAAM5B,KAAO,GAAG6lB,MACvBd,EAAOnjB,MAAMxB,MAAQ,GAAG0lB,KAC5B,MAEIf,EAAOnjB,MAAM5B,KAAO,GAAG6lB,MACvBd,EAAOnjB,MAAMxB,MAAQ,GAAG0lB,KAEhC,CAMA,SAASS,EAAajpB,GAClB,MAAM8Q,EAAU8W,EAAO5nB,IAAMoB,gBAAgB,aAAewmB,EAAO5nB,GACnE,IAAK8Q,EAAS,OACd,MAAM/N,EAAI8H,KAAKC,IACXgG,EAAQ7K,aACR6K,EAAQtO,wBAAwBQ,QAKpC,GAHAvD,EAAU6E,MAAMtB,OAAS,GAAGD,MAGxBilB,EACA,IACIA,EAAGkB,YACP,CAAE,MAAO,CAEThjB,OAAOijB,iBACPnB,EAAK,IAAImB,eAAe,KACpB,MAAMC,EAAKve,KAAKC,IACZgG,EAAQ7K,aACR6K,EAAQtO,wBAAwBQ,QAEpCvD,EAAU6E,MAAMtB,OAAS,GAAGomB,QAEhCpB,EAAGqB,QAAQvY,GAEnB,CAEA,SAASwY,EAAUC,EAAOC,GACtBD,EAAQrB,EAAMqB,EAAO,EAAG1B,EAAKxf,OAAS,GACtC,MAAMmf,EAAOO,EAjCjB,IAAqB/nB,EA7FDkS,EAAGuX,EA4InB,GAbA1B,EAAcwB,EAEd1B,EAAKxgB,QAAQ,CAACqb,EAAG5hB,KACb,MAAM4oB,EAAW5oB,IAAMyoB,EACvB7G,EAAE9d,UAAU4e,OAAO,SAAUkG,GAC7BhH,EAAEmE,aAAa,gBAAiB6C,EAAW,OAAS,SACpDhH,EAAEmE,aAAa,WAAY6C,EAAW,IAAM,QAxC/B1pB,EA2CLupB,EA1CZ5B,EAASrjB,MAAMwC,UAAY,eAAoB,IAAN9G,MA2CzCipB,EAAaM,GACblB,EAAaR,EAAK0B,IA1IFrX,EA0IqBsV,EA1IlBiC,EA0IwBF,EA1IlB1e,KAAKiO,IAAI5G,EAAIuX,GA0Ic,IAEhDrC,EAAY,CACZ,MAAMzJ,EAAKkK,EAAK0B,GAAOtkB,QAAQ0Y,IAAM,GAAG4L,IAClCta,EAAM,IAAIgO,IAAI/N,SAASC,MAC7BF,EAAI0a,KAAOhM,EACXiM,QAAQC,aAAa,KAAM,GAAI5a,EACnC,EAGiB,IAAbua,GAAmB3B,EAAK0B,GAAOjoB,OACvC,CAGA,SAASwoB,EAAW/lB,GAChB,MAAMlD,EAAKkD,EAAE8K,cAEbya,EADYxf,OAAOjJ,EAAGoE,QAAQjF,KAAO,IACtB,EACnB,CAEA,SAAS+pB,EAAUhmB,GACf,MAAMyQ,IAAEA,GAAQzQ,EAEhB,IAAK+jB,EAAQxiB,SAAS/B,SAASymB,eAAgB,OAC/C,IAAIhqB,EAAM+nB,EACV,GAAY,eAARvT,EACAxU,EAAMkoB,EAAMH,EAAc,EAAG,EAAGF,EAAKxf,OAAS,QAC3C,GAAY,cAARmM,EACPxU,EAAMkoB,EAAMH,EAAc,EAAG,EAAGF,EAAKxf,OAAS,QAC3C,GAAY,SAARmM,EACPxU,EAAM,MACH,IAAY,QAARwU,EAEJ,OADHxU,EAAM6nB,EAAKxf,OAAS,CACjB,CACPtE,EAAEmf,iBACFoG,EAAUtpB,GAAK,EACnB,CAEA,SAASiqB,IAEL5B,EAAaR,EAAKE,IAAc,GAChCkB,EAAalB,EACjB,CAGAF,EAAKxgB,QAASqb,GAAMA,EAAE5e,iBAAiB,QAASgmB,IAChD5jB,OAAOpC,iBAAiB,UAAWimB,GAAW,GAC9C7jB,OAAOpC,iBAAiB,SAAUmmB,GAGlC,IAEI,IAAIC,EAAa,EACjB,GAAIhkB,OAAOgJ,SAASya,KAAM,CACtB,MAAMhM,EAAKwM,mBAAmBjkB,OAAOgJ,SAASya,KAAKS,UAAU,IACvDC,EAAQxC,EAAKyC,UAAWzpB,IAAQA,EAAGoE,QAAQ0Y,IAAM,KAAOA,GAC1D0M,GAAS,IAAGH,EAAaG,EACjC,CACAf,EAAUY,GAAY,GACtBzC,GAAQ7iB,UAAUa,IAAI,UAC1B,CAAE,MAAO1B,GACLpE,QAAQC,IAAI,kBAAmBmE,EACnC,CAGA,SAASwjB,EAAKnjB,GACV,IAAI6jB,EACJ,GAAsB,iBAAX7jB,EAAqBklB,EAAUllB,GAAQ,QAC7C,GAAsB,iBAAXA,EAAqB,CACjC,MAAMimB,EAAQxC,EAAKyC,UACdzpB,IAAQA,EAAGoE,QAAQ0Y,IAAM,MAAQvZ,GAElCimB,GAAS,GAAGf,EAAUe,GAAO,EACrC,CACJ,CAiBA,MAAO,CAAE9C,OAAMlb,KAhBf,WACIkb,EAAKQ,EAAc,EACvB,EAcqBP,KAbrB,WACID,EAAKQ,EAAc,EACvB,EAW2Bhd,QAV3B,WACIkd,GAAY,EACZJ,EAAKxgB,QAASqb,GAAMA,EAAEW,oBAAoB,QAASyG,IACnD5jB,OAAOmd,oBAAoB,UAAW0G,GAAW,GACjD7jB,OAAOmd,oBAAoB,SAAU4G,GACrC,IACIjC,GAAIkB,YACR,CAAE,MAAO,CACb,EAGJ,CCnSgB/nB,EAAGoC,SAAU,SAClBpC,EAAGoC,SAAU,UACZpC,EAAGoC,SAAU,WACPpC,EAAGoC,SAAU,iBACjBpC,EAAGoC,SAAU,aCR3B,MAAMgnB,EAAa,CAAC,MAAO,QAAS,SAAU,QACxCC,EAAU,CACZ,KACA,KACA,KACA,KACA,KACA,IACA,KACA,IACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MA8BJ,SAASC,EAAaC,GAElB,GAAa,MAATA,EACA,MAAO,iDAGX,MAAMC,EAjCV,WACI,MAAMC,EAAU/f,KAAKkO,MAAsB,EAAhBlO,KAAKggB,UAAgB,EAC1CC,EAAO,IAAIP,GAAYQ,KAAK,IAAMlgB,KAAKggB,SAAW,IAClDG,EAAM,GACZ,IAAK,IAAIlqB,EAAI,EAAGA,EAAI8pB,EAAS9pB,IACzBkqB,EAAI7a,KAAK,CACL8a,UAAWH,EAAKhqB,GAChBuW,OAAQmT,EAAQ3f,KAAKkO,MAAMlO,KAAKggB,SAAWL,EAAQniB,WAG3D,OAAO2iB,CACX,CAsBmBE,GACTC,EAAsBT,EApBnB3c,QACL,WACCyK,IACI,CACG,IAAK,QACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,SACPA,KAmBV,MAAO,+CAA+C2S,kCAAyCA,kBAP7ER,EACbtoB,IACG,EAAGgV,SAAQ4T,eACP,oBAAoBA,gBAAwBA,MAAc5T,SAEjExD,KAAK,YAGd,CAEO,SAASuX,EAAa3rB,EAAYH,EAAQG,WAE7CsB,EAAItB,EAAW,SAAS4H,QAASxG,IAE7B,MAAMa,EAAOb,EAAGmJ,YAChBnJ,EAAG6I,UAAYhI,EACVwM,cAEAD,WACAE,UAAU,OACVhE,OACA4D,QAAQ,WAAY,IACpB+E,MAAM,IACNzQ,IAAIooB,GACJ5W,KAAK,KAElB,CCjGA,MAAM5I,GACO,YADPA,GAEK,QAFLA,GAGY,uBAHZA,GAIY,kBAJZA,GAKY,KALZA,GAMS,eANTA,GAOQ,mBAPRA,GAQuB,EAMvBogB,GAAa,CACf7W,IAAM7R,GAAM,0BAA0BA,IACtC2oB,MAAO,MAEP,IAAAC,CAAK5oB,GACD,IACI,OAAOmP,KAAKC,MAAMC,aAAaC,QAAQtO,KAAK6Q,IAAI7R,IACpD,CAAE,MACE,OAAO,IACX,CACJ,EACA,KAAA6oB,CAAM7oB,EAAG8oB,GACL,MAAM5Q,EAAU,CACZ6Q,QAAS,EACTC,UAAWC,KAAKC,MAChBC,UAAWF,KAAKC,MAChBJ,UAGJ,OADAzZ,aAAaS,QAAQ9O,KAAK6Q,IAAI7R,GAAImP,KAAKY,UAAUmI,IAC1CA,CACX,EACA,OAAAkR,CAAQppB,GACJ,MAAMqpB,EAAIroB,KAAK4nB,KAAK5oB,GACpB,OAAKqpB,GACEJ,KAAKC,OAASG,EAAEF,WAAa,GAAKnoB,KAAK2nB,KAClD,EACA,KAAAW,CAAMtpB,GACF,MAAMqpB,EAAIroB,KAAK4nB,KAAK5oB,IAAM,CAAA,EAC1BqpB,EAAEF,UAAYF,KAAKC,MACnB7Z,aAAaS,QAAQ9O,KAAK6Q,IAAI7R,GAAImP,KAAKY,UAAUsZ,GACrD,GAGEE,GAAe,IAAI9gB,IAGZ+gB,GAAe,CACxBC,QAAQ,EACR3sB,UAAW,KACX4sB,GAAI,KACJC,SAAU,KAEV,QAAAC,CAAS9sB,GACLkE,KAAKyoB,QAAS,EACdzoB,KAAKlE,UAAYA,GAAa8D,QAClC,EACA,IAAAmE,GAII,GAHA/D,KAAKyoB,QAAS,EAGVzoB,KAAK0oB,GAAI,CACT,IACI1oB,KAAK0oB,GAAGnD,YACZ,CAAE,MAAO,CACTvlB,KAAK0oB,GAAK,IACd,CAGI1oB,KAAK2oB,UAAUtc,YACfrM,KAAK2oB,SAASznB,SAElBlB,KAAK2oB,SAAW,KAGhB,IAAK,MAAM,CAAG3O,KAAOuO,GAAcM,aAAa7O,GAChDuO,GAAa1e,QAGb7J,KAAKlE,UAAY,IACrB,GAIEgtB,GAAmBhB,GACrBA,EACKppB,IAAI,EAAGqqB,KAAIjZ,QAAO3F,QAAOqB,OAAMwd,WAAM,CAClCD,KACAjZ,QACA3F,QACAqB,OACAwd,UAEH5B,KAAK,CAAC7Y,EAAGuX,IAAMvX,EAAEwa,GAAKjD,EAAEiD,IAG3BE,GAAS,CAACjqB,EAAGoB,IAAM,GAAGpB,MAAMoB,EAAE0P,UAAU1P,EAAEoL,MAAQ,KAClD0d,GAAe,CAAClqB,EAAGuP,EAAI,GAAIuX,EAAI,MACjC,GAAIvX,EAAE7J,SAAWohB,EAAEphB,OAAQ,OAAO,EAClC,MAAMykB,EAAI,IAAIC,IAAI7a,EAAE7P,IAAK0B,GAAM6oB,GAAOjqB,EAAGoB,KACzC,IAAK,MAAMA,KAAK0lB,EAAG,IAAKqD,EAAEzL,IAAIuL,GAAOjqB,EAAGoB,IAAK,OAAO,EACpD,OAAO,GAKLipB,GAAU,CAACrqB,EAAG6V,KAAM,SAAG7V,IADfkH,EACwB2O,EADlBtO,OAAOL,GAAG6O,SAAS,EAAG,SAA7B,IAAC7O,GAGRojB,GAAI,CAACjsB,EAAMC,IAAQD,EAAKI,cAAcH,GACtCisB,GAAK,CAAClsB,EAAMC,IAAQka,MAAM9E,KAAKrV,EAAKE,iBAAiBD,IAGrDksB,GAAe,IAAMF,GAAE1pB,SAAU0H,KAAqB1H,SAAS6pB,KAkDrE,MAAMC,GAAU,KAAM,IAAIzB,MAAO0B,cAQ3BC,GAAgB5qB,GAClBuqB,GAAGC,KAAgBliB,IAAkBsJ,KAChCkV,GAAMwD,GAAExD,EAAGxe,KAAmBjB,YAAYG,SAAWD,OAAOvH,KAC5D,KAET,SAAS6qB,GAAgB7qB,GACrB,IAAI8qB,EAAQF,GAAa5qB,GACzB,GAAI8qB,EAAO,OAAOA,EAElBA,EAAQlqB,SAASiG,cAAc,OAC/BikB,EAAMhkB,UAAY,mDAClBgkB,EAAM/jB,UAAY,wDAEZ/G,+CAIN,MAAMlD,EAAY0tB,KACZb,EAAW7sB,EAAU2B,cACvB,qCASJ,OALIkrB,EACA7sB,EAAU4R,aAAaoc,EAAOnB,GAE9B7sB,EAAUkK,YAAY8jB,GAEnBA,CACX,CAKA,MAAMC,GAAW,CAAC/qB,EAAG8Q,EAAOtE,IAAS,GAAGxM,MAAM8Q,MAAUtE,GAAQ,KAGhE,SAASwe,GAAeC,GAEpB,MAAMC,EAAQD,EAAOxsB,cAAc,sBAG7B0sB,EAAS3S,MAAM9E,KAAKuX,EAAO1sB,iBAAiB,MAAMqT,KAAMrC,GAC1D,YAAY6b,KAAK7b,EAAEiH,aAAa,SAAW,KAG/C,IAAK2U,EAAQ,OAAO,KAGpB,IAAIpB,EAAK,KACT,GAAImB,EACA,IACI,MACMtV,EADI,IAAI0E,IAAI4Q,EAAM1U,aAAa,QAASjK,SAASgO,QAC3C8Q,aAAavjB,IAAI,KACzB8N,IAAGmU,EAAiB,IAAZ5iB,OAAOyO,GACvB,CAAE,MAAO,CAEb,IAAKmU,GAAMmB,EAAO,CACd,MAAMI,EAAMJ,EAAM7jB,YAAYG,OACxB+jB,EAAUtC,KAAK7Z,MAAMkc,EAAIlgB,QAAQ,oBAAqB,KACvDjE,OAAOC,MAAMmkB,KAAUxB,EAAKwB,EACrC,CACA,IAAKxB,EAAI,OAAO,KAEhB,MAAMnU,EAAI,IAAIqT,KAAKc,GACb3N,EAAOxG,EAAE+U,cACT7Z,EAAQ,GAAGvJ,OAAOqO,EAAE4V,WAAWzV,SAAS,EAAG,QAAQxO,OACrDqO,EAAE6V,WAAa,GACjB1V,SAAS,EAAG,OAERvJ,EAAO2e,EAAO3U,aAAa,SAAW,GACtCrL,GAASggB,EAAO9jB,aAAe,IAAIG,OAOzC,IAAIwiB,EAAO,KACX,MAAM0B,EAvIV,SAAqCC,GACjC,IAAKA,EAAM,OAAO,KAElB,IAAI9V,EAAI8V,EAAK5Q,MAAM,+CAEnB,OADKlF,IAAGA,EAAI8V,EAAK5Q,MAAM,gDAClBlF,EAGGA,EAAE,GAAGzK,QAAQ,OAAQ,KAAKA,QAAQ,OAAQ,KAHnC,IAKnB,CA6HyBwgB,CAJjBT,EAAO3U,aAAa,gBACpB2U,EAAO3U,aAAa,gBACpB,IAOJ,OAJIkV,IACA1B,EA9HR,SAA2Btd,GACvB,MAAMrE,EAAOzH,SAASiG,cAAc,OA4BpC,OA3BAwB,EAAKtB,UAAY2F,EA2BV,CAAEmf,UAxBLxjB,EAAK5J,cAAc,oBAAoB4I,aAAaG,QAAU,GAwB9CoU,OAtBL,MACX,MAAMvL,EAAImI,MAAM9E,KAAKrL,EAAK9J,iBAAiB,MAAMqT,KAAM1T,GACnD,aAAaktB,KAAKltB,EAAGmJ,cAEzB,IAAKgJ,EAAG,MAAO,GACf,MACMwF,EADMxF,EAAEhJ,YAAY+D,QAAQ,OAAQ,KAAK5D,OACjCuT,MAAM,8BACpB,OAAOlF,EAAIA,EAAE,GAAGrO,OAAS,EAC5B,EARc,GAsBaskB,eAZL,MACnB,MAAMzb,EAAImI,MAAM9E,KAAKrL,EAAK9J,iBAAiB,MAAMqT,KAAM1T,GACnD,oBAAoBktB,KAAKltB,EAAGmJ,cAEhC,IAAKgJ,EAAG,MAAO,GACf,MACMwF,EADMxF,EAAEhJ,YAAY+D,QAAQ,OAAQ,KAAK5D,OACjCuT,MAAM,8BACpB,OAAOlF,EAAIA,EAAE,GAAGrO,OAAS,EAC5B,EARsB,GAYqBukB,QAF5B1jB,EAAK5J,cAAc,YAAY4I,aAAaG,QAAU,GAG1E,CAgGewkB,CAAkBN,IAGtB,CAAE3B,KAAI3N,OAAMtL,QAAO3F,QAAOqB,OAAMwd,OAC3C,CAGA,SAASiC,GAAqB9f,GAC1B,OAAOoe,GAAGpe,EAAK7D,IACV5I,IAAIsrB,IACJnc,OAAO0N,SACP6L,KAAK,CAAC7Y,EAAGuX,IAAMvX,EAAEwa,GAAKjD,EAAEiD,GACjC,CAiCA,SAASmC,GAAkBlsB,EAAG8oB,GAC1B,MAAMgC,EAAQD,GAAgB7qB,GAC9B,IAAImsB,EAAUrB,EAAMrsB,cAAc,WAC7B0tB,IACDA,EAAUvrB,SAASiG,cAAc,WACjCikB,EAAM9jB,YAAYmlB,IAGtBA,EAAQplB,UAAY,GACpB,MAAMkE,EAAKrK,SAASiG,cAAc,MAElC,IAAK,MAAMzF,KAAK0nB,EAAQ,CACpB,MAAM5d,EAAKtK,SAASiG,cAAc,MAClCqE,EAAG7D,YAAcjG,EAAE0P,MAEnB,MAAMsb,EAAKxrB,SAASiG,cAAc,MAClC,GAAIzF,EAAEoL,KAAM,CACR,MAAM+C,EAAI3O,SAASiG,cAAc,KACjC0I,EAAE/C,KAAOpL,EAAEoL,KACX+C,EAAElI,YAAcjG,EAAE+J,OAAS/J,EAAEoL,KAC7B4f,EAAGplB,YAAYuI,EACnB,MACI6c,EAAG/kB,YAAcjG,EAAE+J,OAAS,IAEhCF,EAAGohB,OAAOnhB,EAAIkhB,EAClB,CAEAD,EAAQnlB,YAAYiE,EACxB,CAuBAxB,eAAe6iB,GAAiBtsB,EAAG6V,GAC/B,MAAMvJ,EAAM,GAAGhE,MAAeA,MAAa+hB,GAAQrqB,EAAG6V,KAChDmE,QAAYC,MAAM3N,EAAK,CAAE4N,YAAa,gBAC5C,IAAKF,EAAIuS,GAAI,MAAO,GAhPN,IAAC7f,EAkPf,OAAOuf,IAlPQvf,QAiPasN,EAAIjb,QAjPR,IAAIob,WAAYC,gBAAgB1N,EAAM,eAkP7BmC,OAAQzN,GAAMA,EAAEgb,OAASpc,EAC9D,CAEAyJ,eAAe+iB,GAAgBxsB,GAC3B,MAAMysB,EAAY,GACZC,EAAO,IAAItC,IACjB,IAAK,IAAIvU,EAAI,EAAGA,GAAK,GAAIA,IAAK,CAC1B,MAAM8W,QAAYL,GAAiBtsB,EAAG6V,GACtC,IAAK,MAAMzU,KAAKurB,EAAK,CACjB,MAAM7d,EAAI,GAAG9O,MAAMoB,EAAE0P,UAAU1P,EAAEoL,MAAQ,KACrCkgB,EAAKhO,IAAI5P,KACb4d,EAAK5pB,IAAIgM,GACT2d,EAAUjf,KAAKpM,GACnB,CACJ,CAEA,OADAqrB,EAAUrE,KAAK,CAAC7Y,EAAGuX,IAAMvX,EAAEwa,GAAKjD,EAAEiD,IAC3B0C,CACX,CAEAhjB,eAAemjB,GAAwB5sB,GACnC6qB,GAAgB7qB,GAGhB,MAAM6sB,EAASnE,GAAWE,KAAK5oB,GAC3B6sB,GAAQ/D,QAAQpjB,QAChBwmB,GAAkBlsB,EAAG6sB,EAAO/D,QAIhC,MAAMgE,QAAcN,GAAgBxsB,GAapC,OAZoB6sB,IAAW3C,GAAalqB,EAAG6sB,EAAO/D,OAAQgE,IAG1DZ,GAAkBlsB,EAAG8sB,GACrBpE,GAAWG,MAAM7oB,EAAG8pB,GAAgBgD,KAEpCpE,GAAWY,MAAMtpB,GAIrB+sB,GAAoB/sB,GAEb4qB,GAAa5qB,EACxB,CAoBA,SAAS+sB,GAAoB/sB,GACzB,MAAM6kB,EAAO0E,GAAazhB,IAAI9H,GAC1B6kB,GAAMgF,aAAahF,GACvB,MAAM7J,EAAKnT,WAAW4B,UAClB,IACI,IAAK+f,GAAaC,OAAQ,aAvBtChgB,eAA2BzJ,GAEvB,IAAK4qB,GAAa5qB,GAAI,OAEtB,IAAK0oB,GAAWU,QAAQppB,GAAI,OAE5B,MAAM6sB,EAASnE,GAAWE,KAAK5oB,GACzB8sB,QAAcN,GAAgBxsB,GAChB6sB,GAAW3C,GAAalqB,EAAG6sB,EAAO/D,OAAQgE,GAM1DpE,GAAWY,MAAMtpB,IAHjBksB,GAAkBlsB,EAAG8sB,GACrBpE,GAAWG,MAAM7oB,EAAG8pB,GAAgBgD,IAI5C,CAQkBE,CAAYhtB,EACtB,CAAC,QAED,GACD0oB,GAAWC,OACdY,GAAatiB,IAAIjH,EAAGgb,EACxB,CAGA,SAASiS,KACL,MAAMC,EAAOxC,KACbG,GAAgBqC,GAEhB,MAAMC,EAAalB,GAAqBrrB,UAAUiO,OAC7CzN,GAAMA,EAAEgb,OAAS8Q,GAEhBR,EA/GV,SAA0B1sB,GACtB,MAAM0sB,EAAO,IAAItC,IACXU,EAAQF,GAAa5qB,GAC3B,IAAK8qB,EAAO,OAAO4B,EACnB,MAAMzhB,EAAKqf,GAAEQ,EAAOxiB,IACpB,IAAK2C,EAAI,OAAOyhB,EAGhB,IAAIU,EAAQ,KACZ,IAAK,MAAMC,KAAQ7U,MAAM9E,KAAKzI,EAAGqiB,UAC7B,GAAqB,OAAjBD,EAAK1hB,QACLyhB,EAAQC,EAAKhmB,YAAYG,YACtB,GAAqB,OAAjB6lB,EAAK1hB,SAAoByhB,EAAO,CACvC,MAAM5gB,EAAO6gB,EAAK5uB,cAAc,MAAM+X,aAAa,SAAW,GAC9DkW,EAAK5pB,IAAIioB,GAAS/qB,EAAGotB,EAAO5gB,GAChC,CAEJ,OAAOkgB,CACX,CA6FiBa,CAAiBL,IA3KlC,SAA4BltB,EAAG8oB,EAAQ0E,GACnC,IAAK1E,EAAOpjB,OAAQ,OACpB,MAAMymB,EAAU7B,GAAEO,GAAgB7qB,GAAI,WAChCiL,EAAKrK,SAASiG,cAAc,MAElC,IAAK,MAAMzF,KAAK0nB,EAAQ,CACpB,MAAMjX,EAAMkZ,GAAS/qB,EAAGoB,EAAE0P,MAAO1P,EAAEoL,MAEnC,GADAxP,QAAQC,IAAImE,GACRosB,EAAQ9O,IAAI7M,GAAM,SACtB2b,EAAQ1qB,IAAI+O,GAEZ,MAAM3G,EAAKtK,SAASiG,cAAc,MAClCqE,EAAG7D,YAAcjG,EAAE0P,MAEnB,MAAMsb,EAAKxrB,SAASiG,cAAc,MAClC,GAAIzF,EAAEoL,KAAM,CACR,MAAM+C,EAAI3O,SAASiG,cAAc,KACjC0I,EAAE/C,KAAOpL,EAAEoL,KACX+C,EAAElI,YAAcjG,EAAE+J,OAAS/J,EAAEoL,KAC7B4f,EAAGplB,YAAYuI,EACnB,MACI6c,EAAG/kB,YAAcjG,EAAE+J,OAAS,IAGhCF,EAAGohB,OAAOnhB,EAAIkhB,EAClB,CAEInhB,EAAGqD,WAAW5I,QAAQymB,EAAQnlB,YAAYiE,EAClD,CAgJIwiB,CAAmBP,EAAMC,EAAYT,GAGrChE,GAAWG,MAAMqE,EAAMpD,GAAgBqD,IACvCJ,GAAoBG,EACxB,CAmGOzjB,eAAeikB,KAClBT,WAjGJxjB,iBAEI,IAAIkkB,EAAQ,EACR3tB,EAFS0qB,KAEE,EAEf,KAAOiD,EAAQrlB,IAA6B,CACxC,MAAMwiB,QAAc8B,GAAwB5sB,GAG5C,GAFA2tB,IAEI7C,GACaA,EAAMjrB,wBACI6iB,OAASnf,OAAOC,YAAc,GACtC,MAEnBxD,GACJ,CACJ,CAkFU4tB,EAEV,CCliBA,MAAM5oB,GAAW,CACbsH,IAAK,KACL/C,KAAM,KACNskB,SAAU,2BACV/wB,UAAW,WACXgxB,SAAU,SACVC,gBAAiB,MACjBC,aAAc,EACdC,UAAW,KACXC,cAAc,EACdC,iBAAiB,EACjBC,WAAY,IAGVC,GAAQ,CACVlkB,KAAM,IAAKnF,IACXspB,KAAM,KACNC,MAAO,KACPC,SAAU,KACVrgB,QAAS,KACT6V,QAAQ,EACRyK,YAAa,KACbC,gBAAiB,KACjBC,WAAY,MAIVrE,GAAI,IAAI/I,IACM,IAAhBA,EAAK7b,OACC9E,SAASnC,cAAc8iB,EAAK,IAC5BA,EAAK,IAAI9iB,gBAAgB8iB,EAAK,IAClCgJ,GAAK,IAAIhJ,IACK,IAAhBA,EAAK7b,OACC8S,MAAM9E,KAAK9S,SAASrC,iBAAiBgjB,EAAK,KAC1C/I,MAAM9E,KAAK6N,EAAK,IAAIhjB,mBAAmBgjB,EAAK,KAAO,IAEvD/V,GAAa4M,IACf,IAAKA,EAAK,MAAO,GACjB,GAAII,MAAMC,QAAQL,GAAM,CACpB,MAAMiQ,EAAM,CAAA,EAIZ,OAHAjQ,EAAI1T,QAAS5E,IACLA,GAAKA,EAAE+R,MAAKwW,EAAI9gB,OAAOzH,EAAE+R,MAAQ/R,KAElCuoB,CACX,CACA,OAAOjQ,GAQLwW,GAAiB3V,IACnB,IAAKoV,GAAME,QAAUtV,GAAmC,WAAxBoV,GAAMlkB,KAAK2jB,SAAuB,OAElEO,GAAME,MAAMtsB,UAAUa,IAAI,YARZ,MACd,MAAMumB,EAAIgF,GAAMlkB,KAAKrN,UACrB,OAAOusB,GAAKA,EAAE9b,SAAW8b,EAAiB,iBAANA,EAAiBiB,GAAEjB,GAAKzoB,SAAS6pB,MAOxDoE,GACShvB,wBACtB,MAAMivB,EAAK7V,EAAQpZ,wBAEbkvB,EADc9V,EAAQ5H,cACLxR,wBAEjBmvB,EAAYX,GAAME,MAAM1uB,wBAExBovB,EADiBZ,GAAME,MAAMW,aACTrvB,wBAKpBsvB,EACGL,EAAG7uB,IAAMgvB,EAAGhvB,IAAM8uB,EAAG1uB,OACnByuB,EAAGrM,MAAQwM,EAAGlvB,KAAOsuB,GAAMlkB,KAAK6jB,aAC/Bc,EAAGpM,OAASuM,EAAGhvB,IAAO6uB,EAAGzuB,OAAS2uB,EAAU3uB,OAC9CyuB,EAAG/uB,KAAOkvB,EAAGlvB,KAAQivB,EAAU7uB,MAAQkuB,GAAMlkB,KAAK6jB,aAG5DK,GAAME,MAAM5sB,MAAM1B,IAAM,GAAGkvB,OAGzBC,GAAY3lB,UACd,GAAI4kB,GAAMC,KAAM,OAAOD,GAAMC,KAC7B,MAAMhiB,IAAEA,EAAG/C,KAAEA,GAAS8kB,GAAMlkB,KAC5B,GAAImC,EAAK,CACL,MAAM0N,QAAYC,MAAM3N,EAAK,CACzByW,MAAO,WACP7I,YAAa,gBAEjB,IAAKF,EAAIuS,GAAI,MAAM,IAAI8C,MAAM,sBAAwBrV,EAAIsJ,QACzD+K,GAAMC,KAAO9iB,SAAgBwO,EAAIsV,OACrC,MACIjB,GAAMC,KADC/kB,EACMiC,GAAUjC,GAEV,GAGjB,OADAvM,QAAQC,IAAIoxB,IACLA,GAAMC,MAGXiB,GAAa,CAAC5hB,EAAI,KACpBA,EAAEvC,QACE,WACCyK,IACI,CACG,IAAK,QACL,IAAK,OACL,IAAK,OACL,IAAK,SACL,IAAK,SACPA,KASR2Z,GAAapuB,IACf,IAAKitB,GAAMrK,OAAQ,OACnB,MAAMyL,EAPNlF,GACI8D,GAAME,MACN,uEACF1f,OAAQ3Q,IAAQA,EAAGiL,aAAa,aAKlC,IAAKsmB,EAAM/pB,OAAQ,OACnB,MAAMgqB,EAAQD,EAAM,GACdE,EAAOF,EAAMA,EAAM/pB,OAAS,GACpB,QAAVtE,EAAEyQ,IACEzQ,EAAEwuB,UAAYhvB,SAASymB,gBAAkBqI,GACzCtuB,EAAEmf,iBACFoP,EAAKhxB,SACGyC,EAAEwuB,UAAYhvB,SAASymB,gBAAkBsI,IACjDvuB,EAAEmf,iBACFmP,EAAM/wB,SAEO,WAAVyC,EAAEyQ,KACTsO,MAIF0P,GAAW,KACb,GAAIxB,GAAME,MAAO,OACjB,MAAMA,EAAQ3tB,SAASiG,cAAc,SACrC0nB,EAAMznB,UAAY,iBAClBynB,EAAMrK,aAAa,OAAQ,UAC3BqK,EAAMrK,aAAa,aAAc,QACjCqK,EAAMrK,aAAa,kBAAmB,kBAEtC,MAAMsK,EAAW5tB,SAASiG,cAAc,OACxC2nB,EAAS1nB,UAAY,oBAErBynB,EAAMxnB,UAAY,wjBASlBujB,GAAE+D,GAAMlkB,KAAKrN,WAAWkK,YAAYwnB,GACpClE,GAAE+D,GAAMlkB,KAAKrN,WAAWkK,YAAYunB,GAEpCF,GAAME,MAAQA,EACdF,GAAMG,SAAWA,EACjBH,GAAMlgB,QAAUmc,GAAE+D,GAAME,MAAO,kBAE/BC,EAASrtB,iBAAiB,QAASgf,IACnCmK,GAAE+D,GAAME,MAAO,mBAAmBptB,iBAAiB,QAASgf,IAC5Dvf,SAASO,iBAAiB,UAAWquB,IAAW,IAG9CM,GAAc,CAACje,EAAKke,KACtB,MAAM5kB,EAAQ4kB,EAAM5kB,OAAS0G,EACvBme,EAAQD,EAAMC,MACd,6BAA6BD,EAAMC,YACnC,GACAC,EAAOF,EAAME,KACb,8BAA8BF,EAAME,aACpC,GACAC,EACF1X,MAAMC,QAAQsX,EAAMG,OAASH,EAAMG,KAAKxqB,OAClC,6BAA6BqqB,EAAMG,KAC9BxwB,IAAKqgB,GAAM,QAAQwP,GAAWhoB,OAAOwY,YACrC7O,KAAK,WACV,GACJif,EACF3X,MAAMC,QAAQsX,EAAMI,QAAUJ,EAAMI,MAAMzqB,OACpC,8BAA8BqqB,EAAMI,MAC/BzwB,IACI4d,GACG,+CAA+CiS,GAC3CjS,EAAE9Q,UACA+iB,GAAWjS,EAAExM,OAASwM,EAAE9Q,kBAErC0E,KAAK,WACV,GAEVoZ,GAAE+D,GAAME,MAAO,mBAAmBlnB,YAAc8D,EAGhDkjB,GAAMlgB,QAAQpH,UAAY,GAAGipB,IAAQC,IAAOC,IAAOC,IAEnD9B,GAAME,MAAM6B,cACR,IAAIC,YAAY,kBAAmB,CAAEC,OAAQ,CAAEze,MAAKke,aAItD9P,GAAOxW,MAAOoI,EAAKoH,KACrBoV,GAAMK,gBAAkB9tB,SAASymB,cACjCgH,GAAMI,YAAcxV,GAAW,KAC/B4W,KAEA,MAIME,SAJaX,KAAYmB,MAAOrQ,IAClCljB,QAAQ2J,MAAM,wBAAyBuZ,GAChC,MAEQrO,IAAQ,KAOvBie,GAAYje,EALXke,GACgB,CACb5kB,MAAO0G,IAMfjK,sBAAsB,IAAMgnB,GAAc3V,IAE1CoV,GAAME,MAAMtsB,UAAUa,IAAI,QAC1BurB,GAAMG,SAASvsB,UAAUa,IAAI,QAC7BurB,GAAMrK,QAAS,EAEf,MAAMwM,EACFlG,GAAE+D,GAAME,MAAO,mBAAqBjE,GAAE+D,GAAME,MAAO,mBAGvD,GAFA3mB,sBAAsB,IAAM4oB,GAAeA,EAAY7xB,SAEnD0vB,GAAMlkB,KAAK8jB,UAAW,CACtB,MAAM3hB,EAAM,IAAIgO,IAAI/N,SAASC,MAC7BF,EAAI0a,KAAO,GAAGqH,GAAMlkB,KAAK8jB,aAAawC,mBAAmB5e,KACzDoV,QAAQC,aAAa,KAAM,GAAI5a,EAAIhB,WACvC,CAEA+iB,GAAMqC,QAAU,IAAM9B,GAAcP,GAAMI,aAC1ClrB,OAAOpC,iBAAiB,SAAUktB,GAAMqC,SACxCntB,OAAOpC,iBAAiB,SAAUktB,GAAMqC,SAAS,GACjDrC,GAAME,MAAM6B,cACR,IAAIC,YAAY,gBAAiB,CAAEC,OAAQ,CAAEze,MAAKke,aAIpD5P,GAAQ,KACV,IAAKkO,GAAMrK,OAAQ,OAKnB,GAJAqK,GAAME,MAAMtsB,UAAUC,OAAO,QAC7BmsB,GAAMG,SAASvsB,UAAUC,OAAO,QAChCmsB,GAAMrK,QAAS,EAGXqK,GAAMlkB,KAAK8jB,WACX1hB,SAASya,KAAKla,SAASuhB,GAAMlkB,KAAK8jB,UAAY,KAChD,CACE,MAAM3hB,EAAM,IAAIgO,IAAI/N,SAASC,MAC7BF,EAAI0a,KAAO,GACXC,QAAQC,aAAa,KAAM,GAAI5a,EAAIhB,WACvC,CAEA,MAAMqlB,EAAUtC,GAAMI,aAAeJ,GAAMK,gBACvCiC,GAAoC,mBAAlBA,EAAQhyB,OAAsBgyB,EAAQhyB,QAE5D0vB,GAAME,MAAM6B,cAAc,IAAIC,YAAY,oBAGxCO,GAAexvB,IACjBA,EAAEmf,iBACF,MAAMriB,EAAKkD,EAAE8K,cACP2F,EAAM3T,EAAGsY,aAAa,aAAetY,EAAGsY,aAAa,SACvDtY,EAAGsY,aAAa,WAChBtY,EAAG2yB,gBAAgB,SACnB3yB,EAAGgmB,aAAa,WAAYrS,IAE3BA,GACLoO,GAAKpO,EAAK3T,IAGR4yB,GAAa1vB,IACD,UAAVA,EAAEyQ,KAA6B,MAAVzQ,EAAEyQ,MACvBzQ,EAAEmf,iBACFnf,EAAE8K,cAAc6kB,UAIlBC,GAAW9yB,IACb,GAAIA,EAAG+yB,UAAW,OAClBj0B,QAAQC,IAAIiB,GACZA,EAAG+yB,WAAY,EACf/yB,EAAGgmB,aAAa,OAAQ,UACxBhmB,EAAGgmB,aAAa,WAAY,KAC5BhmB,EAAGiD,iBAAiB,QAASyvB,IAC7B1yB,EAAGiD,iBAAiB,UAAW2vB,IAE/B,MAAMjf,EAAM3T,EAAGsY,aAAa,aAAetY,EAAGsY,aAAa,SACvDtY,EAAGsY,aAAa,WAChBtY,EAAG2yB,gBAAgB,SACnB3yB,EAAGgmB,aAAa,WAAYrS,IAG5Bwc,GAAMlkB,KAAKgkB,iBAAmBE,GAAMlkB,KAAKmC,MACzCpO,EAAGiD,iBAAiB,aAAc,KAC9B0oB,aAAawE,GAAMM,YACnBN,GAAMM,WAAa9mB,WAAW,KAC1BunB,KAAYmB,MAAOnvB,IACfpE,QAAQ8L,KAAK1H,MAElBitB,GAAMlkB,KAAKikB,cAElBlwB,EAAGiD,iBAAiB,aAAc,IAAM0oB,aAAawE,GAAMM,eAI7DuC,GAAO,CAAC7yB,EAAOuC,YACjB5D,QAAQC,IAAIstB,GAAGlsB,EAAMgwB,GAAMlkB,KAAK0jB,WAChCtD,GAAGlsB,EAAMgwB,GAAMlkB,KAAK0jB,UAAUnpB,QAAQssB,KAUpCG,GAAW,CACbpwB,KAAI,CAACkF,EAAU,MACXooB,GAAMlkB,KAAO,IAAKnF,MAAaiB,GAC/B4pB,KACAqB,GAAKtwB,UAXI,MACb,IAAKytB,GAAMlkB,KAAK8jB,UAAW,OAC3B,MAAM7tB,GAAKmM,SAASya,MAAQ,IAAI3M,MAAM,IAC/BvL,EAAGoH,GAAK9V,EAAE+P,MAAM,KACnBrB,IAAMuf,GAAMlkB,KAAK8jB,WAAa/X,GAAG+J,GAAKuH,mBAAmBtR,KAQzDkb,GACAp0B,QAAQC,IAAI,yBAA0BoxB,IAClCA,GAAMlkB,KAAK+jB,cAAgB,qBAAsBttB,UACjDA,SAASO,iBAAiB,cAAe,IAAM+vB,GAAKtwB,WAEjD,CAAEqf,QAAME,SAAO+Q,UAE1BjR,QACAE,SACA+Q,SCzVEG,GAAoB,UACpBC,GAAkB1wB,SAASoI,eAAe,cAC1CuoB,GAAeliB,aAAaC,QAAQ+hB,KAAsB,GAEzD,MAAMG,GACT,WAAAxrB,GACQsrB,KACAA,GAAgBp0B,MAAQq0B,IAE5BD,GAAgBnwB,iBAAiB,QAAS,WACtCkO,aAAaS,QAAQuhB,GAAmBrwB,KAAK9D,MACjD,EACJ,ECIG,SAASu0B,KACd7wB,SACGrC,iBAAiB,wBACjBmG,QAASxG,GAAOA,EAAGgE,UAEtBvF,EAAQG,UACN8D,SAASnC,cAAc,oCAAsCmC,SAE/D,MAAMvB,EAASsB,EAAiBI,OAmChC,OAjCA,IAAIywB,GLZC,WAEH,MAAME,EAAU5Y,EAAoB,CAChCvF,WAAY,CAAEzO,kBAGdvB,OAAOhB,OAAO3F,OACd2F,MAAM3F,MAAM+0B,YAAY,KACpB,IACID,EAAQvR,OACZ,CAAE,MAAO,IAIjB2D,GAUJ,CKVE8N,GAEAlpB,EAAY,WAAY,CAAEoB,WAAYL,SXqHjC,SAA6B3M,EAAY8D,UAC5C,IACI,MAAMixB,EAAS/0B,EAAU2B,cAAc,mBACvC,IAAKozB,EAAQ,OAEbA,EAAOnR,oBAAoB,OAAQ3U,GACnC8lB,EAAO1wB,iBAAiB,OAAQ4K,EACpC,CAAE,MAAO3K,GACLpE,QAAQC,IAAI,mBAAoBmE,EACpC,CACJ,CW/HoD0wB,KAElDppB,EAAY,QAAS,CACnBoB,WAAYL,OAASC,WACnBqE,EAAiBrE,EAAK5M,WACtB2rB,EAAa/e,EAAK5M,cAItB4L,EAAY,MAAO,CACjBoB,WAAYL,OAASC,WACnB8a,EAAe9a,EAAK5M,WACpB2rB,EAAa/e,EAAK5M,WAClBq0B,GAASpwB,KAAK,CACZuL,IAAK,sCAKX5D,EAAY,WAAY,CACtBoB,WAAYL,OAASC,iBACbgkB,GAAqBhkB,EAAK5M,cAIpCE,QAAQ6M,MAAM,+BZ+HL2O,MAAM9E,KAAKlL,EAASmJ,SY7H7B9I,EAAU,CAAExJ,WAEL,CAAE1C,UAAS0C,SACpB,CC3DAuB,SAASO,iBAAiB,mBAAoB,KAC1CswB"}