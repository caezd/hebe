{"version":3,"file":"hebe.js","sources":["../src/core/context.js","../src/core/utils.js","../src/ui/CursorController.js","../src/animations/presets.js","../src/animations/lines.js","../src/animations/navigation.js","../src/ui/Badge.js","../src/init/barba.js","../src/features/register.js","../src/ui/MapController.js","../src/features/layout.js","../src/ui/Enochian.js","../src/init/app.js","../src/features/topic.js","../src/main.js"],"sourcesContent":["// modules/context.js\r\n// Refactor du bloc Context de ton menu.js\r\n\r\nconst Context = (function () {\r\n    let hooks = [];\r\n    let currentIndex = 0;\r\n    let container = null;\r\n\r\n    const update = () => {\r\n        console.log(\"Context updated!\");\r\n    };\r\n\r\n    return {\r\n        get container() {\r\n            return container;\r\n        },\r\n        set container(value) {\r\n            container = value;\r\n            currentIndex = 0; // reset index à chaque nouveau container\r\n        },\r\n\r\n        useState(initialValue) {\r\n            const idx = currentIndex++;\r\n            hooks[idx] = hooks[idx] ?? initialValue;\r\n\r\n            const setState = (newValue) => {\r\n                hooks[idx] =\r\n                    typeof newValue === \"function\"\r\n                        ? newValue(hooks[idx])\r\n                        : newValue;\r\n                update();\r\n            };\r\n\r\n            return [hooks[idx], setState];\r\n        },\r\n\r\n        useReducer(reducer, initialState) {\r\n            const idx = currentIndex++;\r\n            hooks[idx] = hooks[idx] ?? initialState;\r\n\r\n            const dispatch = (action) => {\r\n                hooks[idx] = reducer(hooks[idx], action);\r\n                update();\r\n            };\r\n\r\n            return [hooks[idx], dispatch];\r\n        },\r\n\r\n        useEffect(callback, deps) {\r\n            const idx = currentIndex++;\r\n            const prevDeps = hooks[idx];\r\n            const hasNoDeps = !deps;\r\n            const hasChanged = prevDeps\r\n                ? !deps.every((el, i) => el === prevDeps[i])\r\n                : true;\r\n\r\n            if (hasNoDeps || hasChanged) {\r\n                hooks[idx] = deps;\r\n                callback();\r\n            }\r\n        },\r\n    };\r\n})();\r\n\r\nexport default Context;\r\n","export const isElement = (node) =>\r\n    node instanceof Element || node instanceof HTMLDocument;\r\n\r\nexport const qsa = (root, sel) => root.querySelectorAll(sel);\r\nexport const qs = (root, sel) => root.querySelector(sel);\r\n\r\nexport const closest = (el, sel) =>\r\n    el && el.nodeType === 1 ? el.closest(sel) : null;\r\n","import { isElement, closest } from \"../core/utils.js\";\r\n\r\nconst CONFIG = {\r\n    FOLLOW_SIZE: 40,\r\n    EASE: \"power4\",\r\n    DUR: {\r\n        focus: 0.5, // zoom sur l'élément\r\n        shrink: 0.2, // retour à la taille 40\r\n        follow: 0.6, // inertie de suivi\r\n        fade: 300, // show/hide via Element.animate\r\n    },\r\n    SELECTORS: {\r\n        text: \".txt, .txt *, .ce-block__content, .ce-block__content *, textarea, input\",\r\n        forum: \".forum, .forum *\",\r\n        btn: \".btn, .btn *\",\r\n        profileSymbol: \".subject__profileSymbol\",\r\n        barbaContainer: 'section[data-barba=\"container\"]',\r\n        progressPath: \".progress-wrap path\",\r\n        cursor: \"#cursor\",\r\n        cursorFollow: \"#cursorFollow\",\r\n        postbody: \".postbody\",\r\n        forumEl: \".forum\",\r\n        link: \"a[href]:not(.no-cursor):not(:where(.btn *)):not(.btn), a[href]:not(.no-cursor):not(:where(.btn *)) *, .marker, .marker *\",\r\n        map: \"#map canvas\",\r\n    },\r\n};\r\n\r\nfunction getRectData(el) {\r\n    const rect = el.getBoundingClientRect();\r\n    return { x: rect.left, y: rect.top, w: rect.width, h: rect.height };\r\n}\r\n\r\nfunction setOpacity(el, value) {\r\n    el.animate(\r\n        { opacity: value },\r\n        { duration: CONFIG.DUR.fade, fill: \"forwards\" }\r\n    );\r\n}\r\n\r\nconst CursorController = {\r\n    // ------- refs & state -------\r\n    cursor: document.querySelector(CONFIG.SELECTORS.cursor),\r\n    cursorFollow: document.querySelector(CONFIG.SELECTORS.cursorFollow),\r\n    postbody: document.querySelectorAll(CONFIG.SELECTORS.postbody),\r\n    progressPath: document.querySelector(CONFIG.SELECTORS.progressPath),\r\n    forums: document.querySelectorAll(CONFIG.SELECTORS.forumEl),\r\n\r\n    stopFollow: false,\r\n\r\n    // ------- API -------\r\n    init() {\r\n        this.bindEvents();\r\n        this.bindScroll();\r\n    },\r\n\r\n    // ------- events -------\r\n    bindEvents() {\r\n        document.addEventListener(\"mouseenter\", () => {\r\n            setOpacity(this.cursor, 1);\r\n            setOpacity(this.cursorFollow, 1);\r\n        });\r\n\r\n        document.addEventListener(\"mouseleave\", () => {\r\n            setOpacity(this.cursor, 0);\r\n            setOpacity(this.cursorFollow, 0);\r\n        });\r\n\r\n        document.addEventListener(\"mousemove\", (e) => {\r\n            const { pageX: leftPosition, pageY: topPosition, target } = e;\r\n\r\n            if (!(target instanceof Element)) return;\r\n\r\n            // position du pointeur \"avant-plan\"\r\n            this.cursor.style.left = leftPosition + \"px\";\r\n            this.cursor.style.top = topPosition + \"px\";\r\n\r\n            // badges visuels (texte / oeil)\r\n            this.updateCursorBadges(target);\r\n\r\n            // branchements exacts de l'original\r\n            if (target.matches(CONFIG.SELECTORS.btn)) {\r\n                this.handleBtnFocus(target);\r\n            } else if (target.matches(CONFIG.SELECTORS.profileSymbol)) {\r\n                this.handleProfileSymbolFocus(target);\r\n            } else {\r\n                this.resetFollowSize();\r\n            }\r\n\r\n            // suivre la souris si non figé\r\n            if (!this.stopFollow) {\r\n                this.cursorFollow.classList.remove(\"static\");\r\n                this.cursor.classList.remove(\"hide\");\r\n                gsap.to(this.cursorFollow, {\r\n                    top: topPosition,\r\n                    left: leftPosition,\r\n                    duration: CONFIG.DUR.follow,\r\n                    ease: CONFIG.EASE,\r\n                });\r\n            }\r\n        });\r\n\r\n        // progress sur scroll (container Barba)\r\n        document.addEventListener(\r\n            \"scroll\",\r\n            (e) => {\r\n                if (e.target.dataset.barba === \"container\") {\r\n                    this.updateProgress();\r\n                }\r\n            },\r\n            true\r\n        );\r\n\r\n        document.addEventListener(\r\n            \"pointerleave\",\r\n            (e) => {\r\n                if (!(e.target instanceof Element)) return;\r\n\r\n                const host = e.target.closest(\".btn, .subject__profileSymbol\");\r\n                if (!host) return;\r\n                // si on quitte l'élément mais qu'on reste dans un de ses enfants => on ne fait rien\r\n                if (host.contains(e.relatedTarget)) return;\r\n\r\n                // on force le retour à l'état \"follow\" même si la souris ne bouge plus\r\n                this.stopFollow = false;\r\n\r\n                // retirer tout de suite les classes qui modifient le border-radius\r\n                this.cursorFollow.classList.remove(\"static\", \"large\");\r\n                this.cursor.classList.remove(\"hide\", \"grow\");\r\n\r\n                // arrêter l'animation en cours pour éviter les états mixtes\r\n                gsap.killTweensOf(this.cursorFollow);\r\n                gsap.killTweensOf(this.cursor);\r\n\r\n                // revenir à la taille d'origine ; la position sera gérée par le prochain mousemove\r\n                gsap.to(this.cursorFollow, {\r\n                    width: 40,\r\n                    height: 40,\r\n                    duration: 0.5,\r\n                    ease: \"circ.out\",\r\n                });\r\n            },\r\n\r\n            true\r\n        );\r\n    },\r\n\r\n    // ------- helpers souris -------\r\n    updateCursorBadges(target) {\r\n        // .text\r\n        if (target.matches(CONFIG.SELECTORS.text)) {\r\n            this.cursor.classList.add(\"text\");\r\n        } else {\r\n            this.cursor.classList.remove(\"text\");\r\n        }\r\n\r\n        // .eye\r\n        if (target.matches(CONFIG.SELECTORS.forum)) {\r\n            this.cursor.classList.add(\"eye\");\r\n        } else {\r\n            this.cursor.classList.remove(\"eye\");\r\n        }\r\n\r\n        if (target.matches(CONFIG.SELECTORS.link)) {\r\n            this.cursor.classList.add(\"grow\");\r\n            this.cursorFollow.classList.add(\"large\");\r\n        } else {\r\n            this.cursor.classList.remove(\"grow\");\r\n            this.cursorFollow.classList.remove(\"large\");\r\n        }\r\n\r\n        if (target.matches(CONFIG.SELECTORS.map)) {\r\n            this.cursor.classList.add(\"crosshair\");\r\n            this.cursorFollow.classList.add(\"shrink\");\r\n        } else {\r\n            this.cursor.classList.remove(\"crosshair\");\r\n            this.cursorFollow.classList.remove(\"shrink\");\r\n        }\r\n    },\r\n\r\n    handleBtnFocus(target) {\r\n        this.stopFollow = true;\r\n        const element = target.closest(\".btn\");\r\n        const { x, y, w, h } = getRectData(element);\r\n\r\n        this.cursorFollow.classList.add(\"static\");\r\n\r\n        gsap.to(this.cursorFollow, {\r\n            top: y + h / 2,\r\n            left: x + w / 2,\r\n            width: w,\r\n            height: h,\r\n            duration: CONFIG.DUR.focus,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    handleProfileSymbolFocus(target) {\r\n        this.stopFollow = true;\r\n        const element = target.closest(\".subject__profileSymbol\");\r\n        const { x, y, w, h } = getRectData(element);\r\n\r\n        // NB: fidèle à l’original — pas d'ajout de .static / .hide ici\r\n        gsap.to(this.cursorFollow, {\r\n            top: y + h / 2,\r\n            left: x + w / 2,\r\n            width: w,\r\n            height: h,\r\n            duration: CONFIG.DUR.focus,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    resetFollowSize() {\r\n        this.stopFollow = false;\r\n        gsap.to(this.cursorFollow, {\r\n            width: CONFIG.FOLLOW_SIZE,\r\n            height: CONFIG.FOLLOW_SIZE,\r\n            duration: CONFIG.DUR.shrink,\r\n            ease: CONFIG.EASE,\r\n        });\r\n    },\r\n\r\n    // ------- scroll progress -------\r\n    bindScroll() {\r\n        if (!this.progressPath) return; // garde-fou\r\n        const len = this.pathLength();\r\n        this.progressPath.style.strokeDasharray = `${len} ${len}`;\r\n        this.updateProgress();\r\n    },\r\n\r\n    currentContainer() {\r\n        return document.querySelector(CONFIG.SELECTORS.barbaContainer);\r\n    },\r\n\r\n    updateProgress() {\r\n        if (!this.progressPath) return;\r\n        const container = this.currentContainer();\r\n        if (!container) return;\r\n\r\n        const scroll = container.scrollTop;\r\n        const height = container.scrollHeight - window.innerHeight;\r\n        const progress =\r\n            this.pathLength() - (scroll * this.pathLength()) / height;\r\n        this.progressPath.style.strokeDashoffset = progress;\r\n    },\r\n\r\n    // ------- computed -------\r\n    pathLength() {\r\n        return this.progressPath.getTotalLength();\r\n    },\r\n};\r\nexport default CursorController;\r\n","// animations/presets.js\r\nexport const easeCurve = \"M0,0,C0.625,0,0,1,1,1\";\r\n\r\nlet _ease = null;\r\nexport function ensureEase() {\r\n    if (!window.gsap) return null;\r\n    if (_ease) return _ease;\r\n    try {\r\n        if (window.CustomEase) {\r\n            gsap.registerPlugin(CustomEase);\r\n            _ease =\r\n                gsap.parseEase?.(\"custom\") ||\r\n                CustomEase.create(\"custom\", easeCurve);\r\n        }\r\n    } catch {}\r\n    if (!_ease) _ease = \"power4.out\"; // fallback discret\r\n    return _ease;\r\n}\r\n\r\nexport const he = {\r\n    coverFrom: { transform: \"scaleX(0)\" },\r\n    coverTo: { transform: \"scaleX(1)\" },\r\n    coverExitFrom: { left: 0, width: \"100%\" },\r\n    coverExitTo: { left: \"100%\", width: \"0%\" },\r\n    fadeFrom: { autoAlpha: 0 },\r\n    fadeTo: { autoAlpha: 1 },\r\n    fadeUpFrom: { autoAlpha: 0, transform: \"translateY(20px)\" },\r\n    fadeUpTo: { autoAlpha: 1, transform: \"translateY(0)\" },\r\n    growHeightFrom: { height: \"0%\" },\r\n    growHeightTo: { height: \"100%\" },\r\n    growWidthFrom: { width: \"0%\" },\r\n    growWidthTo: { width: \"100%\" },\r\n    fadeFromLeft50From: { autoAlpha: 0, transform: \"translateX(-50%)\" },\r\n    fadeFromLeft50To: { autoAlpha: 1, transform: \"translateX(0)\" },\r\n};\r\n","// animations/lines.js\r\nimport { ensureEase } from \"./presets.js\";\r\n\r\nconst qsa = (root, sel) => root.querySelectorAll(sel);\r\n\r\nexport function animateLinesIn(root = document, onDone) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) {\r\n        onDone?.();\r\n        return;\r\n    }\r\n    const tl = gsap.timeline({ ease, onComplete: onDone });\r\n    qsa(root, \".bb\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.2, delay: i * 0.03 }, \"h\")\r\n    );\r\n    qsa(root, \".br\").forEach((el, i) =>\r\n        tl.to(el, { height: \"100%\", duration: 0.2, delay: i * 0.03 }, \"v\")\r\n    );\r\n    qsa(root, \".bl\").forEach((el, i) =>\r\n        tl.to(el, { height: \"100%\", duration: 0.2, delay: i * 0.03 }, \"v\")\r\n    );\r\n    qsa(root, \".bt\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.2, delay: i * 0.03 }, \"h\")\r\n    );\r\n    qsa(root, \".bg-hash-v\").forEach((el, i) =>\r\n        tl.to(el, { width: \"100%\", duration: 0.4 }, \"h\")\r\n    );\r\n    return tl;\r\n}\r\n\r\nexport function animateLinesOut(root = document, onDone) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) {\r\n        onDone?.();\r\n        return;\r\n    }\r\n    const tl = gsap.timeline({ ease, onComplete: onDone });\r\n    qsa(root, \".br\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                top: i % 2 ? 0 : \"+=100%\",\r\n                height: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"v\"\r\n        )\r\n    );\r\n    qsa(root, \".bl\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                top: i % 2 ? 0 : \"+=100%\",\r\n                height: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"v\"\r\n        )\r\n    );\r\n    qsa(root, \".bb\").forEach((el, i) =>\r\n        tl.to(\r\n            el,\r\n            {\r\n                left: i % 2 ? 0 : \"+=100%\",\r\n                width: 0,\r\n                duration: 0.2,\r\n                delay: i * 0.03,\r\n            },\r\n            \"h\"\r\n        )\r\n    );\r\n    qsa(root, \".bg-hash-v\").forEach((el, i) =>\r\n        tl.to(el, { width: \"0%\", duration: 0.4 }, \"h\")\r\n    );\r\n    return tl;\r\n}\r\n","// animations/navigation.js\r\nimport { he, ensureEase } from \"./presets.js\";\r\nimport { qsa, qs } from \"../core/utils.js\";\r\n\r\n// ✅ timeline globale déclarée\r\nlet globalTimeline = null;\r\n\r\nexport const getGlobalTimeline = () => globalTimeline;\r\nexport const setGlobalTimeline = (tl) => (globalTimeline = tl);\r\nexport const clearGlobal = () => {\r\n    globalTimeline = null;\r\n};\r\n\r\nconst has = (list) => list && list.length > 0;\r\n\r\nexport function mapAnimation({ container }) {\r\n    const ease = ensureEase();\r\n    if (!window.gsap || !ease) return null;\r\n\r\n    const root = qs(document, \"#map\");\r\n    try {\r\n        globalTimeline?.kill();\r\n    } catch {}\r\n\r\n    const tl = gsap.timeline({\r\n        defaults: { duration: 1, ease },\r\n        onReverseComplete: () => {\r\n            clearGlobal();\r\n            container.classList.add(\"onLoad\");\r\n        },\r\n    });\r\n\r\n    const i = qsa(root, \".anim-bg-cover\");\r\n    const r = qsa(root, \".anim-bg\");\r\n    const o = qsa(root, \".anim-fade\");\r\n    const p = qsa(root, \".anim-fadeFromLeft-50\");\r\n    const l = qsa(root, \".anim-fadeUp\");\r\n    const width = qsa(root, \".anim-bb, .anim-bt\");\r\n    const height = qsa(root, \".anim-br, .anim-bl\");\r\n\r\n    const ft = (targets, fromVars, toVars, pos) => {\r\n        if (!has(targets)) return tl;\r\n        return pos !== undefined\r\n            ? tl.fromTo(targets, fromVars, toVars, pos)\r\n            : tl.fromTo(targets, fromVars, toVars);\r\n    };\r\n\r\n    ft(i, he.coverFrom, he.coverTo);\r\n    ft(i, he.coverExitFrom, he.coverExitTo, 0.7);\r\n    ft(r, he.coverFrom, he.coverTo, 0.7);\r\n    ft(o, he.fadeFrom, { ...he.fadeTo, stagger: 0.033 }, 1.7);\r\n    ft(width, he.growWidthFrom, { ...he.growWidthTo, stagger: 0.033 }, 1.7);\r\n    ft(height, he.growHeightFrom, { ...he.growHeightTo, stagger: 0.033 }, 1.7);\r\n\r\n    setGlobalTimeline(tl);\r\n    return tl;\r\n}\r\n\r\nexport function navigationAnimation() {}\r\n\r\nexport function contentsIn(root = document, opts = {}) {\r\n    const items = root.querySelectorAll(\".content, .contents\");\r\n    if (!items || items.length === 0) return null; // évite le warning GSAP si vide\r\n    return gsap.to(items, {\r\n        alpha: 1,\r\n        stagger: 0.03,\r\n        ...opts,\r\n    });\r\n}\r\n\r\nexport function contentsOut(root = document, opts = {}) {\r\n    const items = root.querySelectorAll(\".content, .contents\");\r\n    if (!items || items.length === 0) return null;\r\n    return gsap.to(items, {\r\n        alpha: 0,\r\n        stagger: 0.03,\r\n        ...opts,\r\n    });\r\n}\r\n","// ui/Badge.js\r\n// Badge compteur, fidèle à ton comportement, mais plus robuste à l'init.\r\n\r\nexport default class Badge {\r\n    /**\r\n     * @param {HTMLElement} element  hôte du badge (ex: #menu .notification)\r\n     * @param {Object} options\r\n     */\r\n    constructor(element, options = {}) {\r\n        this.options = {\r\n            badgeClass: \"notification-badge\",\r\n            badgeCounterClass: \"notification-counter\",\r\n            animationSpeed: 150,\r\n            countLimit: 99,\r\n            activeClass: \"notification-badge--active\",\r\n            limitClass: \"notification-badge--limit\",\r\n            ...options,\r\n        };\r\n\r\n        if (!element) {\r\n            console.error(\"[Badge] host element is null/undefined.\");\r\n            return; // no-op, évite les erreurs.\r\n        }\r\n\r\n        this.element = element;\r\n        this.badgeElement = null;\r\n        this.badgeCounterElement = null;\r\n\r\n        // ✅ injecte/recâble systématiquement le markup\r\n        this.renderIfNeeded();\r\n    }\r\n\r\n    /** Injecte le markup si absent et met à jour les refs */\r\n    renderIfNeeded() {\r\n        // cherche un wrapper existant\r\n        let wrapper = this.element.querySelector(\".\" + this.options.badgeClass);\r\n        if (!wrapper) {\r\n            wrapper = document.createElement(\"span\");\r\n            wrapper.className = this.options.badgeClass;\r\n            wrapper.innerHTML = `<span class=\"${this.options.badgeCounterClass}\">0</span>`;\r\n            this.element.appendChild(wrapper);\r\n        }\r\n        this.badgeElement = wrapper;\r\n        this.badgeCounterElement = wrapper.querySelector(\r\n            \".\" + this.options.badgeCounterClass\r\n        );\r\n    }\r\n\r\n    /** Active/désactive et swap la valeur avec petite anim */\r\n    set(n = 0) {\r\n        if (!this.element) return false;\r\n\r\n        // ✅ s’assure que le DOM du badge est présent (au cas où Barba a réhydraté)\r\n        this.renderIfNeeded();\r\n\r\n        if (typeof n !== \"number\" || Number.isNaN(n) || n < 0) {\r\n            console.error(`[Badge] invalid value: ${n}`);\r\n            this.badgeElement?.classList.remove(this.options.activeClass);\r\n            if (this.badgeCounterElement)\r\n                this.badgeCounterElement.textContent = \"\";\r\n            return false;\r\n        }\r\n\r\n        // n == 0 : on “éteint” visuellement\r\n        if (n === 0) {\r\n            this.badgeElement?.classList.remove(this.options.activeClass);\r\n            if (this.badgeCounterElement)\r\n                this.badgeCounterElement.textContent = \"\";\r\n            return false;\r\n        }\r\n\r\n        // état \"limit\"\r\n        if (n > this.options.countLimit) {\r\n            this.badgeElement?.classList.add(this.options.limitClass);\r\n        } else {\r\n            this.badgeElement?.classList.remove(this.options.limitClass);\r\n        }\r\n\r\n        // activer si pas déjà\r\n        if (\r\n            this.badgeElement &&\r\n            !this.badgeElement.classList.contains(this.options.activeClass)\r\n        ) {\r\n            this.badgeElement.classList.add(this.options.activeClass);\r\n        }\r\n\r\n        const oldEl = this.badgeCounterElement;\r\n        if (!oldEl) return false;\r\n\r\n        // si même valeur, assure juste l’état actif et sors\r\n        if (String(oldEl.textContent).trim() === String(n)) {\r\n            return true;\r\n        }\r\n\r\n        const newEl = oldEl.cloneNode(false);\r\n        newEl.textContent = n;\r\n\r\n        // petites classes d’anim (compatibles avec ton CSS)\r\n        newEl.classList.add(this.options.badgeCounterClass + \"--new\");\r\n        oldEl.classList.add(this.options.badgeCounterClass + \"--old\");\r\n\r\n        oldEl.after(newEl);\r\n\r\n        // déclenche l’anim au frame suivant puis nettoie\r\n        requestAnimationFrame(() => {\r\n            newEl.classList.remove(this.options.badgeCounterClass + \"--new\");\r\n            setTimeout(() => {\r\n                try {\r\n                    oldEl.remove();\r\n                } catch {}\r\n                this.badgeCounterElement = newEl;\r\n            }, this.options.animationSpeed);\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    get() {\r\n        const n = parseInt(this.badgeCounterElement?.textContent || \"0\", 10);\r\n        return Number.isNaN(n) ? 0 : n;\r\n    }\r\n\r\n    increase(n = 1) {\r\n        return this.set(this.get() + n);\r\n    }\r\n    decrease(n = 1) {\r\n        return this.set(Math.max(0, this.get() - n));\r\n    }\r\n\r\n    destroy() {\r\n        if (!this.element) return;\r\n        const wrap = this.element.querySelector(\".\" + this.options.badgeClass);\r\n        if (wrap) wrap.remove();\r\n        this.badgeElement = null;\r\n        this.badgeCounterElement = null;\r\n        this.element = null;\r\n    }\r\n}\r\n","// init/barba.js\r\nimport Context from \"../core/context.js\";\r\nimport { animateLinesIn, animateLinesOut } from \"../animations/lines.js\";\r\nimport {\r\n    navigationAnimation,\r\n    contentsIn,\r\n    contentsOut,\r\n} from \"../animations/navigation.js\";\r\n\r\nimport Badge from \"../ui/Badge.js\";\r\n\r\nconst CFG = {\r\n    CONTAINER_SEL: 'section[data-barba=\"container\"]',\r\n    PROGRESS_PATH_SEL: \".progress-wrap path\",\r\n};\r\n\r\nlet _initialized = false;\r\nconst _nsHooks = new Map();\r\n\r\nfunction rebindProgressPath(nextContainer, cursor) {\r\n    if (!cursor || !cursor.progressPath) return;\r\n    const nextPath = nextContainer?.querySelector?.(CFG.PROGRESS_PATH_SEL);\r\n    if (nextPath) cursor.progressPath = nextPath;\r\n    try {\r\n        const len = cursor.pathLength();\r\n        cursor.progressPath.style.strokeDasharray = `${len} ${len}`;\r\n        cursor.updateProgress();\r\n    } catch {}\r\n}\r\n\r\nexport function onNamespace(ns, handlers) {\r\n    _nsHooks.set(ns, { ...(handlers || {}) });\r\n}\r\n\r\nexport function initBarba({ cursor } = {}) {\r\n    if (_initialized) return { destroy };\r\n    _initialized = true;\r\n\r\n    if (!window.barba?.init) {\r\n        console.warn(\r\n            \"[barba] introuvable. Charge @barba/core avant initBarba().\"\r\n        );\r\n        const root = document.querySelector(CFG.CONTAINER_SEL) || document;\r\n        Context.container = root;\r\n        animateLinesIn(root, () => navigationAnimation(root));\r\n        return { destroy };\r\n    }\r\n\r\n    Context.container = document.querySelector(CFG.CONTAINER_SEL) || document;\r\n\r\n    const menu = document.getElementById(\"menu\");\r\n    const host = menu?.querySelector(\".notification\");\r\n    const notificationBadge = new Badge(host);\r\n\r\n    barba.init({\r\n        prevent: ({ el }) => el?.hasAttribute?.(\"data-barba-prevent\"),\r\n        transitions: [\r\n            {\r\n                name: \"lines-and-reveal\",\r\n\r\n                beforeOnce(data) {\r\n                    const done = this.async();\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.beforeOnce?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:beforeOnce ns]\", e);\r\n                    }\r\n                    animateLinesIn(data.next.container, done);\r\n                    notificationBadge.set(5);\r\n                },\r\n\r\n                once(data) {\r\n                    console.debug(\"[barba] once ns=\", data?.next?.namespace);\r\n\r\n                    // 🔗 appeler les hooks namespace au premier load\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.once?.(data); // si tu en as un\r\n                        h?.afterEnter?.(data); // mime afterEnter au 1er load\r\n                    } catch (e) {\r\n                        console.error(\"[barba:once ns hook]\", e);\r\n                    }\r\n\r\n                    // fade-in de tes .content/.contents (inchangé)\r\n                    const done = this.async();\r\n                    const contents = data.next.container.querySelectorAll(\r\n                        \".content, .contents\"\r\n                    );\r\n                    if (contents.length) {\r\n                        gsap.to(contents, {\r\n                            alpha: 1,\r\n                            stagger: 0.03,\r\n                            onComplete: done,\r\n                        });\r\n                    } else {\r\n                        done();\r\n                    }\r\n                },\r\n\r\n                before(data) {\r\n                    const ns = data?.current?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.before?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:before ns]\", e);\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    const tl = contentsOut(data.current.container, {\r\n                        onComplete: done,\r\n                    });\r\n                    if (!tl) done();\r\n                },\r\n\r\n                async leave(data) {\r\n                    const ns = data?.current?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    if (h?.leave) {\r\n                        try {\r\n                            await h.leave(data);\r\n                        } catch (e) {\r\n                            console.error(\"[barba:leave]\", e);\r\n                        }\r\n                    }\r\n                    const done = this.async();\r\n                    animateLinesOut(data.current.container, done);\r\n                },\r\n\r\n                async enter(data) {\r\n                    console.debug(\"[barba] enter ns=\", data?.next?.namespace);\r\n                    Context.container = data.next.container;\r\n                    rebindProgressPath(data.next.container, cursor);\r\n\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    if (h?.enter) {\r\n                        try {\r\n                            await h.enter(data);\r\n                        } catch (e) {\r\n                            console.error(\"[barba:enter]\", e);\r\n                        }\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    animateLinesIn(data.next.container, () => {\r\n                        navigationAnimation(data.next.container);\r\n                        done();\r\n                    });\r\n                },\r\n\r\n                afterEnter(data) {\r\n                    console.debug(\r\n                        \"[barba] afterEnter ns=\",\r\n                        data?.next?.namespace\r\n                    );\r\n\r\n                    const ns = data?.next?.namespace;\r\n                    const h = ns ? _nsHooks.get(ns) : null;\r\n                    try {\r\n                        h?.afterEnter?.(data);\r\n                    } catch (e) {\r\n                        console.error(\"[barba:afterEnter]\", e);\r\n                    }\r\n\r\n                    const done = this.async();\r\n                    const tl = contentsIn(data.next.container, {\r\n                        onComplete: done,\r\n                    });\r\n                    if (!tl) done();\r\n                },\r\n            },\r\n        ],\r\n    });\r\n\r\n    return { destroy };\r\n}\r\n\r\nexport function getRegisteredNamespaces() {\r\n    return Array.from(_nsHooks.keys());\r\n}\r\n\r\nfunction destroy() {\r\n    try {\r\n        if (barba && barba.destroy) barba.destroy();\r\n    } catch {}\r\n    _nsHooks.clear();\r\n    _initialized = false;\r\n}\r\n","// features/register/register.js\r\n// Refactor minimal du \"register script\" (iframe) depuis ton code existant.\r\n// Aucune logique ajoutée : juste structuré, sécurisé, et sans utiliser `this` implicite.\r\n\r\nimport localforage from \"https://cdn.jsdelivr.net/npm/localforage@1.10.0/+esm\";\r\n\r\n// Helpers locaux (copie fidèle de tes utilitaires)\r\nconst slugify = (text) =>\r\n    text\r\n        .toString()\r\n        .toLowerCase()\r\n        .normalize(\"NFD\")\r\n        .trim()\r\n        .replace(/\\s+/g, \"-\")\r\n        .replace(/[^\\w\\-]+/g, \"\")\r\n        .replace(/\\-\\-+/g, \"-\");\r\n\r\nconst getSiblings = (el) => {\r\n    const siblings = [];\r\n    if (!el?.parentNode) return siblings;\r\n    let n = el.parentNode.firstChild;\r\n    while (n) {\r\n        if (n.nodeType === 1 && n !== el) siblings.push(n);\r\n        n = n.nextSibling;\r\n    }\r\n    return siblings;\r\n};\r\n\r\n// --- parsing / étapes -------------------------------------------------------\r\n\r\nfunction computeRegisterStep(url = \"\", htmlDoc = document) {\r\n    // Fidèle à ta logique, avec garde-fous\r\n    let step = 1;\r\n    if (url.includes(\"step=2\")) step = 2;\r\n    if (htmlDoc.querySelector(\"form#form_confirm\")) step = 6;\r\n    if (htmlDoc.querySelector(\".randommessageclass\")) step = 7; // message de succès\r\n    return step;\r\n}\r\n\r\nfunction parseFieldset(fieldset) {\r\n    const dls = fieldset?.querySelectorAll?.(\"dl\") || [];\r\n    const data = {};\r\n    dls.forEach((dl) => {\r\n        const dt = dl.querySelector(\"dt\");\r\n        const title = (dt?.textContent || \"\").replace(/[*:]/g, \"\");\r\n        const slug = slugify(title);\r\n        const input = dl.querySelector(\"dd input, dd textarea, dd select\");\r\n        if (input) {\r\n            const type = input.tagName.toLowerCase();\r\n            const value =\r\n                type === \"select\" ? input.value : (input.value || \"\").trim();\r\n            data[slug] = {\r\n                title,\r\n                type,\r\n                value,\r\n                validate: () => true,\r\n                inputHTML: input,\r\n                originalHTML: dl,\r\n            };\r\n        }\r\n    });\r\n    return data;\r\n}\r\n\r\nfunction getAllFields(accountFieldset, profileFieldset) {\r\n    return [parseFieldset(accountFieldset), parseFieldset(profileFieldset)];\r\n}\r\n\r\n// Placeholders pour garder le même flux sans casser\r\nfunction formatFields(/* account, profile */) {\r\n    return null;\r\n}\r\nfunction changeFormAction() {\r\n    /* no-op fidèle au code actuel */\r\n}\r\n\r\n// --- DOM actions ------------------------------------------------------------\r\n\r\nfunction goToStep(container, idx) {\r\n    const panel = container.querySelector(`.register__panel:nth-child(${idx})`);\r\n    if (!panel) return;\r\n    getSiblings(panel).forEach((s) => s.classList.remove(\"isOpen\"));\r\n    panel.classList.add(\"isOpen\");\r\n}\r\n\r\nfunction deletePanelContent(container, idx) {\r\n    const target = container.querySelector(\r\n        `.register__panel:nth-child(${idx}) .register__panelContentWrapper`\r\n    );\r\n    target?.remove();\r\n}\r\n\r\n// --- handler principal (évènement load de l’iframe) ------------------------\r\n\r\nexport async function updateIframeRegister(event) {\r\n    const iframe = event?.currentTarget;\r\n    if (!iframe) return;\r\n\r\n    const doc = iframe.contentDocument || iframe.contentWindow?.document;\r\n    const url = iframe.contentWindow?.location?.href || \"\";\r\n    if (!doc) return;\r\n\r\n    const cpMain = doc.querySelector(\"#cp-main\");\r\n    if (!cpMain) return;\r\n\r\n    const html = cpMain.cloneNode(true);\r\n    const fieldsets = html.querySelectorAll(\"fieldset\");\r\n\r\n    // état local minimum (comme ton code)\r\n    /* const foragedForm = await localforage.getItem(\"registration_form\");\r\n    const formData = {}; */\r\n\r\n    // container barba courant (ou document à défaut)\r\n    const container =\r\n        iframe.closest('section[data-barba=\"container\"]') || document;\r\n\r\n    const step = computeRegisterStep(url, html);\r\n\r\n    const steps = {\r\n        1: () => {},\r\n        2: async () => {\r\n            if (fieldsets.length >= 2) {\r\n                const [account, profile] = getAllFields(\r\n                    fieldsets[0],\r\n                    fieldsets[1]\r\n                );\r\n                // garde le hook existant :\r\n                const formatted = formatFields(account, profile);\r\n                void formatted;\r\n            }\r\n            goToStep(container, 2);\r\n            await new Promise((r) => setTimeout(r, 400));\r\n            deletePanelContent(container, 1);\r\n            changeFormAction();\r\n        },\r\n        3: () => {},\r\n        6: () => {}, // confirm\r\n        7: () => {}, // success\r\n    };\r\n\r\n    if (steps[step]) {\r\n        await steps[step]();\r\n    }\r\n}\r\n\r\n// --- init public ------------------------------------------------------------\r\n\r\nexport function initRegisterScripts(container = document) {\r\n    try {\r\n        const iFrame = container.querySelector(\"#registerIframe\");\r\n        if (!iFrame) return;\r\n        // sécurise : évite les doublons si Barba réentre\r\n        iFrame.removeEventListener(\"load\", updateIframeRegister);\r\n        iFrame.addEventListener(\"load\", updateIframeRegister);\r\n    } catch (e) {\r\n        console.log(\"RegisterScripts:\", e);\r\n    }\r\n}\r\n","import { qs } from \"../core/utils.js\";\r\nimport { getGlobalTimeline } from \"../animations/navigation.js\";\r\n\r\n// Map + Topic Controllers — refactor v2\r\n// -------------------------------------\r\n// Goals\r\n// - Stronger separation of concerns (map vs. topic creation UI)\r\n// - Safer DOM access & defensive guards to avoid null errors\r\n// - Resize-aware map (ResizeObserver), with camera/offset updates when side asides open/close\r\n// - Clean event lifecycle (add/remove) and small utilities (throttle, DMS helpers)\r\n// - Robust topic parsing from forum list + safe marker rendering\r\n// - Smooth “click to drop temp marker → open creation aside → prefill coords” flow\r\n\r\n// External expectations\r\n// - global `maplibregl`\r\n// - optional `getGlobalTimeline()` from animations/navigation.js\r\n// - DOM structure:\r\n//   - map container: #map and #map-content (canvas host)\r\n//   - list aside: .map__asideContainer.topicList\r\n//   - new-topic aside: .map__asideContainer.newTopic\r\n//   - toggle board button: #board\r\n//   - creation close button (optional): .newTopic__closeButton\r\n//   - creation form fields (optional):\r\n//       [name=\"subject\"], [name=\"message\"], [name=\"district\"], [name=\"coords\"],\r\n//       [data-coords-decimal], [data-coords-dms]\r\n\r\n// -------------------------------------\r\n// utils\r\nexport function rafThrottle(fn) {\r\n    let ticking = false;\r\n    return function throttled(...args) {\r\n        if (ticking) return;\r\n        ticking = true;\r\n        requestAnimationFrame(() => {\r\n            try {\r\n                fn.apply(this, args);\r\n            } finally {\r\n                ticking = false;\r\n            }\r\n        });\r\n    };\r\n}\r\n\r\nfunction clamp(n, min, max) {\r\n    return Math.max(min, Math.min(max, n));\r\n}\r\n\r\nfunction pxOffsetToLngLatFraction(container, pxX = 0, pxY = 0) {\r\n    // Convert a pixel offset into a crude lng/lat fraction of current bounds width/height.\r\n    // Used only to nudge maxBounds slightly when the layout changes.\r\n    // Guards: if container missing, return 0,0 fractions.\r\n    const w = container?.clientWidth || 0;\r\n    const h = container?.clientHeight || 0;\r\n    if (!w || !h) return { fx: 0, fy: 0 };\r\n    return { fx: pxX / w, fy: pxY / h };\r\n}\r\n\r\nfunction offsetBoundsByFraction(bounds, fx = 0, fy = 0) {\r\n    const sw = bounds.getSouthWest();\r\n    const ne = bounds.getNorthEast();\r\n    const dLng = (ne.lng - sw.lng) * fx;\r\n    const dLat = (ne.lat - sw.lat) * fy;\r\n    return new maplibregl.LngLatBounds(\r\n        [sw.lng + dLng, sw.lat + dLat],\r\n        [ne.lng + dLng, ne.lat + dLat]\r\n    );\r\n}\r\n\r\n// -------------------------------------\r\n// DMS helpers\r\nexport function toDMS(value, type = \"lat\", precision = 4) {\r\n    const hemi =\r\n        type === \"lat\" ? (value >= 0 ? \"N\" : \"S\") : value >= 0 ? \"E\" : \"W\";\r\n    let v = Math.abs(Number(value));\r\n    let d = Math.floor(v);\r\n    let mFloat = (v - d) * 60;\r\n    let m = Math.floor(mFloat);\r\n    let s = (mFloat - m) * 60;\r\n    const p = Math.max(0, precision | 0);\r\n    s = Number(s.toFixed(p));\r\n    if (s >= 60) {\r\n        s -= 60;\r\n        m += 1;\r\n    }\r\n    if (m >= 60) {\r\n        m -= 60;\r\n        d += 1;\r\n    }\r\n    return { d, m, s, hemi, type };\r\n}\r\n\r\nexport function formatDMS(\r\n    { d, m, s, hemi, type },\r\n    { precision = 4, pad = true } = {}\r\n) {\r\n    const dd = String(d).padStart(type === \"lon\" ? 3 : 2, \"0\");\r\n    const mm = pad ? String(m).padStart(2, \"0\") : String(m);\r\n    const ss = pad\r\n        ? Number(s)\r\n              .toFixed(precision)\r\n              .padStart(precision ? 3 + 1 + precision : 2, \"0\")\r\n        : Number(s).toFixed(precision);\r\n    return `${dd}° ${mm}' ${ss}\" ${hemi}`;\r\n}\r\n\r\nexport function decimalToDMSString(\r\n    value,\r\n    type = \"lat\",\r\n    precision = 4,\r\n    pad = true\r\n) {\r\n    return formatDMS(toDMS(value, type, precision), { precision, pad });\r\n}\r\n\r\n// -------------------------------------\r\n// Forum topics scraping (robust)\r\nasync function fetchForumTopics({ forumId = 1, limit = 12, signal } = {}) {\r\n    try {\r\n        const res = await fetch(`/f${forumId}-`, {\r\n            credentials: \"same-origin\",\r\n            signal,\r\n        });\r\n        const html = await res.text();\r\n        const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n        const anchors = Array.from(doc.querySelectorAll(\"a.topictitle\"));\r\n        const list = anchors\r\n            .slice(0, limit)\r\n            .map((a) => {\r\n                try {\r\n                    const href = a.getAttribute(\"href\");\r\n                    const url = new URL(href, location.origin).href;\r\n                    const row = a.closest(\".row, .topic-row, tr\");\r\n                    const title = (a.textContent || \"Untitled\").trim();\r\n                    const author =\r\n                        row\r\n                            ?.querySelector(\".username, .topic-author a\")\r\n                            ?.textContent?.trim() || \"\";\r\n                    const replies =\r\n                        row\r\n                            ?.querySelector(\".posts, .topic-replies\")\r\n                            ?.textContent?.trim() || \"\";\r\n                    const last =\r\n                        row\r\n                            ?.querySelector(\r\n                                \".lastpost, .topic-lastpost, .gensmall\"\r\n                            )\r\n                            ?.textContent?.trim() || \"\";\r\n                    const desc =\r\n                        row\r\n                            ?.querySelector(\".topic-description, .topic-desc\")\r\n                            ?.textContent?.trim() || \"\";\r\n                    const mId = url.match(/t(\\d+)-/);\r\n                    const id = mId ? mId[1] : \"\";\r\n                    // parse [lon, lat] in title or description\r\n                    const where = title + \"\\n\" + desc;\r\n                    const coords = where.match(/\\[(.+?),\\s*(.+?)\\]/);\r\n                    if (!coords) return null;\r\n                    const lon = parseFloat(coords[1]);\r\n                    const lat = parseFloat(coords[2]);\r\n                    if (!Number.isFinite(lon) || !Number.isFinite(lat))\r\n                        return null;\r\n                    const district = (\r\n                        where.match(/\"([^\"]+)\"/)?.[1] || \"\"\r\n                    ).trim();\r\n                    return {\r\n                        id,\r\n                        title,\r\n                        desc,\r\n                        district,\r\n                        url,\r\n                        author,\r\n                        replies,\r\n                        last,\r\n                        coords: [lon, lat],\r\n                    };\r\n                } catch {\r\n                    return null;\r\n                }\r\n            })\r\n            .filter(Boolean);\r\n        return list;\r\n    } catch (e) {\r\n        console.warn(\"[Map] fetchForumTopics error:\", e);\r\n        return [];\r\n    }\r\n}\r\n\r\n// -------------------------------------\r\n// TopicController (refactor)\r\nexport class TopicController {\r\n    constructor({\r\n        map,\r\n        topicsContainerSelector = \".map__asideContainer.topicList\",\r\n        newTopicAsideSelector = \".map__asideContainer.newTopic\",\r\n    } = {}) {\r\n        this.map = map;\r\n        this.topicsContainer =\r\n            document.querySelector(topicsContainerSelector) || null;\r\n        this.asideContainer =\r\n            document.querySelector(newTopicAsideSelector) || null;\r\n        this.toggleButton =\r\n            this.asideContainer?.querySelector(\".newTopic__closeButton\") ||\r\n            null;\r\n        this.isCreating = false;\r\n        this.isAsideOpened = false;\r\n\r\n        // optional fields inside aside\r\n        this.subjectInput =\r\n            this.asideContainer?.querySelector(\r\n                '[name=\"subject\"], #newTopicSubject'\r\n            ) || null;\r\n        this.messageInput =\r\n            this.asideContainer?.querySelector(\r\n                '[name=\"message\"], #newTopicMessage'\r\n            ) || null;\r\n        this.coordsInput =\r\n            this.asideContainer?.querySelector(\r\n                '[name=\"coords\"], #newTopicCoords'\r\n            ) || null;\r\n        this.districtInput =\r\n            this.asideContainer?.querySelector(\r\n                '[name=\"district\"], #newTopicDistrict'\r\n            ) || null;\r\n        this.coordsDecimalEl =\r\n            this.asideContainer?.querySelector(\"[data-coords-decimal]\") || null;\r\n        this.coordsDMSEl =\r\n            this.asideContainer?.querySelector(\"[data-coords-dms]\") || null;\r\n\r\n        this._bindAsideEvents();\r\n        this._loadState();\r\n    }\r\n\r\n    _bindAsideEvents() {\r\n        if (this.toggleButton) {\r\n            this.toggleButton.addEventListener(\"click\", () =>\r\n                this.toggleAside()\r\n            );\r\n        }\r\n        // ESC to close\r\n        document.addEventListener(\"keydown\", (e) => {\r\n            if (e.key === \"Escape\" && this.isAsideOpened) this.closeAside();\r\n        });\r\n\r\n        // Mirror text inputs back into state\r\n        const sync = () => this._saveState();\r\n        this.subjectInput?.addEventListener(\"input\", sync);\r\n        this.messageInput?.addEventListener(\"input\", sync);\r\n    }\r\n\r\n    _loadState() {\r\n        try {\r\n            const saved = localStorage.getItem(\"newTopic\");\r\n            if (!saved) return;\r\n            const { coords, district, subject, message } = JSON.parse(saved);\r\n            if (coords)\r\n                this.isCreating = { coords, district, subject, message };\r\n            if (this.subjectInput) this.subjectInput.value = subject || \"\";\r\n            if (this.messageInput) this.messageInput.value = message || \"\";\r\n            if (this.districtInput) this.districtInput.value = district || \"\";\r\n            if (coords) this._updateCoordDisplays(coords);\r\n            // expose close button if we have a draft\r\n            this.toggleButton?.classList.add(\"show\");\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    _saveState() {\r\n        if (!this.isCreating) return;\r\n        try {\r\n            const payload = {\r\n                coords: this.isCreating.coords || null,\r\n                district:\r\n                    this.isCreating.district || this.districtInput?.value || \"\",\r\n                subject: this.subjectInput?.value || \"\",\r\n                message: this.messageInput?.value || \"\",\r\n            };\r\n            localStorage.setItem(\"newTopic\", JSON.stringify(payload));\r\n        } catch {\r\n            /* ignore */\r\n        }\r\n    }\r\n\r\n    _updateCoordDisplays(lngLat) {\r\n        const { lng, lat } = Array.isArray(lngLat)\r\n            ? { lng: lngLat[0], lat: lngLat[1] }\r\n            : lngLat;\r\n        if (this.coordsInput) this.coordsInput.value = `${lng},${lat}`;\r\n        if (this.coordsDecimalEl)\r\n            this.coordsDecimalEl.textContent = `${lng.toFixed(\r\n                6\r\n            )}, ${lat.toFixed(6)}`;\r\n        if (this.coordsDMSEl)\r\n            this.coordsDMSEl.textContent = `${decimalToDMSString(\r\n                lng,\r\n                \"lon\",\r\n                4\r\n            )}, ${decimalToDMSString(lat, \"lat\", 4)}`;\r\n    }\r\n\r\n    initNewTopic(coords, district) {\r\n        this.isCreating = { coords, district };\r\n        this._saveState();\r\n        this.openAside();\r\n        this.moveNewTopic(coords, district);\r\n    }\r\n\r\n    moveNewTopic(coords, district) {\r\n        if (!coords) return;\r\n        this.isCreating = {\r\n            ...this.isCreating,\r\n            coords,\r\n            district: district ?? this.isCreating?.district,\r\n        };\r\n        this._updateCoordDisplays(coords);\r\n        this._saveState();\r\n        this.openAside();\r\n    }\r\n\r\n    setDistrict(district) {\r\n        this.isCreating = { ...this.isCreating, district };\r\n        if (this.districtInput) this.districtInput.value = district || \"\";\r\n        this._saveState();\r\n    }\r\n\r\n    toggleAside() {\r\n        this.isAsideOpened ? this.closeAside() : this.openAside();\r\n    }\r\n\r\n    openAside() {\r\n        if (!this.asideContainer) return;\r\n        this.asideContainer.classList.add(\"active\");\r\n        this.topicsContainer?.classList.remove(\"active\");\r\n        this.isAsideOpened = true;\r\n    }\r\n\r\n    closeAside() {\r\n        if (!this.asideContainer) return;\r\n        this.asideContainer.classList.remove(\"active\");\r\n        this.isAsideOpened = false;\r\n        // keep draft in localStorage; do not wipe here\r\n    }\r\n}\r\n\r\n// -------------------------------------\r\n// MapController (refactor)\r\nexport async function createMapController({\r\n    styleUrl = \"http://127.0.0.1:8080/dark_matter.json\",\r\n    selectors = {\r\n        trigger: \"#navigate\",\r\n        container: \"#map\",\r\n        mapContainer: \"#map-content\",\r\n        board: \"#board\",\r\n        cursor: \"#cursor\",\r\n        topics: \"#map-topics\",\r\n        layoutBoard: \".map__asideContainer.topicList\",\r\n        newTopic: \".map__asideContainer.newTopic\",\r\n    },\r\n    animations = {},\r\n    forumId = 1,\r\n    topicsLimit = 12,\r\n} = {}) {\r\n    const { mapAnimation } = animations || {};\r\n\r\n    const trigger = document.querySelector(selectors.trigger);\r\n    const container = document.querySelector(selectors.container);\r\n    const mapHost = document.querySelector(selectors.mapContainer);\r\n    const cursor = document.querySelector(selectors.cursor);\r\n    const boardTrigger = document.querySelector(selectors.board);\r\n    const topicsContainer = document.querySelector(selectors.topics);\r\n    const layoutBoard = document.querySelector(selectors.layoutBoard);\r\n    const newTopicAside = document.querySelector(selectors.newTopic);\r\n\r\n    if (!container || !mapHost) {\r\n        console.warn(\"[Map] container/mapHost missing:\", selectors);\r\n    }\r\n\r\n    const aborter = new AbortController();\r\n    const topics =\r\n        (await fetchForumTopics({\r\n            forumId,\r\n            limit: topicsLimit,\r\n            signal: aborter.signal,\r\n        })) || [];\r\n\r\n    let map = null;\r\n    let cam = null;\r\n    let tempMarker = null;\r\n    let onMove = null;\r\n    let resizeObs = null;\r\n    let topicController = null;\r\n\r\n    // district layer name you use to restrict clicks\r\n    const DISTRICT_LAYER = \"districts-fill\";\r\n\r\n    // initial logical bounds (Amsterdam demo)\r\n    const INITIAL_BOUNDS = new maplibregl.LngLatBounds(\r\n        [4.825, 52.33],\r\n        [5.015, 52.397]\r\n    );\r\n    const INITIAL_CENTER = [4.89361, 52.37278];\r\n\r\n    function safeGetTl() {\r\n        try {\r\n            return (\r\n                (typeof getGlobalTimeline === \"function\" &&\r\n                    getGlobalTimeline()) ||\r\n                null\r\n            );\r\n        } catch {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    function isMarkerElement(el) {\r\n        return !!el?.closest?.(\".marker, .maplibregl-marker, .mapboxgl-marker\");\r\n    }\r\n\r\n    function isDistrictLayerPresent() {\r\n        return Boolean(\r\n            map?.getStyle()?.layers?.some((l) => l.id === DISTRICT_LAYER)\r\n        );\r\n    }\r\n\r\n    function pointIsInDistrict(point) {\r\n        if (!map) return false;\r\n        if (!isDistrictLayerPresent()) return true; // fallback: allow clicks anywhere if layer missing\r\n        const features = map.queryRenderedFeatures(point, {\r\n            layers: [DISTRICT_LAYER],\r\n        });\r\n        return features && features.length > 0;\r\n    }\r\n\r\n    function districtAtLngLat(lngLat) {\r\n        if (!map || !isDistrictLayerPresent()) return null;\r\n        const features = map.queryRenderedFeatures(map.project(lngLat), {\r\n            layers: [DISTRICT_LAYER],\r\n        });\r\n        return features && features.length > 0\r\n            ? features[0].properties?.name || features[0].id || null\r\n            : null;\r\n    }\r\n\r\n    function renderTopicMarkers() {\r\n        if (!map || !Array.isArray(topics) || !topics.length) return [];\r\n        const made = [];\r\n        const frag = document.createDocumentFragment();\r\n\r\n        topics.forEach((t) => {\r\n            try {\r\n                if (!t || !Array.isArray(t.coords) || t.coords.length !== 2)\r\n                    return;\r\n                const [lon, lat] = t.coords;\r\n                if (!Number.isFinite(lon) || !Number.isFinite(lat)) return;\r\n                const title = t.title || \"Untitled\";\r\n                const el = document.createElement(\"div\");\r\n                el.className = \"marker\";\r\n                el.innerHTML = `<div class=\"marker-label\">${title}</div><div class='marker-pulse'></div>`;\r\n                const m = new maplibregl.Marker({ element: el })\r\n                    .setLngLat([lon, lat])\r\n                    .setPopup(new maplibregl.Popup().setHTML(title))\r\n                    .addTo(map);\r\n                made.push(m);\r\n                frag.appendChild(el);\r\n            } catch {\r\n                /* ignore one bad topic */\r\n            }\r\n        });\r\n\r\n        // optional: attach to topicsContainer\r\n        try {\r\n            if (topicsContainer) topicsContainer.appendChild(frag);\r\n        } catch {}\r\n\r\n        return made;\r\n    }\r\n\r\n    function renderTopicAside() {\r\n        if (!Array.isArray(topics) || !topics.length || !topicsContainer)\r\n            return;\r\n        const grouped = topics.reduce((acc, t) => {\r\n            const key = t?.district || \"Unknown\";\r\n            (acc[key] ||= []).push(t);\r\n            return acc;\r\n        }, {});\r\n\r\n        const frag = document.createDocumentFragment();\r\n        Object.entries(grouped).forEach(([district, arr]) => {\r\n            const districtEl = document.createElement(\"div\");\r\n            districtEl.className = \"map-topics__district\";\r\n            districtEl.innerHTML = `<h3>${district}</h3>`;\r\n            arr.forEach((topic) => {\r\n                const item = document.createElement(\"div\");\r\n                item.className = \"map-topics__item\";\r\n                const safeTitle = topic.title || \"Untitled\";\r\n                const safeDesc = topic.desc || \"\";\r\n                item.innerHTML = `<a href=\"${topic.url}\" rel=\"noopener\">\r\n          <h4 class=\"map-topics__item-title\">${safeTitle}</h4>\r\n          <p class=\"map-topics__item-desc\">${safeDesc}</p>\r\n        </a>`;\r\n                districtEl.appendChild(item);\r\n            });\r\n            frag.appendChild(districtEl);\r\n        });\r\n\r\n        topicsContainer.innerHTML = \"\";\r\n        topicsContainer.appendChild(frag);\r\n    }\r\n\r\n    function installUIBindings() {\r\n        // toggle between topic list and new-topic asides via the board button\r\n        boardTrigger?.addEventListener(\"click\", (e) => {\r\n            e?.preventDefault?.();\r\n            layoutBoard?.classList.toggle(\"active\");\r\n            newTopicAside?.classList.remove(\"active\");\r\n        });\r\n    }\r\n\r\n    function onMouseMove(e) {\r\n        if (!cursor) return;\r\n        const outside = !pointIsInDistrict(e.point);\r\n        cursor.classList.toggle(\"out\", outside);\r\n        const { lng, lat } = e.lngLat;\r\n        cursor.dataset.coords = `${decimalToDMSString(\r\n            lng,\r\n            \"lon\",\r\n            4\r\n        )}, ${decimalToDMSString(lat, \"lat\", 4)}`;\r\n    }\r\n\r\n    function onMapClick(e) {\r\n        if (!map) return;\r\n\r\n        // ignore clicks on markers/popups\r\n        if (isMarkerElement(e.originalEvent?.target)) return;\r\n\r\n        // optionally constrain to district layer\r\n        if (!pointIsInDistrict(e.point)) return;\r\n\r\n        // drop/replace a temp marker\r\n        if (tempMarker) {\r\n            try {\r\n                tempMarker.remove();\r\n            } catch {}\r\n        }\r\n\r\n        const el = document.createElement(\"div\");\r\n        el.className = \"marker temp\";\r\n        el.innerHTML = `<div class=\"marker-label marker-label--temp\" hidden></div><div class='marker-pulse'></div>`;\r\n\r\n        tempMarker = new maplibregl.Marker({ element: el })\r\n            .setLngLat(e.lngLat)\r\n            .setPopup(\r\n                new maplibregl.Popup({ offset: 16 }).setText(\r\n                    `Lng: ${e.lngLat.lng.toFixed(\r\n                        6\r\n                    )}\\nLat: ${e.lngLat.lat.toFixed(6)}`\r\n                )\r\n            )\r\n            .addTo(map);\r\n\r\n        // zoom in a bit & center on click\r\n        map.easeTo({\r\n            zoom: Math.max(map.getZoom(), 16.4),\r\n            center: e.lngLat,\r\n            duration: 600,\r\n        });\r\n\r\n        // update aside via TopicController\r\n        const dist = districtAtLngLat(e.lngLat);\r\n        topicController?.moveNewTopic(e.lngLat, dist);\r\n        topicController?.openAside();\r\n\r\n        // if we have a subject, show it on the temp marker label\r\n        const currentSubject = topicController?.subjectInput?.value?.trim();\r\n        if (currentSubject) updateTempMarkerLabel(currentSubject);\r\n    }\r\n\r\n    function updateViewportConstraints() {\r\n        if (!map) return;\r\n        // Always notify MapLibre first\r\n        map.resize();\r\n\r\n        // Shift camera target a bit if any aside is open so focus stays visible\r\n        const leftAsideW = layoutBoard?.classList.contains(\"active\")\r\n            ? layoutBoard.offsetWidth || 0\r\n            : 0;\r\n        const rightAsideW = newTopicAside?.classList.contains(\"active\")\r\n            ? newTopicAside.offsetWidth || 0\r\n            : 0;\r\n        const netOffsetX = (rightAsideW - leftAsideW) / 2; // rough: move half the delta\r\n\r\n        // Recompute a slightly shifted maxBounds based on pixel offset → fraction\r\n        const { fx } = pxOffsetToLngLatFraction(mapHost, -netOffsetX, 0);\r\n        const base = INITIAL_BOUNDS;\r\n        const shifted = offsetBoundsByFraction(base, fx, 0);\r\n        try {\r\n            map.setMaxBounds(shifted);\r\n        } catch {}\r\n\r\n        // If we have a cached camera-from-bounds, refresh it\r\n        try {\r\n            cam = map.cameraForBounds(shifted, {\r\n                padding: { top: 32, right: 32, bottom: 32, left: 32 },\r\n                bearing: map.getBearing(),\r\n                pitch: map.getPitch(),\r\n                maxZoom: clamp(map.getZoom(), 6, 19),\r\n            });\r\n        } catch {}\r\n    }\r\n\r\n    function updateTempMarkerLabel(text) {\r\n        if (!tempMarker) return;\r\n        const el = tempMarker.getElement?.() || tempMarker._element || null;\r\n        if (!el) return;\r\n\r\n        let label = el.querySelector(\".marker-label\");\r\n        if (!label) {\r\n            label = document.createElement(\"div\");\r\n            label.className = \"marker-label marker-label--temp\";\r\n            el.prepend(label);\r\n        }\r\n        const t = (text || \"\").trim();\r\n        label.textContent = t;\r\n        label.hidden = !t.length; // affiche si non-vide\r\n    }\r\n\r\n    function open() {\r\n        try {\r\n            if (typeof mapAnimation === \"function\" && trigger && container) {\r\n                trigger.classList.add(\"active\");\r\n                container.classList.remove(\"onLoad\");\r\n                mapAnimation({ container });\r\n            }\r\n        } catch (err) {\r\n            console.error(\"[Map] mapAnimation error:\", err);\r\n        }\r\n    }\r\n\r\n    function close() {\r\n        const tl = safeGetTl();\r\n        if (tl) tl.timeScale(2).reverse();\r\n        trigger?.classList.remove(\"active\");\r\n        layoutBoard?.classList.remove(\"active\");\r\n        newTopicAside?.classList.remove(\"active\");\r\n    }\r\n\r\n    function onTriggerClick(e) {\r\n        e?.preventDefault?.();\r\n        const tl = safeGetTl();\r\n        if (tl && tl.progress() > 0 && !tl.reversed()) {\r\n            close();\r\n            return;\r\n        }\r\n        open();\r\n    }\r\n\r\n    function destroy() {\r\n        aborter.abort();\r\n        trigger?.removeEventListener(\"click\", onTriggerClick);\r\n        boardTrigger?.replaceWith(boardTrigger.cloneNode(true)); // drop listeners\r\n        if (map) {\r\n            try {\r\n                map.off(\"mousemove\", onMove);\r\n                map.off(\"click\", onMapClick);\r\n            } catch {}\r\n            try {\r\n                tempMarker?.remove();\r\n            } catch {}\r\n            try {\r\n                map.remove();\r\n            } catch {}\r\n            map = null;\r\n        }\r\n        try {\r\n            resizeObs?.disconnect();\r\n        } catch {}\r\n    }\r\n\r\n    // ---- init map\r\n    if (!maplibregl) {\r\n        console.error(\r\n            \"[Map] maplibregl missing. Inject the script before init.\"\r\n        );\r\n        return { open, close, destroy };\r\n    }\r\n\r\n    installUIBindings();\r\n\r\n    try {\r\n        map = new maplibregl.Map({\r\n            style: styleUrl,\r\n            center: INITIAL_CENTER,\r\n            pitch: 45,\r\n            bearing: -17.6,\r\n            container: mapHost || selectors.mapContainer,\r\n            canvasContextAttributes: { antialias: true },\r\n            attributionControl: false,\r\n            maxBounds: offsetBoundsByFraction(INITIAL_BOUNDS, -0.18, 0),\r\n            dragRotate: false,\r\n        });\r\n        window.map = map; // debug\r\n\r\n        // topic UI\r\n        topicController = new TopicController({ map });\r\n        topicController?.subjectInput?.addEventListener(\"input\", (e) => {\r\n            updateTempMarkerLabel(e.currentTarget.value);\r\n        });\r\n\r\n        onMove = rafThrottle(onMouseMove);\r\n        map.on(\"mousemove\", onMove);\r\n        map.on(\"click\", onMapClick);\r\n\r\n        map.on(\"load\", () => {\r\n            try {\r\n                cam = map.cameraForBounds(\r\n                    offsetBoundsByFraction(INITIAL_BOUNDS, -0.18, 0),\r\n                    {\r\n                        padding: { top: 32, right: 32, bottom: 32, left: 32 },\r\n                        bearing: -17.6,\r\n                        pitch: 45,\r\n                        maxZoom: 12.62,\r\n                    }\r\n                );\r\n                if (cam) map.jumpTo(cam);\r\n                map.easeTo({ ...cam, offset: [-600, 0], duration: 600 });\r\n            } catch {}\r\n\r\n            renderTopicMarkers();\r\n            renderTopicAside();\r\n            updateViewportConstraints();\r\n        });\r\n    } catch (err) {\r\n        console.error(\"[Map] init error:\", err);\r\n    }\r\n\r\n    trigger?.addEventListener(\"click\", onTriggerClick);\r\n\r\n    return { open, close, destroy };\r\n}\r\n","import { qs, qsa } from \"../core/utils.js\";\r\nimport {\r\n    navigationAnimation,\r\n    getGlobalTimeline,\r\n    clearGlobal,\r\n    mapAnimation,\r\n} from \"../animations/navigation.js\";\r\n\r\nimport { createMapController } from \"../ui/MapController.js\";\r\n\r\nconst els = {\r\n    menuButton: qs(document, \"#menu\"),\r\n    panel: qs(document, \"#board\"),\r\n    cursor: qs(document, \"#cursor\"),\r\n    cursorFollow: qs(document, \"#cursorFollow\"),\r\n    mapPanel: qs(document, \"#mapPanel\"),\r\n};\r\n\r\nexport function initLayoutScripts(opts = {}) {\r\n    // MAP\r\n    const mapCtrl = createMapController({\r\n        animations: { mapAnimation, getGlobalTimeline },\r\n    });\r\n    // Hooks Barba (optionnels si tu utilises Barba)\r\n    if (window.barba?.hooks) {\r\n        barba.hooks.beforeLeave(() => {\r\n            try {\r\n                mapCtrl.close();\r\n            } catch {}\r\n        });\r\n    }\r\n\r\n    return {\r\n        destroy() {\r\n            mapCtrl.destroy();\r\n        },\r\n        closeAll() {\r\n            mapCtrl.close();\r\n        },\r\n    };\r\n\r\n    initMap();\r\n}\r\n\r\nfunction page_type() {\r\n    const p = location.pathname;\r\n    if (/^\\/t[1-9][0-9]*(p[1-9][0-9]*)?-/.test(p)) return \"topic\";\r\n    if (/^\\/f[1-9][0-9]*(p[1-9][0-9]*)?-/.test(p)) return \"forum\";\r\n    if (\r\n        document\r\n            .querySelector(\"#i_icon_mini_index\")\r\n            ?.parentElement?.getAttribute(\"href\") === p ||\r\n        p === \"/\"\r\n    )\r\n        return \"index\";\r\n    if (/^\\/post/.test(p)) return \"editor\";\r\n    if (/^\\/c[1-9][0-9]*-/.test(p)) return \"category\";\r\n    const qs = p + location.search;\r\n    const m = qs.match(/\\/modcp\\?mode=([^&]+)/);\r\n    return m ? m[1] : \"\";\r\n}\r\n\r\nasync function defaultFetchForums() {\r\n    if (page_type() === \"index\") {\r\n        const el = document.querySelector(\"#js-board\");\r\n        if (el) el.innerHTML = \"\";\r\n    }\r\n    const res = await fetch(\"/\");\r\n    const html = await res.text();\r\n    const parser = new DOMParser();\r\n    return parser.parseFromString(html, \"text/html\");\r\n}\r\n\r\nfunction initMap() {\r\n    const trigger = qs(document, \"#navigate\");\r\n    const panel = qs(document, \"#map\");\r\n\r\n    async function onClick(e) {\r\n        e.preventDefault();\r\n\r\n        // Si une timeline est active, on ferme (reverse) comme dans menu.js\r\n        const tl =\r\n            (typeof getGlobalTimeline === \"function\" && getGlobalTimeline()) ||\r\n            null;\r\n        if (tl) {\r\n            trigger.classList.remove(\"active\");\r\n            tl.timeScale(2).reverse(); // fermeture accélérée\r\n            return;\r\n        }\r\n\r\n        // Ouverture\r\n        try {\r\n            trigger.classList.add(\"active\");\r\n\r\n            // Lance tes anims d'ouverture (doit définir window.globalTimeline en interne)\r\n            mapAnimation();\r\n        } catch (err) {\r\n            console.error(\"[HomeMenu] fetch/open error:\", err);\r\n        }\r\n    }\r\n\r\n    trigger.addEventListener(\"click\", onClick);\r\n\r\n    const map = new maplibregl.Map({\r\n        style: `http://127.0.0.1:8080/dark_matter.json`,\r\n        center: [4.905115848796186, 52.36171966529636], // Amsterdam\r\n        zoom: 12.64072662255258,\r\n        pitch: 45,\r\n        bearing: -17.6,\r\n        container: document.querySelector(\"#map-content\"),\r\n        canvasContextAttributes: { antialias: true },\r\n        attributionControl: false,\r\n        maxBounds: [\r\n            [4.737470306116194, 52.31534775089125],\r\n            [5.00319881008906, 52.4543176657192],\r\n        ],\r\n    });\r\n\r\n    map.on(\"load\", () => panel.classList.remove(\"onLoad\"));\r\n\r\n    if (!map) return;\r\n\r\n    map.on(\"mousemove\", (e) => {\r\n        // j'ai besoin d'avoir les coordonnées latitutde/longitude du point sous le curseur\r\n        const coords = e.lngLat;\r\n        console.log(`Longitude: ${coords.lng}, Latitude: ${coords.lat}`);\r\n        els.cursor.dataset.coords = `${coords.lng.toFixed(\r\n            5\r\n        )}, ${coords.lat.toFixed(5)}`;\r\n    });\r\n\r\n    map.on(\"click\", (e) => {\r\n        const t = e.originalEvent?.target;\r\n        if (t && t.closest(\".marker, .maplibregl-marker, .mapboxgl-marker\"))\r\n            return;\r\n        const popup = new maplibregl.Popup({ offset: 25 }).setText(\r\n            \"Construction on the Washington Monument began in 1848.\"\r\n        );\r\n\r\n        /* else, open side panel */\r\n        console.log(\"click map\", e.lngLat);\r\n        els.mapPanel.classList.add(\"active\");\r\n\r\n        // create DOM element for the marker\r\n        const el = document.createElement(\"div\");\r\n        el.className = \"marker\";\r\n        el.innerHTML = `<div class=\"marker-label\">Frankfurt</div><div class='marker-pulse'></div>`;\r\n\r\n        /* [\"click\", \"pointerdown\", \"pointerup\", \"mousedown\", \"mouseup\"].forEach(\r\n            (evt) => el.addEventListener(evt, (ev) => ev.stopPropagation())\r\n        ); */\r\n\r\n        // create the marker\r\n        new maplibregl.Marker({ element: el })\r\n            .setLngLat(e.lngLat)\r\n            .setPopup(popup) // sets a popup on this marker\r\n            .addTo(map);\r\n    });\r\n}\r\n","import Context from \"../core/context.js\";\r\nimport { qsa } from \"../core/utils.js\";\r\n\r\nconst DIRECTIONS = [\"top\", \"right\", \"bottom\", \"left\"];\r\nconst SYMBOLS = [\r\n    \"🜁\",\r\n    \"🜃\",\r\n    \"🜂\",\r\n    \"🜄\",\r\n    \"🜍\",\r\n    \"☿\",\r\n    \"🜔\",\r\n    \"☉\",\r\n    \"☿\",\r\n    \"♃\",\r\n    \"♁\",\r\n    \"♆\",\r\n    \"🜊\",\r\n    \"🜅\",\r\n    \"🜖\",\r\n    \"🜋\",\r\n    \"🜏\",\r\n    \"♈︎\",\r\n    \"♉︎\",\r\n    \"♊︎\",\r\n    \"♋︎\",\r\n    \"♌︎\",\r\n    \"♍︎\",\r\n    \"♎︎\",\r\n    \"♏︎\",\r\n    \"♐︎\",\r\n    \"♑︎\",\r\n    \"♒︎\",\r\n    \"♓︎\",\r\n];\r\n\r\nfunction randomlyAddedSymbols() {\r\n    const howMany = Math.floor(Math.random() * 4) + 1; // 1..4\r\n    const dirs = [...DIRECTIONS].sort(() => Math.random() - 0.5);\r\n    const out = [];\r\n    for (let i = 0; i < howMany; i++) {\r\n        out.push({\r\n            direction: dirs[i],\r\n            symbol: SYMBOLS[Math.floor(Math.random() * SYMBOLS.length)],\r\n        });\r\n    }\r\n    return out;\r\n}\r\n\r\nfunction escapeHTML(s) {\r\n    return s.replace(\r\n        /[&<>\"']/g,\r\n        (m) =>\r\n            ({\r\n                \"&\": \"&amp;\",\r\n                \"<\": \"&lt;\",\r\n                \">\": \"&gt;\",\r\n                '\"': \"&quot;\",\r\n                \"'\": \"&#39;\",\r\n            }[m])\r\n    );\r\n}\r\n\r\nfunction renderLetter(char) {\r\n    // Cas espace : pas de symboles, et la classe est .space\r\n    if (char === \" \") {\r\n        return `<span class=\"space\"><span>&nbsp;</span></span>`;\r\n    }\r\n\r\n    const extras = randomlyAddedSymbols();\r\n    const charHTML = escapeHTML(char);\r\n    const extraHTML = extras\r\n        .map(\r\n            ({ symbol, direction }) =>\r\n                `<i class=\"symbol ${direction}\" data-dir=\"${direction}\">${symbol}</i>`\r\n        )\r\n        .join(\"\");\r\n\r\n    return `<span class=\"letter\"><span class=\"e-letter\">${charHTML}</span><span class=\"t-letter\">${charHTML}</span><b></b>${extraHTML}</span>`;\r\n}\r\n\r\nexport function initEnochian(container = Context.container) {\r\n    console.log(\"enoch\");\r\n    // Initialize Enochian UI components here\r\n    qsa(container, \".enochian\").forEach((el) => {\r\n        // split each letter into a span\r\n        const text = el.textContent;\r\n        el.innerHTML = text\r\n            .toLowerCase()\r\n            /* replace tout ce qui n'est pas une lettre de a à z ou un espace */\r\n            .toString()\r\n            .normalize(\"NFD\")\r\n            .trim()\r\n            .replace(/[^a-z ]/g, \"\")\r\n            .split(\"\")\r\n            .map(renderLetter)\r\n            .join(\"\");\r\n    });\r\n}\r\n","import Context from \"../core/context.js\";\r\nimport CursorController from \"../ui/CursorController.js\";\r\nimport { initBarba, onNamespace, getRegisteredNamespaces } from \"./barba.js\";\r\n\r\nimport { initRegisterScripts } from \"../features/register.js\";\r\nimport { initTopicScripts } from \"../features/topic.js\";\r\nimport { initLayoutScripts } from \"../features/layout.js\";\r\nimport { initEnochian } from \"../ui/Enochian.js\";\r\n\r\n// ex:\r\n\r\nexport function initUI() {\r\n    document\r\n        .querySelectorAll('div[style^=\"height:\"')\r\n        .forEach((el) => el.remove());\r\n\r\n    Context.container =\r\n        document.querySelector('section[data-barba=\"container\"]') || document;\r\n\r\n    const cursor = CursorController.init();\r\n\r\n    initLayoutScripts();\r\n    onNamespace(\"register\", { afterEnter: async () => initRegisterScripts() });\r\n    onNamespace(\"topic\", {\r\n        afterEnter: async ({ next }) => {\r\n            initTopicScripts(next.container);\r\n            initEnochian(next.container);\r\n        },\r\n    });\r\n\r\n    console.debug(\"[barba] registered ns hooks:\", getRegisteredNamespaces());\r\n\r\n    initBarba({ cursor });\r\n\r\n    return { Context, cursor };\r\n}\r\n","// features/subject/SubjectScripts.js\r\n// Refactor minimal du bloc \"SubjectScripts\" depuis menu.js (comportement identique)\r\nimport Context from \"../core/context.js\";\r\nimport { qsa } from \"../core/utils.js\";\r\n\r\nexport function initTopicScripts(root = Context.container) {\r\n    const container = root || document;\r\n\r\n    /* Date with Tyme.js */\r\n    qsa(container, \".postbody__date-time\").forEach((el) => {\r\n        el.innerHTML = new Tyme(el).fromNow();\r\n    });\r\n    try {\r\n        /* ----------------------------\r\n         * EditorJS: normaliser les paragraphes\r\n         * ---------------------------- */\r\n        const messages = container.querySelectorAll(\".postbody\");\r\n        messages.forEach((message) => {\r\n            const content = message.querySelector(\".grid-content\");\r\n            if (!content) return;\r\n\r\n            const trim = (str) => str.replace(/^\\s+|\\s+$/g, \"\");\r\n            const arr = [];\r\n\r\n            for (let i = 0; i < content.childNodes.length; i++) {\r\n                const elem = content.childNodes[i];\r\n                if (elem.nodeType === 3) {\r\n                    const newElem = document.createElement(\"p\");\r\n                    newElem.innerHTML = trim(elem.nodeValue);\r\n                    elem.parentNode.insertBefore(newElem, elem.nextSibling);\r\n                    content.removeChild(elem);\r\n                    arr.push(newElem);\r\n                } else {\r\n                    arr.push(elem);\r\n                }\r\n            }\r\n\r\n            const paragraphs = arr\r\n                .filter((k) => k.nodeName !== \"BR\")\r\n                .filter((k) => k.nodeName === \"P\" && k.childNodes.length === 0);\r\n\r\n            const frag = document.createDocumentFragment();\r\n            for (let i = 0; i < paragraphs.length; ++i)\r\n                frag.appendChild(paragraphs[i]);\r\n            content.appendChild(frag);\r\n        });\r\n\r\n        /* ----------------------------\r\n         * Masquer des profils (œil) + localStorage\r\n         * ---------------------------- */\r\n        const appendToStorage = (name, data) => {\r\n            let list = JSON.parse(localStorage.getItem(name));\r\n            if (list == null) list = [];\r\n            const idx = list.indexOf(data);\r\n            if (idx === -1) list.push(data);\r\n            else list.splice(idx, 1);\r\n            localStorage.setItem(name, JSON.stringify(list));\r\n        };\r\n\r\n        const hideProfiles = () => {\r\n            const items = JSON.parse(localStorage.getItem(\"hiddenProfiles\"));\r\n            if (items === null) return;\r\n\r\n            if (items.length === 0) {\r\n                container\r\n                    .querySelectorAll(\".subject__profileAvatar\")\r\n                    .forEach((a) => {\r\n                        a.classList.remove(\"blurred\");\r\n                    });\r\n            }\r\n\r\n            items.forEach((u) => {\r\n                const avatars = container.querySelectorAll(\r\n                    `.subject__profileAvatar > a[href ^= \"/${u}\"]`\r\n                );\r\n                const removeOthers = container.querySelectorAll(\r\n                    `.subject__profileAvatar > a:not([href ^= \"/${u}\"])`\r\n                );\r\n                avatars.forEach((a) =>\r\n                    a\r\n                        .closest(\".subject__profileAvatar\")\r\n                        .classList.add(\"blurred\")\r\n                );\r\n                removeOthers.forEach((a) =>\r\n                    a\r\n                        .closest(\".subject__profileAvatar\")\r\n                        .classList.remove(\"blurred\")\r\n                );\r\n            });\r\n        };\r\n\r\n        container.querySelectorAll(\".subject__profileEye\").forEach((eye) => {\r\n            eye.addEventListener(\"click\", () => {\r\n                const u = eye\r\n                    .closest(\".subject__profileAvatar\")\r\n                    .querySelector('a[href^=\"/u\"]')\r\n                    .pathname.replace(/^./, \"\");\r\n                appendToStorage(\"hiddenProfiles\", u);\r\n                hideProfiles();\r\n            });\r\n        });\r\n        hideProfiles();\r\n\r\n        /* ----------------------------\r\n         * Triggers <tw> → #triggers\r\n         * ---------------------------- */\r\n        const nextBR = (elem) => {\r\n            do {\r\n                elem = elem.nextSibling;\r\n            } while (elem && elem.nodeType !== 1);\r\n            if (elem && elem.tagName === \"BR\") return elem;\r\n        };\r\n        /* const allTriggers = [];\r\n        const appendTriggers = () => {\r\n            const triggersContainer = container.querySelector(\"#triggers\");\r\n            const triggersEls = container.querySelectorAll(\"tw\");\r\n            if (!triggersContainer || !triggersEls.length) return;\r\n            triggersEls.forEach((el) => {\r\n                const triggersArr = el.textContent\r\n                    .split(\",\")\r\n                    .map((v) => v.trim());\r\n                triggersArr.forEach((t) => allTriggers.push(t));\r\n                nextBR(el)?.remove();\r\n                el.remove();\r\n            });\r\n            allTriggers.forEach((trigger, idx, array) => {\r\n                const text =\r\n                    idx === array.length - 1 ? trigger : trigger + \", \";\r\n                triggersContainer.innerHTML += text;\r\n            });\r\n        };\r\n        appendTriggers(); */\r\n\r\n        /* ----------------------------\r\n         * Helpers profil (nom/couleur/groupe)\r\n         * ---------------------------- */\r\n        const splitNames = (p) => {\r\n            const name = p.querySelector(\".username strong\");\r\n            if (!name) return null;\r\n            name.innerHTML = name.innerText\r\n                .split(\"\")\r\n                .map((e) =>\r\n                    !e.trim() ? \"<div>&nbsp</div>\" : \"<div>\" + e + \"</div>\"\r\n                )\r\n                .join(\"\");\r\n            return name;\r\n        };\r\n\r\n        const applyColorFromName = (name) => {\r\n            if (!name) return null;\r\n            const color = name.parentElement.style.color;\r\n            name.closest(\".subject__post\").style = \"--accentColor:\" + color;\r\n            return color;\r\n        };\r\n\r\n        const getGroup = (color) => {\r\n            const groups = {\r\n                djinn: \"rgb(255, 107, 139)\",\r\n                human: \"rgb(115, 169, 255)\",\r\n            };\r\n            return Object.keys(groups).find((key) => groups[key] === color);\r\n        };\r\n\r\n        /* ----------------------------\r\n         * Déplacement champs profil + Chart OCEAN\r\n         * ---------------------------- */\r\n        const pfields = container.querySelectorAll(\".pfield\");\r\n        pfields.forEach(function (field) {\r\n            var name = field.textContent\r\n                .split(\" \")[0]\r\n                .toLowerCase()\r\n                .replace(/'/g, \"\")\r\n                .replace(/\\(|\\)/g, \"\");\r\n            field.closest(\".pfield\").classList.add(name);\r\n        });\r\n        const moveField = (p, item, to) => {\r\n            const el = p.querySelectorAll(`.pfield.${item} `);\r\n            let value = \"\";\r\n            el.forEach((e) => {\r\n                value = e.querySelector(\".pcontent\")?.textContent || \"\";\r\n                e.closest(\".subject__profileWrapper\")\r\n                    .querySelector(to)\r\n                    ?.appendChild(e);\r\n            });\r\n            return value;\r\n        };\r\n\r\n        const createChart = (p, color, values) => {\r\n            const ctx = p.querySelector(\".subject__profileChart canvas\");\r\n            if (!ctx || !window.Chart) return null;\r\n            return new Chart(ctx, {\r\n                type: \"line\",\r\n                data: {\r\n                    labels: [\"O\", \"C\", \"E\", \"A\", \"N\"],\r\n                    datasets: [\r\n                        {\r\n                            data: values,\r\n                            borderWidth: 2,\r\n                            borderColor: color,\r\n                            fill: true,\r\n                            backgroundColor: color,\r\n                        },\r\n                    ],\r\n                },\r\n                options: {\r\n                    aspectRatio: 8,\r\n                    maintainAspectRatio: false,\r\n                    animations: {\r\n                        tension: {\r\n                            duration: 1000,\r\n                            easing: \"easeInQuad\",\r\n                            from: 0,\r\n                            to: 0.4,\r\n                            loop: true,\r\n                        },\r\n                    },\r\n                    scales: {\r\n                        y: { display: false, min: -10, max: 10 },\r\n                        x: { display: false },\r\n                    },\r\n                    layout: { padding: 0 },\r\n                    elements: { point: { pointRadius: 0 } },\r\n                    plugins: {\r\n                        tooltip: { enabled: false },\r\n                        title: { display: false },\r\n                        subtitle: { display: false },\r\n                        legend: { display: false },\r\n                    },\r\n                },\r\n            });\r\n        };\r\n\r\n        /* ----------------------------\r\n         * Symboles (hover / mapping)\r\n         * ---------------------------- */\r\n        const createSymbols = (p, group) => {\r\n            const symbolElements = p.querySelectorAll(\r\n                \".subject__profileSymbol\"\r\n            );\r\n            symbolElements.forEach((el) => {\r\n                const symbol = el.dataset.symbol;\r\n                el.addEventListener(\"mouseenter\", (e) => {\r\n                    const target = e.target\r\n                        .closest(\".subject__profileBlock\")\r\n                        .querySelector(\".subject__profileAvatar\");\r\n                    if (target) target.dataset.symbol = symbol;\r\n                });\r\n            });\r\n\r\n            const symbolList = p.querySelectorAll(\".subject__profileMeta\");\r\n            symbolList.forEach((el) => {\r\n                el.addEventListener(\"mouseenter\", (e) => {\r\n                    const target = e.target\r\n                        .closest(\".subject__profileBlock\")\r\n                        .querySelector(\".subject__profileAvatar\");\r\n                    target?.classList.add(\"symbol\");\r\n                });\r\n                el.addEventListener(\"mouseleave\", (e) => {\r\n                    const target = e.target\r\n                        .closest(\".subject__profileBlock\")\r\n                        .querySelector(\".subject__profileAvatar\");\r\n                    target?.classList.remove(\"symbol\");\r\n                });\r\n            });\r\n        };\r\n\r\n        const moveSymbol = (p, item, to, group) => {\r\n            const f = p.querySelectorAll(`.pfield.${item} `);\r\n            if (!f || !f.length) return;\r\n            const [name, desc] = f;\r\n\r\n            const labelName =\r\n                group == \"djinn\"\r\n                    ? (name\r\n                          .querySelector(\".plabel span[style]\")\r\n                          .textContent.split(\")\")[0] += \")\")\r\n                    : \"Vœu\";\r\n            const labelContent =\r\n                name.querySelector(\".pcontent\")?.textContent || \"\";\r\n            const description =\r\n                desc.querySelector(\".pcontent\")?.textContent || \"\";\r\n\r\n            const label = p.querySelector(\r\n                `.subject__symbolsTrack.${to} .label`\r\n            );\r\n            if (label) label.innerText = labelName;\r\n            const content = p.querySelector(\r\n                `.subject__symbolsTrack.${to} .content`\r\n            );\r\n            if (content) content.innerText = labelContent;\r\n            const descr = p.querySelector(`.subject__symbolsTrack.${to} .desc`);\r\n            if (descr) descr.innerText = description;\r\n        };\r\n\r\n        /* ----------------------------\r\n         * Application sur chaque bloc profil\r\n         * ---------------------------- */\r\n        const allProfiles = container.querySelectorAll(\r\n            \".subject__profileBlock\"\r\n        );\r\n        allProfiles.forEach((profile) => {\r\n            const name = splitNames(profile);\r\n            const color = applyColorFromName(name);\r\n            const group = getGroup(color);\r\n            const chartValues = [];\r\n\r\n            const ocean = [\r\n                \"ouverture\",\r\n                \"conscienciosité\",\r\n                \"extraversion\",\r\n                \"agréabilité\",\r\n                \"neuroticisme\",\r\n            ];\r\n            const fields = {\r\n                messages: \".subject__profileNumbers\",\r\n                points: \".subject__profileNumbers\",\r\n\r\n                ouverture: \".subject__profileChart div\",\r\n                conscienciosité: \".subject__profileChart div\",\r\n                extraversion: \".subject__profileChart div\",\r\n                agréabilité: \".subject__profileChart div\",\r\n                neuroticisme: \".subject__profileChart div\",\r\n\r\n                âge: \".subject__profileFacts\",\r\n                pronoms: \".subject__profileFacts\",\r\n                faceclaim: \".subject__profileFacts\",\r\n\r\n                citation: \".subject__profileQuote\",\r\n            };\r\n\r\n            for (const [key, to] of Object.entries(fields)) {\r\n                const content = moveField(profile, key, to);\r\n                if (ocean.indexOf(key) > -1)\r\n                    chartValues.push(Number(content) || 0);\r\n            }\r\n\r\n            createChart(profile, color, chartValues);\r\n            createSymbols(profile, group);\r\n            moveSymbol(profile, \"salt\", \"body\", group);\r\n            moveSymbol(profile, \"mercury\", \"mind\", group);\r\n            moveSymbol(profile, \"sulfur\", \"soul\", group);\r\n        });\r\n    } catch (e) {\r\n        console.log(e);\r\n    }\r\n}\r\n","import { initUI } from \"./init/app.js\";\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n    initUI();\r\n});\r\n"],"names":["Context","hooks","currentIndex","container","update","console","log","value","useState","initialValue","idx","newValue","useReducer","reducer","initialState","action","useEffect","callback","deps","prevDeps","hasNoDeps","hasChanged","every","el","i","qsa","root","sel","querySelectorAll","qs","querySelector","CONFIG","focus","shrink","follow","fade","text","forum","btn","profileSymbol","barbaContainer","progressPath","cursor","cursorFollow","postbody","forumEl","link","map","getRectData","rect","getBoundingClientRect","x","left","y","top","w","width","h","height","setOpacity","animate","opacity","duration","fill","CursorController","document","forums","stopFollow","init","this","bindEvents","bindScroll","addEventListener","e","pageX","leftPosition","pageY","topPosition","target","Element","style","updateCursorBadges","matches","handleBtnFocus","handleProfileSymbolFocus","resetFollowSize","classList","remove","gsap","to","ease","dataset","barba","updateProgress","host","closest","contains","relatedTarget","killTweensOf","add","element","len","pathLength","strokeDasharray","currentContainer","scroll","scrollTop","scrollHeight","window","innerHeight","progress","strokeDashoffset","getTotalLength","_ease","ensureEase","CustomEase","registerPlugin","parseEase","create","he","transform","autoAlpha","animateLinesIn","onDone","tl","timeline","onComplete","forEach","delay","globalTimeline","getGlobalTimeline","mapAnimation","kill","defaults","onReverseComplete","r","o","ft","targets","fromVars","toVars","pos","list","length","undefined","fromTo","stagger","setGlobalTimeline","Badge","constructor","options","badgeClass","badgeCounterClass","animationSpeed","countLimit","activeClass","limitClass","badgeElement","badgeCounterElement","renderIfNeeded","error","wrapper","createElement","className","innerHTML","appendChild","set","n","Number","isNaN","textContent","oldEl","String","trim","newEl","cloneNode","after","requestAnimationFrame","setTimeout","get","parseInt","increase","decrease","Math","max","destroy","wrap","CFG","_initialized","_nsHooks","Map","onNamespace","ns","handlers","initBarba","warn","menu","getElementById","notificationBadge","prevent","hasAttribute","transitions","name","beforeOnce","data","done","async","next","namespace","once","debug","afterEnter","contents","alpha","before","current","opts","items","contentsOut","leave","animateLinesOut","enter","nextContainer","nextPath","rebindProgressPath","contentsIn","clear","parseFieldset","fieldset","dls","dl","dt","title","replace","slug","toString","toLowerCase","normalize","input","type","tagName","validate","inputHTML","originalHTML","updateIframeRegister","event","iframe","currentTarget","doc","contentDocument","contentWindow","url","location","href","cpMain","html","fieldsets","step","htmlDoc","includes","computeRegisterStep","steps","accountFieldset","profileFieldset","panel","siblings","parentNode","firstChild","nodeType","push","nextSibling","getSiblings","s","goToStep","Promise","deletePanelContent","offsetBoundsByFraction","bounds","fx","fy","sw","getSouthWest","ne","getNorthEast","dLng","lng","dLat","lat","maplibregl","LngLatBounds","decimalToDMSString","precision","pad","d","m","hemi","padStart","toFixed","formatDMS","v","abs","floor","mFloat","p","toDMS","TopicController","topicsContainerSelector","newTopicAsideSelector","topicsContainer","asideContainer","toggleButton","isCreating","isAsideOpened","subjectInput","messageInput","coordsInput","districtInput","coordsDecimalEl","coordsDMSEl","_bindAsideEvents","_loadState","toggleAside","key","closeAside","sync","_saveState","saved","localStorage","getItem","coords","district","subject","message","JSON","parse","_updateCoordDisplays","payload","setItem","stringify","lngLat","Array","isArray","initNewTopic","openAside","moveNewTopic","setDistrict","createMapController","styleUrl","selectors","trigger","mapContainer","board","topics","layoutBoard","newTopic","animations","forumId","topicsLimit","mapHost","boardTrigger","newTopicAside","aborter","AbortController","limit","signal","res","fetch","credentials","DOMParser","parseFromString","from","slice","a","getAttribute","URL","origin","row","author","replies","last","desc","mId","match","id","where","lon","parseFloat","isFinite","filter","Boolean","fetchForumTopics","cam","tempMarker","onMove","topicController","DISTRICT_LAYER","INITIAL_BOUNDS","INITIAL_CENTER","safeGetTl","isDistrictLayerPresent","getStyle","layers","some","l","pointIsInDistrict","point","features","queryRenderedFeatures","onMapClick","isMarkerElement","originalEvent","Marker","setLngLat","setPopup","Popup","offset","setText","addTo","easeTo","zoom","getZoom","center","dist","project","properties","districtAtLngLat","currentSubject","updateTempMarkerLabel","getElement","_element","label","prepend","t","hidden","open","err","close","timeScale","reverse","onTriggerClick","preventDefault","reversed","abort","removeEventListener","replaceWith","off","toggle","pitch","bearing","canvasContextAttributes","antialias","attributionControl","maxBounds","dragRotate","fn","ticking","args","apply","rafThrottle","outside","on","cameraForBounds","padding","right","bottom","maxZoom","jumpTo","made","frag","createDocumentFragment","setHTML","renderTopicMarkers","grouped","reduce","acc","Object","entries","arr","districtEl","topic","item","safeTitle","safeDesc","renderTopicAside","resize","leftAsideW","offsetWidth","netOffsetX","pxX","pxY","clientWidth","clientHeight","pxOffsetToLngLatFraction","shifted","setMaxBounds","getBearing","getPitch","min","updateViewportConstraints","DIRECTIONS","SYMBOLS","renderLetter","char","extras","howMany","random","dirs","sort","out","direction","symbol","randomlyAddedSymbols","charHTML","join","initUI","mapCtrl","beforeLeave","initLayoutScripts","iFrame","initRegisterScripts","Tyme","fromNow","content","str","childNodes","elem","newElem","nodeValue","insertBefore","removeChild","paragraphs","k","nodeName","appendToStorage","indexOf","splice","hideProfiles","u","avatars","removeOthers","eye","pathname","splitNames","innerText","split","applyColorFromName","color","parentElement","getGroup","groups","djinn","human","keys","find","field","moveField","createChart","values","ctx","Chart","labels","datasets","borderWidth","borderColor","backgroundColor","aspectRatio","maintainAspectRatio","tension","easing","loop","scales","display","layout","elements","pointRadius","plugins","tooltip","enabled","subtitle","legend","createSymbols","group","moveSymbol","f","labelName","labelContent","description","descr","profile","chartValues","ocean","fields","messages","points","ouverture","extraversion","neuroticisme","pronoms","faceclaim","citation","initTopicScripts","initEnochian"],"mappings":"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"}