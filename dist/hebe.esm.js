import"https://cdn.jsdelivr.net/npm/localforage@1.10.0/+esm";const e=function(){let e=[],t=0,o=null;const r=()=>{console.log("Context updated!")};return{get container(){return o},set container(e){o=e,t=0},useState(o){const n=t++;e[n]=e[n]??o;return[e[n],t=>{e[n]="function"==typeof t?t(e[n]):t,r()}]},useReducer(o,n){const s=t++;e[s]=e[s]??n;return[e[s],t=>{e[s]=o(e[s],t),r()}]},useEffect(o,r){const n=t++,s=e[n],a=!r,i=!s||!r.every((e,t)=>e===s[t]);(a||i)&&(e[n]=r,o())}}}(),t=(e,t)=>e.querySelectorAll(t),o=(e,t)=>e.querySelector(t),r=40,n="power4",s={focus:.5,shrink:.2,follow:.6,fade:300},a={text:".txt, .txt *, .ce-block__content, .ce-block__content *, textarea, input",forum:".forum, .forum *",btn:".btn, .btn *",profileSymbol:".subject__profileSymbol",barbaContainer:'section[data-barba="container"]',progressPath:".progress-wrap path",cursor:"#cursor",cursorFollow:"#cursorFollow",postbody:".postbody",forumEl:".forum",link:"a[href]:not(.no-cursor):not(:where(.btn *)):not(.btn), a[href]:not(.no-cursor):not(:where(.btn *)) *, .marker, .marker *",map:"#map canvas"};function i(e){const t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}}function c(e,t){e.animate({opacity:t},{duration:s.fade,fill:"forwards"})}const l={cursor:document.querySelector(a.cursor),cursorFollow:document.querySelector(a.cursorFollow),postbody:document.querySelectorAll(a.postbody),progressPath:document.querySelector(a.progressPath),forums:document.querySelectorAll(a.forumEl),stopFollow:!1,init(){this.bindEvents(),this.bindScroll()},bindEvents(){document.addEventListener("mouseenter",()=>{c(this.cursor,1),c(this.cursorFollow,1)}),document.addEventListener("mouseleave",()=>{c(this.cursor,0),c(this.cursorFollow,0)}),document.addEventListener("mousemove",e=>{const{pageX:t,pageY:o,target:r}=e;r instanceof Element&&(this.cursor.style.left=t+"px",this.cursor.style.top=o+"px",this.updateCursorBadges(r),r.matches(a.btn)?this.handleBtnFocus(r):r.matches(a.profileSymbol)?this.handleProfileSymbolFocus(r):this.resetFollowSize(),this.stopFollow||(this.cursorFollow.classList.remove("static"),this.cursor.classList.remove("hide"),gsap.to(this.cursorFollow,{top:o,left:t,duration:s.follow,ease:n})))}),document.addEventListener("scroll",e=>{"container"===e.target.dataset.barba&&this.updateProgress()},!0),document.addEventListener("pointerleave",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest(".btn, .subject__profileSymbol");t&&(t.contains(e.relatedTarget)||(this.stopFollow=!1,this.cursorFollow.classList.remove("static","large"),this.cursor.classList.remove("hide","grow"),gsap.killTweensOf(this.cursorFollow),gsap.killTweensOf(this.cursor),gsap.to(this.cursorFollow,{width:40,height:40,duration:.5,ease:"circ.out"})))},!0)},updateCursorBadges(e){e.matches(a.text)?this.cursor.classList.add("text"):this.cursor.classList.remove("text"),e.matches(a.forum)?this.cursor.classList.add("eye"):this.cursor.classList.remove("eye"),e.matches(a.link)?(this.cursor.classList.add("grow"),this.cursorFollow.classList.add("large")):(this.cursor.classList.remove("grow"),this.cursorFollow.classList.remove("large")),e.matches(a.map)?(this.cursor.classList.add("crosshair"),this.cursorFollow.classList.add("shrink")):(this.cursor.classList.remove("crosshair"),this.cursorFollow.classList.remove("shrink"))},handleBtnFocus(e){this.stopFollow=!0;const t=e.closest(".btn"),{x:o,y:r,w:a,h:c}=i(t);this.cursorFollow.classList.add("static"),gsap.to(this.cursorFollow,{top:r+c/2,left:o+a/2,width:a,height:c,duration:s.focus,ease:n})},handleProfileSymbolFocus(e){this.stopFollow=!0;const t=e.closest(".subject__profileSymbol"),{x:o,y:r,w:a,h:c}=i(t);gsap.to(this.cursorFollow,{top:r+c/2,left:o+a/2,width:a,height:c,duration:s.focus,ease:n})},resetFollowSize(){this.stopFollow=!1,gsap.to(this.cursorFollow,{width:r,height:r,duration:s.shrink,ease:n})},bindScroll(){if(!this.progressPath)return;const e=this.pathLength();this.progressPath.style.strokeDasharray=`${e} ${e}`,this.updateProgress()},currentContainer:()=>document.querySelector(a.barbaContainer),updateProgress(){if(!this.progressPath)return;const e=this.currentContainer();if(!e)return;const t=e.scrollTop,o=e.scrollHeight-window.innerHeight,r=this.pathLength()-t*this.pathLength()/o;this.progressPath.style.strokeDashoffset=r},pathLength(){return this.progressPath.getTotalLength()}};let u=null;function d(){if(!window.gsap)return null;if(u)return u;try{window.CustomEase&&(gsap.registerPlugin(CustomEase),u=gsap.parseEase?.("custom")||CustomEase.create("custom","M0,0,C0.625,0,0,1,1,1"))}catch{}return u||(u="power4.out"),u}const m={transform:"scaleX(0)"},p={transform:"scaleX(1)"},h={left:0,width:"100%"},f={left:"100%",width:"0%"},g={autoAlpha:0},b={autoAlpha:1},y={height:"0%"},v={height:"100%"},w={width:"0%"},C={width:"100%"},L=(e,t)=>e.querySelectorAll(t);function S(e=document,t){const o=d();if(!window.gsap||!o)return void t?.();const r=gsap.timeline({ease:o,onComplete:t});return L(e,".bb").forEach((e,t)=>r.to(e,{width:"100%",duration:.2,delay:.03*t},"h")),L(e,".br").forEach((e,t)=>r.to(e,{height:"100%",duration:.2,delay:.03*t},"v")),L(e,".bl").forEach((e,t)=>r.to(e,{height:"100%",duration:.2,delay:.03*t},"v")),L(e,".bt").forEach((e,t)=>r.to(e,{width:"100%",duration:.2,delay:.03*t},"h")),L(e,".bg-hash-v").forEach((e,t)=>r.to(e,{width:"100%",duration:.4},"h")),r}let _=null;const E=()=>_;function x({container:e}){const r=d();if(!window.gsap||!r)return null;const n=o(document,"#map");try{_?.kill()}catch{}const s=gsap.timeline({defaults:{duration:1,ease:r},onReverseComplete:()=>{_=null,e.classList.add("onLoad")}}),a=t(n,".anim-bg-cover"),i=t(n,".anim-bg"),c=t(n,".anim-fade");t(n,".anim-fadeFromLeft-50"),t(n,".anim-fadeUp");const l=t(n,".anim-bb, .anim-bt"),u=t(n,".anim-br, .anim-bl"),L=(e,t,o,r)=>{return(n=e)&&n.length>0?void 0!==r?s.fromTo(e,t,o,r):s.fromTo(e,t,o):s;var n};return L(a,m,p),L(a,h,f,.7),L(i,m,p,.7),L(c,g,{...b,stagger:.033},1.7),L(l,w,{...C,stagger:.033},1.7),L(u,y,{...v,stagger:.033},1.7),(e=>{_=e})(s),s}class q{constructor(e,t={}){this.options={badgeClass:"notification-badge",badgeCounterClass:"notification-counter",animationSpeed:150,countLimit:99,activeClass:"notification-badge--active",limitClass:"notification-badge--limit",...t},e?(this.element=e,this.badgeElement=null,this.badgeCounterElement=null,this.renderIfNeeded()):console.error("[Badge] host element is null/undefined.")}renderIfNeeded(){let e=this.element.querySelector("."+this.options.badgeClass);e||(e=document.createElement("span"),e.className=this.options.badgeClass,e.innerHTML=`<span class="${this.options.badgeCounterClass}">0</span>`,this.element.appendChild(e)),this.badgeElement=e,this.badgeCounterElement=e.querySelector("."+this.options.badgeCounterClass)}set(e=0){if(!this.element)return!1;if(this.renderIfNeeded(),"number"!=typeof e||Number.isNaN(e)||e<0)return console.error(`[Badge] invalid value: ${e}`),this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;if(0===e)return this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;e>this.options.countLimit?this.badgeElement?.classList.add(this.options.limitClass):this.badgeElement?.classList.remove(this.options.limitClass),this.badgeElement&&!this.badgeElement.classList.contains(this.options.activeClass)&&this.badgeElement.classList.add(this.options.activeClass);const t=this.badgeCounterElement;if(!t)return!1;if(String(t.textContent).trim()===String(e))return!0;const o=t.cloneNode(!1);return o.textContent=e,o.classList.add(this.options.badgeCounterClass+"--new"),t.classList.add(this.options.badgeCounterClass+"--old"),t.after(o),requestAnimationFrame(()=>{o.classList.remove(this.options.badgeCounterClass+"--new"),setTimeout(()=>{try{t.remove()}catch{}this.badgeCounterElement=o},this.options.animationSpeed)}),!0}get(){const e=parseInt(this.badgeCounterElement?.textContent||"0",10);return Number.isNaN(e)?0:e}increase(e=1){return this.set(this.get()+e)}decrease(e=1){return this.set(Math.max(0,this.get()-e))}destroy(){if(!this.element)return;const e=this.element.querySelector("."+this.options.badgeClass);e&&e.remove(),this.badgeElement=null,this.badgeCounterElement=null,this.element=null}}const A='section[data-barba="container"]',j=".progress-wrap path";let k=!1;const F=new Map;function N(e,t){F.set(e,{...t||{}})}function T({cursor:t}={}){if(k)return{destroy:M};if(k=!0,!window.barba?.init){console.warn("[barba] introuvable. Charge @barba/core avant initBarba().");const t=document.querySelector(A)||document;return e.container=t,S(t,()=>{}),{destroy:M}}e.container=document.querySelector(A)||document;const o=document.getElementById("menu"),r=o?.querySelector(".notification"),n=new q(r);return barba.init({prevent:({el:e})=>e?.hasAttribute?.("data-barba-prevent"),transitions:[{name:"lines-and-reveal",beforeOnce(e){const t=this.async(),o=e?.next?.namespace,r=o?F.get(o):null;try{r?.beforeOnce?.(e)}catch(e){console.error("[barba:beforeOnce ns]",e)}S(e.next.container,t),n.set(5)},once(e){console.debug("[barba] once ns=",e?.next?.namespace);const t=e?.next?.namespace,o=t?F.get(t):null;try{o?.once?.(e),o?.afterEnter?.(e)}catch(e){console.error("[barba:once ns hook]",e)}const r=this.async(),n=e.next.container.querySelectorAll(".content, .contents");n.length?gsap.to(n,{alpha:1,stagger:.03,onComplete:r}):r()},before(e){const t=e?.current?.namespace,o=t?F.get(t):null;try{o?.before?.(e)}catch(e){console.error("[barba:before ns]",e)}const r=this.async();(function(e=document,t={}){const o=e.querySelectorAll(".content, .contents");return o&&0!==o.length?gsap.to(o,{alpha:0,stagger:.03,...t}):null})(e.current.container,{onComplete:r})||r()},async leave(e){const t=e?.current?.namespace,o=t?F.get(t):null;if(o?.leave)try{await o.leave(e)}catch(e){console.error("[barba:leave]",e)}const r=this.async();!function(e=document,t){const o=d();if(!window.gsap||!o)return void t?.();const r=gsap.timeline({ease:o,onComplete:t});L(e,".br").forEach((e,t)=>r.to(e,{top:t%2?0:"+=100%",height:0,duration:.2,delay:.03*t},"v")),L(e,".bl").forEach((e,t)=>r.to(e,{top:t%2?0:"+=100%",height:0,duration:.2,delay:.03*t},"v")),L(e,".bb").forEach((e,t)=>r.to(e,{left:t%2?0:"+=100%",width:0,duration:.2,delay:.03*t},"h")),L(e,".bg-hash-v").forEach((e,t)=>r.to(e,{width:"0%",duration:.4},"h"))}(e.current.container,r)},async enter(o){console.debug("[barba] enter ns=",o?.next?.namespace),e.container=o.next.container,function(e,t){if(!t||!t.progressPath)return;const o=e?.querySelector?.(j);o&&(t.progressPath=o);try{const e=t.pathLength();t.progressPath.style.strokeDasharray=`${e} ${e}`,t.updateProgress()}catch{}}(o.next.container,t);const r=o?.next?.namespace,n=r?F.get(r):null;if(n?.enter)try{await n.enter(o)}catch(e){console.error("[barba:enter]",e)}const s=this.async();S(o.next.container,()=>{o.next.container,s()})},afterEnter(e){console.debug("[barba] afterEnter ns=",e?.next?.namespace);const t=e?.next?.namespace,o=t?F.get(t):null;try{o?.afterEnter?.(e)}catch(e){console.error("[barba:afterEnter]",e)}const r=this.async();(function(e=document,t={}){const o=e.querySelectorAll(".content, .contents");return o&&0!==o.length?gsap.to(o,{alpha:1,stagger:.03,...t}):null})(e.next.container,{onComplete:r})||r()}}]}),{destroy:M}}function M(){try{barba&&barba.destroy&&barba.destroy()}catch{}F.clear(),k=!1}function $(e){const t=e?.querySelectorAll?.("dl")||[],o={};return t.forEach(e=>{const t=e.querySelector("dt"),r=(t?.textContent||"").replace(/[*:]/g,""),n=r.toString().toLowerCase().normalize("NFD").trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-");const s=e.querySelector("dd input, dd textarea, dd select");if(s){const t=s.tagName.toLowerCase(),a="select"===t?s.value:(s.value||"").trim();o[n]={title:r,type:t,value:a,validate:()=>!0,inputHTML:s,originalHTML:e}}}),o}async function P(e){const t=e?.currentTarget;if(!t)return;const o=t.contentDocument||t.contentWindow?.document,r=t.contentWindow?.location?.href||"";if(!o)return;const n=o.querySelector("#cp-main");if(!n)return;const s=n.cloneNode(!0),a=s.querySelectorAll("fieldset"),i=t.closest('section[data-barba="container"]')||document,c=function(e="",t=document){let o=1;return e.includes("step=2")&&(o=2),t.querySelector("form#form_confirm")&&(o=6),t.querySelector(".randommessageclass")&&(o=7),o}(r,s),l={1:()=>{},2:async()=>{var e,t;a.length>=2&&(e=a[0],t=a[1],$(e),$(t)),function(e,t){const o=e.querySelector(`.register__panel:nth-child(${t})`);o&&((e=>{const t=[];if(!e?.parentNode)return t;let o=e.parentNode.firstChild;for(;o;)1===o.nodeType&&o!==e&&t.push(o),o=o.nextSibling;return t})(o).forEach(e=>e.classList.remove("isOpen")),o.classList.add("isOpen"))}(i,2),await new Promise(e=>setTimeout(e,400)),function(e,t){const o=e.querySelector(`.register__panel:nth-child(${t}) .register__panelContentWrapper`);o?.remove()}(i,1)},3:()=>{},6:()=>{},7:()=>{}};l[c]&&await l[c]()}class B{constructor({map:e}){this.map=e,this.topicsContainer=o(document,".map__asideContainer.topicList"),this.asideContainer=o(document,".map__asideContainer.newTopic"),this.isCreating=!1,this.isAsideOpened=!1}initNewTopic(e,t){this.isCreating={coords:e,district:t},this.openAside(),this.moveNewTopic()}moveNewTopic(e,t){this.isCreating={coords:e,district:t},this.openAside()}toggleAside(){this.isAsideOpened=!this.isAsideOpened,this.isAsideOpened?this.openAside():this.closeAside()}openAside(){this.asideContainer.classList.add("active"),this.topicsContainer.classList.remove("active")}closeAside(){this.asideContainer.classList.remove("active"),this.isCreating=!1}}function O(e,t="lat",o=4,r=!0){return function({d:e,m:t,s:o,hemi:r,type:n},{precision:s=4,pad:a=!0}={}){return`${String(e).padStart("lon"===n?3:2,"0")}° ${a?String(t).padStart(2,"0"):String(t)}' ${a?Number(o).toFixed(s).padStart(s?4+s:2,"0"):Number(o).toFixed(s)}" ${r}`}(function(e,t="lat",o=4){const r="lat"===t?e>=0?"N":"S":e>=0?"E":"W";let n=Math.abs(Number(e)),s=Math.floor(n),a=60*(n-s),i=Math.floor(a),c=60*(a-i);const l=Math.max(0,0|o);return c=Number(c.toFixed(l)),c>=60&&(c-=60,i+=1),i>=60&&(i-=60,s+=1),{d:s,m:i,s:c,hemi:r,type:t}}(e,t,o),{precision:o,pad:r})}const H=()=>E()||null;async function I({styleUrl:e="http://127.0.0.1:8080/dark_matter.json",selectors:t={trigger:"#navigate",container:"#map",mapContainer:"#map-content",board:"#board",cursor:"#cursor",topics:"#map-topics",layoutBoard:".map__asideContainer.topicList",newTopic:".map__asideContainer.newTopic"},animations:r={},forumId:n=1,topicsLimit:s=12}){const{mapAnimation:a}=r,i=o(document,t.trigger),c=o(document,t.container),l=o(document,t.cursor),u=o(document,t.board),d=o(document,t.topics),m=o(document,t.layoutBoard),p=o(document,t.newTopic);let h=!1,f=null,g=null;i&&c||console.warn("[Map] Sélecteurs introuvables:",t);let b=null,y=null,v=(await async function({forumId:e=1,limit:t=12}={}){try{const o=await fetch(`/f${e}-`,{credentials:"same-origin"}),r=await o.text(),n=(new DOMParser).parseFromString(r,"text/html"),s=Array.from(n.querySelectorAll("a.topictitle")).slice(0,t).map(e=>{const t=e.getAttribute("href"),o=new URL(t,location.origin).href,r=e.closest(".row"),n=r?.querySelector(".username, .topic-author a")?.textContent?.trim()||"",s=r?.querySelector(".posts, .topic-replies")?.textContent?.trim()||"",a=r?.querySelector(".lastpost, .topic-lastpost, .gensmall")?.textContent?.trim()||"",i=r?.querySelector(".topic-description")?.textContent?.trim()||"",c=o.match(/t(\d+)-/)[1]||"",l=i.match(/\[(.+?), ?(.+?)\]/);if(!l)return null;const[u,d]=l.slice(1).map(parseFloat),m=i.match(/"([^"]+)"/)?.[1]||"";return{title:e.textContent.trim(),id:c,desc:i,district:m,url:o,author:n,replies:s,last:a,coords:[Number(u),Number(d)]}});if(s.length)return s}catch(e){console.log(e)}return[]}({forumId:n,limit:s})).filter(Boolean),w=null;function C(e){if(b&&L(e.point)){g&&g.remove();const t=e.originalEvent?.target;if(t&&t.closest(".marker, .maplibregl-marker, .mapboxgl-marker"))return;const o=new maplibregl.Popup({offset:25}).setText("Longitude : "+e.lngLat.lng+", Latitude : "+e.lngLat.lat),r=document.createElement("div");r.className="marker",r.classList.add("temp"),r.innerHTML="<div class='marker-pulse'></div>";const n=new maplibregl.Marker({element:r}).setLngLat(e.lngLat).setPopup(o).addTo(b);b.easeTo({...y,zoom:Math.max(b.getZoom(),16.6),center:e.lngLat,duration:600}),g=n,f.moveNewTopic(e.lngLat)}}function L(e){if(!b)return!1;const t=b.queryRenderedFeatures(e,{layers:["districts-fill"]});return t&&t.length>0}function S(){try{"function"==typeof a&&(i.classList.add("active"),c.classList.remove("onLoad"),a({container:c}))}catch(e){console.error("[Map] mapAnimation erreur:",e)}}function _(){const e=H();e&&e.timeScale(2).reverse(),i.classList.remove("active"),m?.classList.remove("active")}function E(e){e?.preventDefault?.();const t=H();t&&t.progress()>0&&!t.reversed()?_():S()}return function(){if(b)return;if(u?.addEventListener("click",e=>{e?.preventDefault?.(),m?.classList.toggle("active"),p?.classList.remove("active"),h=!h,console.log(h)}),!maplibregl)return void console.error("[Map] maplibregl manquant. Injection requise.");try{const t=[4.89361,52.37278],o=function(e,t=0,o=0){const r=e.getSouthWest(),n=e.getNorthEast(),s=(n.lng-r.lng)*t,a=(n.lat-r.lat)*o;return new maplibregl.LngLatBounds([r.lng+s,r.lat+a],[n.lng+s,n.lat+a])}(new maplibregl.LngLatBounds([4.825,52.33],[5.015,52.397]),-.18,0);b=new maplibregl.Map({style:e,center:t,pitch:45,bearing:-17.6,container:document.querySelector("#map-content"),canvasContextAttributes:{antialias:!0},attributionControl:!1,maxBounds:o,dragRotate:!1}),window.map=b,f=new B({map:b,topicsContainer:d}),w=function(e){let t=!1;return function(...o){t||(t=!0,requestAnimationFrame(()=>{e.apply(this,o),t=!1}))}}(e=>{if(!l)return;L(e.point)?l.classList.remove("out"):l.classList.add("out");const{lng:t,lat:o}=e.lngLat;l.dataset.coords=`${O(t,"lon",4)}, ${O(o,"lat",4)}`}),b.on("mousemove",w),b.on("click",C),b.on("load",()=>{y=b.cameraForBounds(o,{padding:{top:32,right:32,bottom:32,left:32},bearing:-17.6,pitch:45,maxZoom:12.623168426705108}),y&&b.jumpTo(y),b.easeTo({...y,offset:[-600,0],duration:600}),b&&Array.isArray(v)&&v.length&&v.filter(e=>e&&Array.isArray(e.coords)&&2===e.coords.length).map(e=>{const t=e.title||"Untitled",o=document.createElement("div");return o.className="marker",o.innerHTML=`<div class="marker-label">${t}</div><div class='marker-pulse'></div>`,new maplibregl.Marker({element:o}).setLngLat(e.coords).setPopup((new maplibregl.Popup).setHTML(t)).addTo(b)}),async function(){if(!Array.isArray(v)||!v.length)return;const e=v.reduce((e,t)=>{const o=t.district||"Unknown";return e[o]||(e[o]=[]),e[o].push(t),e},{});Object.entries(e).forEach(([e,t])=>{const o=document.createElement("div");o.className="map-topics__district",o.innerHTML=`<h3>${e}</h3>`,t.forEach(e=>{const t=document.createElement("div");t.className="map-topics__item",t.innerHTML=`<a href="${e.url}"  rel="noopener">\n                    <h4 class="map-topics__item-title">${e.title}</h4>\n                    <p class="map-topics__item-desc">${e.desc}</p>\n                </a>`,o.appendChild(t)}),d.appendChild(o)})}()})}catch(e){console.error("[Map] Erreur d’initialisation:",e)}}(),i?.addEventListener("click",E),{open:S,close:_,destroy:function(){if(i?.removeEventListener("click",E),b){try{w&&b.off("mousemove",w),b.off("click",C)}catch(e){}b.remove(),b=null}}}}o(document,"#menu"),o(document,"#board"),o(document,"#cursor"),o(document,"#cursorFollow"),o(document,"#mapPanel");const D=["top","right","bottom","left"],R=["🜁","🜃","🜂","🜄","🜍","☿","🜔","☉","☿","♃","♁","♆","🜊","🜅","🜖","🜋","🜏","♈︎","♉︎","♊︎","♋︎","♌︎","♍︎","♎︎","♏︎","♐︎","♑︎","♒︎","♓︎"];function W(e){if(" "===e)return'<span class="space"><span>&nbsp;</span></span>';const t=function(){const e=Math.floor(4*Math.random())+1,t=[...D].sort(()=>Math.random()-.5),o=[];for(let r=0;r<e;r++)o.push({direction:t[r],symbol:R[Math.floor(Math.random()*R.length)]});return o}(),o=e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]));return`<span class="letter"><span class="e-letter">${o}</span><span class="t-letter">${o}</span><b></b>${t.map(({symbol:e,direction:t})=>`<i class="symbol ${t}" data-dir="${t}">${e}</i>`).join("")}</span>`}function z(){document.querySelectorAll('div[style^="height:"').forEach(e=>e.remove()),e.container=document.querySelector('section[data-barba="container"]')||document;const o=l.init();return function(){const e=I({animations:{mapAnimation:x}});window.barba?.hooks&&barba.hooks.beforeLeave(()=>{try{e.close()}catch{}})}(),N("register",{afterEnter:async()=>function(e=document){try{const t=e.querySelector("#registerIframe");if(!t)return;t.removeEventListener("load",P),t.addEventListener("load",P)}catch(e){console.log("RegisterScripts:",e)}}()}),N("topic",{afterEnter:async({next:o})=>{!function(o=e.container){const r=o||document;t(r,".postbody__date-time").forEach(e=>{e.innerHTML=new Tyme(e).fromNow()});try{r.querySelectorAll(".postbody").forEach(e=>{const t=e.querySelector(".grid-content");if(!t)return;const o=e=>e.replace(/^\s+|\s+$/g,""),r=[];for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];if(3===n.nodeType){const e=document.createElement("p");e.innerHTML=o(n.nodeValue),n.parentNode.insertBefore(e,n.nextSibling),t.removeChild(n),r.push(e)}else r.push(n)}const n=r.filter(e=>"BR"!==e.nodeName).filter(e=>"P"===e.nodeName&&0===e.childNodes.length),s=document.createDocumentFragment();for(let e=0;e<n.length;++e)s.appendChild(n[e]);t.appendChild(s)});const e=(e,t)=>{let o=JSON.parse(localStorage.getItem(e));null==o&&(o=[]);const r=o.indexOf(t);-1===r?o.push(t):o.splice(r,1),localStorage.setItem(e,JSON.stringify(o))},t=()=>{const e=JSON.parse(localStorage.getItem("hiddenProfiles"));null!==e&&(0===e.length&&r.querySelectorAll(".subject__profileAvatar").forEach(e=>{e.classList.remove("blurred")}),e.forEach(e=>{const t=r.querySelectorAll(`.subject__profileAvatar > a[href ^= "/${e}"]`),o=r.querySelectorAll(`.subject__profileAvatar > a:not([href ^= "/${e}"])`);t.forEach(e=>e.closest(".subject__profileAvatar").classList.add("blurred")),o.forEach(e=>e.closest(".subject__profileAvatar").classList.remove("blurred"))}))};r.querySelectorAll(".subject__profileEye").forEach(o=>{o.addEventListener("click",()=>{const r=o.closest(".subject__profileAvatar").querySelector('a[href^="/u"]').pathname.replace(/^./,"");e("hiddenProfiles",r),t()})}),t();const o=e=>{const t=e.querySelector(".username strong");return t?(t.innerHTML=t.innerText.split("").map(e=>e.trim()?"<div>"+e+"</div>":"<div>&nbsp</div>").join(""),t):null},n=e=>{if(!e)return null;const t=e.parentElement.style.color;return e.closest(".subject__post").style="--accentColor:"+t,t},s=e=>{const t={djinn:"rgb(255, 107, 139)",human:"rgb(115, 169, 255)"};return Object.keys(t).find(o=>t[o]===e)};r.querySelectorAll(".pfield").forEach(function(e){var t=e.textContent.split(" ")[0].toLowerCase().replace(/'/g,"").replace(/\(|\)/g,"");e.closest(".pfield").classList.add(t)});const a=(e,t,o)=>{const r=e.querySelectorAll(`.pfield.${t} `);let n="";return r.forEach(e=>{n=e.querySelector(".pcontent")?.textContent||"",e.closest(".subject__profileWrapper").querySelector(o)?.appendChild(e)}),n},i=(e,t,o)=>{const r=e.querySelector(".subject__profileChart canvas");return r&&window.Chart?new Chart(r,{type:"line",data:{labels:["O","C","E","A","N"],datasets:[{data:o,borderWidth:2,borderColor:t,fill:!0,backgroundColor:t}]},options:{aspectRatio:8,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"easeInQuad",from:0,to:.4,loop:!0}},scales:{y:{display:!1,min:-10,max:10},x:{display:!1}},layout:{padding:0},elements:{point:{pointRadius:0}},plugins:{tooltip:{enabled:!1},title:{display:!1},subtitle:{display:!1},legend:{display:!1}}}}):null},c=(e,t)=>{e.querySelectorAll(".subject__profileSymbol").forEach(e=>{const t=e.dataset.symbol;e.addEventListener("mouseenter",e=>{const o=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");o&&(o.dataset.symbol=t)})}),e.querySelectorAll(".subject__profileMeta").forEach(e=>{e.addEventListener("mouseenter",e=>{const t=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");t?.classList.add("symbol")}),e.addEventListener("mouseleave",e=>{const t=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");t?.classList.remove("symbol")})})},l=(e,t,o,r)=>{const n=e.querySelectorAll(`.pfield.${t} `);if(!n||!n.length)return;const[s,a]=n,i="djinn"==r?s.querySelector(".plabel span[style]").textContent.split(")")[0]+=")":"Vœu",c=s.querySelector(".pcontent")?.textContent||"",l=a.querySelector(".pcontent")?.textContent||"",u=e.querySelector(`.subject__symbolsTrack.${o} .label`);u&&(u.innerText=i);const d=e.querySelector(`.subject__symbolsTrack.${o} .content`);d&&(d.innerText=c);const m=e.querySelector(`.subject__symbolsTrack.${o} .desc`);m&&(m.innerText=l)};r.querySelectorAll(".subject__profileBlock").forEach(e=>{const t=o(e),r=n(t),u=s(r),d=[],m=["ouverture","conscienciosité","extraversion","agréabilité","neuroticisme"],p={messages:".subject__profileNumbers",points:".subject__profileNumbers",ouverture:".subject__profileChart div","conscienciosité":".subject__profileChart div",extraversion:".subject__profileChart div","agréabilité":".subject__profileChart div",neuroticisme:".subject__profileChart div","âge":".subject__profileFacts",pronoms:".subject__profileFacts",faceclaim:".subject__profileFacts",citation:".subject__profileQuote"};for(const[t,o]of Object.entries(p)){const r=a(e,t,o);m.indexOf(t)>-1&&d.push(Number(r)||0)}i(e,r,d),c(e,u),l(e,"salt","body",u),l(e,"mercury","mind",u),l(e,"sulfur","soul",u)})}catch(e){console.log(e)}}(o.container),function(o=e.container){console.log("enoch"),t(o,".enochian").forEach(e=>{const t=e.textContent;e.innerHTML=t.toLowerCase().toString().normalize("NFD").trim().replace(/[^a-z ]/g,"").split("").map(W).join("")})}(o.container)}}),console.debug("[barba] registered ns hooks:",Array.from(F.keys())),T({cursor:o}),{Context:e,cursor:o}}document.addEventListener("DOMContentLoaded",()=>{z()});
//# sourceMappingURL=hebe.esm.js.map
