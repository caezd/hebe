!function(){"use strict";const e=function(){let e=[],t=0,o=null;const r=()=>{console.log("Context updated!")};return{get container(){return o},set container(e){o=e,t=0},useState(o){const n=t++;e[n]=e[n]??o;return[e[n],t=>{e[n]="function"==typeof t?t(e[n]):t,r()}]},useReducer(o,n){const s=t++;e[s]=e[s]??n;return[e[s],t=>{e[s]=o(e[s],t),r()}]},useEffect(o,r){const n=t++,s=e[n],i=!r,a=!s||!r.every((e,t)=>e===s[t]);(i||a)&&(e[n]=r,o())}}}(),t=(e,t)=>e.querySelectorAll(t),o=(e,t)=>e.querySelector(t),r=40,n="power4",s={focus:.5,shrink:.2,follow:.6,fade:300},i={text:".txt, .txt *, .ce-block__content, .ce-block__content *, textarea, input",forum:".forum, .forum *",btn:".btn, .btn *",profileSymbol:".subject__profileSymbol",barbaContainer:'section[data-barba="container"]',progressPath:".progress-wrap path",cursor:"#cursor",cursorFollow:"#cursorFollow",postbody:".postbody",forumEl:".forum",link:"a[href]:not(.no-cursor):not(:where(.btn *)):not(.btn), a[href]:not(.no-cursor):not(:where(.btn *)) *, .marker, .marker *",map:"#map canvas"};function a(e){const t=e.getBoundingClientRect();return{x:t.left,y:t.top,w:t.width,h:t.height}}function c(e,t){e.animate({opacity:t},{duration:s.fade,fill:"forwards"})}const l={cursor:document.querySelector(i.cursor),cursorFollow:document.querySelector(i.cursorFollow),postbody:document.querySelectorAll(i.postbody),progressPath:document.querySelector(i.progressPath),forums:document.querySelectorAll(i.forumEl),stopFollow:!1,init(){this.bindEvents(),this.bindScroll()},bindEvents(){document.addEventListener("mouseenter",()=>{c(this.cursor,1),c(this.cursorFollow,1)}),document.addEventListener("mouseleave",()=>{c(this.cursor,0),c(this.cursorFollow,0)}),document.addEventListener("mousemove",e=>{const{pageX:t,pageY:o,target:r}=e;r instanceof Element&&(this.cursor.style.left=t+"px",this.cursor.style.top=o+"px",this.updateCursorBadges(r),r.matches(i.btn)?this.handleBtnFocus(r):r.matches(i.profileSymbol)?this.handleProfileSymbolFocus(r):this.resetFollowSize(),this.stopFollow||(this.cursorFollow.classList.remove("static"),this.cursor.classList.remove("hide"),gsap.to(this.cursorFollow,{top:o,left:t,duration:s.follow,ease:n})))}),document.addEventListener("scroll",e=>{"container"===e.target.dataset.barba&&this.updateProgress()},!0),document.addEventListener("pointerleave",e=>{if(!(e.target instanceof Element))return;const t=e.target.closest(".btn, .subject__profileSymbol");t&&(t.contains(e.relatedTarget)||(this.stopFollow=!1,this.cursorFollow.classList.remove("static","large"),this.cursor.classList.remove("hide","grow"),gsap.killTweensOf(this.cursorFollow),gsap.killTweensOf(this.cursor),gsap.to(this.cursorFollow,{width:40,height:40,duration:.5,ease:"circ.out"})))},!0)},updateCursorBadges(e){e.matches(i.text)?this.cursor.classList.add("text"):this.cursor.classList.remove("text"),e.matches(i.forum)?this.cursor.classList.add("eye"):this.cursor.classList.remove("eye"),e.matches(i.link)?(this.cursor.classList.add("grow"),this.cursorFollow.classList.add("large")):(this.cursor.classList.remove("grow"),this.cursorFollow.classList.remove("large")),e.matches(i.map)?(this.cursor.classList.add("crosshair"),this.cursorFollow.classList.add("shrink")):(this.cursor.classList.remove("crosshair"),this.cursorFollow.classList.remove("shrink"))},handleBtnFocus(e){this.stopFollow=!0;const t=e.closest(".btn"),{x:o,y:r,w:i,h:c}=a(t);this.cursorFollow.classList.add("static"),gsap.to(this.cursorFollow,{top:r+c/2,left:o+i/2,width:i,height:c,duration:s.focus,ease:n})},handleProfileSymbolFocus(e){this.stopFollow=!0;const t=e.closest(".subject__profileSymbol"),{x:o,y:r,w:i,h:c}=a(t);gsap.to(this.cursorFollow,{top:r+c/2,left:o+i/2,width:i,height:c,duration:s.focus,ease:n})},resetFollowSize(){this.stopFollow=!1,gsap.to(this.cursorFollow,{width:r,height:r,duration:s.shrink,ease:n})},bindScroll(){if(!this.progressPath)return;const e=this.pathLength();this.progressPath.style.strokeDasharray=`${e} ${e}`,this.updateProgress()},currentContainer:()=>document.querySelector(i.barbaContainer),updateProgress(){if(!this.progressPath)return;const e=this.currentContainer();if(!e)return;const t=e.scrollTop,o=e.scrollHeight-window.innerHeight,r=this.pathLength()-t*this.pathLength()/o;this.progressPath.style.strokeDashoffset=r},pathLength(){return this.progressPath.getTotalLength()}};let u=null;function d(){if(!window.gsap)return null;if(u)return u;try{window.CustomEase&&(gsap.registerPlugin(CustomEase),u=gsap.parseEase?.("custom")||CustomEase.create("custom","M0,0,C0.625,0,0,1,1,1"))}catch{}return u||(u="power4.out"),u}const h={transform:"scaleX(0)"},p={transform:"scaleX(1)"},m={left:0,width:"100%"},g={left:"100%",width:"0%"},f={autoAlpha:0},b={autoAlpha:1},y={height:"0%"},v={height:"100%"},C={width:"0%"},w={width:"100%"},S=(e,t)=>e.querySelectorAll(t);function L(e=document,t){const o=d();if(!window.gsap||!o)return void t?.();const r=gsap.timeline({ease:o,onComplete:t});return S(e,".bb").forEach((e,t)=>r.to(e,{width:"100%",duration:.2,delay:.03*t},"h")),S(e,".br").forEach((e,t)=>r.to(e,{height:"100%",duration:.2,delay:.03*t},"v")),S(e,".bl").forEach((e,t)=>r.to(e,{height:"100%",duration:.2,delay:.03*t},"v")),S(e,".bt").forEach((e,t)=>r.to(e,{width:"100%",duration:.2,delay:.03*t},"h")),S(e,".bg-hash-v").forEach((e,t)=>r.to(e,{width:"100%",duration:.4},"h")),r}let _=null;const E=()=>_;function q({container:e}){const r=d();if(!window.gsap||!r)return null;const n=o(document,"#map");try{_?.kill()}catch{}const s=gsap.timeline({defaults:{duration:1,ease:r},onReverseComplete:()=>{_=null,e.classList.add("onLoad")}}),i=t(n,".anim-bg-cover"),a=t(n,".anim-bg"),c=t(n,".anim-fade");t(n,".anim-fadeFromLeft-50"),t(n,".anim-fadeUp");const l=t(n,".anim-bb, .anim-bt"),u=t(n,".anim-br, .anim-bl"),S=(e,t,o,r)=>{return(n=e)&&n.length>0?void 0!==r?s.fromTo(e,t,o,r):s.fromTo(e,t,o):s;var n};return S(i,h,p),S(i,m,g,.7),S(a,h,p,.7),S(c,f,{...b,stagger:.033},1.7),S(l,C,{...w,stagger:.033},1.7),S(u,y,{...v,stagger:.033},1.7),(e=>{_=e})(s),s}class x{constructor(e,t={}){this.options={badgeClass:"notification-badge",badgeCounterClass:"notification-counter",animationSpeed:150,countLimit:99,activeClass:"notification-badge--active",limitClass:"notification-badge--limit",...t},e?(this.element=e,this.badgeElement=null,this.badgeCounterElement=null,this.renderIfNeeded()):console.error("[Badge] host element is null/undefined.")}renderIfNeeded(){let e=this.element.querySelector("."+this.options.badgeClass);e||(e=document.createElement("span"),e.className=this.options.badgeClass,e.innerHTML=`<span class="${this.options.badgeCounterClass}">0</span>`,this.element.appendChild(e)),this.badgeElement=e,this.badgeCounterElement=e.querySelector("."+this.options.badgeCounterClass)}set(e=0){if(!this.element)return!1;if(this.renderIfNeeded(),"number"!=typeof e||Number.isNaN(e)||e<0)return console.error(`[Badge] invalid value: ${e}`),this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;if(0===e)return this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;e>this.options.countLimit?this.badgeElement?.classList.add(this.options.limitClass):this.badgeElement?.classList.remove(this.options.limitClass),this.badgeElement&&!this.badgeElement.classList.contains(this.options.activeClass)&&this.badgeElement.classList.add(this.options.activeClass);const t=this.badgeCounterElement;if(!t)return!1;if(String(t.textContent).trim()===String(e))return!0;const o=t.cloneNode(!1);return o.textContent=e,o.classList.add(this.options.badgeCounterClass+"--new"),t.classList.add(this.options.badgeCounterClass+"--old"),t.after(o),requestAnimationFrame(()=>{o.classList.remove(this.options.badgeCounterClass+"--new"),setTimeout(()=>{try{t.remove()}catch{}this.badgeCounterElement=o},this.options.animationSpeed)}),!0}get(){const e=parseInt(this.badgeCounterElement?.textContent||"0",10);return Number.isNaN(e)?0:e}increase(e=1){return this.set(this.get()+e)}decrease(e=1){return this.set(Math.max(0,this.get()-e))}destroy(){if(!this.element)return;const e=this.element.querySelector("."+this.options.badgeClass);e&&e.remove(),this.badgeElement=null,this.badgeCounterElement=null,this.element=null}}const A='section[data-barba="container"]',F=".progress-wrap path";let j=!1;const T=new Map;function k(e,t){T.set(e,{...t||{}})}function N({cursor:t}={}){if(j)return{destroy:M};if(j=!0,!window.barba?.init){console.warn("[barba] introuvable. Charge @barba/core avant initBarba().");const t=document.querySelector(A)||document;return e.container=t,L(t,()=>{}),{destroy:M}}e.container=document.querySelector(A)||document;const o=document.getElementById("menu"),r=o?.querySelector(".notification"),n=new x(r);return barba.init({prevent:({el:e})=>e?.hasAttribute?.("data-barba-prevent"),transitions:[{name:"lines-and-reveal",beforeOnce(e){const t=this.async(),o=e?.next?.namespace,r=o?T.get(o):null;try{r?.beforeOnce?.(e)}catch(e){console.error("[barba:beforeOnce ns]",e)}L(e.next.container,t),n.set(5)},once(e){console.debug("[barba] once ns=",e?.next?.namespace);const t=e?.next?.namespace,o=t?T.get(t):null;try{o?.once?.(e),o?.afterEnter?.(e)}catch(e){console.error("[barba:once ns hook]",e)}const r=this.async(),n=e.next.container.querySelectorAll(".content, .contents");n.length?gsap.to(n,{alpha:1,stagger:.03,onComplete:r}):r()},before(e){const t=e?.current?.namespace,o=t?T.get(t):null;try{o?.before?.(e)}catch(e){console.error("[barba:before ns]",e)}const r=this.async();(function(e=document,t={}){const o=e.querySelectorAll(".content, .contents");return o&&0!==o.length?gsap.to(o,{alpha:0,stagger:.03,...t}):null})(e.current.container,{onComplete:r})||r()},async leave(e){const t=e?.current?.namespace,o=t?T.get(t):null;if(o?.leave)try{await o.leave(e)}catch(e){console.error("[barba:leave]",e)}const r=this.async();!function(e=document,t){const o=d();if(!window.gsap||!o)return void t?.();const r=gsap.timeline({ease:o,onComplete:t});S(e,".br").forEach((e,t)=>r.to(e,{top:t%2?0:"+=100%",height:0,duration:.2,delay:.03*t},"v")),S(e,".bl").forEach((e,t)=>r.to(e,{top:t%2?0:"+=100%",height:0,duration:.2,delay:.03*t},"v")),S(e,".bb").forEach((e,t)=>r.to(e,{left:t%2?0:"+=100%",width:0,duration:.2,delay:.03*t},"h")),S(e,".bg-hash-v").forEach((e,t)=>r.to(e,{width:"0%",duration:.4},"h"))}(e.current.container,r)},async enter(o){console.debug("[barba] enter ns=",o?.next?.namespace),e.container=o.next.container,function(e,t){if(!t||!t.progressPath)return;const o=e?.querySelector?.(F);o&&(t.progressPath=o);try{const e=t.pathLength();t.progressPath.style.strokeDasharray=`${e} ${e}`,t.updateProgress()}catch{}}(o.next.container,t);const r=o?.next?.namespace,n=r?T.get(r):null;if(n?.enter)try{await n.enter(o)}catch(e){console.error("[barba:enter]",e)}const s=this.async();L(o.next.container,()=>{o.next.container,s()})},afterEnter(e){console.debug("[barba] afterEnter ns=",e?.next?.namespace);const t=e?.next?.namespace,o=t?T.get(t):null;try{o?.afterEnter?.(e)}catch(e){console.error("[barba:afterEnter]",e)}const r=this.async();(function(e=document,t={}){const o=e.querySelectorAll(".content, .contents");return o&&0!==o.length?gsap.to(o,{alpha:1,stagger:.03,...t}):null})(e.next.container,{onComplete:r})||r()}}]}),{destroy:M}}function M(){try{barba&&barba.destroy&&barba.destroy()}catch{}T.clear(),j=!1}function $(e){const t=e?.querySelectorAll?.("dl")||[],o={};return t.forEach(e=>{const t=e.querySelector("dt"),r=(t?.textContent||"").replace(/[*:]/g,""),n=r.toString().toLowerCase().normalize("NFD").trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-");const s=e.querySelector("dd input, dd textarea, dd select");if(s){const t=s.tagName.toLowerCase(),i="select"===t?s.value:(s.value||"").trim();o[n]={title:r,type:t,value:i,validate:()=>!0,inputHTML:s,originalHTML:e}}}),o}async function I(e){const t=e?.currentTarget;if(!t)return;const o=t.contentDocument||t.contentWindow?.document,r=t.contentWindow?.location?.href||"";if(!o)return;const n=o.querySelector("#cp-main");if(!n)return;const s=n.cloneNode(!0),i=s.querySelectorAll("fieldset"),a=t.closest('section[data-barba="container"]')||document,c=function(e="",t=document){let o=1;return e.includes("step=2")&&(o=2),t.querySelector("form#form_confirm")&&(o=6),t.querySelector(".randommessageclass")&&(o=7),o}(r,s),l={1:()=>{},2:async()=>{var e,t;i.length>=2&&(e=i[0],t=i[1],$(e),$(t)),function(e,t){const o=e.querySelector(`.register__panel:nth-child(${t})`);o&&((e=>{const t=[];if(!e?.parentNode)return t;let o=e.parentNode.firstChild;for(;o;)1===o.nodeType&&o!==e&&t.push(o),o=o.nextSibling;return t})(o).forEach(e=>e.classList.remove("isOpen")),o.classList.add("isOpen"))}(a,2),await new Promise(e=>setTimeout(e,400)),function(e,t){const o=e.querySelector(`.register__panel:nth-child(${t}) .register__panelContentWrapper`);o?.remove()}(a,1)},3:()=>{},6:()=>{},7:()=>{}};l[c]&&await l[c]()}function B(e,t=0,o=0){const r=e.getSouthWest(),n=e.getNorthEast(),s=(n.lng-r.lng)*t,i=(n.lat-r.lat)*o;return new maplibregl.LngLatBounds([r.lng+s,r.lat+i],[n.lng+s,n.lat+i])}function P(e,t="lat",o=4,r=!0){return function({d:e,m:t,s:o,hemi:r,type:n},{precision:s=4,pad:i=!0}={}){return`${String(e).padStart("lon"===n?3:2,"0")}° ${i?String(t).padStart(2,"0"):String(t)}' ${i?Number(o).toFixed(s).padStart(s?4+s:2,"0"):Number(o).toFixed(s)}" ${r}`}(function(e,t="lat",o=4){const r="lat"===t?e>=0?"N":"S":e>=0?"E":"W";let n=Math.abs(Number(e)),s=Math.floor(n),i=60*(n-s),a=Math.floor(i),c=60*(i-a);const l=Math.max(0,0|o);return c=Number(c.toFixed(l)),c>=60&&(c-=60,a+=1),a>=60&&(a-=60,s+=1),{d:s,m:a,s:c,hemi:r,type:t}}(e,t,o),{precision:o,pad:r})}class O{constructor({map:e,topicsContainerSelector:t=".map__asideContainer.topicList",newTopicAsideSelector:o=".map__asideContainer.newTopic"}={}){this.map=e,this.topicsContainer=document.querySelector(t)||null,this.asideContainer=document.querySelector(o)||null,this.toggleButton=this.asideContainer?.querySelector(".newTopic__closeButton")||null,this.isCreating=!1,this.isAsideOpened=!1,this.subjectInput=this.asideContainer?.querySelector('[name="subject"], #newTopicSubject')||null,this.messageInput=this.asideContainer?.querySelector('[name="message"], #newTopicMessage')||null,this.coordsInput=this.asideContainer?.querySelector('[name="coords"], #newTopicCoords')||null,this.districtInput=this.asideContainer?.querySelector('[name="district"], #newTopicDistrict')||null,this.coordsDecimalEl=this.asideContainer?.querySelector("[data-coords-decimal]")||null,this.coordsDMSEl=this.asideContainer?.querySelector("[data-coords-dms]")||null,this._bindAsideEvents(),this._loadState()}_bindAsideEvents(){this.toggleButton&&this.toggleButton.addEventListener("click",()=>this.toggleAside()),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isAsideOpened&&this.closeAside()});const e=()=>this._saveState();this.subjectInput?.addEventListener("input",e),this.messageInput?.addEventListener("input",e)}_loadState(){try{const e=localStorage.getItem("newTopic");if(!e)return;const{coords:t,district:o,subject:r,message:n}=JSON.parse(e);t&&(this.isCreating={coords:t,district:o,subject:r,message:n}),this.subjectInput&&(this.subjectInput.value=r||""),this.messageInput&&(this.messageInput.value=n||""),this.districtInput&&(this.districtInput.value=o||""),t&&this._updateCoordDisplays(t),this.toggleButton?.classList.add("show")}catch{}}_saveState(){if(this.isCreating)try{const e={coords:this.isCreating.coords||null,district:this.isCreating.district||this.districtInput?.value||"",subject:this.subjectInput?.value||"",message:this.messageInput?.value||""};localStorage.setItem("newTopic",JSON.stringify(e))}catch{}}_updateCoordDisplays(e){const{lng:t,lat:o}=Array.isArray(e)?{lng:e[0],lat:e[1]}:e;this.coordsInput&&(this.coordsInput.value=`${t},${o}`),this.coordsDecimalEl&&(this.coordsDecimalEl.textContent=`${t.toFixed(6)}, ${o.toFixed(6)}`),this.coordsDMSEl&&(this.coordsDMSEl.textContent=`${P(t,"lon",4)}, ${P(o,"lat",4)}`)}initNewTopic(e,t){this.isCreating={coords:e,district:t},this._saveState(),this.openAside(),this.moveNewTopic(e,t)}moveNewTopic(e,t){e&&(this.isCreating={...this.isCreating,coords:e,district:t??this.isCreating?.district},this._updateCoordDisplays(e),this._saveState(),this.openAside())}setDistrict(e){this.isCreating={...this.isCreating,district:e},this.districtInput&&(this.districtInput.value=e||""),this._saveState()}toggleAside(){this.isAsideOpened?this.closeAside():this.openAside()}openAside(){this.asideContainer&&(this.asideContainer.classList.add("active"),this.topicsContainer?.classList.remove("active"),this.isAsideOpened=!0)}closeAside(){this.asideContainer&&(this.asideContainer.classList.remove("active"),this.isAsideOpened=!1)}}async function D({styleUrl:e="http://127.0.0.1:8080/dark_matter.json",selectors:t={trigger:"#navigate",container:"#map",mapContainer:"#map-content",board:"#board",cursor:"#cursor",topics:"#map-topics",layoutBoard:".map__asideContainer.topicList",newTopic:".map__asideContainer.newTopic"},animations:o={},forumId:r=1,topicsLimit:n=12}={}){const{mapAnimation:s}=o||{},i=document.querySelector(t.trigger),a=document.querySelector(t.container),c=document.querySelector(t.mapContainer),l=document.querySelector(t.cursor),u=document.querySelector(t.board),d=document.querySelector(t.topics),h=document.querySelector(t.layoutBoard),p=document.querySelector(t.newTopic);a&&c||console.warn("[Map] container/mapHost missing:",t);const m=new AbortController,g=await async function({forumId:e=1,limit:t=12,signal:o}={}){try{const r=await fetch(`/f${e}-`,{credentials:"same-origin",signal:o}),n=await r.text(),s=(new DOMParser).parseFromString(n,"text/html");return Array.from(s.querySelectorAll("a.topictitle")).slice(0,t).map(e=>{try{const t=e.getAttribute("href"),o=new URL(t,location.origin).href,r=e.closest(".row, .topic-row, tr"),n=(e.textContent||"Untitled").trim(),s=r?.querySelector(".username, .topic-author a")?.textContent?.trim()||"",i=r?.querySelector(".posts, .topic-replies")?.textContent?.trim()||"",a=r?.querySelector(".lastpost, .topic-lastpost, .gensmall")?.textContent?.trim()||"",c=r?.querySelector(".topic-description, .topic-desc")?.textContent?.trim()||"",l=o.match(/t(\d+)-/),u=l?l[1]:"",d=n+"\n"+c,h=d.match(/\[(.+?),\s*(.+?)\]/);if(!h)return null;const p=parseFloat(h[1]),m=parseFloat(h[2]);return Number.isFinite(p)&&Number.isFinite(m)?{id:u,title:n,desc:c,district:(d.match(/"([^"]+)"/)?.[1]||"").trim(),url:o,author:s,replies:i,last:a,coords:[p,m]}:null}catch{return null}}).filter(Boolean)}catch(e){return console.warn("[Map] fetchForumTopics error:",e),[]}}({forumId:r,limit:n,signal:m.signal})||[];let f=null,b=null,y=null,v=null,C=null;const w="districts-fill",S=new maplibregl.LngLatBounds([4.825,52.33],[5.015,52.397]),L=[4.89361,52.37278];function _(){try{return E()||null}catch{return null}}function q(){return Boolean(f?.getStyle()?.layers?.some(e=>e.id===w))}function x(e){if(!f)return!1;if(!q())return!0;const t=f.queryRenderedFeatures(e,{layers:[w]});return t&&t.length>0}function A(e){if(!f)return;if(function(e){return!!e?.closest?.(".marker, .maplibregl-marker, .mapboxgl-marker")}(e.originalEvent?.target))return;if(!x(e.point))return;if(y)try{y.remove()}catch{}const t=document.createElement("div");t.className="marker temp",t.innerHTML="<div class=\"marker-label marker-label--temp\" hidden></div><div class='marker-pulse'></div>",y=new maplibregl.Marker({element:t}).setLngLat(e.lngLat).setPopup(new maplibregl.Popup({offset:16}).setText(`Lng: ${e.lngLat.lng.toFixed(6)}\nLat: ${e.lngLat.lat.toFixed(6)}`)).addTo(f),f.easeTo({zoom:Math.max(f.getZoom(),16.4),center:e.lngLat,duration:600});const o=function(e){if(!f||!q())return null;const t=f.queryRenderedFeatures(f.project(e),{layers:[w]});return t&&t.length>0&&(t[0].properties?.name||t[0].id)||null}(e.lngLat);C?.moveNewTopic(e.lngLat,o),C?.openAside();const r=C?.subjectInput?.value?.trim();r&&F(r)}function F(e){if(!y)return;const t=y.getElement?.()||y._element||null;if(!t)return;let o=t.querySelector(".marker-label");o||(o=document.createElement("div"),o.className="marker-label marker-label--temp",t.prepend(o));const r=(e||"").trim();o.textContent=r,o.hidden=!r.length}function j(){try{"function"==typeof s&&i&&a&&(i.classList.add("active"),a.classList.remove("onLoad"),s({container:a}))}catch(e){console.error("[Map] mapAnimation error:",e)}}function T(){const e=_();e&&e.timeScale(2).reverse(),i?.classList.remove("active"),h?.classList.remove("active"),p?.classList.remove("active")}function k(e){e?.preventDefault?.();const t=_();t&&t.progress()>0&&!t.reversed()?T():j()}function N(){if(m.abort(),i?.removeEventListener("click",k),u?.replaceWith(u.cloneNode(!0)),f){try{f.off("mousemove",v),f.off("click",A)}catch{}try{y?.remove()}catch{}try{f.remove()}catch{}f=null}}if(!maplibregl)return console.error("[Map] maplibregl missing. Inject the script before init."),{open:j,close:T,destroy:N};u?.addEventListener("click",e=>{e?.preventDefault?.(),h?.classList.toggle("active"),p?.classList.remove("active")});try{f=new maplibregl.Map({style:e,center:L,pitch:45,bearing:-17.6,container:c||t.mapContainer,canvasContextAttributes:{antialias:!0},attributionControl:!1,maxBounds:B(S,-.18,0),dragRotate:!1}),window.map=f,C=new O({map:f}),C?.subjectInput?.addEventListener("input",e=>{F(e.currentTarget.value)}),v=function(e){let t=!1;return function(...o){t||(t=!0,requestAnimationFrame(()=>{try{e.apply(this,o)}finally{t=!1}}))}}(function(e){if(!l)return;const t=!x(e.point);l.classList.toggle("out",t);const{lng:o,lat:r}=e.lngLat;l.dataset.coords=`${P(o,"lon",4)}, ${P(r,"lat",4)}`}),f.on("mousemove",v),f.on("click",A),f.on("load",()=>{try{b=f.cameraForBounds(B(S,-.18,0),{padding:{top:32,right:32,bottom:32,left:32},bearing:-17.6,pitch:45,maxZoom:12.62}),b&&f.jumpTo(b),f.easeTo({...b,offset:[-600,0],duration:600})}catch{}!function(){if(!f||!Array.isArray(g)||!g.length)return[];const e=[],t=document.createDocumentFragment();g.forEach(o=>{try{if(!o||!Array.isArray(o.coords)||2!==o.coords.length)return;const[r,n]=o.coords;if(!Number.isFinite(r)||!Number.isFinite(n))return;const s=o.title||"Untitled",i=document.createElement("div");i.className="marker",i.innerHTML=`<div class="marker-label">${s}</div><div class='marker-pulse'></div>`;const a=new maplibregl.Marker({element:i}).setLngLat([r,n]).setPopup((new maplibregl.Popup).setHTML(s)).addTo(f);e.push(a),t.appendChild(i)}catch{}});try{d&&d.appendChild(t)}catch{}}(),function(){if(!Array.isArray(g)||!g.length||!d)return;const e=g.reduce((e,t)=>{const o=t?.district||"Unknown";return(e[o]||=[]).push(t),e},{}),t=document.createDocumentFragment();Object.entries(e).forEach(([e,o])=>{const r=document.createElement("div");r.className="map-topics__district",r.innerHTML=`<h3>${e}</h3>`,o.forEach(e=>{const t=document.createElement("div");t.className="map-topics__item";const o=e.title||"Untitled",n=e.desc||"";t.innerHTML=`<a href="${e.url}" rel="noopener">\n          <h4 class="map-topics__item-title">${o}</h4>\n          <p class="map-topics__item-desc">${n}</p>\n        </a>`,r.appendChild(t)}),t.appendChild(r)}),d.innerHTML="",d.appendChild(t)}(),function(){if(!f)return;f.resize();const e=h?.classList.contains("active")&&h.offsetWidth||0,t=((p?.classList.contains("active")&&p.offsetWidth||0)-e)/2,{fx:o}=function(e,t=0,o=0){const r=e?.clientWidth||0,n=e?.clientHeight||0;return r&&n?{fx:t/r,fy:o/n}:{fx:0,fy:0}}(c,-t,0),r=B(S,o,0);try{f.setMaxBounds(r)}catch{}try{b=f.cameraForBounds(r,{padding:{top:32,right:32,bottom:32,left:32},bearing:f.getBearing(),pitch:f.getPitch(),maxZoom:(n=f.getZoom(),s=6,i=19,Math.max(s,Math.min(i,n)))})}catch{}var n,s,i}()})}catch(e){console.error("[Map] init error:",e)}return i?.addEventListener("click",k),{open:j,close:T,destroy:N}}o(document,"#menu"),o(document,"#board"),o(document,"#cursor"),o(document,"#cursorFollow"),o(document,"#mapPanel");const H=["top","right","bottom","left"],R=["🜁","🜃","🜂","🜄","🜍","☿","🜔","☉","☿","♃","♁","♆","🜊","🜅","🜖","🜋","🜏","♈︎","♉︎","♊︎","♋︎","♌︎","♍︎","♎︎","♏︎","♐︎","♑︎","♒︎","♓︎"];function W(e){if(" "===e)return'<span class="space"><span>&nbsp;</span></span>';const t=function(){const e=Math.floor(4*Math.random())+1,t=[...H].sort(()=>Math.random()-.5),o=[];for(let r=0;r<e;r++)o.push({direction:t[r],symbol:R[Math.floor(Math.random()*R.length)]});return o}(),o=e.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]));return`<span class="letter"><span class="e-letter">${o}</span><span class="t-letter">${o}</span><b></b>${t.map(({symbol:e,direction:t})=>`<i class="symbol ${t}" data-dir="${t}">${e}</i>`).join("")}</span>`}function z(){document.querySelectorAll('div[style^="height:"').forEach(e=>e.remove()),e.container=document.querySelector('section[data-barba="container"]')||document;const o=l.init();return function(){const e=D({animations:{mapAnimation:q}});window.barba?.hooks&&barba.hooks.beforeLeave(()=>{try{e.close()}catch{}})}(),k("register",{afterEnter:async()=>function(e=document){try{const t=e.querySelector("#registerIframe");if(!t)return;t.removeEventListener("load",I),t.addEventListener("load",I)}catch(e){console.log("RegisterScripts:",e)}}()}),k("topic",{afterEnter:async({next:o})=>{!function(o=e.container){const r=o||document;t(r,".postbody__date-time").forEach(e=>{e.innerHTML=new Tyme(e).fromNow()});try{r.querySelectorAll(".postbody").forEach(e=>{const t=e.querySelector(".grid-content");if(!t)return;const o=e=>e.replace(/^\s+|\s+$/g,""),r=[];for(let e=0;e<t.childNodes.length;e++){const n=t.childNodes[e];if(3===n.nodeType){const e=document.createElement("p");e.innerHTML=o(n.nodeValue),n.parentNode.insertBefore(e,n.nextSibling),t.removeChild(n),r.push(e)}else r.push(n)}const n=r.filter(e=>"BR"!==e.nodeName).filter(e=>"P"===e.nodeName&&0===e.childNodes.length),s=document.createDocumentFragment();for(let e=0;e<n.length;++e)s.appendChild(n[e]);t.appendChild(s)});const e=(e,t)=>{let o=JSON.parse(localStorage.getItem(e));null==o&&(o=[]);const r=o.indexOf(t);-1===r?o.push(t):o.splice(r,1),localStorage.setItem(e,JSON.stringify(o))},t=()=>{const e=JSON.parse(localStorage.getItem("hiddenProfiles"));null!==e&&(0===e.length&&r.querySelectorAll(".subject__profileAvatar").forEach(e=>{e.classList.remove("blurred")}),e.forEach(e=>{const t=r.querySelectorAll(`.subject__profileAvatar > a[href ^= "/${e}"]`),o=r.querySelectorAll(`.subject__profileAvatar > a:not([href ^= "/${e}"])`);t.forEach(e=>e.closest(".subject__profileAvatar").classList.add("blurred")),o.forEach(e=>e.closest(".subject__profileAvatar").classList.remove("blurred"))}))};r.querySelectorAll(".subject__profileEye").forEach(o=>{o.addEventListener("click",()=>{const r=o.closest(".subject__profileAvatar").querySelector('a[href^="/u"]').pathname.replace(/^./,"");e("hiddenProfiles",r),t()})}),t();const o=e=>{const t=e.querySelector(".username strong");return t?(t.innerHTML=t.innerText.split("").map(e=>e.trim()?"<div>"+e+"</div>":"<div>&nbsp</div>").join(""),t):null},n=e=>{if(!e)return null;const t=e.parentElement.style.color;return e.closest(".subject__post").style="--accentColor:"+t,t},s=e=>{const t={djinn:"rgb(255, 107, 139)",human:"rgb(115, 169, 255)"};return Object.keys(t).find(o=>t[o]===e)};r.querySelectorAll(".pfield").forEach(function(e){var t=e.textContent.split(" ")[0].toLowerCase().replace(/'/g,"").replace(/\(|\)/g,"");e.closest(".pfield").classList.add(t)});const i=(e,t,o)=>{const r=e.querySelectorAll(`.pfield.${t} `);let n="";return r.forEach(e=>{n=e.querySelector(".pcontent")?.textContent||"",e.closest(".subject__profileWrapper").querySelector(o)?.appendChild(e)}),n},a=(e,t,o)=>{const r=e.querySelector(".subject__profileChart canvas");return r&&window.Chart?new Chart(r,{type:"line",data:{labels:["O","C","E","A","N"],datasets:[{data:o,borderWidth:2,borderColor:t,fill:!0,backgroundColor:t}]},options:{aspectRatio:8,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"easeInQuad",from:0,to:.4,loop:!0}},scales:{y:{display:!1,min:-10,max:10},x:{display:!1}},layout:{padding:0},elements:{point:{pointRadius:0}},plugins:{tooltip:{enabled:!1},title:{display:!1},subtitle:{display:!1},legend:{display:!1}}}}):null},c=(e,t)=>{e.querySelectorAll(".subject__profileSymbol").forEach(e=>{const t=e.dataset.symbol;e.addEventListener("mouseenter",e=>{const o=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");o&&(o.dataset.symbol=t)})}),e.querySelectorAll(".subject__profileMeta").forEach(e=>{e.addEventListener("mouseenter",e=>{const t=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");t?.classList.add("symbol")}),e.addEventListener("mouseleave",e=>{const t=e.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");t?.classList.remove("symbol")})})},l=(e,t,o,r)=>{const n=e.querySelectorAll(`.pfield.${t} `);if(!n||!n.length)return;const[s,i]=n,a="djinn"==r?s.querySelector(".plabel span[style]").textContent.split(")")[0]+=")":"Vœu",c=s.querySelector(".pcontent")?.textContent||"",l=i.querySelector(".pcontent")?.textContent||"",u=e.querySelector(`.subject__symbolsTrack.${o} .label`);u&&(u.innerText=a);const d=e.querySelector(`.subject__symbolsTrack.${o} .content`);d&&(d.innerText=c);const h=e.querySelector(`.subject__symbolsTrack.${o} .desc`);h&&(h.innerText=l)};r.querySelectorAll(".subject__profileBlock").forEach(e=>{const t=o(e),r=n(t),u=s(r),d=[],h=["ouverture","conscienciosité","extraversion","agréabilité","neuroticisme"],p={messages:".subject__profileNumbers",points:".subject__profileNumbers",ouverture:".subject__profileChart div","conscienciosité":".subject__profileChart div",extraversion:".subject__profileChart div","agréabilité":".subject__profileChart div",neuroticisme:".subject__profileChart div","âge":".subject__profileFacts",pronoms:".subject__profileFacts",faceclaim:".subject__profileFacts",citation:".subject__profileQuote"};for(const[t,o]of Object.entries(p)){const r=i(e,t,o);h.indexOf(t)>-1&&d.push(Number(r)||0)}a(e,r,d),c(e,u),l(e,"salt","body",u),l(e,"mercury","mind",u),l(e,"sulfur","soul",u)})}catch(e){console.log(e)}}(o.container),function(o=e.container){console.log("enoch"),t(o,".enochian").forEach(e=>{const t=e.textContent;e.innerHTML=t.toLowerCase().toString().normalize("NFD").trim().replace(/[^a-z ]/g,"").split("").map(W).join("")})}(o.container)}}),console.debug("[barba] registered ns hooks:",Array.from(T.keys())),N({cursor:o}),{Context:e,cursor:o}}document.addEventListener("DOMContentLoaded",()=>{z()})}();
//# sourceMappingURL=hebe.js.map
