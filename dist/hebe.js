!function(){"use strict";const t=function(){let t=[],e=0,n=null;const r=()=>{console.log("Context updated!")};return{get container(){return n},set container(t){n=t,e=0},useState(n){const o=e++;t[o]=t[o]??n;return[t[o],e=>{t[o]="function"==typeof e?e(t[o]):e,r()}]},useReducer(n,o){const s=e++;t[s]=t[s]??o;return[t[s],e=>{t[s]=n(t[s],e),r()}]},useEffect(n,r){const o=e++,s=t[o],a=!r,i=!s||!r.every((t,e)=>t===s[e]);(a||i)&&(t[o]=r,n())}}}(),e=(t,e)=>t.querySelectorAll(e),n=(t,e)=>t.querySelector(e),r=40,o="power4",s={focus:.5,shrink:.2,follow:.6,fade:300},a={text:".txt, .txt *:not(dfn, a), .ce-block__content, .ce-block__content *, textarea, input",forum:".forum, .forum *, .spy, .spy *, dfn",btn:".btn, .btn *",profileSymbol:".subject__profileSymbol",barbaContainer:'section[data-barba="container"]',progressPath:".progress-wrap path",cursor:"#cursor",cursorFollow:"#cursorFollow",postbody:".postbody",forumEl:".forum",link:".switcheroo__squircle--button, .switcheroo__squircle--button *, .switcheroo__delete, a[href]:not(.no-cursor):not(:where(.btn *, .spy *)):not(.btn, .spy), a[href]:not(.no-cursor):not(:where(.btn *, .spy *)) *, .marker:not(.temp), .marker:not(.temp) *, .link, .link *",map:"#map canvas"};function i(t){const e=t.getBoundingClientRect();return{x:e.left,y:e.top,w:e.width,h:e.height}}function l(t,e){t.animate({opacity:e},{duration:s.fade,fill:"forwards"})}const c={cursor:document.querySelector(a.cursor),cursorFollow:document.querySelector(a.cursorFollow),postbody:document.querySelectorAll(a.postbody),progressPath:document.querySelector(a.progressPath),forums:document.querySelectorAll(a.forumEl),stopFollow:!1,init(){this.bindEvents(),this.bindScroll()},bindEvents(){document.addEventListener("mouseenter",()=>{l(this.cursor,1),l(this.cursorFollow,1)}),document.addEventListener("mouseleave",()=>{l(this.cursor,0),l(this.cursorFollow,0)}),document.addEventListener("mousemove",t=>{const{pageX:e,pageY:n,target:r}=t;r instanceof Element&&(this.cursor.style.left=e+"px",this.cursor.style.top=n+"px",this.updateCursorBadges(r),r.matches(a.btn)?this.handleBtnFocus(r):r.matches(a.profileSymbol)?this.handleProfileSymbolFocus(r):this.resetFollowSize(),this.stopFollow||(this.cursorFollow.classList.remove("static"),this.cursor.classList.remove("hide"),gsap.to(this.cursorFollow,{top:n,left:e,duration:s.follow,ease:o})))}),document.addEventListener("scroll",t=>{"container"===t.target.dataset.barba&&this.updateProgress()},!0),document.addEventListener("pointerleave",t=>{if(!(t.target instanceof Element))return;const e=t.target.closest(".btn, .subject__profileSymbol");e&&(e.contains(t.relatedTarget)||(this.stopFollow=!1,this.cursorFollow.classList.remove("static","large"),this.cursor.classList.remove("hide","grow"),gsap.killTweensOf(this.cursorFollow),gsap.killTweensOf(this.cursor),gsap.to(this.cursorFollow,{width:40,height:40,duration:.5,ease:"circ.out"})))},!0)},updateCursorBadges(t){t.matches(a.text)?this.cursor.classList.add("text"):this.cursor.classList.remove("text"),t.matches(a.forum)?this.cursor.classList.add("eye"):this.cursor.classList.remove("eye"),t.matches(a.link)?(this.cursor.classList.add("grow"),this.cursorFollow.classList.add("large")):(this.cursor.classList.remove("grow"),this.cursorFollow.classList.remove("large")),t.matches(a.map)?(this.cursor.classList.add("crosshair"),this.cursorFollow.classList.add("shrink")):(this.cursor.classList.remove("crosshair"),this.cursorFollow.classList.remove("shrink"))},handleBtnFocus(t){this.stopFollow=!0;const e=t.closest(".btn"),{x:n,y:r,w:a,h:l}=i(e);this.cursorFollow.classList.add("static"),gsap.to(this.cursorFollow,{top:r+l/2,left:n+a/2,width:a,height:l,duration:s.focus,ease:o})},handleProfileSymbolFocus(t){this.stopFollow=!0;const e=t.closest(".subject__profileSymbol"),{x:n,y:r,w:a,h:l}=i(e);gsap.to(this.cursorFollow,{top:r+l/2,left:n+a/2,width:a,height:l,duration:s.focus,ease:o})},resetFollowSize(){this.stopFollow=!1,gsap.to(this.cursorFollow,{width:r,height:r,duration:s.shrink,ease:o})},bindScroll(){if(!this.progressPath)return;const t=this.pathLength();this.progressPath.style.strokeDasharray=`${t} ${t}`,this.updateProgress()},currentContainer:()=>document.querySelector(a.barbaContainer),updateProgress(){if(!this.progressPath)return;const t=this.currentContainer();if(!t)return;const e=t.scrollTop,n=t.scrollHeight-window.innerHeight,r=this.pathLength()-e*this.pathLength()/n;this.progressPath.style.strokeDashoffset=r},pathLength(){return this.progressPath.getTotalLength()}};let u=null;function d(){if(!window.gsap)return null;if(u)return u;try{window.CustomEase&&(gsap.registerPlugin(CustomEase),u=gsap.parseEase?.("custom")||CustomEase.create("custom","M0,0,C0.625,0,0,1,1,1"))}catch{}return u||(u="power4.out"),u}const h={transform:"scaleX(0)"},p={transform:"scaleX(1)"},m={left:0,width:"100%"},f={left:"100%",width:"0%"},g={autoAlpha:0},y={autoAlpha:1},b={height:"0%"},v={height:"100%"},w={width:"0%"},S={width:"100%"},L=(t,e)=>t.querySelectorAll(e);function E(t=document,e){const n=d();if(!window.gsap||!n)return void e?.();const r=gsap.timeline({ease:n,onComplete:e});return L(t,".bb").forEach((t,e)=>r.to(t,{width:"100%",duration:.2,delay:.03*e},"h")),L(t,".br").forEach((t,e)=>r.to(t,{height:"100%",duration:.2,delay:.03*e},"v")),L(t,".bl").forEach((t,e)=>r.to(t,{height:"100%",duration:.2,delay:.03*e},"v")),L(t,".bt").forEach((t,e)=>r.to(t,{width:"100%",duration:.2,delay:.03*e},"h")),L(t,".bg-hash-v").forEach((t,e)=>r.to(t,{width:"100%",duration:.4},"h")),r}let C=null;const _=()=>C;function x({container:t}){const r=d();if(!window.gsap||!r)return null;const o=n(document,"#map");try{C?.kill()}catch{}const s=gsap.timeline({defaults:{duration:1,ease:r},onReverseComplete:()=>{C=null,t.classList.add("onLoad")}}),a=e(o,".anim-bg-cover"),i=e(o,".anim-bg"),l=e(o,".anim-fade");e(o,".anim-fadeFromLeft-50"),e(o,".anim-fadeUp");const c=e(o,".anim-bb, .anim-bt"),u=e(o,".anim-br, .anim-bl"),L=(t,e,n,r)=>{return(o=t)&&o.length>0?void 0!==r?s.fromTo(t,e,n,r):s.fromTo(t,e,n):s;var o};return L(a,h,p),L(a,m,f,.3),L(i,h,p,.3),L(l,g,{...y,stagger:.033},.4),L(c,w,{...S,stagger:.033},.4),L(u,b,{...v,stagger:.033},.4),(t=>{C=t})(s),s}class A{constructor(t,e={}){this.options={badgeClass:"notification-badge",badgeCounterClass:"notification-counter",animationSpeed:150,countLimit:99,activeClass:"notification-badge--active",limitClass:"notification-badge--limit",...e},t?(this.element=t,this.badgeElement=null,this.badgeCounterElement=null,this.renderIfNeeded()):console.error("[Badge] host element is null/undefined.")}renderIfNeeded(){let t=this.element.querySelector("."+this.options.badgeClass);t||(t=document.createElement("span"),t.className=this.options.badgeClass,t.innerHTML=`<span class="${this.options.badgeCounterClass}">0</span>`,this.element.appendChild(t)),this.badgeElement=t,this.badgeCounterElement=t.querySelector("."+this.options.badgeCounterClass)}set(t=0){if(!this.element)return!1;if(this.renderIfNeeded(),"number"!=typeof t||Number.isNaN(t)||t<0)return console.error(`[Badge] invalid value: ${t}`),this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;if(0===t)return this.badgeElement?.classList.remove(this.options.activeClass),this.badgeCounterElement&&(this.badgeCounterElement.textContent=""),!1;t>this.options.countLimit?this.badgeElement?.classList.add(this.options.limitClass):this.badgeElement?.classList.remove(this.options.limitClass),this.badgeElement&&!this.badgeElement.classList.contains(this.options.activeClass)&&this.badgeElement.classList.add(this.options.activeClass);const e=this.badgeCounterElement;if(!e)return!1;if(String(e.textContent).trim()===String(t))return!0;const n=e.cloneNode(!1);return n.textContent=t,n.classList.add(this.options.badgeCounterClass+"--new"),e.classList.add(this.options.badgeCounterClass+"--old"),e.after(n),requestAnimationFrame(()=>{n.classList.remove(this.options.badgeCounterClass+"--new"),setTimeout(()=>{try{e.remove()}catch{}this.badgeCounterElement=n},this.options.animationSpeed)}),!0}get(){const t=parseInt(this.badgeCounterElement?.textContent||"0",10);return Number.isNaN(t)?0:t}increase(t=1){return this.set(this.get()+t)}decrease(t=1){return this.set(Math.max(0,this.get()-t))}destroy(){if(!this.element)return;const t=this.element.querySelector("."+this.options.badgeClass);t&&t.remove(),this.badgeElement=null,this.badgeCounterElement=null,this.element=null}}const q='section[data-barba="container"]',k=".progress-wrap path";let $=!1;const T=new Map;function F(t,e){T.set(t,{...e||{}})}function N({cursor:e}={}){if($)return{destroy:j};if($=!0,!window.barba?.init){console.warn("[barba] introuvable. Charge @barba/core avant initBarba().");const e=document.querySelector(q)||document;return t.container=e,E(e,()=>{}),{destroy:j}}t.container=document.querySelector(q)||document;const n=document.getElementById("menu"),r=n?.querySelector(".notification"),o=new A(r);return barba.init({prevent:({el:t})=>t?.hasAttribute?.("data-barba-prevent"),transitions:[{name:"lines-and-reveal",beforeOnce(t){const e=this.async(),n=t?.next?.namespace,r=n?T.get(n):null;try{r?.beforeOnce?.(t)}catch(t){console.error("[barba:beforeOnce ns]",t)}E(t.next.container,e),o.set(5)},once(t){console.debug("[barba] once ns=",t?.next?.namespace);const e=t?.next?.namespace,n=e?T.get(e):null;try{n?.once?.(t),n?.afterEnter?.(t)}catch(t){console.error("[barba:once ns hook]",t)}const r=this.async(),o=t.next.container.querySelectorAll(".content, .contents");o.length?gsap.to(o,{alpha:1,stagger:.03,onComplete:r}):r()},before(t){const e=t?.current?.namespace,n=e?T.get(e):null;try{n?.before?.(t)}catch(t){console.error("[barba:before ns]",t)}const r=this.async();(function(t=document,e={}){const n=t.querySelectorAll(".content, .contents");return n&&0!==n.length?gsap.to(n,{alpha:0,stagger:.03,...e}):null})(t.current.container,{onComplete:r})||r()},async leave(t){const e=t?.current?.namespace,n=e?T.get(e):null;if(n?.leave)try{await n.leave(t)}catch(t){console.error("[barba:leave]",t)}const r=this.async();!function(t=document,e){const n=d();if(!window.gsap||!n)return void e?.();const r=gsap.timeline({ease:n,onComplete:e});L(t,".br").forEach((t,e)=>r.to(t,{top:e%2?0:"+=100%",height:0,duration:.2,delay:.03*e},"v")),L(t,".bl").forEach((t,e)=>r.to(t,{top:e%2?0:"+=100%",height:0,duration:.2,delay:.03*e},"v")),L(t,".bb").forEach((t,e)=>r.to(t,{left:e%2?0:"+=100%",width:0,duration:.2,delay:.03*e},"h")),L(t,".bg-hash-v").forEach((t,e)=>r.to(t,{width:"0%",duration:.4},"h"))}(t.current.container,r)},async enter(n){console.debug("[barba] enter ns=",n?.next?.namespace),t.container=n.next.container,function(t,e){if(!e||!e.progressPath)return;const n=t?.querySelector?.(k);n&&(e.progressPath=n);try{const t=e.pathLength();e.progressPath.style.strokeDasharray=`${t} ${t}`,e.updateProgress()}catch{}}(n.next.container,e);const r=n?.next?.namespace,o=r?T.get(r):null;if(o?.enter)try{await o.enter(n)}catch(t){console.error("[barba:enter]",t)}const s=this.async();E(n.next.container,()=>{n.next.container,s()})},afterEnter(t){console.debug("[barba] afterEnter ns=",t?.next?.namespace);const e=t?.next?.namespace,n=e?T.get(e):null;try{n?.afterEnter?.(t)}catch(t){console.error("[barba:afterEnter]",t)}const r=this.async();(function(t=document,e={}){const n=t.querySelectorAll(".content, .contents");return n&&0!==n.length?gsap.to(n,{alpha:1,stagger:.03,...e}):null})(t.next.container,{onComplete:r})||r()}}]}),{destroy:j}}function j(){try{barba&&barba.destroy&&barba.destroy()}catch{}T.clear(),$=!1}function M(t){const e=t?.querySelectorAll?.("dl")||[],n={};return e.forEach(t=>{const e=t.querySelector("dt"),r=(e?.textContent||"").replace(/[*:]/g,""),o=r.toString().toLowerCase().normalize("NFD").trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-");const s=t.querySelector("dd input, dd textarea, dd select");if(s){const e=s.tagName.toLowerCase(),a="select"===e?s.value:(s.value||"").trim();n[o]={title:r,type:e,value:a,validate:()=>!0,inputHTML:s,originalHTML:t}}}),n}async function I(t){const e=t?.currentTarget;if(!e)return;const n=e.contentDocument||e.contentWindow?.document,r=e.contentWindow?.location?.href||"";if(!n)return;const o=n.querySelector("#cp-main");if(!o)return;const s=o.cloneNode(!0),a=s.querySelectorAll("fieldset"),i=e.closest('section[data-barba="container"]')||document,l=function(t="",e=document){let n=1;return t.includes("step=2")&&(n=2),e.querySelector("form#form_confirm")&&(n=6),e.querySelector(".randommessageclass")&&(n=7),n}(r,s),c={1:()=>{},2:async()=>{var t,e;a.length>=2&&(t=a[0],e=a[1],M(t),M(e)),function(t,e){const n=t.querySelector(`.register__panel:nth-child(${e})`);n&&((t=>{const e=[];if(!t?.parentNode)return e;let n=t.parentNode.firstChild;for(;n;)1===n.nodeType&&n!==t&&e.push(n),n=n.nextSibling;return e})(n).forEach(t=>t.classList.remove("isOpen")),n.classList.add("isOpen"))}(i,2),await new Promise(t=>setTimeout(t,400)),function(t,e){const n=t.querySelector(`.register__panel:nth-child(${e}) .register__panelContentWrapper`);n?.remove()}(i,1)},3:()=>{},6:()=>{},7:()=>{}};c[l]&&await c[l]()}function B(n=t.container){const r=n||document;e(r,".postbody__date-time").forEach(t=>{t.innerHTML=new Tyme(t).fromNow()});r.querySelectorAll(".postbody").forEach(t=>{const e=t.querySelector(".grid-content");if(!e)return;const n=t=>t.replace(/^\s+|\s+$/g,""),r=[];for(let t=0;t<e.childNodes.length;t++){const o=e.childNodes[t];if(3===o.nodeType){const t=document.createElement("p");t.innerHTML=n(o.nodeValue),o.parentNode.insertBefore(t,o.nextSibling),e.removeChild(o),r.push(t)}else r.push(o)}const o=r.filter(t=>"BR"!==t.nodeName).filter(t=>"P"===t.nodeName&&0===t.childNodes.length),s=document.createDocumentFragment();for(let t=0;t<o.length;++t)s.appendChild(o[t]);e.appendChild(s)});const o=()=>{const t=JSON.parse(localStorage.getItem("hiddenProfiles"));null!==t&&(0===t.length&&r.querySelectorAll(".subject__profileAvatar").forEach(t=>{t.classList.remove("blurred")}),t.forEach(t=>{const e=r.querySelectorAll(`.subject__profileAvatar > a[href ^= "/${t}"]`),n=r.querySelectorAll(`.subject__profileAvatar > a:not([href ^= "/${t}"])`);e.forEach(t=>t.closest(".subject__profileAvatar").classList.add("blurred")),n.forEach(t=>t.closest(".subject__profileAvatar").classList.remove("blurred"))}))};r.querySelectorAll(".subject__profileEye").forEach(t=>{t.addEventListener("click",()=>{((t,e)=>{let n=JSON.parse(localStorage.getItem(t));null==n&&(n=[]);const r=n.indexOf(e);-1===r?n.push(e):n.splice(r,1),localStorage.setItem(t,JSON.stringify(n))})("hiddenProfiles",t.closest(".subject__profileAvatar").querySelector('a[href^="/u"]').pathname.replace(/^./,"")),o()})}),o();r.querySelectorAll(".pfield").forEach(function(t){var e=t.textContent.split(" ")[0].toLowerCase().replace(/'/g,"").replace(/\(|\)/g,"");t.closest(".pfield").classList.add(e)});const s=(t,e,n)=>{const r=t.querySelectorAll(`.pfield.${e} `);let o="";return r.forEach(t=>{o=t.querySelector(".pcontent")?.textContent||"",t.closest(".subject__profileWrapper").querySelector(n)?.appendChild(t)}),o},a=(t,e,n,r)=>{const o=t.querySelectorAll(`.pfield.${e} `);if(!o||!o.length)return;const[s,a]=o,i="djinn"==r?s.querySelector(".plabel span[style]").textContent.split(")")[0]+=")":"Vœu",l=s.querySelector(".pcontent")?.textContent||"",c=a.querySelector(".pcontent")?.textContent||"";console.log(i,l,c);const u=t.querySelector(`.subject__symbolsTrack .${n} .label`);console.log(u),u&&(u.innerText=i);const d=t.querySelector(`.subject__symbolsTrack .${n} .content`);d&&(d.innerText=l);const h=t.querySelector(`.subject__symbolsTrack .${n} .desc`);h&&(h.innerText=c)};r.querySelectorAll(".subject__profileBlock").forEach(t=>{const e=(t=>{const e=t.querySelector(".username strong");return e?(e.innerHTML=e.innerText.split("").map(t=>t.trim()?"<div>"+t+"</div>":"<div>&nbsp</div>").join(""),e):null})(t),n=(t=>{if(!t)return null;const e=t.parentElement.style.color;return t.closest(".subject__post").style="--accentColor:"+e,e})(e),r=(t=>{const e={djinn:"rgb(255, 107, 139)",human:"rgb(115, 169, 255)"};return Object.keys(e).find(n=>e[n]===t)})(n),o=[],i=["ouverture","conscienciosité","extraversion","agréabilité","neuroticisme"],l={messages:".subject__profileNumbers",points:".subject__profileNumbers",ouverture:".subject__profileChart div","conscienciosité":".subject__profileChart div",extraversion:".subject__profileChart div","agréabilité":".subject__profileChart div",neuroticisme:".subject__profileChart div","âge":".subject__profileFacts",pronoms:".subject__profileFacts",faceclaim:".subject__profileFacts",citation:".subject__profileQuote"};for(const[e,n]of Object.entries(l)){const r=s(t,e,n);i.indexOf(e)>-1&&o.push(Number(r)||0)}var c;!function(t){const e=t.querySelector(".pfield.niveau"),n=t.querySelector(".subject__profileEnmity");if(!e)return;switch((e.querySelector(".pcontent")?.textContent||"").toLowerCase()){case"normal":n.querySelector(".level-1").classList.add("show");break;case"surveillé":n.querySelector(".level-2").classList.add("show");break;case"recherché":n.querySelector(".level-3").classList.add("show")}}(t),((t,e,n)=>{const r=t.querySelector(".subject__profileChart canvas");r&&window.Chart&&new Chart(r,{type:"line",data:{labels:["O","C","E","A","N"],datasets:[{data:n,borderWidth:2,borderColor:e,fill:!0,backgroundColor:e}]},options:{aspectRatio:8,maintainAspectRatio:!1,animations:{tension:{duration:1e3,easing:"easeInQuad",from:0,to:.4,loop:!0}},scales:{y:{display:!1,min:-10,max:10},x:{display:!1}},layout:{padding:0},elements:{point:{pointRadius:0}},plugins:{tooltip:{enabled:!1},title:{display:!1},subtitle:{display:!1},legend:{display:!1}}}})})(t,n,o),(c=t).querySelectorAll(".subject__profileSymbol").forEach(t=>{const e=t.dataset.symbol;t.addEventListener("mouseenter",t=>{const n=t.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");n&&(n.dataset.symbol=e)})}),c.querySelectorAll(".subject__profileMeta").forEach(t=>{t.addEventListener("mouseenter",t=>{const e=t.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");e?.classList.add("symbol")}),t.addEventListener("mouseleave",t=>{const e=t.target.closest(".subject__profileBlock").querySelector(".subject__profileAvatar");e?.classList.remove("symbol")})}),a(t,"salt","body",r),a(t,"mercury","mind",r),a(t,"sulfur","soul",r)})}function D(t,e=0,n=0){const r=t.getSouthWest(),o=t.getNorthEast(),s=(o.lng-r.lng)*e,a=(o.lat-r.lat)*n;return new maplibregl.LngLatBounds([r.lng+s,r.lat+a],[o.lng+s,o.lat+a])}function O(t,e="lat",n=4,r=!0){return function({d:t,m:e,s:n,hemi:r,type:o},{precision:s=4,pad:a=!0}={}){return`${String(t).padStart("lon"===o?3:2,"0")}° ${a?String(e).padStart(2,"0"):String(e)}' ${a?Number(n).toFixed(s).padStart(s?4+s:2,"0"):Number(n).toFixed(s)}" ${r}`}(function(t,e="lat",n=4){const r="lat"===e?t>=0?"N":"S":t>=0?"E":"W";let o=Math.abs(Number(t)),s=Math.floor(o),a=60*(o-s),i=Math.floor(a),l=60*(a-i);const c=Math.max(0,0|n);return l=Number(l.toFixed(c)),l>=60&&(l-=60,i+=1),i>=60&&(i-=60,s+=1),{d:s,m:i,s:l,hemi:r,type:e}}(t,e,n),{precision:n,pad:r})}function P(t){if(!t)return"";const e=t.querySelector?.('.color-groups[style*="color"]')||t,n=e?.style.color||e?.getAttribute("style")||"";return n||""}class R{constructor({map:t,topicsContainerSelector:e=".map__asideContainer.topicList",newTopicAsideSelector:r=".map__asideContainer.newTopic"}={}){this.map=t,this.topicsContainer=n(document,e)||null,this.asideContainer=n(document,r)||null,this.toggleButton=n(this.asideContainer,".newTopic__closeButton")||null,this.isCreating=!1,this.isAsideOpened=!1,this.subjectInput=n(this.asideContainer,'[name="subject"], #newTopicSubject')||null,this.messageInput=n(this.asideContainer,'[name="message"], #newTopicMessage')||null,this.coordsInput=n(this.asideContainer,'[name="coords"], #newTopicCoords')||null,this.districtInput=n(this.asideContainer,'[name="district"], #newTopicDistrict')||null,this.coordsDecimalEl=n(this.asideContainer,"[data-coords-decimal]")||null,this.coordsDMSEl=n(this.asideContainer,"[data-coords-dms]")||null,this._bindAsideEvents(),this._loadState()}_bindAsideEvents(){this.toggleButton&&this.toggleButton.addEventListener("click",()=>this.toggleAside()),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.isAsideOpened&&this.closeAside()});const t=()=>this._saveState();this.subjectInput?.addEventListener("input",t),this.messageInput?.addEventListener("input",t)}_loadState(){try{const t=localStorage.getItem("newTopic");if(!t)return;const{coords:e,district:n,subject:r,message:o}=JSON.parse(t);e&&(this.isCreating={coords:e,district:n,subject:r,message:o}),this.subjectInput&&(this.subjectInput.value=r||""),this.messageInput&&(this.messageInput.value=o||""),this.districtInput&&(this.districtInput.value=n||""),e&&this._updateCoordDisplays(e),this.toggleButton?.classList.add("show")}catch{}}_saveState(){if(this.isCreating)try{const t={coords:this.isCreating.coords||null,district:this.isCreating.district||this.districtInput?.value||"",subject:this.subjectInput?.value||"",message:this.messageInput?.value||""};localStorage.setItem("newTopic",JSON.stringify(t))}catch{}}_readDraft(){const t=localStorage.getItem("newTopic");return t?JSON.parse(t):null}_writeDraft(t){try{localStorage.setItem("newTopic",JSON.stringify(t))}catch{}}getDraft(){return this._readDraft()}_updateCoordDisplays(t){const{lng:e,lat:n}=Array.isArray(t)?{lng:t[0],lat:t[1]}:t;this.coordsInput&&(this.coordsInput.value=`${e},${n}`),this.coordsDecimalEl&&(this.coordsDecimalEl.textContent=`${e.toFixed(6)}, ${n.toFixed(6)}`),this.coordsDMSEl&&(this.coordsDMSEl.textContent=`${O(e,"lon",4)}, ${O(n,"lat",4)}`)}initNewTopic(t,e){this.isCreating={coords:t,district:e},this._saveState(),this.openAside(),this.moveNewTopic(t,e)}moveNewTopic(t,e){t&&(this.isCreating={...this.isCreating,coords:t,district:e??this.isCreating?.district},this._updateCoordDisplays(t),this._saveState(),this.openAside())}setDistrict(t){this.isCreating={...this.isCreating,district:t},this.districtInput&&(this.districtInput.value=t||""),this._saveState()}toggleAside(){this.isAsideOpened?this.closeAside():this.openAside()}openAside(){this.asideContainer&&(this.asideContainer.classList.add("active"),this.topicsContainer?.classList.remove("active"),this.isAsideOpened=!0)}closeAside(){this.asideContainer&&(this.asideContainer.classList.remove("active"),this.isAsideOpened=!1)}}async function H({styleUrl:t="http://127.0.0.1:8080/dark_matter.json",selectors:e={trigger:"#navigate",container:"#map",mapContainer:"#map-content",board:"#board",cursor:"#cursor",topics:"#map-topics",layoutBoard:".map__asideContainer.topicList",newTopic:".map__asideContainer.newTopic"},animations:r={},forumId:o=1,topicsLimit:s=12}={}){const{mapAnimation:a}=r||{},i=document.querySelector(e.trigger),l=document.querySelector(e.container),c=document.querySelector(e.mapContainer),u=document.querySelector(e.cursor),d=document.querySelector(e.board),h=document.querySelector(e.topics),p=document.querySelector(e.layoutBoard),m=document.querySelector(e.newTopic);l&&c||console.warn("[Map] container/mapHost missing:",e);const f=new AbortController,g=await async function({forumId:t=1,limit:e=12,signal:r}={}){try{const o=await fetch(`/f${t}-`,{credentials:"same-origin",signal:r}),s=await o.text(),a=(new DOMParser).parseFromString(s,"text/html");return Array.from(a.querySelectorAll("a.topictitle")).slice(0,e).map(t=>{try{const e=t.getAttribute("href"),r=new URL(e,location.origin).href,o=t.closest(".row, .topic-row, tr"),s=(t.textContent||"Untitled").trim(),a=n(o,".topic-author a, .username a, .topic-author > a"),i=a?new URL(a.getAttribute("href"),location.origin).href:"",l=a?.textContent?.trim()||o?.querySelector(".topic-author")?.textContent?.replace(/\s*par\s*/i,"").trim()||"",c=P(a),u=n(o,".posts, .topic-replies")?.textContent?.trim()||"",d=n(o,".topic-description, .topic-desc")?.textContent?.trim()||"",h=r.match(/t(\d+)-/),p=h?h[1]:"",m=(s+"\n"+d).match(/\[(.+?),\s*(.+?)\]/);if(!m)return null;const f=parseFloat(m[1]),g=parseFloat(m[2]);if(!Number.isFinite(f)||!Number.isFinite(g))return null;const y=n(o,".lastpost"),b=n(y,"img"),v=n(y,'a[href^="/u"]'),w=P(v),S=n(y,'a[href^="/t"]'),L=n(y,".lastpost-infos"),E=new Tyme(L?.lastChild.textContent.trim())||"";return console.log({lastpost_avatar:b,lastpost_user:v,lastpost_color:w,lastpost_link:S,lastpost_date:E}),{id:p,title:s,desc:d,url:r,author:{name:l,url:i,color:c},replies:u,coords:[f,g],lastpost:{avatar:b?new URL(b.src):null,user:v?{name:v.textContent.trim(),url:new URL(v.href),color:w}:null,link:S?new URL(S.href):null,date:{day:E.parseToFormat("DD")||"",month:E.parseToFormat("MM")||"",year:E.parseToFormat("YYYY")||"",time:E.parseToFormat("HH:mm")||"",full:E.toString()||""}}}}catch(t){return console.error("[Map] fetchForumTopics error:",t),null}}).filter(Boolean)}catch(t){return console.warn("[Map] fetchForumTopics error:",t),[]}}({forumId:o,limit:s,signal:f.signal})||[];let y=null;const b=new Map;let v=null,w=null,S=null,L=null;const E="districts-fill",C=new maplibregl.LngLatBounds([4.825,52.33],[5.015,52.397]),x=[4.89361,52.37278];function A(){try{return _()||null}catch{return null}}function q(){return Boolean(y?.getStyle()?.layers?.some(t=>t.id===E))}function k(t){if(!y)return!1;if(!q())return!0;const e=y.queryRenderedFeatures(t,{layers:[E]});return e&&e.length>0}function $(t){if(!y||!q())return null;const e=y.queryRenderedFeatures(y.project(t),{layers:[E]});return e&&e.length>0&&(e[0].properties?.Stadsdeel||e[0].id)||null}function T(t,{zoom:e=16,padX:n=0,padY:r=0,duration:o=450}={}){y&&y.easeTo({center:t,zoom:Math.max(y.getZoom(),e),offset:[n,r],duration:o})}function F(){if(!h)return;let t=null;function e(){t&&(t.classList.remove("marker-label--hover"),t=null)}h.addEventListener("mouseover",n=>{const r=n.target.closest(".map__topicsList-item");if(!r||!h.contains(r))return;const o=r.dataset.topicId;if(o&&b?.has(o)){!function(t){const e=b.get(String(t));if(!e||!y)return;const n=e.getLngLat();p?.classList.contains("active")&&p.offsetWidth,m?.classList.contains("active")&&m.offsetWidth,T(n);try{const t=e.getElement();t.classList.add("is-hovered"),setTimeout(()=>t.classList.remove("is-hovered"),700)}catch{}}(o);!function(e){try{const n=e?.getElement?.(),r=n?.querySelector?.(".marker-label")||null;t&&t!==r&&t.classList.remove("marker-label--hover"),r&&r.classList.add("marker-label--hover"),t=r||null}catch{t&&(t.classList.remove("marker-label--hover"),t=null)}}(b.get(o))}else if(r.dataset.lng&&r.dataset.lat){const t=[parseFloat(r.dataset.lng),parseFloat(r.dataset.lat)];Number.isFinite(t[0])&&Number.isFinite(t[1])&&T(t,{zoom:16.4,duration:600}),e()}}),h.addEventListener("mouseout",t=>{const n=t.target.closest(".map__topicsList-item");n&&(t.relatedTarget&&n.contains(t.relatedTarget)||e())}),h.addEventListener("mouseleave",e)}function N(t){if(!y)return;if(e=t.originalEvent?.target,e?.closest?.(".marker, .maplibregl-marker, .mapboxgl-marker"))return;var e;if(!k(t.point))return;j(t.lngLat),T(t.lngLat,{zoom:16.4,duration:600});const n=$(t.lngLat);L?.moveNewTopic(t.lngLat,n),L?.openAside();const r=L?.subjectInput?.value?.trim();r&&M(r)}function j(t){if(!y)return null;const e=Array.isArray(t)?{lng:t[0],lat:t[1]}:t;if(w)w.setLngLat(e);else{const t=document.createElement("div");t.className="marker temp",t.innerHTML="<div class=\"marker-label marker-label--temp\" hidden></div><div class='marker-pulse'></div>",w=new maplibregl.Marker({element:t}).setLngLat(e),w.addTo(y)}const n=`Lng: ${Number(e.lng).toFixed(6)}\nLat: ${Number(e.lat).toFixed(6)}`;return w.getPopup()?.setText(n),w}function M(t){if(!w)return;const e=w.getElement?.()||w._element||null;if(!e)return;let n=e.querySelector(".marker-label");n||(n=document.createElement("div"),n.className="marker-label marker-label--temp",e.prepend(n));const r=(t||"").trim();n.textContent=r,n.hidden=!r.length}function I(){try{"function"==typeof a&&i&&l&&(i.classList.add("active"),l.classList.remove("onLoad"),a({container:l}))}catch(t){console.error("[Map] mapAnimation error:",t)}}function B(){const t=A();t&&t.timeScale(2).reverse(),i?.classList.remove("active"),p?.classList.remove("active"),m?.classList.remove("active")}function H(t){t?.preventDefault?.();const e=A();e&&e.progress()>0&&!e.reversed()?B():I()}function z(){if(f.abort(),i?.removeEventListener("click",H),d?.replaceWith(d.cloneNode(!0)),y){try{y.off("mousemove",S),y.off("click",N)}catch{}try{w?.remove()}catch{}try{y.remove()}catch{}y=null}}if(!maplibregl)return console.error("[Map] maplibregl missing. Inject the script before init."),{open:I,close:B,destroy:z};d?.addEventListener("click",t=>{t?.preventDefault?.(),p?.classList.toggle("active"),m?.classList.remove("active")});try{y=new maplibregl.Map({style:t,center:x,pitch:45,bearing:-17.6,container:c||e.mapContainer,canvasContextAttributes:{antialias:!0},attributionControl:!1,maxBounds:D(C,-.18,0),dragRotate:!1}),window.map=y,L=new R({map:y}),L?.subjectInput?.addEventListener("input",t=>{M(t.currentTarget.value)}),S=function(t){let e=!1;return function(...n){e||(e=!0,requestAnimationFrame(()=>{try{t.apply(this,n)}finally{e=!1}}))}}(function(t){if(!u)return;const e=!k(t.point);u.classList.toggle("out",e);const{lng:n,lat:r}=t.lngLat;u.dataset.coords=`${O(n,"lon",4)}, ${O(r,"lat",4)}`}),y.on("mousemove",S),y.on("click",N),y.on("load",()=>{try{v=y.cameraForBounds(D(C,-.18,0),{bearing:-17.6,pitch:45,maxZoom:12.62,offset:[-600,0]}),v&&y.jumpTo(v),y.easeTo({...v,offset:[-600,0],duration:600})}catch{}!function(){if(!y||!Array.isArray(g)||!g.length)return[];const t=[];g.forEach(e=>{try{if(!e||!Array.isArray(e.coords)||2!==e.coords.length)return;const n=Array.isArray(e.coords)?{lng:e.coords[0],lat:e.coords[1]}:e.coords;if(!Number.isFinite(n.lng)||!Number.isFinite(n.lat))return;const r=e.title||"Untitled",o=document.createElement("div");o.className="marker",o.innerHTML=`<div class="marker-label">${r}</div><div class='marker-pulse'></div>`;const s=new maplibregl.Marker({element:o}).setLngLat([n.lng,n.lat]).addTo(y);t.push(s),e.id&&b.set(String(e.id),s)}catch(t){console.error("[Map] renderTopicMarkers error:",t)}});try{h&&h.appendChild(frag)}catch{}}(),function(){if(!Array.isArray(g)||!g.length||!h)return;const t=document.createElement("div");t.className="map__topicsList",g.forEach(e=>{const n=document.createElement("div");n.className="map__topicsList-item",n.dataset.topicId=String(e.id||""),n.dataset.lng=String(e.coords?.[0]??""),n.dataset.lat=String(e.coords?.[1]??"");const r=e.title||"Aucun titre à signaler";n.innerHTML=`\n            <div>\n                ${e.lastpost?.avatar?`<img src="${e.lastpost.avatar}" alt="Avatar" class="map__topicsList-item-avatar" />`:""}\n                <div class="map__topicsList-item-date">\n                    <span>${e.lastpost?.date.day||""}</span>\n                    <span>${e.lastpost?.date.month||""}</span>\n                </div>\n            </div>\n            <div>\n                <h4 class="map__topicsList-item-title"><a class="linkStriked" href="${e.url}">${r}</a></h4>\n                <p class="map__topicsList-item-meta">\n                 <span class="map__topicsList-item-district">${$({lng:e.coords[0],lat:e.coords[1]})||"Unknown District"}</span>\n                    <a href="${e.lastpost?.user?.profileUrl||"#"}" class="map__topicsList-item-author ">\n                        <span style="background-color:${e.lastpost?.user?.color||"inherit"}"></span>${e.lastpost?.user?.name.split(" ")[0][0]}. ${e.lastpost?.user?.name.split(" ")[1]||""}\n                    </a>\n                </p>\n            </div>\n\n            `,t.appendChild(n)}),h.innerHTML="",h.appendChild(t)}(),F();try{const t=L?.getDraft?.();if(t?.coords){const e=Array.isArray(t.coords)?{lng:t.coords[0],lat:t.coords[1]}:t.coords;j(e),L?.moveNewTopic([e.lng,e.lat],t.district||null),L?.openAside(),y.easeTo({...v,center:[e.lng,e.lat],zoom:Math.max(y.getZoom(),16.4)}),t.subject&&M(t.subject)}}catch(t){console.error("[Map] init error:",t)}!function(){if(y){y.resize();try{y.setMaxBounds(C),v=y.cameraForBounds(C,{padding:{top:32,right:32,bottom:32,left:32},bearing:y.getBearing(),pitch:y.getPitch(),maxZoom:(t=y.getZoom(),e=6,n=19,Math.max(e,Math.min(n,t)))})}catch{}var t,e,n}}()})}catch(t){console.error("[Map] init error:",t)}return i?.addEventListener("click",H),{open:I,close:B,destroy:z}}const z=(()=>{let t={};return e=>{if(e in t)return t[e];var n="";switch(e){case"Présent(e)":n="present";break;case"Réduite":n="slowed";break;case"Absent(e)":n="away"}return t[e]=n,n}})(),U=document.querySelectorAll('a[href^="/u"]'),J=async(t,e)=>{const n=[];await fetch(e).then(t=>t.text()).then(e=>{var r=(new DOMParser).parseFromString(e,"text/html");n.push({id:t,status:r.querySelector("#field_id16 div.field_uneditable").innerText})}),n.forEach(t=>{document.querySelectorAll(`a[href="/u${t.id}"] strong`).forEach(e=>{const n=document.createElement("span");n.classList.add("status",z(t.status)),e.appendChild(n)})})};class W{constructor(){for(const[t,e]of Object.entries((()=>{const t={};return U.forEach(e=>{const n=e.pathname,r=e.pathname.slice(2);t[r]=n}),t})()))J(t,e)}}let Y=null;function Z(){Y&&Y();const t=document.getElementById("menu"),e=document.getElementById("sidebar");if(!t||!e)return Y=null,()=>{};const n=()=>e.classList.contains("open"),r=n=>{e.classList.toggle("open",n),t.classList.toggle("active",n),t.setAttribute("aria-expanded",n?"true":"false")},o=t=>{t.stopPropagation(),r(!n())},s=t=>{!t.target.closest(".layout__menu")&&n()&&r(!1)},a=t=>{"Escape"===t.key&&n()&&r(!1)};return t.addEventListener("click",o),document.documentElement.addEventListener("click",s),document.addEventListener("keydown",a),r(n()),Y=()=>{t.removeEventListener("click",o),document.documentElement.removeEventListener("click",s),document.removeEventListener("keydown",a)},new W,Y}function Q(e={}){const n=e.updateHash??!0,r=e.duration??500,o=e.container||t.container||document,s=o?.querySelector?.(".faq");if(!s)return console.warn("[FAQ] .faq root not found"),{goTo:()=>{},next:()=>{},prev:()=>{},destroy:()=>{}};const a=s.querySelector(".faq__tab-slider")||function(t){const e=document.createElement("div");return e.className="faq__tab-slider",t.querySelector(".faq__tabs")?.appendChild(e)||t.appendChild(e),e}(s),i=s.querySelector(".faq__scroll"),l=Array.from(s.querySelectorAll(".faq__content")),c=Array.from(s.querySelectorAll(".faq__tab")),u=s.querySelector(".faq__container")||s,d=a?.parentElement||c[0]?.parentElement||s;if(!i||!c.length||!l.length)return console.warn("[FAQ] Missing pieces: ",{scroller:!!i,tabs:c.length,panels:l.length}),{goTo:()=>{},next:()=>{},prev:()=>{},destroy:()=>{}};c.forEach((t,e)=>{t.dataset.idx||(t.dataset.idx=String(e)),t.id||(t.id=`faq-tab-${e}`),t.setAttribute("role","tab"),t.setAttribute("tabindex","-1"),t.setAttribute("aria-selected","false")}),l.forEach((t,e)=>{t.setAttribute("role","tabpanel"),t.setAttribute("aria-labelledby",c[e]?.id||`faq-tab-${e}`)}),d?.setAttribute?.("role","tablist");let h=0,p=null,m=!1;const f=(t,e,n)=>Math.max(e,Math.min(n,t));function g(t){const e=t.parentElement||t;return{left:e.offsetLeft,width:e.offsetWidth}}function y(t,e=!1){if(!a||!t)return;const{left:n,width:o}=g(t),s=Number.parseFloat(a.style.left||0)||0,i=Number.parseFloat(a.style.width||0)||g(c[h])?.width||o;let l=null;try{l=injectedTimeline&&"function"==typeof injectedTimeline.to?injectedTimeline:_()}catch{l=null}const u=window.gsap&&"function"==typeof window.gsap.to?window.gsap:null,d=r/1e3;if(l&&"function"==typeof l.to)l.to(a,{left:`${n}px`,width:`${o}px`,ease:"power2.inOut",duration:d,overwrite:"auto"});else if(u)u.to(a,{left:`${n}px`,width:`${o}px`,ease:"power2.inOut",duration:d,overwrite:"auto"});else if(a.animate){const t=e?[`${i}px`,`${Math.max(200,(i+o)/2)}px`,`${o}px`]:[`${i}px`,`${o}px`],l=e?[`${s}px`,`${n}px`,`${n}px`]:[`${s}px`,`${n}px`];a.animate({left:l,width:t},{duration:r,fill:"forwards",easing:"cubic-bezier(0.4,0,0.2,1)"}),a.style.left=`${n}px`,a.style.width=`${o}px`}else a.style.left=`${n}px`,a.style.width=`${o}px`}function b(t){const e=l[t]?.querySelector?.(".content")||l[t];if(!e)return;const n=Math.max(e.scrollHeight,e.getBoundingClientRect().height);if(u.style.height=`${n}px`,p)try{p.disconnect()}catch{}window.ResizeObserver&&(p=new ResizeObserver(()=>{const t=Math.max(e.scrollHeight,e.getBoundingClientRect().height);u.style.height=`${t}px`}),p.observe(e))}function v(t,e){t=f(t,0,c.length-1);const r=h;var o,s,a;if(h=t,c.forEach((e,n)=>{const r=n===t;e.classList.toggle("active",r),e.setAttribute("aria-selected",r?"true":"false"),e.setAttribute("tabindex",r?"0":"-1")}),o=t,i.style.transform=`translateX(${-100*o}%)`,b(t),y(c[t],(s=r,a=t,Math.abs(s-a)>1)),n){const e=c[t].dataset.id||`${t}`,n=new URL(location.href);n.hash=e,history.replaceState(null,"",n)}!0===e&&c[t].focus()}function w(t){const e=t.currentTarget;v(Number(e.dataset.idx||0),!0)}function S(t){const{key:e}=t;if(!d.contains(document.activeElement))return;let n=h;if("ArrowRight"===e)n=f(h+1,0,c.length-1);else if("ArrowLeft"===e)n=f(h-1,0,c.length-1);else if("Home"===e)n=0;else{if("End"!==e)return;n=c.length-1}t.preventDefault(),v(n,!0)}function L(){y(c[h],!1),b(h)}c.forEach(t=>t.addEventListener("click",w)),window.addEventListener("keydown",S,!0),window.addEventListener("resize",L);try{let t=0;if(window.location.hash){const e=decodeURIComponent(window.location.hash.substring(1)),n=c.findIndex(t=>(t.dataset.id||"")==e);n>=0&&(t=n)}v(t,!1),a?.classList.add("visible")}catch(t){console.log("FAQ init error:",t)}function E(t){if(!m)if("number"==typeof t)v(t,!0);else if("string"==typeof t){const e=c.findIndex(e=>(e.dataset.id||"")===t);e>=0&&v(e,!0)}}return{goTo:E,next:function(){E(h+1)},prev:function(){E(h-1)},destroy:function(){m=!0,c.forEach(t=>t.removeEventListener("click",w)),window.removeEventListener("keydown",S,!0),window.removeEventListener("resize",L);try{p?.disconnect()}catch{}}}}n(document,"#menu"),n(document,"#board"),n(document,"#cursor"),n(document,"#cursorFollow"),n(document,"#mapPanel");const X=["top","right","bottom","left"],G=["🜁","🜃","🜂","🜄","🜍","☿","🜔","☉","☿","♃","♁","♆","🜊","🜅","🜖","🜋","🜏","♈︎","♉︎","♊︎","♋︎","♌︎","♍︎","♎︎","♏︎","♐︎","♑︎","♒︎","♓︎"];function K(t){if(" "===t)return'<span class="space"><span>&nbsp;</span></span>';const e=function(){const t=Math.floor(4*Math.random())+1,e=[...X].sort(()=>Math.random()-.5),n=[];for(let r=0;r<t;r++)n.push({direction:e[r],symbol:G[Math.floor(Math.random()*G.length)]});return n}(),n=t.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t]));return`<span class="letter"><span class="e-letter">${n}</span><span class="t-letter">${n}</span><b></b>${e.map(({symbol:t,direction:e})=>`<i class="symbol ${e}" data-dir="${e}">${t}</i>`).join("")}</span>`}function V(n=t.container){e(n,"enoch").forEach(t=>{const e=t.textContent;t.innerHTML=e.toLowerCase().toString().normalize("NFD").trim().replace(/[^a-z ]/g,"").split("").map(K).join("")})}const tt="/calendar",et="start",nt=".calendar__container",rt=".calendar__year",ot="h2",st="article > dl",at=".calendar__event",it=5,lt={key:t=>`calendar.timeline.year.${t}`,ttlMs:108e5,read(t){try{return JSON.parse(localStorage.getItem(this.key(t)))}catch{return null}},write(t,e){const n={version:1,updatedAt:Date.now(),checkedAt:Date.now(),events:e};return localStorage.setItem(this.key(t),JSON.stringify(n)),n},isStale(t){const e=this.read(t);return!e||Date.now()-(e.checkedAt||0)>this.ttlMs},touch(t){const e=this.read(t)||{};e.checkedAt=Date.now(),localStorage.setItem(this.key(t),JSON.stringify(e))}},ct=new Map,ut={active:!1,container:null,io:null,sentinel:null,activate(t){this.active=!0,this.container=t||document},kill(){if(this.active=!1,this.io){try{this.io.disconnect()}catch{}this.io=null}this.sentinel?.parentNode&&this.sentinel.remove(),this.sentinel=null;for(const[,t]of ct)clearTimeout(t);ct.clear(),this.container=null}},dt=t=>t.map(({ts:t,label:e,title:n,href:r,meta:o})=>({ts:t,label:e,title:n,href:r,meta:o})).sort((t,e)=>t.ts-e.ts),ht=(t,e)=>`${t}::${e.label}::${e.href||""}`,pt=(t,e=[],n=[])=>{if(e.length!==n.length)return!1;const r=new Set(e.map(e=>ht(t,e)));for(const e of n)if(!r.has(ht(t,e)))return!1;return!0},mt=(t,e)=>{return`${t}${n=e,String(n).padStart(2,"0")}01`;var n},ft=(t,e)=>t.querySelector(e),gt=(t,e)=>Array.from(t.querySelectorAll(e)),yt=()=>ft(document,nt)||document.body;const bt=()=>(new Date).getFullYear(),vt=t=>gt(yt(),rt).find(e=>ft(e,ot)?.textContent.trim()===String(t))||null;function wt(t){let e=vt(t);if(e)return e;e=document.createElement("div"),e.className="calendar__year grid grid--ratioReversed hasLines",e.innerHTML=`\n    <hr class="br" style="height: 100%;">\n    <h2>${t}</h2>\n    <article><dl></dl></article>\n  `;const n=yt(),r=n.querySelector('[data-cal-sentinel-bottom="true"]');return r?n.insertBefore(e,r):n.appendChild(e),e}const St=(t,e,n)=>`${t}::${e}::${n||""}`;function Lt(t){const e=t.querySelector(".calendar-day-date"),n=Array.from(t.querySelectorAll("a")).find(t=>/^\/t\d+-/i.test(t.getAttribute("href")||""));if(!n)return null;let r=null;if(e)try{const t=new URL(e.getAttribute("href"),location.origin).searchParams.get("d");t&&(r=1e3*Number(t))}catch{}if(!r&&e){const t=e.textContent.trim(),n=Date.parse(t.replace(/^[A-Za-zéûç]+\s+/i,""));Number.isNaN(n)||(r=n)}if(!r)return null;const o=new Date(r),s=o.getFullYear(),a=`${String(o.getDate()).padStart(2,"0")}.${String(o.getMonth()+1).padStart(2,"0")}`,i=n.getAttribute("href")||"",l=(n.textContent||"").trim();let c=null;const u=function(t){if(!t)return null;let e=t.match(/createTitle\(\s*this\s*,\s*'([\s\S]*?)'\s*,/);return e||(e=t.match(/createTitle\(\s*this\s*,\s*"([\s\S]*?)"\s*,/)),e?e[1].replace(/\\'/g,"'").replace(/\\"/g,'"'):null}(n.getAttribute("onmouseover")||n.getAttribute("onmousemove")||"");return u&&(c=function(t){const e=document.createElement("div");return e.innerHTML=t,{titleName:e.querySelector(".title-overview")?.textContent?.trim()||"",author:(()=>{const t=Array.from(e.querySelectorAll("p")).find(t=>/Auteur\s*:/.test(t.textContent));if(!t)return"";const n=t.textContent.replace(/\s+/g," ").trim().match(/Auteur\s*:\s*([^|<\n\r]+)/i);return n?n[1].trim():""})(),linkedDateText:(()=>{const t=Array.from(e.querySelectorAll("p")).find(t=>/Sujets\s+liés\s*:/.test(t.textContent));if(!t)return"";const n=t.textContent.replace(/\s+/g," ").trim().match(/Sujets\s+liés\s*:\s*(.+)$/i);return n?n[1].trim():""})(),excerpt:e.querySelector("#msg_ov")?.textContent?.trim()||""}}(u)),{ts:r,year:s,label:a,title:l,href:i,meta:c}}function Et(t){return gt(t,at).map(Lt).filter(Boolean).sort((t,e)=>t.ts-e.ts)}function Ct(t,e){const n=wt(t);let r=n.querySelector("article");r||(r=document.createElement("article"),n.appendChild(r)),r.innerHTML="";const o=document.createElement("dl");for(const t of e){const e=document.createElement("dt");e.textContent=t.label;const n=document.createElement("dd");if(t.href){const e=document.createElement("a");e.href=t.href,e.textContent=t.title||t.href,n.appendChild(e)}else n.textContent=t.title||"—";o.append(e,n)}r.appendChild(o)}async function _t(t,e){const n=`${tt}?${et}=${mt(t,e)}`,r=await fetch(n,{credentials:"same-origin"});if(!r.ok)return[];var o;return Et((o=await r.text(),(new DOMParser).parseFromString(o,"text/html"))).filter(e=>e.year===t)}async function xt(t){const e=[],n=new Set;for(let r=1;r<=12;r++){const o=await _t(t,r);for(const r of o){const o=`${t}::${r.label}::${r.href||""}`;n.has(o)||(n.add(o),e.push(r))}}return e.sort((t,e)=>t.ts-e.ts),e}async function At(t){wt(t);const e=lt.read(t);e?.events?.length&&Ct(t,e.events);const n=await xt(t);return!e||!pt(t,e.events,n)?(Ct(t,n),lt.write(t,dt(n))):lt.touch(t),qt(t),vt(t)}function qt(t){const e=ct.get(t);e&&clearTimeout(e);const n=setTimeout(async()=>{try{if(!ut.active)return;await async function(t){if(!vt(t))return;if(!lt.isStale(t))return;const e=lt.read(t),n=await xt(t);e&&pt(t,e.events,n)?lt.touch(t):(Ct(t,n),lt.write(t,dt(n)))}(t)}finally{}},lt.ttlMs);ct.set(t,n)}function kt(){const t=bt();wt(t);const e=Et(document).filter(e=>e.year===t),n=function(t){const e=new Set,n=vt(t);if(!n)return e;const r=ft(n,st);if(!r)return e;let o=null;for(const n of Array.from(r.children))if("DT"===n.tagName)o=n.textContent.trim();else if("DD"===n.tagName&&o){const r=n.querySelector("a")?.getAttribute("href")||"";e.add(St(t,o,r))}return e}(t);!function(t,e,n){if(!e.length)return;const r=ft(wt(t),"article"),o=document.createElement("dl");for(const r of e){const e=St(t,r.label,r.href);if(console.log(r),n.has(e))continue;n.add(e);const s=document.createElement("dt");s.textContent=r.label;const a=document.createElement("dd");if(r.href){const t=document.createElement("a");t.href=r.href,t.textContent=r.title||r.href,a.appendChild(t)}else a.textContent=r.title||"—";o.append(s,a)}o.childNodes.length&&r.appendChild(o)}(t,e,n),lt.write(t,dt(e)),qt(t)}async function $t(){kt(),await async function(){let t=0,e=bt()-1;for(;t<it;){const n=await At(e);if(t++,n&&n.getBoundingClientRect().bottom>window.innerHeight-20)break;e--}}()}const Tt={url:null,data:null,selector:"dfn[data-def],dfn[title]",container:"#faq-dfn",position:"anchor",anchorPlacement:"top",anchorOffset:0,hashParam:null,observeBarba:!0,prefetchOnHover:!0,hoverDelay:80},Ft={opts:{...Tt},dict:null,aside:null,backdrop:null,content:null,isOpen:!1,lastTrigger:null,focusBeforeOpen:null,hoverTimer:null},Nt=(...t)=>1===t.length?document.querySelector(t[0]):t[0]?.querySelector?.(t[1]),jt=(...t)=>1===t.length?Array.from(document.querySelectorAll(t[0])):Array.from(t[0]?.querySelectorAll?.(t[1])||[]),Mt=t=>{if(!t)return{};if(Array.isArray(t)){const e={};return t.forEach(t=>{t&&t.key&&(e[String(t.key)]=t)}),e}return t},It=t=>{if(!Ft.aside||!t||"anchor"!==Ft.opts.position)return;Ft.aside.classList.add("anchored");(()=>{const t=Ft.opts.container;return t&&t.nodeType?t:"string"==typeof t?Nt(t):document.body})().getBoundingClientRect();const e=t.getBoundingClientRect(),n=t.parentElement.getBoundingClientRect(),r=Ft.aside.getBoundingClientRect(),o=Ft.aside.offsetParent.getBoundingClientRect(),s=e.top-o.top-n.height;e.right,o.left,Ft.opts.anchorOffset,e.bottom,o.top,e.height,r.height,e.left,o.left,r.width,Ft.opts.anchorOffset;Ft.aside.style.top=`${s}px`},Bt=async()=>{if(Ft.dict)return Ft.dict;const{url:t,data:e}=Ft.opts;if(t){const e=await fetch(t,{cache:"no-store",credentials:"same-origin"});if(!e.ok)throw new Error("Glossary JSON HTTP "+e.status);Ft.dict=Mt(await e.json())}else Ft.dict=e?Mt(e):{};return console.log(Ft),Ft.dict},Dt=(t="")=>t.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])),Ot=t=>{if(!Ft.isOpen)return;const e=jt(Ft.aside,'button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])').filter(t=>!t.hasAttribute("disabled"));if(!e.length)return;const n=e[0],r=e[e.length-1];"Tab"===t.key?t.shiftKey&&document.activeElement===n?(t.preventDefault(),r.focus()):t.shiftKey||document.activeElement!==r||(t.preventDefault(),n.focus()):"Escape"===t.key&&zt()},Pt=()=>{if(Ft.aside)return;const t=document.createElement("aside");t.className="glossary-aside",t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),t.setAttribute("aria-labelledby","glossary-title");const e=document.createElement("div");e.className="glossary-backdrop",t.innerHTML='\n    <header class="glossary-header">\n        <h3 id="glossary-title"></h3>\n        <button class="glossary-close btn" aria-label="Fermer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-icon lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg></button>\n    </header>\n    <div class="glossary-body" id="glossary-body" tabindex="-1"></div>\n    <footer class="glossary-footer" hidden></footer>\n  ',Nt(Ft.opts.container).appendChild(e),Nt(Ft.opts.container).appendChild(t),Ft.aside=t,Ft.backdrop=e,Ft.content=Nt(Ft.aside,"#glossary-body"),e.addEventListener("click",zt),Nt(Ft.aside,".glossary-close").addEventListener("click",zt),document.addEventListener("keydown",Ot,!0)},Rt=(t,e)=>{const n=e.title||t,r=e.short?`<p class="glossary-short">${e.short}</p>`:"",o=e.long?`<div class="glossary-long">${e.long}</div>`:"",s=Array.isArray(e.tags)&&e.tags.length?`<ul class="glossary-tags">${e.tags.map(t=>`<li>#${Dt(String(t))}</li>`).join("")}</ul>`:"",a=Array.isArray(e.links)&&e.links.length?`<ul class="glossary-links">${e.links.map(t=>`<li><a target="_blank" rel="noopener" href="${Dt(t.href)}">${Dt(t.label||t.href)}</a></li>`).join("")}</ul>`:"";Nt(Ft.aside,"#glossary-title").textContent=n,Ft.content.innerHTML=`${r}${o}${s}${a}`,Ft.aside.dispatchEvent(new CustomEvent("glossary:render",{detail:{key:t,entry:e}}))},Ht=async(t,e)=>{Ft.focusBeforeOpen=document.activeElement,Ft.lastTrigger=e||null,Pt();const n=(await Bt().catch(t=>(console.error("[Glossary] JSON error",t),{})))[t]||null;Rt(t,n||{title:t}),requestAnimationFrame(()=>It(e)),Ft.aside.classList.add("open"),Ft.backdrop.classList.add("open"),Ft.isOpen=!0;const r=Nt(Ft.aside,"#glossary-body")||Nt(Ft.aside,".glossary-close");if(requestAnimationFrame(()=>r&&r.focus()),Ft.opts.hashParam){const e=new URL(location.href);e.hash=`${Ft.opts.hashParam}=${encodeURIComponent(t)}`,history.replaceState(null,"",e.toString())}Ft._reflow=()=>It(Ft.lastTrigger),window.addEventListener("resize",Ft._reflow),window.addEventListener("scroll",Ft._reflow,!0),Ft.aside.dispatchEvent(new CustomEvent("glossary:open",{detail:{key:t,entry:n}}))},zt=()=>{if(!Ft.isOpen)return;if(Ft.aside.classList.remove("open"),Ft.backdrop.classList.remove("open"),Ft.isOpen=!1,Ft.opts.hashParam&&location.hash.includes(Ft.opts.hashParam+"=")){const t=new URL(location.href);t.hash="",history.replaceState(null,"",t.toString())}const t=Ft.lastTrigger||Ft.focusBeforeOpen;t&&"function"==typeof t.focus&&t.focus(),Ft.aside.dispatchEvent(new CustomEvent("glossary:close"))},Ut=t=>{t.preventDefault();const e=t.currentTarget,n=e.getAttribute("data-def")||e.getAttribute("title");e.getAttribute("title")&&(e.removeAttribute("title"),e.setAttribute("data-def",n)),n&&Ht(n,e)},Jt=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.currentTarget.click())},Wt=t=>{if(t.__glBound)return;console.log(t),t.__glBound=!0,t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.addEventListener("click",Ut),t.addEventListener("keydown",Jt);const e=t.getAttribute("data-def")||t.getAttribute("title");t.getAttribute("title")&&(t.removeAttribute("title"),t.setAttribute("data-def",e)),Ft.opts.prefetchOnHover&&Ft.opts.url&&(t.addEventListener("mouseenter",()=>{clearTimeout(Ft.hoverTimer),Ft.hoverTimer=setTimeout(()=>{Bt().catch(t=>{console.warn(t)})},Ft.opts.hoverDelay)}),t.addEventListener("mouseleave",()=>clearTimeout(Ft.hoverTimer)))},Yt=(t=document)=>{console.log(jt(t,Ft.opts.selector)),jt(t,Ft.opts.selector).forEach(Wt)},Zt={init:(t={})=>(Ft.opts={...Tt,...t},Pt(),Yt(document),(()=>{if(!Ft.opts.hashParam)return;const t=(location.hash||"").slice(1),[e,n]=t.split("=");e===Ft.opts.hashParam&&n&&Ht(decodeURIComponent(n))})(),console.log("[Glossary] initialized",Ft),Ft.opts.observeBarba&&"addEventListener"in document&&document.addEventListener("barba:after",()=>Yt(document)),{open:Ht,close:zt,scan:Yt}),open:Ht,close:zt,scan:Yt},Qt="notepad",Xt=document.getElementById("js-notepad"),Gt=localStorage.getItem(Qt)||"";class Kt{constructor(){Xt&&(Xt.value=Gt),Xt.addEventListener("input",function(){localStorage.setItem(Qt,this.value)})}}function Vt(){document.querySelectorAll('div[style^="height:"').forEach(t=>t.remove()),t.container=document.querySelector('section[data-barba="container"]')||document;const e=c.init();return new Kt,function(){const t=H({animations:{mapAnimation:x}});window.barba?.hooks&&barba.hooks.beforeLeave(()=>{try{t.close()}catch{}}),Z()}(),F("register",{afterEnter:async()=>function(t=document){try{const e=t.querySelector("#registerIframe");if(!e)return;e.removeEventListener("load",I),e.addEventListener("load",I)}catch(t){console.log("RegisterScripts:",t)}}()}),F("topic",{afterEnter:async({next:t})=>{B(t.container),V(t.container)}}),F("faq",{afterEnter:async({next:t})=>{Q(t.container),V(t.container),Zt.init({url:"http://127.0.0.1:8080/faq.json"})}}),F("calendar",{afterEnter:async({next:t})=>{await $t(t.container)}}),console.debug("[barba] registered ns hooks:",Array.from(T.keys())),N({cursor:e}),{Context:t,cursor:e}}document.addEventListener("DOMContentLoaded",()=>{Vt()})}();
//# sourceMappingURL=hebe.js.map
